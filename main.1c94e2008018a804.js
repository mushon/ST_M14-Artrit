(self.webpackChunkspeculatron=self.webpackChunkspeculatron||[]).push([[179],{89:(Ft,At,Ne)=>{"use strict";var $e=Ne(95),Ue=Ne(703),d="\n  ",W={};function Te(_t){var le=Array.isArray(_t);return function(Le){var xe=Me(W.plainArray,Le);if(xe)return xe;if(le&&Le.length!==_t.length)return"an array with "+_t.length+" items";for(var Xe=0;Xe<Le.length;Xe++)if(xe=Me(le?_t[Xe]:_t,Le[Xe]))return[Xe].concat(xe)}}function Me(_t,le){if(null!=le||_t.hasOwnProperty("__required")){var Be=_t(le);if(Be)return Array.isArray(Be)?Be:[Be]}}function ce(_t,le){var Be=_t.length,je=_t[Be-1],Le=_t.slice(0,Be-1);return 0===Le.length&&(Le=["value"]),le=Ue(le,{path:Le}),"function"==typeof je?je(le):tt(le,function lt(_t){return"must be "+function $t(_t){return/^an? /.test(_t)?_t:/^[aeiou]/i.test(_t)?"an "+_t:/^[a-z]/i.test(_t)?"a "+_t:_t}(_t)+"."}(je))}function De(_t){return _t.length<2?_t[0]:2===_t.length?_t.join(" or "):_t.slice(0,-1).join(", ")+", or "+_t.slice(-1)}function tt(_t,le){return(Mt(_t.path)?"Item at position ":"")+_t.path.join(".")+" "+le}function Mt(_t){return"number"==typeof _t[_t.length-1]||"number"==typeof _t[0]}W.assert=function(_t,le){return le=le||{},function(Be){var je=Me(_t,Be);if(je){var Le=ce(je,le);throw le.apiName&&(Le=le.apiName+": "+Le),new Error(Le)}}},W.shape=function(le){var Be=function vt(_t){return Object.keys(_t||{}).map(function(le){return{key:le,value:_t[le]}})}(le);return function(Le){var xe=Me(W.plainObject,Le);if(xe)return xe;for(var Xe,He=[],zt=0;zt<Be.length;zt++)(xe=Me(Be[zt].value,Le[Xe=Be[zt].key]))&&He.push([Xe].concat(xe));return He.length<2?He[0]:function(tn){He=He.map(function(Pt){return"- "+Pt[0]+": "+ce(Pt,tn).split("\n").join(d)});var Wt=tn.path.join(".");return"The following properties"+("value"===Wt?"":" of "+Wt)+" have invalid values:"+d+He.join(d)}}},W.strictShape=function(le){var Be=W.shape(le);return function(Le){var xe=Be(Le);if(xe)return xe;var Xe=Object.keys(Le).reduce(function(st,He){return void 0===le[He]&&st.push(He),st},[]);return 0!==Xe.length?function(){return"The following keys are invalid: "+Xe.join(", ")}:void 0}},W.arrayOf=function(le){return Te(le)},W.tuple=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Te(le)},W.required=function(le){function Be(je){return null==je?function(Le){return tt(Le,Mt(Le.path)?"cannot be undefined/null.":"is required.")}:le.apply(this,arguments)}return Be.__required=!0,Be},W.oneOfType=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(je){var Le=le.map(function(xe){return Me(xe,je)}).filter(Boolean);if(Le.length===le.length)return Le.every(function(xe){return 1===xe.length&&"string"==typeof xe[0]})?De(Le.map(function(xe){return xe[0]})):Le.reduce(function(xe,Xe){return Xe.length>xe.length?Xe:xe})}},W.equal=function(le){return function(je){if(je!==le)return JSON.stringify(le)}},W.oneOf=function(){var le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),Be=le.map(function(je){return W.equal(je)});return W.oneOfType.apply(this,Be)},W.range=function(le){var Be=le[0],je=le[1];return function(xe){if(Me(W.number,xe)||xe<Be||xe>je)return"number between "+Be+" & "+je+" (inclusive)"}},W.any=function(){},W.boolean=function(le){if("boolean"!=typeof le)return"boolean"},W.number=function(le){if("number"!=typeof le)return"number"},W.plainArray=function(le){if(!Array.isArray(le))return"array"},W.plainObject=function(le){if(!$e(le))return"object"},W.string=function(le){if("string"!=typeof le)return"string"},W.func=function(le){if("function"!=typeof le)return"function"},W.validate=Me,W.processMessage=ce,Ft.exports=W},95:Ft=>{"use strict";var At=Object.prototype.toString;Ft.exports=function(Ne){var $e;return"[object Object]"===At.call(Ne)&&(null===($e=Object.getPrototypeOf(Ne))||$e===Object.getPrototypeOf({}))}},564:(Ft,At,Ne)=>{"use strict";var $e=Ne(652).x0;function Ue(be){this.origin=be.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=be.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=be,this.send=this.send.bind(this),this.countries=be.countries?be.countries.split(","):null,this.types=be.types?be.types.split(","):null,this.bbox=be.bbox?be.bbox:null,this.language=be.language?be.language.split(","):null,this.limit=be.limit?+be.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(be),this.eventQueue=new Array,this.flushInterval=be.flushInterval||1e3,this.maxQueueSize=be.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Ue.prototype={select:function(be,d){var W=this.getSelectedIndex(be,d),Te=this.getEventPayload("search.select",d);if(Te.resultIndex=W,Te.resultPlaceName=be.place_name,Te.resultId=be.id,(W!==this.lastSentIndex||Te.queryString!==this.lastSentInput)&&-1!=W&&(this.lastSentIndex=W,this.lastSentInput=Te.queryString,Te.queryString))return this.push(Te)},start:function(be){var d=this.getEventPayload("search.start",be);if(d.queryString)return this.push(d)},keyevent:function(be,d){if(be.key&&!be.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(be.keyCode)){var W=this.getEventPayload("search.keystroke",d);if(W.lastAction=be.key,W.queryString)return this.push(W)}},send:function(be,d){if(!this.enableEventLogging)return d?d():void 0;var W=this.getRequestOptions(be);this.request(W,function(Te){return Te?this.handleError(Te,d):d?d():void 0}.bind(this))},getRequestOptions:function(be){return Array.isArray(be)||(be=[be]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(be)}},getEventPayload:function(be,d){var W;W=d.options.proximity?"object"==typeof d.options.proximity?[d.options.proximity.longitude,d.options.proximity.latitude]:"ip"===d.options.proximity?[999,999]:d.options.proximity:null;var Te=d._map?d._map.getZoom():void 0,Me={event:be,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:d.options.autocomplete,fuzzyMatch:d.options.fuzzyMatch,proximity:W,limit:d.options.limit,routing:d.options.routing,worldview:d.options.worldview,mapZoom:Te,keyboardLocale:this.locale};return Me.queryString="search.select"===be?d.inputString:"search.select"!=be&&d._inputEl?d._inputEl.value:d.inputString,Me},request:function(be,d){var W=new XMLHttpRequest;for(var Te in W.onreadystatechange=function(){if(4==this.readyState)return d(204==this.status?null:this.statusText)},W.open(be.method,be.host+"/"+be.path,!0),be.headers)W.setRequestHeader(Te,be.headers[Te]);W.send(be.body)},handleError:function(be,d){if(d)return d(be)},generateSessionID:function(){return $e()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(be,d){if(d._typeahead){var Te=be.id;return d._typeahead.data.map(function(De){return De.id}).indexOf(Te)}},shouldEnableLogging:function(be){return!(!1===be.enableEventLogging||be.origin&&"https://api.mapbox.com"!==be.origin||be.localGeocoder||be.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(be,d){this.eventQueue.push(be),(this.eventQueue.length>=this.maxQueueSize||d)&&this.flush()},remove:function(){this.flush()}},Ft.exports=Ue},424:Ft=>{Ft.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},569:Ft=>{function At(){}At.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const Ne={enableHighAccuracy:!0};return new Promise(function($e,Ue){window.navigator.geolocation.getCurrentPosition($e,Ue,Ne)})}},Ft.exports=At},545:(Ft,At,Ne)=>{"use strict";var $e=Ne(562),Ue=Ne(82),be=Ne(703),d=Ne(69).EventEmitter,W=Ne(424),Te=Ne(471),Me=Ne(75),ce=Ne(564),De=Ne(234),lt=Ne(775),$t=Ne(569),tt=Ne(777);function _t(le){this._eventEmitter=new d,this.options=be({},this.options,le),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new $t}_t.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(le){return le.place_name},render:function(le){var Be=le.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Be[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Be.splice(1,Be.length).join(",")+"</div></div>"}},addTo:function(le){function Be(je,Le){if(!document.body.contains(Le))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const xe=je.onAdd();Le.appendChild(xe)}if(le._controlContainer)le.addControl(this);else if(le instanceof HTMLElement)Be(this,le);else{if("string"!=typeof le)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const je=document.querySelectorAll(le);if(0===je.length)throw new Error("Element ",le,"not found.");if(je.length>1)throw new Error("Geocoder can only be added to a single html element");Be(this,je[0])}}},onAdd:function(le){if(le&&"string"!=typeof le&&(this._map=le),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Me(Te({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ce(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var Be=this.container=document.createElement("div");Be.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var je=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ue(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(tn){this.eventManager.keyevent(tn,this)}.bind(this));var Le=document.createElement("div");Le.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var xe=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(xe),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Le.appendChild(this._clearEl),Le.appendChild(this._loadingEl),Be.appendChild(je),Be.appendChild(this._inputEl),Be.appendChild(Le),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Xe=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Xe),Le.appendChild(this._geolocateEl),this._showGeolocateButton()}var st=this._typeahead=new $e(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),st.getItemValue=this.options.getItemValue;var He=st.list.draw,zt=this._footerNode=function vt(){var le=document.createElement("div");return le.className="mapboxgl-ctrl-geocoder--powered-by",le.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',le}();return st.list.draw=function(){He.call(this),zt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),zt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(zt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Be},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(le){this._hideLoadingIcon();const Be={geometry:{type:"Point",coordinates:[le.coords.longitude,le.coords.latitude]}};this._handleMarker(Be),this._fly(Be),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(Be),this._showClearButton(),this.fresh=!1;const je={limit:1,language:[this.options.language],query:Be.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(Be.geometry.coordinates[0]+","+Be.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:Be})):this.geocoderService.reverseGeocode(je).send().then(function(Le){const xe=Le.body.features[0];if(xe){const Xe=tt.transformFeatureToGeolocationText(xe,this.options.addressAccuracy);this._setInputValue(Xe),xe.user_coordinates=Be.geometry.coordinates,this._eventEmitter.emit("result",{result:xe})}else this._eventEmitter.emit("result",{result:{user_coordinates:Be.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(le){1===le.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(le,Be){var je=document.createElementNS("http://www.w3.org/2000/svg","svg");return je.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+le),je.setAttribute("viewBox","0 0 18 18"),je.setAttribute("xml:space","preserve"),je.setAttribute("width",18),je.setAttribute("height",18),je.innerHTML=Be,je},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(le){this._inputEl.value=le,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(le){var Be=(le.clipboardData||window.clipboardData).getData("text");Be.length>=this.options.minLength&&this._geocode(Be)},_onKeyDown:function(le){var Be=27,je=9;if(le.keyCode===Be&&this.options.clearAndBlurOnEsc)return this._clear(le),this._inputEl.blur();var Le=le.target&&le.target.shadowRoot?le.target.shadowRoot.activeElement:le.target;if(!Le||!Le.value)return this.fresh=!0,le.keyCode!==je&&this.clear(le),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!le.metaKey&&-1===[je,Be,37,39,13,38,40].indexOf(le.keyCode)&&Le.value.length>=this.options.minLength&&this._geocode(Le.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(le){this.options.clearOnBlur&&this._clearOnBlur(le),this.options.collapsed&&this._collapse()},_onChange:function(){var le=this._typeahead.selected;le&&JSON.stringify(le)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(le),this.options.marker&&this._mapboxgl&&this._handleMarker(le),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(le),this._eventEmitter.emit("result",{result:le}),this.eventManager.select(le,this))},_fly:function(le){var Be;if(le.properties&&W[le.properties.short_code])Be=be({},this.options.flyTo),this._map&&this._map.fitBounds(W[le.properties.short_code].bbox,Be);else if(le.bbox){var je=le.bbox;Be=be({},this.options.flyTo),this._map&&this._map.fitBounds([[je[0],je[1]],[je[2],je[3]]],Be)}else Be=be({},{zoom:this.options.zoom},this.options.flyTo),le.center?Be.center=le.center:le.geometry&&le.geometry.type&&"Point"===le.geometry.type&&le.geometry.coordinates&&(Be.center=le.geometry.coordinates),this._map&&this._map.flyTo(Be)},_requestType:function(le,Be){return le.localGeocoderOnly?1:le.reverseGeocode&&tt.REVERSE_GEOCODE_COORD_RGX.test(Be)?2:0},_setupConfig:function(le,Be){const Le=/[\s,]+/;var xe=this,Xe=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(He,zt){return null==xe.options[zt]||(He[zt]=["countries","types","language"].indexOf(zt)>-1?xe.options[zt].split(Le):xe.options[zt],"proximity"===zt&&"number"==typeof xe.options[zt].longitude&&"number"==typeof xe.options[zt].latitude&&(He[zt]=[xe.options[zt].longitude,xe.options[zt].latitude])),He},{});switch(le){case 2:var st=Be.split(Le).map(function(He){return parseFloat(He,10)});xe.options.flipCoordinates||st.reverse(),Xe=be(Xe,{query:st,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(He){He in Xe&&delete Xe[He]});break;case 0:{const He=Be.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(He)&&(Be=Be.replace(/,/g," ")),Xe=be(Xe,{query:Be})}}return Xe},_geocode:function(le){this.inputString=le,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:le});const Be=this._requestType(this.options,le),je=this._setupConfig(Be,le);var Le;switch(Be){case 1:Le=Promise.resolve();break;case 0:Le=this.geocoderService.forwardGeocode(je).send();break;case 2:Le=this.geocoderService.reverseGeocode(je).send()}var xe=this.options.localGeocoder&&this.options.localGeocoder(le)||[],Xe=[],st=null;return Le.catch(function(He){st=He}.bind(this)).then(function(He){this._hideLoadingIcon();var zt={};return He?"200"==He.statusCode&&((zt=He.body).request=He.request,zt.headers=He.headers):zt={type:"FeatureCollection",features:[]},zt.config=je,this.fresh&&(this.eventManager.start(this),this.fresh=!1),zt.features=zt.features?xe.concat(zt.features):xe,this.options.externalGeocoder?(Xe=this.options.externalGeocoder(le,zt.features)||Promise.resolve([])).then(function(tn){return zt.features=zt.features?tn.concat(zt.features):tn,zt},function(){return zt}):zt}.bind(this)).then(function(He){if(st)throw st;this.options.filter&&He.features.length&&(He.features=He.features.filter(this.options.filter)),He.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",He),this._typeahead.update(He.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",He))}.bind(this)).catch(function(He){this._hideLoadingIcon(),this._hideAttribution(),xe.length&&this.options.localGeocoder||Xe.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(xe)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:xe}),this._eventEmitter.emit("error",{error:He})}.bind(this)),Le},_clear:function(le){le&&le.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(le){this._clear(le),this._inputEl.focus()},_clearOnBlur:function(le){le.relatedTarget&&this._clear(le)},_onQueryResult:function(le){var Be=le.body;if(Be.features.length){var je=Be.features[0];this._typeahead.selected=je,this._inputEl.value=je.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var le=this._map.getCenter().wrap();this.setProximity({longitude:le.lng,latitude:le.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(le){return this._geocode(le).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(le){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(le)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var le=this.options.language.split(",")[0],Be=lt.language(le),je=De.placeholder[Be];if(je)return je}return"Search"},setInput:function(le){return this._inputEl.value=le,this._typeahead.selected=null,this._typeahead.clear(),le.length>=this.options.minLength&&this._geocode(le),this},setProximity:function(le,Be=!0){return this.options.proximity=le,Be&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(le){return le&&"function"==typeof le&&(this._typeahead.render=le),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(le){var Be=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=le||this.options.language||Be,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(le){return this.options.zoom=le,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(le){return this.options.flyTo=le,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(le){return this.placeholder=le||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(le){return this.options.bbox=le,this},getCountries:function(){return this.options.countries},setCountries:function(le){return this.options.countries=le,this},getTypes:function(){return this.options.types},setTypes:function(le){return this.options.types=le,this},getMinLength:function(){return this.options.minLength},setMinLength:function(le){return this.options.minLength=le,this._typeahead&&(this._typeahead.options.minLength=le),this},getLimit:function(){return this.options.limit},setLimit:function(le){return this.options.limit=le,this._typeahead&&(this._typeahead.options.limit=le),this},getFilter:function(){return this.options.filter},setFilter:function(le){return this.options.filter=le,this},setOrigin:function(le){return this.options.origin=le,this.geocoderService=Me(Te({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(le){return this.options.accessToken=le,this.geocoderService=Me(Te({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(le){return this.options.autocomplete=le,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(le){return this.options.fuzzyMatch=le,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(le){return this.options.routing=le,this},getRouting:function(){return this.options.routing},setWorldview:function(le){return this.options.worldview=le,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(le){if(this._map){this._removeMarker();var je=be({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(je),le.center?this.mapMarker.setLngLat(le.center).addTo(this._map):le.geometry&&le.geometry.type&&"Point"===le.geometry.type&&le.geometry.coordinates&&this.mapMarker.setLngLat(le.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(le,Be){return this._eventEmitter.on(le,Be),this},off:function(le,Be){return this._eventEmitter.removeListener(le,Be),this.eventManager.remove(),this}},Ft.exports=_t},234:Ft=>{"use strict";Ft.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},777:Ft=>{function Ne(Ue){const be=Ue.address||"",d=Ue.text||"",W=Ue.place_name||"",Me={address:W.split(",")[0],houseNumber:be,street:d,placeName:W};return Ue.context.forEach(function(ce){const De=ce.id.split(".")[0];Me[De]=ce.text}),Me}Ft.exports={transformFeatureToGeolocationText:function At(Ue,be){const d=Ne(Ue),W=["address","street","place","country"];if("function"==typeof be)return be(d);const Me=W.indexOf(be);return(-1===Me?W:W.slice(Me)).reduce(function(ce,De){return d[De]?(""!==ce&&(ce+=", "),ce+d[De]):ce},"")},getAddressInfo:Ne,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},471:(Ft,At,Ne)=>{"use strict";var $e=Ne(454);Ft.exports=$e},454:(Ft,At,Ne)=>{"use strict";var $e=Ne(753),Ue=Ne(176);function be(W){Ue.call(this,W)}(be.prototype=Object.create(Ue.prototype)).constructor=be,be.prototype.sendRequest=$e.browserSend,be.prototype.abortRequest=$e.browserAbort,Ft.exports=function d(W){return new be(W)}},753:(Ft,At,Ne)=>{"use strict";var $e=Ne(332),Ue=Ne(158),be=Ne(719),d=Ne(829),W={};function ce(tt){var Mt=tt.total,vt=tt.loaded;return{total:Mt,transferred:vt,percent:100*vt/Mt}}function De(tt,Mt){return new Promise(function(vt,_t){Mt.onprogress=function(je){tt.emitter.emit(be.EVENT_PROGRESS_DOWNLOAD,ce(je))};var le=tt.file;le&&(Mt.upload.onprogress=function(je){tt.emitter.emit(be.EVENT_PROGRESS_UPLOAD,ce(je))}),Mt.onerror=function(je){_t(je)},Mt.onabort=function(){var je=new Ue({request:tt,type:be.ERROR_REQUEST_ABORTED});_t(je)},Mt.onload=function(){if(delete W[tt.id],Mt.status<200||Mt.status>=400){var je=new Ue({request:tt,body:Mt.response,statusCode:Mt.status});_t(je)}else vt(Mt)};var Be=tt.body;"string"==typeof Be?Mt.send(Be):Be?Mt.send(JSON.stringify(Be)):le?Mt.send(le):Mt.send(),W[tt.id]=Mt}).then(function(vt){return function Me(tt,Mt){return new $e(tt,{body:Mt.response,headers:d(Mt.getAllResponseHeaders()),statusCode:Mt.status})}(tt,vt)})}function lt(tt,Mt){var vt=tt.url(Mt),_t=new window.XMLHttpRequest;return _t.open(tt.method,vt),Object.keys(tt.headers).forEach(function(le){_t.setRequestHeader(le,tt.headers[le])}),_t}Ft.exports={browserAbort:function Te(tt){var Mt=W[tt.id];!Mt||(Mt.abort(),delete W[tt.id])},sendRequestXhr:De,browserSend:function $t(tt){return Promise.resolve().then(function(){var Mt=lt(tt,tt.client.accessToken);return De(tt,Mt)})},createRequestXhr:lt}},176:(Ft,At,Ne)=>{"use strict";var $e=Ne(129),Ue=Ne(538),be=Ne(719);function d(W){if(!W||!W.accessToken)throw new Error("Cannot create a client without an access token");$e(W.accessToken),this.accessToken=W.accessToken,this.origin=W.origin||be.API_ORIGIN}d.prototype.createRequest=function(Te){return new Ue(this,Te)},Ft.exports=d},158:(Ft,At,Ne)=>{"use strict";var $e=Ne(719);Ft.exports=function Ue(be){var W,d=be.type||$e.ERROR_HTTP;if(be.body)try{W=JSON.parse(be.body)}catch{W=be.body}else W=null;var Te=be.message||null;Te||("string"==typeof W?Te=W:W&&"string"==typeof W.message?Te=W.message:d===$e.ERROR_REQUEST_ABORTED&&(Te="Request aborted")),this.message=Te,this.type=d,this.statusCode=be.statusCode||null,this.request=be.request,this.body=W}},538:(Ft,At,Ne)=>{"use strict";var $e=Ne(129),Ue=Ne(703),be=Ne(661),d=Ne(449),W=Ne(719),Te=1;function Me(ce,De){if(!ce)throw new Error("MapiRequest requires a client");if(!De||!De.path||!De.method)throw new Error("MapiRequest requires an options object with path and method properties");var lt={};De.body&&(lt["content-type"]="application/json");var $t=Ue(lt,De.headers),tt=Object.keys($t).reduce(function(Mt,vt){return Mt[vt.toLowerCase()]=$t[vt],Mt},{});this.id=Te++,this._options=De,this.emitter=new be,this.client=ce,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=De.path,this.method=De.method,this.origin=De.origin||ce.origin,this.query=De.query||{},this.params=De.params||{},this.body=De.body||null,this.file=De.file||null,this.encoding=De.encoding||"utf8",this.sendFileAs=De.sendFileAs||null,this.headers=tt}Me.prototype.url=function(De){var lt=d.prependOrigin(this.path,this.origin);lt=d.appendQueryObject(lt,this.query);var $t=this.params,tt=De??this.client.accessToken;if(tt){lt=d.appendQueryParam(lt,"access_token",tt);var Mt=$e(tt).user;$t=Ue({ownerId:Mt},$t)}return d.interpolateRouteParams(lt,$t)},Me.prototype.send=function(){var De=this;if(De.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return De.sent=!0,De.client.sendRequest(De).then(function(lt){return De.response=lt,De.emitter.emit(W.EVENT_RESPONSE,lt),lt},function(lt){throw De.error=lt,De.emitter.emit(W.EVENT_ERROR,lt),lt})},Me.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Me.prototype.eachPage=function(De){var lt=this;function $t(vt){De(null,vt,function _t(){delete lt._nextPageRequest;var le=vt.nextPage();le&&(lt._nextPageRequest=le,Mt(le))})}function tt(vt){De(vt,null,function(){})}function Mt(vt){vt.send().then($t,tt)}Mt(this)},Me.prototype.clone=function(){return this._extend()},Me.prototype._extend=function(De){var lt=Ue(this._options,De);return new Me(this.client,lt)},Ft.exports=Me},332:(Ft,At,Ne)=>{"use strict";var $e=Ne(699);function Ue(be,d){this.request=be,this.headers=d.headers,this.rawBody=d.body,this.statusCode=d.statusCode;try{this.body=JSON.parse(d.body||"{}")}catch{this.body=d.body}this.links=$e(this.headers.link)}Ue.prototype.hasNextPage=function(){return!!this.links.next},Ue.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Ft.exports=Ue},719:Ft=>{"use strict";Ft.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},829:Ft=>{"use strict";Ft.exports=function Ne($e){var Ue={};return $e&&$e.trim().split(/[\r|\n]+/).forEach(function(be){var d=function At($e){var Ue=$e.indexOf(":");return{name:$e.substring(0,Ue).trim().toLowerCase(),value:$e.substring(Ue+1).trim()}}(be);Ue[d.name]=d.value}),Ue}},699:Ft=>{"use strict";Ft.exports=function $e(Ue){return Ue?Ue.split(/,\s*</).reduce(function(be,d){var W=function Ne(Ue){var be=Ue.match(/<?([^>]*)>(.*)/);if(!be)return null;var d=be[1],W=be[2].split(";"),Te=null,Me=W.reduce(function(ce,De){var lt=function At(Ue){var be=Ue.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return be?{key:be[1],value:be[2]}:null}(De);return lt?"rel"===lt.key?(Te||(Te=lt.value),ce):(ce[lt.key]=lt.value,ce):ce},{});return Te?{url:d,rel:Te,params:Me}:null}(d);return W?(W.rel.split(/\s+/).forEach(function(Me){be[Me]||(be[Me]={url:W.url,params:W.params})}),be):be},{}):{}}},449:Ft=>{"use strict";function Ne(W){return Array.isArray(W)?function At(W){return W.map(encodeURIComponent).join(",")}(W):encodeURIComponent(String(W))}function $e(W,Te,Me){if(!1===Me||null===Me)return W;var ce=/\?/.test(W)?"&":"?",De=encodeURIComponent(Te);return void 0!==Me&&""!==Me&&!0!==Me&&(De+="="+Ne(Me)),""+W+ce+De}Ft.exports={appendQueryObject:function Ue(W,Te){if(!Te)return W;var Me=W;return Object.keys(Te).forEach(function(ce){var De=Te[ce];void 0!==De&&(Array.isArray(De)&&(De=De.filter(function(lt){return null!=lt}).join(",")),Me=$e(Me,ce,De))}),Me},appendQueryParam:$e,prependOrigin:function be(W,Te){if(!Te||"http"===W.slice(0,4))return W;var Me="/"===W[0]?"":"/";return""+Te.replace(/\/$/,"")+Me+W},interpolateRouteParams:function d(W,Te){return Te?W.replace(/\/:([a-zA-Z0-9]+)/g,function(Me,ce){var De=Te[ce];if(void 0===De)throw new Error("Unspecified route parameter "+ce);return"/"+Ne(De)}):W}}},661:Ft=>{"use strict";var At=Object.prototype.hasOwnProperty,Ne="~";function $e(){}function Ue(Te,Me,ce){this.fn=Te,this.context=Me,this.once=ce||!1}function be(Te,Me,ce,De,lt){if("function"!=typeof ce)throw new TypeError("The listener must be a function");var $t=new Ue(ce,De||Te,lt),tt=Ne?Ne+Me:Me;return Te._events[tt]?Te._events[tt].fn?Te._events[tt]=[Te._events[tt],$t]:Te._events[tt].push($t):(Te._events[tt]=$t,Te._eventsCount++),Te}function d(Te,Me){0==--Te._eventsCount?Te._events=new $e:delete Te._events[Me]}function W(){this._events=new $e,this._eventsCount=0}Object.create&&($e.prototype=Object.create(null),(new $e).__proto__||(Ne=!1)),W.prototype.eventNames=function(){var ce,De,Me=[];if(0===this._eventsCount)return Me;for(De in ce=this._events)At.call(ce,De)&&Me.push(Ne?De.slice(1):De);return Object.getOwnPropertySymbols?Me.concat(Object.getOwnPropertySymbols(ce)):Me},W.prototype.listeners=function(Me){var De=this._events[Ne?Ne+Me:Me];if(!De)return[];if(De.fn)return[De.fn];for(var lt=0,$t=De.length,tt=new Array($t);lt<$t;lt++)tt[lt]=De[lt].fn;return tt},W.prototype.listenerCount=function(Me){var De=this._events[Ne?Ne+Me:Me];return De?De.fn?1:De.length:0},W.prototype.emit=function(Me,ce,De,lt,$t,tt){var Mt=Ne?Ne+Me:Me;if(!this._events[Mt])return!1;var le,Be,vt=this._events[Mt],_t=arguments.length;if(vt.fn){switch(vt.once&&this.removeListener(Me,vt.fn,void 0,!0),_t){case 1:return vt.fn.call(vt.context),!0;case 2:return vt.fn.call(vt.context,ce),!0;case 3:return vt.fn.call(vt.context,ce,De),!0;case 4:return vt.fn.call(vt.context,ce,De,lt),!0;case 5:return vt.fn.call(vt.context,ce,De,lt,$t),!0;case 6:return vt.fn.call(vt.context,ce,De,lt,$t,tt),!0}for(Be=1,le=new Array(_t-1);Be<_t;Be++)le[Be-1]=arguments[Be];vt.fn.apply(vt.context,le)}else{var Le,je=vt.length;for(Be=0;Be<je;Be++)switch(vt[Be].once&&this.removeListener(Me,vt[Be].fn,void 0,!0),_t){case 1:vt[Be].fn.call(vt[Be].context);break;case 2:vt[Be].fn.call(vt[Be].context,ce);break;case 3:vt[Be].fn.call(vt[Be].context,ce,De);break;case 4:vt[Be].fn.call(vt[Be].context,ce,De,lt);break;default:if(!le)for(Le=1,le=new Array(_t-1);Le<_t;Le++)le[Le-1]=arguments[Le];vt[Be].fn.apply(vt[Be].context,le)}}return!0},W.prototype.on=function(Me,ce,De){return be(this,Me,ce,De,!1)},W.prototype.once=function(Me,ce,De){return be(this,Me,ce,De,!0)},W.prototype.removeListener=function(Me,ce,De,lt){var $t=Ne?Ne+Me:Me;if(!this._events[$t])return this;if(!ce)return d(this,$t),this;var tt=this._events[$t];if(tt.fn)tt.fn===ce&&(!lt||tt.once)&&(!De||tt.context===De)&&d(this,$t);else{for(var Mt=0,vt=[],_t=tt.length;Mt<_t;Mt++)(tt[Mt].fn!==ce||lt&&!tt[Mt].once||De&&tt[Mt].context!==De)&&vt.push(tt[Mt]);vt.length?this._events[$t]=1===vt.length?vt[0]:vt:d(this,$t)}return this},W.prototype.removeAllListeners=function(Me){var ce;return Me?this._events[ce=Ne?Ne+Me:Me]&&d(this,ce):(this._events=new $e,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=Ne,W.EventEmitter=W,Ft.exports=W},75:(Ft,At,Ne)=>{"use strict";var $e=Ne(703),Ue=Ne(801),be=Ne(313),d=Ne(836),W=Ne(497),Te={},Me=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Te.forwardGeocode=function(ce){Ue.assertShape({query:Ue.required(Ue.string),mode:Ue.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ue.arrayOf(Ue.string),proximity:Ue.oneOf(Ue.coordinates,"ip"),types:Ue.arrayOf(Ue.oneOf(Me)),autocomplete:Ue.boolean,bbox:Ue.arrayOf(Ue.number),limit:Ue.number,language:Ue.arrayOf(Ue.string),routing:Ue.boolean,fuzzyMatch:Ue.boolean,worldview:Ue.string})(ce),ce.mode=ce.mode||"mapbox.places";var De=d($e({country:ce.countries},be(ce,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:be(ce,["mode","query"]),query:De})},Te.reverseGeocode=function(ce){Ue.assertShape({query:Ue.required(Ue.coordinates),mode:Ue.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ue.arrayOf(Ue.string),types:Ue.arrayOf(Ue.oneOf(Me)),bbox:Ue.arrayOf(Ue.number),limit:Ue.number,language:Ue.arrayOf(Ue.string),reverseMode:Ue.oneOf("distance","score"),routing:Ue.boolean,worldview:Ue.string})(ce),ce.mode=ce.mode||"mapbox.places";var De=d($e({country:ce.countries},be(ce,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:be(ce,["mode","query"]),query:De})},Ft.exports=W(Te)},497:(Ft,At,Ne)=>{"use strict";var $e=Ne(176),Ue=Ne(454);Ft.exports=function be(d){return function(W){var Te;Te=$e.prototype.isPrototypeOf(W)?W:Ue(W);var Me=Object.create(d);return Me.client=Te,Me}}},621:Ft=>{"use strict";Ft.exports=function At(Ne,$e){return Object.keys(Ne).reduce(function(Ue,be){return Ue[be]=$e(be,Ne[be]),Ue},{})}},313:Ft=>{"use strict";Ft.exports=function At(Ne,$e){var Ue=function(be,d){return-1!==$e.indexOf(be)&&void 0!==d};return"function"==typeof $e&&(Ue=$e),Object.keys(Ne).filter(function(be){return Ue(be,Ne[be])}).reduce(function(be,d){return be[d]=Ne[d],be},{})}},836:(Ft,At,Ne)=>{"use strict";var $e=Ne(621);Ft.exports=function Ue(be){return $e(be,function(d,W){return"boolean"==typeof W?JSON.stringify(W):W})}},801:(Ft,At,Ne)=>{"use strict";var $e=Ne(703),Ue=Ne(89);Ft.exports=$e(Ue,{file:function be(Me){return typeof window<"u"?Me instanceof global.Blob||Me instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Me&&void 0===Me.pipe?"Filename or Readable stream":void 0},date:function W(Me){var ce="date";if("boolean"==typeof Me)return ce;try{var De=new Date(Me);if(De.getTime&&isNaN(De.getTime()))return ce}catch{return ce}},coordinates:function Te(Me){return Ue.tuple(Ue.number,Ue.number)(Me)},assertShape:function d(Me,ce){return Ue.assert(Ue.strictShape(Me),ce)}})},129:(Ft,At,Ne)=>{"use strict";var $e=Ne(49),Ue={};function W(Te,Me){return Object.prototype.hasOwnProperty.call(Te,Me)}Ft.exports=function be(Te){if(Ue[Te])return Ue[Te];var Me=Te.split("."),ce=Me[0],De=Me[1];if(!De)throw new Error("Invalid token");var lt=function d(Te){try{return JSON.parse($e.decode(Te))}catch{throw new Error("Invalid token")}}(De),$t={usage:ce,user:lt.u};return W(lt,"a")&&($t.authorization=lt.a),W(lt,"exp")&&($t.expires=1e3*lt.exp),W(lt,"iat")&&($t.created=1e3*lt.iat),W(lt,"scopes")&&($t.scopes=lt.scopes),W(lt,"client")&&($t.client=lt.client),W(lt,"ll")&&($t.lastLogin=lt.ll),W(lt,"iu")&&($t.impersonator=lt.iu),Ue[Te]=$t,$t}},787:(Ft,At,Ne)=>{"use strict";function $e(e){return"function"==typeof e}function Ue(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const be=Ue(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,a)=>`${a+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function d(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class W{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const u of n)u.remove(this);else n.remove(this);const{initialTeardown:r}=this;if($e(r))try{r()}catch(u){t=u instanceof be?u.errors:[u]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const u of a)try{ce(u)}catch(m){t=t??[],m instanceof be?t=[...t,...m.errors]:t.push(m)}}if(t)throw new be(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ce(t);else{if(t instanceof W){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&d(n,t)}remove(t){const{_finalizers:n}=this;n&&d(n,t),t instanceof W&&t._removeParent(this)}}W.EMPTY=(()=>{const e=new W;return e.closed=!0,e})();const Te=W.EMPTY;function Me(e){return e instanceof W||e&&"closed"in e&&$e(e.remove)&&$e(e.add)&&$e(e.unsubscribe)}function ce(e){$e(e)?e():e.unsubscribe()}const De={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},lt={setTimeout(e,t,...n){const{delegate:r}=lt;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=lt;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function $t(e){lt.setTimeout(()=>{const{onUnhandledError:t}=De;if(!t)throw e;t(e)})}function tt(){}const Mt=le("C",void 0,void 0);function le(e,t,n){return{kind:e,value:t,error:n}}let Be=null;function je(e){if(De.useDeprecatedSynchronousErrorHandling){const t=!Be;if(t&&(Be={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=Be;if(Be=null,n)throw r}}else e()}class xe extends W{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Me(t)&&t.add(this)):this.destination=Pt}static create(t,n,r){return new zt(t,n,r)}next(t){this.isStopped?It(function _t(e){return le("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?It(function vt(e){return le("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?It(Mt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Xe=Function.prototype.bind;function st(e,t){return Xe.call(e,t)}class He{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){tn(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){tn(r)}else tn(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){tn(n)}}}class zt extends xe{constructor(t,n,r){let a;if(super(),$e(t)||!t)a={next:t??void 0,error:n??void 0,complete:r??void 0};else{let u;this&&De.useDeprecatedNextContext?(u=Object.create(t),u.unsubscribe=()=>this.unsubscribe(),a={next:t.next&&st(t.next,u),error:t.error&&st(t.error,u),complete:t.complete&&st(t.complete,u)}):a=t}this.destination=new He(a)}}function tn(e){De.useDeprecatedSynchronousErrorHandling?function Le(e){De.useDeprecatedSynchronousErrorHandling&&Be&&(Be.errorThrown=!0,Be.error=e)}(e):$t(e)}function It(e,t){const{onStoppedNotification:n}=De;n&&lt.setTimeout(()=>n(e,t))}const Pt={closed:!0,next:tt,error:function Wt(e){throw e},complete:tt},nn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Rt(e){return e}let Jt=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,a){const u=function lr(e){return e&&e instanceof xe||function On(e){return e&&$e(e.next)&&$e(e.error)&&$e(e.complete)}(e)&&Me(e)}(n)?n:new zt(n,r,a);return je(()=>{const{operator:m,source:v}=this;u.add(m?m.call(u,v):v?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=Lr(r))((a,u)=>{const m=new zt({next:v=>{try{n(v)}catch(C){u(C),m.unsubscribe()}},error:u,complete:a});this.subscribe(m)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[nn](){return this}pipe(...n){return function yn(e){return 0===e.length?Rt:1===e.length?e[0]:function(n){return e.reduce((r,a)=>a(r),n)}}(n)(this)}toPromise(n){return new(n=Lr(n))((r,a)=>{let u;this.subscribe(m=>u=m,m=>a(m),()=>r(u))})}}return e.create=t=>new e(t),e})();function Lr(e){var t;return null!==(t=e??De.Promise)&&void 0!==t?t:Promise}const di=Ue(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Wn=(()=>{class e extends Jt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new Xi(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new di}next(n){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){je(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:a,observers:u}=this;return r||a?Te:(this.currentObservers=null,u.push(n),new W(()=>{this.currentObservers=null,d(u,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:a,isStopped:u}=this;r?n.error(a):u&&n.complete()}asObservable(){const n=new Jt;return n.source=this,n}}return e.create=(t,n)=>new Xi(t,n),e})();class Xi extends Wn{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:Te}}function Yi(e){return $e(e?.lift)}function nr(e){return t=>{if(Yi(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function cn(e,t,n,r,a){return new Gr(e,t,n,r,a)}class Gr extends xe{constructor(t,n,r,a,u,m){super(t),this.onFinalize=u,this.shouldUnsubscribe=m,this._next=n?function(v){try{n(v)}catch(C){t.error(C)}}:super._next,this._error=a?function(v){try{a(v)}catch(C){t.error(C)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(v){t.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Mn(e,t){return nr((n,r)=>{let a=0;n.subscribe(cn(r,u=>{r.next(e.call(t,u,a++))}))})}function Ni(e){return this instanceof Ni?(this.v=e,this):new Ni(e)}function Xs(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,r=n.apply(e,t||[]),u=[];return a={},m("next"),m("throw"),m("return"),a[Symbol.asyncIterator]=function(){return this},a;function m(U){r[U]&&(a[U]=function(G){return new Promise(function(me,Ae){u.push([U,G,me,Ae])>1||v(U,G)})})}function v(U,G){try{!function C(U){U.value instanceof Ni?Promise.resolve(U.value.v).then(D,O):F(u[0][2],U)}(r[U](G))}catch(me){F(u[0][3],me)}}function D(U){v("next",U)}function O(U){v("throw",U)}function F(U,G){U(G),u.shift(),u.length&&v(u[0][0],u[0][1])}}function Nh(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Ws(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(u){n[u]=e[u]&&function(m){return new Promise(function(v,C){!function a(u,m,v,C){Promise.resolve(C).then(function(D){u({value:D,done:v})},m)}(v,C,(m=e[u](m)).done,m.value)})}}}const vc=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function gu(e){return $e(e?.then)}function $h(e){return $e(e[nn])}function _a(e){return Symbol.asyncIterator&&$e(e?.[Symbol.asyncIterator])}function Ys(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const _u=function xc(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function To(e){return $e(e?.[_u])}function bc(e){return Xs(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:a}=yield Ni(n.read());if(a)return yield Ni(void 0);yield yield Ni(r)}}finally{n.releaseLock()}})}function te(e){return $e(e?.getReader)}function B(e){if(e instanceof Jt)return e;if(null!=e){if($h(e))return function $(e){return new Jt(t=>{const n=e[nn]();if($e(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(vc(e))return function ee(e){return new Jt(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(gu(e))return function se(e){return new Jt(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,$t)})}(e);if(_a(e))return Ee(e);if(To(e))return function ge(e){return new Jt(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(te(e))return function Ce(e){return Ee(bc(e))}(e)}throw Ys(e)}function Ee(e){return new Jt(t=>{(function ye(e,t){var n,r,a,u;return function _c(e,t,n,r){return new(n||(n=Promise))(function(u,m){function v(O){try{D(r.next(O))}catch(F){m(F)}}function C(O){try{D(r.throw(O))}catch(F){m(F)}}function D(O){O.done?u(O.value):function a(u){return u instanceof n?u:new n(function(m){m(u)})}(O.value).then(v,C)}D((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Nh(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(m){a={error:m}}finally{try{r&&!r.done&&(u=n.return)&&(yield u.call(n))}finally{if(a)throw a.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Se(e,t,n,r=0,a=!1){const u=t.schedule(function(){n(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(u),!a)return u}function gt(e,t,n=1/0){return $e(t)?gt((r,a)=>Mn((u,m)=>t(r,u,a,m))(B(e(r,a))),n):("number"==typeof t&&(n=t),nr((r,a)=>function it(e,t,n,r,a,u,m,v){const C=[];let D=0,O=0,F=!1;const U=()=>{F&&!C.length&&!D&&t.complete()},G=Ae=>D<r?me(Ae):C.push(Ae),me=Ae=>{u&&t.next(Ae),D++;let We=!1;B(n(Ae,O++)).subscribe(cn(t,Pe=>{a?.(Pe),u?G(Pe):t.next(Pe)},()=>{We=!0},void 0,()=>{if(We)try{for(D--;C.length&&D<r;){const Pe=C.shift();m?Se(t,m,()=>me(Pe)):me(Pe)}U()}catch(Pe){t.error(Pe)}}))};return e.subscribe(cn(t,G,()=>{F=!0,U()})),()=>{v?.()}}(r,a,e,n)))}function ot(e=1/0){return gt(Rt,e)}const Zt=new Jt(e=>e.complete());function fn(e){return e&&$e(e.schedule)}function Rn(e){return e[e.length-1]}function cr(e){return $e(Rn(e))?e.pop():void 0}function vr(e){return fn(Rn(e))?e.pop():void 0}function mr(e,t){return"number"==typeof Rn(e)?e.pop():t}function we(e,t=0){return nr((n,r)=>{n.subscribe(cn(r,a=>Se(r,e,()=>r.next(a),t),()=>Se(r,e,()=>r.complete(),t),a=>Se(r,e,()=>r.error(a),t)))})}function Uo(e,t=0){return nr((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function yu(e,t){if(!e)throw new Error("Iterable cannot be null");return new Jt(n=>{Se(n,t,()=>{const r=e[Symbol.asyncIterator]();Se(n,t,()=>{r.next().then(a=>{a.done?n.complete():n.next(a.value)})},0,!0)})})}function mt(e,t){return t?function vu(e,t){if(null!=e){if($h(e))return function ei(e,t){return B(e).pipe(Uo(t),we(t))}(e,t);if(vc(e))return function ug(e,t){return new Jt(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(gu(e))return function vs(e,t){return B(e).pipe(Uo(t),we(t))}(e,t);if(_a(e))return yu(e,t);if(To(e))return function Qo(e,t){return new Jt(n=>{let r;return Se(n,t,()=>{r=e[_u](),Se(n,t,()=>{let a,u;try{({value:a,done:u}=r.next())}catch(m){return void n.error(m)}u?n.complete():n.next(a)},0,!0)}),()=>$e(r?.return)&&r.return()})}(e,t);if(te(e))return function Sp(e,t){return yu(bc(e),t)}(e,t)}throw Ys(e)}(e,t):B(e)}function bn(e){return e<=0?()=>Zt:nr((t,n)=>{let r=0;t.subscribe(cn(n,a=>{++r<=e&&(n.next(a),e<=r&&n.complete())}))})}function ya(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(bn(1)).subscribe(()=>e())}function Ht(e){for(let t in e)if(e[t]===Ht)return t;throw Error("Could not find renamed property on target object.")}function Rs(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Mr(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Mr).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Cl(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const xs=Ht({__forward_ref__:Ht});function En(e){return e.__forward_ref__=En,e.toString=function(){return Mr(this())},e}function Pn(e){return Ya(e)?e():e}function Ya(e){return"function"==typeof e&&e.hasOwnProperty(xs)&&e.__forward_ref__===En}class Fn extends Error{constructor(t,n){super(function va(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function Vn(e){return"string"==typeof e?e:null==e?"":String(e)}function Bi(e,t){throw new Fn(-201,!1)}function es(e,t){null==e&&function Er(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function gn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Vi(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ks(e){return Hh(e,wc)||Hh(e,Cc)}function Hh(e,t){return e.hasOwnProperty(t)?e[t]:null}function Ap(e){return e&&(e.hasOwnProperty(Zh)||e.hasOwnProperty(fg))?e[Zh]:null}const wc=Ht({\u0275prov:Ht}),Zh=Ht({\u0275inj:Ht}),Cc=Ht({ngInjectableDef:Ht}),fg=Ht({ngInjectorDef:Ht});var Dn=(()=>((Dn=Dn||{})[Dn.Default=0]="Default",Dn[Dn.Host=1]="Host",Dn[Dn.Self=2]="Self",Dn[Dn.SkipSelf=4]="SkipSelf",Dn[Dn.Optional=8]="Optional",Dn))();let cf;function Ai(e){const t=cf;return cf=e,t}function Wh(e,t,n){const r=Ks(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Dn.Optional?null:void 0!==t?t:void Bi(Mr(e))}function bs(e){return{toString:e}.toString()}var Ui=(()=>((Ui=Ui||{})[Ui.OnPush=0]="OnPush",Ui[Ui.Default=1]="Default",Ui))(),So=(()=>{return(e=So||(So={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",So;var e})();const Ir=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),el={},Tr=[],Ml=Ht({\u0275cmp:Ht}),Mc=Ht({\u0275dir:Ht}),Ec=Ht({\u0275pipe:Ht}),Mu=Ht({\u0275mod:Ht}),Un=Ht({\u0275fac:Ht}),xa=Ht({__NG_ELEMENT_ID__:Ht});let El=0;function kr(e){return bs(()=>{const n=!0===e.standalone,r={},a={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Ui.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||Tr,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||So.Emulated,id:"c"+El++,styles:e.styles||Tr,_:null,setInput:null,schemas:e.schemas||null,tView:null},u=e.dependencies,m=e.features;return a.inputs=Kh(e.inputs,r),a.outputs=Kh(e.outputs),m&&m.forEach(v=>v(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(Tc).filter(Xh):null,a.pipeDefs=u?()=>("function"==typeof u?u():u).map(fo).filter(Xh):null,a})}function Tc(e){return Fr(e)||ho(e)}function Xh(e){return null!==e}const mg={};function ws(e){return bs(()=>{const t={type:e.type,bootstrap:e.bootstrap||Tr,declarations:e.declarations||Tr,imports:e.imports||Tr,exports:e.exports||Tr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(mg[e.id]=e.type),t})}function Kh(e,t){if(null==e)return el;const n={};for(const r in e)if(e.hasOwnProperty(r)){let a=e[r],u=a;Array.isArray(a)&&(u=a[1],a=a[0]),n[a]=r,t&&(t[a]=u)}return n}const wn=kr;function oo(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Fr(e){return e[Ml]||null}function ho(e){return e[Mc]||null}function fo(e){return e[Ec]||null}function so(e,t){const n=e[Mu]||null;if(!n&&!0===t)throw new Error(`Type ${Mr(e)} does not have '\u0275mod' property.`);return n}function mo(e){return Array.isArray(e)&&"object"==typeof e[1]}function ts(e){return Array.isArray(e)&&!0===e[1]}function Ac(e){return 0!=(8&e.flags)}function Pc(e){return 2==(2&e.flags)}function ea(e){return 1==(1&e.flags)}function Ao(e){return null!==e.template}function kp(e){return 0!=(256&e[2])}function Ji(e,t){return e.hasOwnProperty(Un)?e[Un]:null}class Su{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function mi(){return id}function id(e){return e.type.prototype.ngOnChanges&&(e.setInput=od),Ol}function Ol(){const e=sd(this),t=e?.current;if(t){const n=e.previous;if(n===el)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function od(e,t,n,r){const a=sd(e)||function kl(e,t){return e[Fc]=t}(e,{previous:el,current:null}),u=a.current||(a.current={}),m=a.previous,v=this.declaredInputs[n],C=m[v];u[v]=new Su(C&&C.currentValue,t,m===el),e[r]=t}mi.ngInherit=!0;const Fc="__ngSimpleChanges__";function sd(e){return e[Fc]||null}let Fl;function zc(){return void 0!==Fl?Fl:typeof document<"u"?document:void 0}function gi(e){return!!e.listen}const Iu={createRenderer:(e,t)=>zc()};function _i(e){for(;Array.isArray(e);)e=e[0];return e}function zl(e,t){return _i(t[e])}function ns(e,t){return _i(t[e.index])}function Pu(e,t){return e.data[t]}function Nl(e,t){return e[t]}function go(e,t){const n=t[e];return mo(n)?n:n[0]}function Pi(e){return 4==(4&e[2])}function ld(e){return 64==(64&e[2])}function Ca(e,t){return null==t?null:e[t]}function Vp(e){e[18]=0}function rs(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const zn={lFrame:h(null),bindingsEnabled:!0};function bf(){return zn.bindingsEnabled}function pt(){return zn.lFrame.lView}function dr(){return zn.lFrame.tView}function ni(e){return zn.lFrame.contextLView=e,e[8]}function Vr(e){return zn.lFrame.contextLView=null,e}function Oi(){let e=wf();for(;null!==e&&64===e.type;)e=e.parent;return e}function wf(){return zn.lFrame.currentTNode}function is(e,t){const n=zn.lFrame;n.currentTNode=e,n.isParent=t}function Nc(){return zn.lFrame.isParent}function Bc(){zn.lFrame.isParent=!1}function Qi(){const e=zn.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function tl(){return zn.lFrame.bindingIndex++}function ta(e){const t=zn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function Gp(e,t){const n=zn.lFrame;n.bindingIndex=n.bindingRootIndex=e,hd(t)}function hd(e){zn.lFrame.currentDirectiveIndex=e}function Df(){return zn.lFrame.currentQueryIndex}function Ru(e){zn.lFrame.currentQueryIndex=e}function dd(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function Vl(e,t,n){if(n&Dn.SkipSelf){let a=t,u=e;for(;!(a=a.parent,null!==a||n&Dn.Host||(a=dd(u),null===a||(u=u[15],10&a.type))););if(null===a)return!1;t=a,e=u}const r=zn.lFrame=o();return r.currentTNode=t,r.lView=e,!0}function p(e){const t=o(),n=e[1];zn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function o(){const e=zn.lFrame,t=null===e?null:e.child;return null===t?h(e):t}function h(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function _(){const e=zn.lFrame;return zn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const x=_;function w(){const e=_();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function A(){return zn.lFrame.selectedIndex}function R(e){zn.lFrame.selectedIndex=e}function L(){const e=zn.lFrame;return Pu(e.tView,e.selectedIndex)}function N(){zn.lFrame.currentNamespace="svg"}function Z(){!function K(){zn.lFrame.currentNamespace=null}()}function Y(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const u=e.data[n].type.prototype,{ngAfterContentInit:m,ngAfterContentChecked:v,ngAfterViewInit:C,ngAfterViewChecked:D,ngOnDestroy:O}=u;m&&(e.contentHooks||(e.contentHooks=[])).push(-n,m),v&&((e.contentHooks||(e.contentHooks=[])).push(n,v),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,v)),C&&(e.viewHooks||(e.viewHooks=[])).push(-n,C),D&&((e.viewHooks||(e.viewHooks=[])).push(n,D),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,D)),null!=O&&(e.destroyHooks||(e.destroyHooks=[])).push(n,O)}}function Q(e,t,n){ne(e,t,3,n)}function X(e,t,n,r){(3&e[2])===n&&ne(e,t,n,r)}function ue(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function ne(e,t,n,r){const u=r??-1,m=t.length-1;let v=0;for(let C=void 0!==r?65535&e[18]:0;C<m;C++)if("number"==typeof t[C+1]){if(v=t[C],null!=r&&v>=r)break}else t[C]<0&&(e[18]+=65536),(v<u||-1==u)&&(oe(e,n,t,C),e[18]=(4294901760&e[18])+C+2),C++}function oe(e,t,n,r){const a=n[r]<0,u=n[r+1],v=e[a?-n[r]:n[r]];if(a){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{u.call(v)}finally{}}}else try{u.call(v)}finally{}}class ke{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function Vt(e,t,n){const r=gi(e);let a=0;for(;a<n.length;){const u=n[a];if("number"==typeof u){if(0!==u)break;a++;const m=n[a++],v=n[a++],C=n[a++];r?e.setAttribute(t,v,C,m):t.setAttributeNS(m,v,C)}else{const m=u,v=n[++a];Et(m)?r&&e.setProperty(t,m,v):r?e.setAttribute(t,m,v):t.setAttribute(m,v),a++}}return a}function xt(e){return 3===e||4===e||6===e}function Et(e){return 64===e.charCodeAt(0)}function wt(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const a=t[r];"number"==typeof a?n=a:0===n||bt(e,n,a,null,-1===n||2===n?t[++r]:null)}}return e}function bt(e,t,n,r,a){let u=0,m=e.length;if(-1===t)m=-1;else for(;u<e.length;){const v=e[u++];if("number"==typeof v){if(v===t){m=-1;break}if(v>t){m=u-1;break}}}for(;u<e.length;){const v=e[u];if("number"==typeof v)break;if(v===n){if(null===r)return void(null!==a&&(e[u+1]=a));if(r===e[u+1])return void(e[u+2]=a)}u++,null!==r&&u++,null!==a&&u++}-1!==m&&(e.splice(m,0,t),u=m+1),e.splice(u++,0,n),null!==r&&e.splice(u++,0,r),null!==a&&e.splice(u++,0,a)}function Lt(e){return-1!==e}function sn(e){return 32767&e}function qt(e,t){let n=function Sn(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let vn=!0;function hr(e){const t=vn;return vn=e,t}let jo=0;const $i={};function Pr(e,t){const n=sr(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Zr(r.data,e),Zr(t,null),Zr(r.blueprint,null));const a=li(e,t),u=e.injectorIndex;if(Lt(a)){const m=sn(a),v=qt(a,t),C=v[1].data;for(let D=0;D<8;D++)t[u+D]=v[m+D]|C[m+D]}return t[u+8]=a,u}function Zr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function sr(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function li(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,a=t;for(;null!==a;){if(r=bg(a),null===r)return-1;if(n++,a=a[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function Gi(e,t,n){!function Da(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(xa)&&(r=n[xa]),null==r&&(r=n[xa]=jo++);const a=255&r;t.data[e+(a>>5)]|=1<<a}(e,t,n)}function ri(e,t,n){if(n&Dn.Optional)return e;Bi()}function nl(e,t,n,r){if(n&Dn.Optional&&void 0===r&&(r=null),0==(n&(Dn.Self|Dn.Host))){const a=e[9],u=Ai(void 0);try{return a?a.get(t,r,n&Dn.Optional):Wh(t,r,n&Dn.Optional)}finally{Ai(u)}}return ri(r,0,n)}function zs(e,t,n,r=Dn.Default,a){if(null!==e){if(1024&t[2]){const m=function Fy(e,t,n,r,a){let u=e,m=t;for(;null!==u&&null!==m&&1024&m[2]&&!(256&m[2]);){const v=Ul(u,m,n,r|Dn.Self,$i);if(v!==$i)return v;let C=u.parent;if(!C){const D=m[21];if(D){const O=D.get(n,$i,r);if(O!==$i)return O}C=bg(m),m=m[15]}u=C}return a}(e,t,n,r,$i);if(m!==$i)return m}const u=Ul(e,t,n,r,$i);if(u!==$i)return u}return nl(t,n,r,a)}function Ul(e,t,n,r,a){const u=function os(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(xa)?e[xa]:void 0;return"number"==typeof t?t>=0?255&t:Ly:t}(n);if("function"==typeof u){if(!Vl(t,e,r))return r&Dn.Host?ri(a,0,r):nl(t,n,r,a);try{const m=u(r);if(null!=m||r&Dn.Optional)return m;Bi()}finally{x()}}else if("number"==typeof u){let m=null,v=sr(e,t),C=-1,D=r&Dn.Host?t[16][6]:null;for((-1===v||r&Dn.SkipSelf)&&(C=-1===v?li(e,t):t[v+8],-1!==C&&rl(r,!1)?(m=t[1],v=sn(C),t=qt(C,t)):v=-1);-1!==v;){const O=t[1];if(Bs(u,v,O.data)){const F=jl(v,t,n,m,r,D);if(F!==$i)return F}C=t[v+8],-1!==C&&rl(r,t[1].data[v+8]===D)&&Bs(u,v,t)?(m=O,v=sn(C),t=qt(C,t)):v=-1}}return a}function jl(e,t,n,r,a,u){const m=t[1],v=m.data[e+8],O=Ns(v,m,n,null==r?Pc(v)&&vn:r!=m&&0!=(3&v.type),a&Dn.Host&&u===v);return null!==O?ki(t,m,O,v):$i}function Ns(e,t,n,r,a){const u=e.providerIndexes,m=t.data,v=1048575&u,C=e.directiveStart,O=u>>20,U=a?v+O:e.directiveEnd;for(let G=r?v:v+O;G<U;G++){const me=m[G];if(G<C&&n===me||G>=C&&me.type===n)return G}if(a){const G=m[C];if(G&&Ao(G)&&G.type===n)return C}return null}function ki(e,t,n,r){let a=e[n];const u=t.data;if(function Ve(e){return e instanceof ke}(a)){const m=a;m.resolving&&function fi(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Fn(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Tn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Vn(e)}(u[n]));const v=hr(m.canSeeViewProviders);m.resolving=!0;const C=m.injectImpl?Ai(m.injectImpl):null;Vl(e,r,Dn.Default);try{a=e[n]=m.factory(void 0,u,e,r),t.firstCreatePass&&n>=r.directiveStart&&function ie(e,t,n){const{ngOnChanges:r,ngOnInit:a,ngDoCheck:u}=t.type.prototype;if(r){const m=id(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,m),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,m)}a&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,a),u&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,u),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,u))}(n,u[n],t)}finally{null!==C&&Ai(C),hr(v),m.resolving=!1,x()}}return a}function Bs(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function rl(e,t){return!(e&Dn.Self||e&Dn.Host&&t)}class Lu{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return zs(this._tNode,this._lView,t,r,n)}}function Ly(){return new Lu(Oi(),pt())}function Sf(e){return Ya(e)?()=>{const t=Sf(Pn(e));return t&&t()}:Ji(e)}function bg(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}const zu="__parameters__";function Bu(e,t,n){return bs(()=>{const r=function Hp(e){return function(...n){if(e){const r=e(...n);for(const a in r)this[a]=r[a]}}}(t);function a(...u){if(this instanceof a)return r.apply(this,u),this;const m=new a(...u);return v.annotation=m,v;function v(C,D,O){const F=C.hasOwnProperty(zu)?C[zu]:Object.defineProperty(C,zu,{value:[]})[zu];for(;F.length<=O;)F.push(null);return(F[O]=F[O]||[]).push(m),C}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}class Nn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=gn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const t1=new Nn("AnalyzeForEntryComponents");function Vs(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),Vs(r,t)):t!==e&&t.push(r)}return t}function $l(e,t){e.forEach(n=>Array.isArray(n)?$l(n,t):t(n))}function Zp(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Uc(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function il(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function Us(e,t,n){let r=yd(e,t);return r>=0?e[1|r]=n:(r=~r,function jc(e,t,n,r){let a=e.length;if(a==t)e.push(n,r);else if(1===a)e.push(r,e[0]),e[0]=n;else{for(a--,e.push(e[a-1],e[a]);a>t;)e[a]=e[a-2],a--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function Eg(e,t){const n=yd(e,t);if(n>=0)return e[1|n]}function yd(e,t){return function If(e,t,n){let r=0,a=e.length>>n;for(;a!==r;){const u=r+(a-r>>1),m=e[u<<n];if(t===m)return u<<n;m>t?a=u:r=u+1}return~(a<<n)}(e,t,1)}const Uu={},Gl="__NG_DI_FLAG__",sl="ngTempTokenPath",$o=/\n/gm,Tg="__source";let Ms;function Hl(e){const t=Ms;return Ms=e,t}function Dg(e,t=Dn.Default){if(void 0===Ms)throw new Fn(-203,"");return null===Ms?Wh(e,void 0,t):Ms.get(e,t&Dn.Optional?null:void 0,t)}function Yt(e,t=Dn.Default){return(function uf(){return cf}()||Dg)(Pn(e),t)}function Pf(e){const t=[];for(let n=0;n<e.length;n++){const r=Pn(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Fn(900,"");let a,u=Dn.Default;for(let m=0;m<r.length;m++){const v=r[m],C=u1(v);"number"==typeof C?-1===C?a=v.token:u|=C:a=v}t.push(Yt(a,u))}else t.push(Yt(r))}return t}function vd(e,t){return e[Gl]=t,e.prototype[Gl]=t,e}function u1(e){return e[Gl]}const $u=vd(Bu("Inject",e=>({token:e})),-1),ra=vd(Bu("Optional"),8),xd=vd(Bu("SkipSelf"),4);let Wu,Hc;function Xu(e){return function wd(){if(void 0===Wu&&(Wu=null,Ir.trustedTypes))try{Wu=Ir.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Wu}()?.createHTML(e)||e}function qc(){if(void 0===Hc&&(Hc=null,Ir.trustedTypes))try{Hc=Ir.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Hc}function Wl(e){return qc()?.createHTML(e)||e}function Pg(e){return qc()?.createScriptURL(e)||e}class al{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Jp extends al{getTypeName(){return"HTML"}}class ll extends al{getTypeName(){return"Style"}}class Qp extends al{getTypeName(){return"Script"}}class Go extends al{getTypeName(){return"URL"}}class ia extends al{getTypeName(){return"ResourceURL"}}function ls(e){return e instanceof al?e.changingThisBreaksApplicationSecurity:e}function oi(e,t){const n=Og(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Og(e){return e instanceof al&&e.getTypeName()||null}class qy{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(Xu(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.removeChild(n.firstChild),n)}catch{return null}}}class Zy{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);const r=this.inertDocument.createElement("body");n.appendChild(r)}}getInertBodyElement(t){const n=this.inertDocument.createElement("template");if("content"in n)return n.innerHTML=Xu(t),n;const r=this.inertDocument.createElement("body");return r.innerHTML=Xu(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(r),r}stripCustomNsAttrs(t){const n=t.attributes;for(let a=n.length-1;0<a;a--){const m=n.item(a).name;("xmlns:ns1"===m||0===m.indexOf("ns1:"))&&t.removeAttribute(m)}let r=t.firstChild;for(;r;)r.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(r),r=r.nextSibling}}const Xy=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,kg=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Yu(e){return(e=String(e)).match(Xy)||e.match(kg)?e:"unsafe:"+e}function Pa(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Rf(...e){const t={};for(const n of e)for(const r in n)n.hasOwnProperty(r)&&(t[r]=!0);return t}const Rg=Pa("area,br,col,hr,img,wbr"),Ky=Pa("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Jy=Pa("rp,rt"),Lf=Rf(Rg,Rf(Ky,Pa("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Rf(Jy,Pa("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Rf(Jy,Ky)),Oa=Pa("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Ho=Pa("srcset"),e0=Rf(Oa,Ho,Pa("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Pa("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),w1=Pa("script,style,template");class C1{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let n=t.firstChild,r=!0;for(;n;)if(n.nodeType===Node.ELEMENT_NODE?r=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,r&&n.firstChild)n=n.firstChild;else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let a=this.checkClobberedElement(n,n.nextSibling);if(a){n=a;break}n=this.checkClobberedElement(n,n.parentNode)}return this.buf.join("")}startElement(t){const n=t.nodeName.toLowerCase();if(!Lf.hasOwnProperty(n))return this.sanitizedSomething=!0,!w1.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const r=t.attributes;for(let a=0;a<r.length;a++){const u=r.item(a),m=u.name,v=m.toLowerCase();if(!e0.hasOwnProperty(v)){this.sanitizedSomething=!0;continue}let C=u.value;Oa[v]&&(C=Yu(C)),Ho[v]&&(e=C,C=(e=String(e)).split(",").map(t=>Yu(t.trim())).join(", ")),this.buf.push(" ",m,'="',Ff(C),'"')}var e;return this.buf.push(">"),!0}endElement(t){const n=t.nodeName.toLowerCase();Lf.hasOwnProperty(n)&&!Rg.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(Ff(t))}checkClobberedElement(t,n){if(n&&(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return n}}const em=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,M1=/([^\#-~ |!])/g;function Ff(e){return e.replace(/&/g,"&amp;").replace(em,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(M1,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let zf;function Xl(e,t){let n=null;try{zf=zf||function Zc(e){const t=new Zy(e);return function Wy(){try{return!!(new window.DOMParser).parseFromString(Xu(""),"text/html")}catch{return!1}}()?new qy(t):t}(e);let r=t?String(t):"";n=zf.getInertBodyElement(r);let a=5,u=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=u,u=n.innerHTML,n=zf.getInertBodyElement(r)}while(r!==u);return Xu((new C1).sanitizeChildren(Ku(n)||n))}finally{if(n){const r=Ku(n)||n;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function Ku(e){return"content"in e&&function E1(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var ci=(()=>((ci=ci||{})[ci.NONE=0]="NONE",ci[ci.HTML=1]="HTML",ci[ci.STYLE=2]="STYLE",ci[ci.SCRIPT=3]="SCRIPT",ci[ci.URL=4]="URL",ci[ci.RESOURCE_URL=5]="RESOURCE_URL",ci))();function Cd(e){const t=Ed();return t?Wl(t.sanitize(ci.HTML,e)||""):oi(e,"HTML")?Wl(ls(e)):Xl(zc(),Vn(e))}function Yl(e){const t=Ed();return t?t.sanitize(ci.URL,e)||"":oi(e,"URL")?ls(e):Yu(Vn(e))}function Lg(e){const t=Ed();if(t)return Pg(t.sanitize(ci.RESOURCE_URL,e)||"");if(oi(e,"ResourceURL"))return Pg(ls(e));throw new Fn(904,"")}function Ed(){const e=pt();return e&&e[12]}function Ju(e){return e.ngOriginalError}class Qu{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Ju(t);for(;n&&Ju(n);)n=Ju(n);return n||null}}const Vf=new Map;let O1=0;const jg="__ngContext__";function ko(e,t){mo(t)?(e[jg]=t[20],function Vg(e){Vf.set(e[20],e)}(t)):e[jg]=t}function cl(e){const t=e[jg];return"number"==typeof t?function Uf(e){return Vf.get(e)||null}(t):t||null}function $g(e){const t=cl(e);return t?mo(t)?t:t.lView:null}const $f=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(Ir))();function ul(e){return e instanceof Function?e():e}var Kr=(()=>((Kr=Kr||{})[Kr.Important=1]="Important",Kr[Kr.DashCase=2]="DashCase",Kr))();function nh(e,t){return undefined(e,t)}function Sd(e){const t=e[3];return ts(t)?t[3]:t}function Hg(e){return d0(e[13])}function qg(e){return d0(e[4])}function d0(e){for(;null!==e&&!ts(e);)e=e[4];return e}function Kl(e,t,n,r,a){if(null!=r){let u,m=!1;ts(r)?u=r:mo(r)&&(m=!0,r=r[0]);const v=_i(r);0===e&&null!==n?null==a?y0(t,n,v):Ra(t,n,v,a||null,!0):1===e&&null!==n?Ra(t,n,v,a||null,!0):2===e?function w0(e,t,n){const r=Wc(e,t);r&&function x0(e,t,n,r){gi(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,v,m):3===e&&t.destroyNode(v),null!=u&&function Z1(e,t,n,r,a){const u=n[7];u!==_i(n)&&Kl(t,e,r,u,a);for(let v=10;v<n.length;v++){const C=n[v];Yf(C[1],C,e,t,r,u)}}(t,e,u,n,a)}}function rm(e,t,n){if(gi(e))return e.createElement(t,n);{const r=null!==n?function Po(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(n):null;return null===r?e.createElement(t):e.createElementNS(r,t)}}function m0(e,t){const n=e[9],r=n.indexOf(t),a=t[3];512&t[2]&&(t[2]&=-513,rs(a,-1)),n.splice(r,1)}function eo(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const a=r[17];null!==a&&a!==e&&m0(a,r),t>0&&(e[n-1][4]=r[4]);const u=Uc(e,10+t);!function U1(e,t){Yf(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const m=u[19];null!==m&&m.detachView(u[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function ka(e,t){if(!(128&t[2])){const n=t[11];gi(n)&&n.destroyNode&&Yf(e,t,n,3,null,null),function G1(e){let t=e[13];if(!t)return Wf(e[1],e);for(;t;){let n=null;if(mo(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)mo(t)&&Wf(t[1],t),t=t[3];null===t&&(t=e),mo(t)&&Wf(t[1],t),n=t&&t[4]}t=n}}(t)}}function Wf(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function Id(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const a=t[n[r]];if(!(a instanceof ke)){const u=n[r+1];if(Array.isArray(u))for(let m=0;m<u.length;m+=2){const v=a[u[m]],C=u[m+1];try{C.call(v)}finally{}}else try{u.call(a)}finally{}}}}(e,t),function im(e,t){const n=e.cleanup,r=t[7];let a=-1;if(null!==n)for(let u=0;u<n.length-1;u+=2)if("string"==typeof n[u]){const m=n[u+1],v="function"==typeof m?m(t):_i(t[m]),C=r[a=n[u+2]],D=n[u+3];"boolean"==typeof D?v.removeEventListener(n[u],C,D):D>=0?r[a=D]():r[a=-D].unsubscribe(),u+=2}else{const m=r[a=n[u+1]];n[u].call(m)}if(null!==r){for(let u=a+1;u<r.length;u++)r[u]();t[7]=null}}(e,t),1===t[1].type&&gi(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&ts(t[3])){n!==t[3]&&m0(n,t);const r=t[19];null!==r&&r.detachView(e)}!function k1(e){Vf.delete(e[20])}(t)}}function g0(e,t,n){return function _0(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const a=e.data[r.directiveStart].encapsulation;if(a===So.None||a===So.Emulated)return null}return ns(r,n)}(e,t.parent,n)}function Ra(e,t,n,r,a){gi(e)?e.insertBefore(t,n,r,a):(Xg(t)?t.content:t).insertBefore(n,r,a)}function y0(e,t,n){gi(e)?e.appendChild(t,n):(Xg(t)?t.content:t).appendChild(n)}function v0(e,t,n,r,a){null!==r?Ra(e,t,n,r,a):y0(e,t,n)}function Xg(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}function Wc(e,t){return gi(e)?e.parentNode(t):t.parentNode}function om(e,t,n){return Kg(e,t,n)}let Kg=function Yg(e,t,n){return 40&e.type?ns(e,n):null};function Xf(e,t,n,r){const a=g0(e,r,t),u=t[11],v=om(r.parent||t[6],r,t);if(null!=a)if(Array.isArray(n))for(let C=0;C<n.length;C++)v0(u,a,n[C],v,!1);else v0(u,a,n,v,!1)}function sm(e,t){if(null!==t){const n=t.type;if(3&n)return ns(t,e);if(4&n)return Jg(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return sm(e,r);{const a=e[t.index];return ts(a)?Jg(-1,a):_i(a)}}if(32&n)return nh(t,e)()||_i(e[t.index]);{const r=b0(e,t);return null!==r?Array.isArray(r)?r[0]:sm(Sd(e[16]),r):sm(e,t.next)}}return null}function b0(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Jg(e,t){const n=10+e+1;if(n<t.length){const r=t[n],a=r[1].firstChild;if(null!==a)return sm(r,a)}return t[7]}function Qg(e,t,n,r,a,u,m){for(;null!=n;){const v=r[n.index],C=n.type;if(m&&0===t&&(v&&ko(_i(v),r),n.flags|=4),64!=(64&n.flags))if(8&C)Qg(e,t,n.child,r,a,u,!1),Kl(t,e,a,v,u);else if(32&C){const D=nh(n,r);let O;for(;O=D();)Kl(t,e,a,O,u);Kl(t,e,a,v,u)}else 16&C?C0(e,t,r,n,a,u):Kl(t,e,a,v,u);n=m?n.projectionNext:n.next}}function Yf(e,t,n,r,a,u){Qg(n,r,e.firstChild,t,a,u,!1)}function C0(e,t,n,r,a,u){const m=n[16],C=m[6].projection[r.projection];if(Array.isArray(C))for(let D=0;D<C.length;D++)Kl(t,e,a,C[D],u);else Qg(e,t,C,m[3],a,u,!0)}function ih(e,t,n){gi(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function lm(e,t,n){gi(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function M0(e,t,n){let r=e.length;for(;;){const a=e.indexOf(t,n);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const u=t.length;if(a+u===r||e.charCodeAt(a+u)<=32)return a}n=a+1}}const E0="ng-template";function e_(e,t,n){let r=0;for(;r<e.length;){let a=e[r++];if(n&&"class"===a){if(a=e[r],-1!==M0(a.toLowerCase(),t,0))return!0}else if(1===a){for(;r<e.length&&"string"==typeof(a=e[r++]);)if(a.toLowerCase()===t)return!0;return!1}}return!1}function cm(e){return 4===e.type&&e.value!==E0}function T0(e,t,n){return t===(4!==e.type||n?e.value:E0)}function js(e,t,n){let r=4;const a=e.attrs||[],u=function W1(e){for(let t=0;t<e.length;t++)if(xt(e[t]))return t;return e.length}(a);let m=!1;for(let v=0;v<t.length;v++){const C=t[v];if("number"!=typeof C){if(!m)if(4&r){if(r=2|1&r,""!==C&&!T0(e,C,n)||""===C&&1===t.length){if(us(r))return!1;m=!0}}else{const D=8&r?C:t[++v];if(8&r&&null!==e.attrs){if(!e_(e.attrs,D,n)){if(us(r))return!1;m=!0}continue}const F=Ad(8&r?"class":C,a,cm(e),n);if(-1===F){if(us(r))return!1;m=!0;continue}if(""!==D){let U;U=F>u?"":a[F+1].toLowerCase();const G=8&r?U:null;if(G&&-1!==M0(G,D,0)||2&r&&D!==U){if(us(r))return!1;m=!0}}}}else{if(!m&&!us(r)&&!us(C))return!1;if(m&&us(C))continue;m=!1,r=C|1&r}}return us(r)||m}function us(e){return 0==(1&e)}function Ad(e,t,n,r){if(null===t)return-1;let a=0;if(r||!n){let u=!1;for(;a<t.length;){const m=t[a];if(m===e)return a;if(3===m||6===m)u=!0;else{if(1===m||2===m){let v=t[++a];for(;"string"==typeof v;)v=t[++a];continue}if(4===m)break;if(0===m){a+=4;continue}}a+=u?1:2}return-1}return function D0(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function um(e,t,n=!1){for(let r=0;r<t.length;r++)if(js(e,t[r],n))return!0;return!1}function S0(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let a=0;a<e.length;a++)if(e[a]!==r[a])continue e;return!0}}return!1}function I0(e,t){return e?":not("+t.trim()+")":t}function A0(e){let t=e[0],n=1,r=2,a="",u=!1;for(;n<e.length;){let m=e[n];if("string"==typeof m)if(2&r){const v=e[++n];a+="["+m+(v.length>0?'="'+v+'"':"")+"]"}else 8&r?a+="."+m:4&r&&(a+=" "+m);else""!==a&&!us(m)&&(t+=I0(u,a),a=""),r=m,u=u||!us(r);n++}return""!==a&&(t+=I0(u,a)),t}const Hn={};function Qe(e){O0(dr(),pt(),A()+e,!1)}function O0(e,t,n,r){if(!r)if(3==(3&t[2])){const u=e.preOrderCheckHooks;null!==u&&Q(t,u,n)}else{const u=e.preOrderHooks;null!==u&&X(t,u,0,n)}R(n)}const o_=new Nn("ENVIRONMENT_INITIALIZER"),Pd=new Nn("INJECTOR_DEF_TYPES");function L0(...e){return{\u0275providers:s_(0,e)}}function s_(e,...t){const n=[],r=new Set;let a;return $l(t,u=>{const m=u;Xc(m,n,[],r)&&(a||(a=[]),a.push(m))}),void 0!==a&&dm(a,n),n}function dm(e,t){for(let n=0;n<e.length;n++){const{providers:a}=e[n];$l(a,u=>{t.push(u)})}}function Xc(e,t,n,r){if(!(e=Pn(e)))return!1;let a=null,u=Ap(e);const m=!u&&Fr(e);if(u||m){if(m&&!m.standalone)return!1;a=e}else{const C=e.ngModule;if(u=Ap(C),!u)return!1;a=C}const v=r.has(a);if(m){if(v)return!1;if(r.add(a),m.dependencies){const C="function"==typeof m.dependencies?m.dependencies():m.dependencies;for(const D of C)Xc(D,t,n,r)}}else{if(!u)return!1;{if(null!=u.imports&&!v){let D;r.add(a);try{$l(u.imports,O=>{Xc(O,t,n,r)&&(D||(D=[]),D.push(O))})}finally{}void 0!==D&&dm(D,t)}if(!v){const D=Ji(a)||(()=>new a);t.push({provide:a,useFactory:D,deps:Tr},{provide:Pd,useValue:a,multi:!0},{provide:o_,useValue:()=>Yt(a),multi:!0})}const C=u.providers;null==C||v||$l(C,O=>{t.push(O)})}}return a!==e&&void 0!==e.providers}const fm=Ht({provide:String,useValue:Ht});function pm(e){return null!==e&&"object"==typeof e&&fm in e}function oh(e){return"function"==typeof e}const a_=new Nn("INJECTOR",-1);class F0{get(t,n=Uu){if(n===Uu){const r=new Error(`NullInjectorError: No provider for ${Mr(t)}!`);throw r.name="NullInjectorError",r}return n}}const l_=new Nn("Set Injector scope."),Ql={},c_={};let u_;function mm(){return void 0===u_&&(u_=new F0),u_}class sh{}class gm extends sh{constructor(t,n,r,a){super(),this.parent=n,this.source=r,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,_m(t,m=>this.processProvider(m)),this.records.set(a_,ec(void 0,this)),a.has("environment")&&this.records.set(sh,ec(void 0,this));const u=this.records.get(l_);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(Pd.multi,Tr,Dn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,n=Uu,r=Dn.Default){this.assertNotDestroyed();const a=Hl(this),u=Ai(void 0);try{if(!(r&Dn.SkipSelf)){let v=this.records.get(t);if(void 0===v){const C=function tb(e){return"function"==typeof e||"object"==typeof e&&e instanceof Nn}(t)&&Ks(t);v=C&&this.injectableDefInScope(C)?ec(h_(t),Ql):null,this.records.set(t,v)}if(null!=v)return this.hydrate(t,v)}return(r&Dn.Self?mm():this.parent).get(t,n=r&Dn.Optional&&n===Uu?null:n)}catch(m){if("NullInjectorError"===m.name){if((m[sl]=m[sl]||[]).unshift(Mr(t)),a)throw m;return function ql(e,t,n,r){const a=e[sl];throw t[Tg]&&a.unshift(t[Tg]),e.message=function ju(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=Mr(t);if(Array.isArray(t))a=t.map(Mr).join(" -> ");else if("object"==typeof t){let u=[];for(let m in t)if(t.hasOwnProperty(m)){let v=t[m];u.push(m+":"+("string"==typeof v?JSON.stringify(v):Mr(v)))}a=`{${u.join(", ")}}`}return`${n}${r?"("+r+")":""}[${a}]: ${e.replace($o,"\n  ")}`}("\n"+e.message,a,n,r),e.ngTokenPath=a,e[sl]=null,e}(m,t,"R3InjectorError",this.source)}throw m}finally{Ai(u),Hl(a)}}resolveInjectorInitializers(){const t=Hl(this),n=Ai(void 0);try{const r=this.get(o_.multi,Tr,Dn.Self);for(const a of r)a()}finally{Hl(t),Ai(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(Mr(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Fn(205,!1)}processProvider(t){let n=oh(t=Pn(t))?t:Pn(t&&t.provide);const r=function z0(e){return pm(e)?ec(void 0,e.useValue):ec(d_(e),Ql)}(t);if(oh(t)||!0!==t.multi)this.records.get(n);else{let a=this.records.get(n);a||(a=ec(void 0,Ql,!0),a.factory=()=>Pf(a.multi),this.records.set(n,a)),n=t,a.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===Ql&&(n.value=c_,n.value=n.factory()),"object"==typeof n.value&&n.value&&function eb(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Pn(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function h_(e){const t=Ks(e),n=null!==t?t.factory:Ji(e);if(null!==n)return n;if(e instanceof Nn)throw new Fn(204,!1);if(e instanceof Function)return function Yc(e){const t=e.length;if(t>0)throw il(t,"?"),new Fn(204,!1);const n=function qh(e){const t=e&&(e[wc]||e[Cc]);if(t){const n=function dg(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Fn(204,!1)}function d_(e,t,n){let r;if(oh(e)){const a=Pn(e);return Ji(a)||h_(a)}if(pm(e))r=()=>Pn(e.useValue);else if(function Jf(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Pf(e.deps||[]));else if(function Kf(e){return!(!e||!e.useExisting)}(e))r=()=>Yt(Pn(e.useExisting));else{const a=Pn(e&&(e.useClass||e.provide));if(!function f_(e){return!!e.deps}(e))return Ji(a)||h_(a);r=()=>new a(...Pf(e.deps))}return r}function ec(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function N0(e){return!!e.\u0275providers}function _m(e,t){for(const n of e)Array.isArray(n)?_m(n,t):N0(n)?_m(n.\u0275providers,t):t(n)}function Od(e,t=null,n=null,r){const a=Kc(e,t,n,r);return a.resolveInjectorInitializers(),a}function Kc(e,t=null,n=null,r,a=new Set){const u=[n||Tr,L0(e)];return r=r||("object"==typeof e?void 0:Mr(e)),new gm(u,t||mm(),r||null,a)}let _o=(()=>{class e{static create(n,r){if(Array.isArray(n))return Od({name:""},r,n,"");{const a=n.name??"";return Od({name:a},n.parent,n.providers,a)}}}return e.THROW_IF_NOT_FOUND=Uu,e.NULL=new F0,e.\u0275prov=gn({token:e,providedIn:"any",factory:()=>Yt(a_)}),e.__NG_ELEMENT_ID__=-1,e})();function rt(e,t=Dn.Default){const n=pt();return null===n?Yt(e,t):zs(Oi(),n,Pn(e),t)}function y_(){throw new Error("invalid")}function wm(e,t){return e<<17|t<<2}function $s(e){return e>>17&32767}function b_(e){return 2|e}function Fa(e){return(131068&e)>>2}function Mm(e,t){return-131069&e|t<<2}function w_(e){return 1|e}function Nd(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const a=n[r],u=n[r+1];if(-1!==u){const m=e.data[u];Ru(a),m.contentQueries(2,t[u],u)}}}function Bd(e,t,n,r,a,u,m,v,C,D,O){const F=t.blueprint.slice();return F[0]=a,F[2]=76|r,(null!==O||e&&1024&e[2])&&(F[2]|=1024),Vp(F),F[3]=F[15]=e,F[8]=n,F[10]=m||e&&e[10],F[11]=v||e&&e[11],F[12]=C||e&&e[12]||null,F[9]=D||e&&e[9]||null,F[6]=u,F[20]=function Bg(){return O1++}(),F[21]=O,F[16]=2==t.type?e[16]:F,F}function Vd(e,t,n,r,a){let u=e.data[t];if(null===u)u=function Am(e,t,n,r,a){const u=wf(),m=Nc(),C=e.data[t]=function P(e,t,n,r,a,u){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:a,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,m?u:u&&u.parent,n,t,r,a);return null===e.firstChild&&(e.firstChild=C),null!==u&&(m?null==u.child&&null!==C.parent&&(u.child=C):null===u.next&&(u.next=C)),C}(e,t,n,r,a),function ud(){return zn.lFrame.inI18n}()&&(u.flags|=64);else if(64&u.type){u.type=n,u.value=r,u.attrs=a;const m=function Ea(){const e=zn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();u.injectorIndex=null===m?-1:m.injectorIndex}return is(u,!0),u}function Ud(e,t,n,r){if(0===n)return-1;const a=t.length;for(let u=0;u<n;u++)t.push(r),e.blueprint.push(r),e.data.push(null);return a}function mh(e,t,n){p(t);try{const r=e.viewQuery;null!==r&&Kn(1,r,n);const a=e.template;null!==a&&s(e,t,a,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Nd(e,t),e.staticViewQueries&&Kn(2,e.viewQuery,n);const u=e.components;null!==u&&function tv(e,t){for(let n=0;n<t.length;n++)yi(e,t[n])}(t,u)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,w()}}function gh(e,t,n,r){const a=t[2];if(128!=(128&a)){p(t);try{Vp(t),function Mf(e){return zn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&s(e,t,n,2,r);const m=3==(3&a);if(m){const D=e.preOrderCheckHooks;null!==D&&Q(t,D,null)}else{const D=e.preOrderHooks;null!==D&&X(t,D,0,null),ue(t,0)}if(function Xt(e){for(let t=Hg(e);null!==t;t=qg(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const a=n[r],u=a[3];0==(512&a[2])&&rs(u,1),a[2]|=512}}}(t),function Bn(e){for(let t=Hg(e);null!==t;t=qg(t))for(let n=10;n<t.length;n++){const r=t[n],a=r[1];ld(r)&&gh(a,r,a.template,r[8])}}(t),null!==e.contentQueries&&Nd(e,t),m){const D=e.contentCheckHooks;null!==D&&Q(t,D)}else{const D=e.contentHooks;null!==D&&X(t,D,1),ue(t,1)}!function ev(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const a=n[r];if(a<0)R(~a);else{const u=a,m=n[++r],v=n[++r];Gp(m,u),v(2,t[u])}}}finally{R(-1)}}(e,t);const v=e.components;null!==v&&function Im(e,t){for(let n=0;n<t.length;n++)Fi(e,t[n])}(t,v);const C=e.viewQuery;if(null!==C&&Kn(2,C,r),m){const D=e.viewCheckHooks;null!==D&&Q(t,D)}else{const D=e.viewHooks;null!==D&&X(t,D,2),ue(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,rs(t[3],-1))}finally{w()}}}function nv(e,t,n,r){const a=t[10],m=Pi(t);try{!m&&a.begin&&a.begin(),m&&mh(e,t,r),gh(e,t,n,r)}finally{!m&&a.end&&a.end()}}function s(e,t,n,r,a){const u=A(),m=2&r;try{R(-1),m&&t.length>22&&O0(e,t,22,!1),n(r,a)}finally{R(u)}}function i(e,t,n){if(Ac(t)){const a=t.directiveEnd;for(let u=t.directiveStart;u<a;u++){const m=e.data[u];m.contentQueries&&m.contentQueries(1,n[u],u)}}}function l(e,t,n){!bf()||(function Fe(e,t,n,r){const a=n.directiveStart,u=n.directiveEnd;e.firstCreatePass||Pr(n,t),ko(r,t);const m=n.initialInputs;for(let v=a;v<u;v++){const C=e.data[v],D=Ao(C);D&&at(t,n,C);const O=ki(t,e,v,n);ko(O,t),null!==m&&$n(0,v-a,O,C,0,m),D&&(go(n.index,t)[8]=O)}}(e,t,n,ns(n,t)),128==(128&n.flags)&&function ze(e,t,n){const r=n.directiveStart,a=n.directiveEnd,u=n.index,m=function Tf(){return zn.lFrame.currentDirectiveIndex}();try{R(u);for(let v=r;v<a;v++){const C=e.data[v],D=t[v];hd(v),(null!==C.hostBindings||0!==C.hostVars||null!==C.hostAttrs)&&Je(C,D)}}finally{R(-1),hd(m)}}(e,t,n))}function c(e,t,n=ns){const r=t.localNames;if(null!==r){let a=t.index+1;for(let u=0;u<r.length;u+=2){const m=r[u+1],v=-1===m?n(t,e):e[m];e[a++]=v}}}function f(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=g(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function g(e,t,n,r,a,u,m,v,C,D){const O=22+r,F=O+a,U=function y(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Hn);return n}(O,F),G="function"==typeof D?D():D;return U[1]={type:e,blueprint:U,template:n,queries:null,viewQuery:v,declTNode:t,data:U.slice().fill(null,O),bindingStartIndex:O,expandoStartIndex:F,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof m?m():m,firstChild:null,schemas:C,consts:G,incompleteFirstPass:!1}}function I(e,t,n,r){const a=fr(t);null===n?a.push(r):(a.push(n),e.firstCreatePass&&Qr(e).push(r,a.length-1))}function k(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const a=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,a):n[r]=[t,a]}return n}function j(e,t,n,r,a,u,m,v){const C=ns(t,n);let O,D=t.inputs;!v&&null!=D&&(O=D[r])?(vi(e,n,O,r,a),Pc(t)&&function J(e,t){const n=go(t,e);16&n[2]||(n[2]|=32)}(n,t.index)):3&t.type&&(r=function V(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),a=null!=m?m(a,t.value||"",r):a,gi(u)?u.setProperty(C,r,a):Et(r)||(C.setProperty?C.setProperty(r,a):C[r]=a))}function pe(e,t,n,r){let a=!1;if(bf()){const u=function ct(e,t,n){const r=e.directiveRegistry;let a=null;if(r)for(let u=0;u<r.length;u++){const m=r[u];um(n,m.selectors,!1)&&(a||(a=[]),Gi(Pr(n,t),e,m.type),Ao(m)?(Oe(e,n),a.unshift(m)):a.push(m))}return a}(e,t,n),m=null===r?null:{"":-1};if(null!==u){a=!0,ht(n,e.data.length,u.length);for(let O=0;O<u.length;O++){const F=u[O];F.providersResolver&&F.providersResolver(F)}let v=!1,C=!1,D=Ud(e,t,u.length,null);for(let O=0;O<u.length;O++){const F=u[O];n.mergedAttrs=wt(n.mergedAttrs,F.hostAttrs),Ot(e,n,t,D,F),ut(D,F,m),null!==F.contentQueries&&(n.flags|=8),(null!==F.hostBindings||null!==F.hostAttrs||0!==F.hostVars)&&(n.flags|=128);const U=F.type.prototype;!v&&(U.ngOnChanges||U.ngOnInit||U.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),v=!0),!C&&(U.ngOnChanges||U.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),C=!0),D++}!function z(e,t){const r=t.directiveEnd,a=e.data,u=t.attrs,m=[];let v=null,C=null;for(let D=t.directiveStart;D<r;D++){const O=a[D],F=O.inputs,U=null===u||cm(t)?null:Qt(F,u);m.push(U),v=k(F,D,v),C=k(O.outputs,D,C)}null!==v&&(v.hasOwnProperty("class")&&(t.flags|=16),v.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=m,t.inputs=v,t.outputs=C}(e,n)}m&&function qe(e,t,n){if(t){const r=e.localNames=[];for(let a=0;a<t.length;a+=2){const u=n[t[a+1]];if(null==u)throw new Fn(-301,!1);r.push(t[a],u)}}}(n,r,m)}return n.mergedAttrs=wt(n.mergedAttrs,n.attrs),a}function _e(e,t,n,r,a,u){const m=u.hostBindings;if(m){let v=e.hostBindingOpCodes;null===v&&(v=e.hostBindingOpCodes=[]);const C=~t.index;(function ve(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(v)!=C&&v.push(C),v.push(r,a,m)}}function Je(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Oe(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function ut(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Ao(t)&&(n[""]=e)}}function ht(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function Ot(e,t,n,r,a){e.data[r]=a;const u=a.factory||(a.factory=Ji(a.type)),m=new ke(u,Ao(a),rt);e.blueprint[r]=m,n[r]=m,_e(e,t,0,r,Ud(e,n,a.hostVars,Hn),a)}function at(e,t,n){const r=ns(t,e),a=f(n),u=e[10],m=Qn(e,Bd(e,a,null,n.onPush?32:16,r,t,u,u.createRenderer(r,n),null,null,null));e[t.index]=m}function yt(e,t,n,r,a,u){const m=ns(e,t);!function In(e,t,n,r,a,u,m){if(null==u)gi(e)?e.removeAttribute(t,a,n):t.removeAttribute(a);else{const v=null==m?Vn(u):m(u,r||"",a);gi(e)?e.setAttribute(t,a,v,n):n?t.setAttributeNS(n,a,v):t.setAttribute(a,v)}}(t[11],m,u,e.value,n,r,a)}function $n(e,t,n,r,a,u){const m=u[t];if(null!==m){const v=r.setInput;for(let C=0;C<m.length;){const D=m[C++],O=m[C++],F=m[C++];null!==v?r.setInput(n,F,D,O):n[O]=F}}}function Qt(e,t){let n=null,r=0;for(;r<t.length;){const a=t[r];if(0!==a)if(5!==a){if("number"==typeof a)break;e.hasOwnProperty(a)&&(null===n&&(n=[]),n.push(a,e[a],t[r+1])),r+=2}else r+=2;else r+=4}return n}function Zn(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function Fi(e,t){const n=go(t,e);if(ld(n)){const r=n[1];48&n[2]?gh(r,n,r.template,n[8]):n[5]>0&&ui(n)}}function ui(e){for(let r=Hg(e);null!==r;r=qg(r))for(let a=10;a<r.length;a++){const u=r[a];if(512&u[2]){const m=u[1];gh(m,u,m.template,u[8])}else u[5]>0&&ui(u)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const a=go(n[r],e);ld(a)&&a[5]>0&&ui(a)}}function yi(e,t){const n=go(t,e),r=n[1];(function Xn(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),mh(r,n,n[8])}function Qn(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function Or(e){for(;e;){e[2]|=32;const t=Sd(e);if(kp(e)&&!t)return e;e=t}return null}function Jr(e){!function xr(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=$g(n);if(null!==r){const a=r[1];nv(a,r,a.template,n)}}}(e[8])}function Kn(e,t,n){Ru(0),t(e,n)}const Ro=(()=>Promise.resolve(null))();function fr(e){return e[7]||(e[7]=[])}function Qr(e){return e.cleanup||(e.cleanup=[])}function Wr(e,t){const n=e[9],r=n?n.get(Qu,null):null;r&&r.handleError(t)}function vi(e,t,n,r,a){for(let u=0;u<n.length;){const m=n[u++],v=n[u++],C=t[m],D=e.data[m];null!==D.setInput?D.setInput(C,a,r,v):C[v]=a}}function si(e,t,n){const r=zl(t,e);!function Wg(e,t,n){gi(e)?e.setValue(t,n):t.textContent=n}(e[11],r,n)}function Ii(e,t,n){let r=n?e.styles:null,a=n?e.classes:null,u=0;if(null!==t)for(let m=0;m<t.length;m++){const v=t[m];"number"==typeof v?u=v:1==u?a=Cl(a,v):2==u&&(r=Cl(r,v+": "+t[++m]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=a:e.classesWithoutHost=a}function eO(){const e=Oi();Y(pt()[1],e)}function Xr(e){let t=function XM(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const r=[e];for(;t;){let a;if(Ao(e))a=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Fn(903,"");a=t.\u0275dir}if(a){if(n){r.push(a);const m=e;m.inputs=bb(e.inputs),m.declaredInputs=bb(e.declaredInputs),m.outputs=bb(e.outputs);const v=a.hostBindings;v&&iO(e,v);const C=a.viewQuery,D=a.contentQueries;if(C&&nO(e,C),D&&rO(e,D),Rs(e.inputs,a.inputs),Rs(e.declaredInputs,a.declaredInputs),Rs(e.outputs,a.outputs),Ao(a)&&a.data.animation){const O=e.data;O.animation=(O.animation||[]).concat(a.data.animation)}}const u=a.features;if(u)for(let m=0;m<u.length;m++){const v=u[m];v&&v.ngInherit&&v(e),v===Xr&&(n=!1)}}t=Object.getPrototypeOf(t)}!function tO(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const a=e[r];a.hostVars=t+=a.hostVars,a.hostAttrs=wt(a.hostAttrs,n=wt(n,a.hostAttrs))}}(r)}function bb(e){return e===el?{}:e===Tr?[]:e}function nO(e,t){const n=e.viewQuery;e.viewQuery=n?(r,a)=>{t(r,a),n(r,a)}:t}function rO(e,t){const n=e.contentQueries;e.contentQueries=n?(r,a,u)=>{t(r,a,u),n(r,a,u)}:t}function iO(e,t){const n=e.hostBindings;e.hostBindings=n?(r,a)=>{t(r,a),n(r,a)}:t}let av=null;function ap(){if(!av){const e=Ir.Symbol;if(e&&e.iterator)av=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(av=r)}}}return av}function P_(e){return!!function wb(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&ap()in e)}function tu(e,t,n){return e[t]=n}function Ss(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function xi(e,t,n,r){const a=pt();return Ss(a,tl(),t)&&(dr(),yt(L(),a,e,t,n,r)),xi}function Om(e,t,n,r){return Ss(e,tl(),n)?t+Vn(n)+r:Hn}function Jn(e,t,n,r,a,u,m,v){const C=pt(),D=dr(),O=e+22,F=D.firstCreatePass?function hO(e,t,n,r,a,u,m,v,C){const D=t.consts,O=Vd(t,e,4,m||null,Ca(D,v));pe(t,n,O,Ca(D,C)),Y(t,O);const F=O.tViews=g(2,O,r,a,u,t.directiveRegistry,t.pipeRegistry,null,t.schemas,D);return null!==t.queries&&(t.queries.template(t,O),F.queries=t.queries.embeddedTView(O)),O}(O,D,C,t,n,r,a,u,m):D.data[O];is(F,!1);const U=C[11].createComment("");Xf(D,C,U,F),ko(U,C),Qn(C,C[O]=Zn(U,C,U,F)),ea(F)&&l(D,C,F),null!=m&&c(C,F,v)}function jt(e,t,n){const r=pt();return Ss(r,tl(),t)&&j(dr(),L(),r,e,t,r[11],n,!1),jt}function Cb(e,t,n,r,a){const m=a?"class":"style";vi(e,n,t.inputs[m],m,r)}function Ze(e,t,n,r){const a=pt(),u=dr(),m=22+e,v=a[11],C=a[m]=rm(v,t,function q(){return zn.lFrame.currentNamespace}()),D=u.firstCreatePass?function fO(e,t,n,r,a,u,m){const v=t.consts,D=Vd(t,e,2,a,Ca(v,u));return pe(t,n,D,Ca(v,m)),null!==D.attrs&&Ii(D,D.attrs,!1),null!==D.mergedAttrs&&Ii(D,D.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,D),D}(m,u,a,0,t,n,r):u.data[m];is(D,!0);const O=D.mergedAttrs;null!==O&&Vt(v,C,O);const F=D.classes;null!==F&&lm(v,C,F);const U=D.styles;return null!==U&&ih(v,C,U),64!=(64&D.flags)&&Xf(u,a,C,D),0===function cd(){return zn.lFrame.elementDepthCount}()&&ko(C,a),function Bt(){zn.lFrame.elementDepthCount++}(),ea(D)&&(l(u,a,D),i(u,D,a)),null!==r&&c(a,D),Ze}function nt(){let e=Oi();Nc()?Bc():(e=e.parent,is(e,!1));const t=e;!function Up(){zn.lFrame.elementDepthCount--}();const n=dr();return n.firstCreatePass&&(Y(n,e),Ac(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Ie(e){return 0!=(16&e.flags)}(t)&&Cb(n,t,pt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Ke(e){return 0!=(32&e.flags)}(t)&&Cb(n,t,pt(),t.stylesWithoutHost,!1),nt}function on(e,t,n,r){return Ze(e,t,n,r),nt(),on}function nu(e,t,n){const r=pt(),a=dr(),u=e+22,m=a.firstCreatePass?function pO(e,t,n,r,a){const u=t.consts,m=Ca(u,r),v=Vd(t,e,8,"ng-container",m);return null!==m&&Ii(v,m,!0),pe(t,n,v,Ca(u,a)),null!==t.queries&&t.queries.elementStart(t,v),v}(u,a,r,t,n):a.data[u];is(m,!0);const v=r[u]=r[11].createComment("");return Xf(a,r,v,m),ko(v,r),ea(m)&&(l(a,r,m),i(a,m,r)),null!=n&&c(r,m),nu}function ru(){let e=Oi();const t=dr();return Nc()?Bc():(e=e.parent,is(e,!1)),t.firstCreatePass&&(Y(t,e),Ac(e)&&t.queries.elementEnd(e)),ru}function Fo(){return pt()}function k_(e){return!!e&&"function"==typeof e.then}function aE(e){return!!e&&"function"==typeof e.subscribe}const Mb=aE;function xn(e,t,n,r){const a=pt(),u=dr(),m=Oi();return function cE(e,t,n,r,a,u,m,v){const C=ea(r),O=e.firstCreatePass&&Qr(e),F=t[8],U=fr(t);let G=!0;if(3&r.type||v){const We=ns(r,t),Pe=v?v(We):We,dt=U.length,Ge=v?Ct=>v(_i(Ct[r.index])):r.index;if(gi(n)){let Ct=null;if(!v&&C&&(Ct=function mO(e,t,n,r){const a=e.cleanup;if(null!=a)for(let u=0;u<a.length-1;u+=2){const m=a[u];if(m===n&&a[u+1]===r){const v=t[7],C=a[u+2];return v.length>C?v[C]:null}"string"==typeof m&&(u+=2)}return null}(e,t,a,r.index)),null!==Ct)(Ct.__ngLastListenerFn__||Ct).__ngNextListenerFn__=u,Ct.__ngLastListenerFn__=u,G=!1;else{u=Eb(r,t,F,u,!1);const en=n.listen(Pe,a,u);U.push(u,en),O&&O.push(a,Ge,dt,dt+1)}}else u=Eb(r,t,F,u,!0),Pe.addEventListener(a,u,m),U.push(u),O&&O.push(a,Ge,dt,m)}else u=Eb(r,t,F,u,!1);const me=r.outputs;let Ae;if(G&&null!==me&&(Ae=me[a])){const We=Ae.length;if(We)for(let Pe=0;Pe<We;Pe+=2){const Tt=t[Ae[Pe]][Ae[Pe+1]].subscribe(u),Yn=U.length;U.push(u,Tt),O&&O.push(a,r.index,Yn,-(Yn+1))}}}(u,a,a[11],m,e,t,!!n,r),xn}function uE(e,t,n,r){try{return!1!==n(r)}catch(a){return Wr(e,a),!1}}function Eb(e,t,n,r,a){return function u(m){if(m===Function)return r;Or(2&e.flags?go(e.index,t):t);let C=uE(t,0,r,m),D=u.__ngNextListenerFn__;for(;D;)C=uE(t,0,D,m)&&C,D=D.__ngNextListenerFn__;return a&&!1===C&&(m.preventDefault(),m.returnValue=!1),C}}function _n(e=1){return function T(e){return(zn.lFrame.contextLView=function S(e,t){for(;e>0;)t=t[15],e--;return t}(e,zn.lFrame.contextLView))[8]}(e)}function gO(e,t){let n=null;const r=function hm(e){const t=e.attrs;if(null!=t){const n=t.indexOf(5);if(0==(1&n))return t[n+1]}return null}(e);for(let a=0;a<t.length;a++){const u=t[a];if("*"!==u){if(null===r?um(e,u,!0):S0(r,u))return a}else n=a}return n}function Tb(e){const t=pt()[16][6];if(!t.projection){const r=t.projection=il(e?e.length:1,null),a=r.slice();let u=t.child;for(;null!==u;){const m=e?gO(u,e):0;null!==m&&(a[m]?a[m].projectionNext=u:r[m]=u,a[m]=u),u=u.next}}}function cv(e,t=0,n){const r=pt(),a=dr(),u=Vd(a,22+e,16,null,n||null);null===u.projection&&(u.projection=t),Bc(),64!=(64&u.flags)&&function q1(e,t,n){C0(t[11],0,t,n,g0(e,n,t),om(n.parent||t[6],n,t))}(a,r,u)}function uv(e,t,n){return Db(e,"",t,"",n),uv}function Db(e,t,n,r,a){const u=pt(),m=Om(u,t,n,r);return m!==Hn&&j(dr(),L(),u,e,m,u[11],a,!1),Db}function vE(e,t,n,r,a){const u=e[n+1],m=null===t;let v=r?$s(u):Fa(u),C=!1;for(;0!==v&&(!1===C||m);){const O=e[v+1];vO(e[v],t)&&(C=!0,e[v+1]=r?w_(O):b_(O)),v=r?$s(O):Fa(O)}C&&(e[n+1]=r?b_(u):w_(u))}function vO(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&yd(e,t)>=0}const zo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function xE(e){return e.substring(zo.key,zo.keyEnd)}function bE(e,t){const n=zo.textEnd;return n===t?-1:(t=zo.keyEnd=function CO(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,zo.key=t,n),Vm(e,t,n))}function Vm(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function Ti(e,t,n){return rc(e,t,n,!1),Ti}function to(e,t){return rc(e,t,null,!0),to}function TE(e){!function ic(e,t,n,r){const a=dr(),u=ta(2);a.firstUpdatePass&&SE(a,null,u,r);const m=pt();if(n!==Hn&&Ss(m,u,n)){const v=a.data[A()];if(OE(v,r)&&!DE(a,u)){let C=r?v.classesWithoutHost:v.stylesWithoutHost;null!==C&&(n=Cl(C,n||"")),Cb(a,v,m,n,r)}else!function OO(e,t,n,r,a,u,m,v){a===Hn&&(a=Tr);let C=0,D=0,O=0<a.length?a[0]:null,F=0<u.length?u[0]:null;for(;null!==O||null!==F;){const U=C<a.length?a[C+1]:void 0,G=D<u.length?u[D+1]:void 0;let Ae,me=null;O===F?(C+=2,D+=2,U!==G&&(me=F,Ae=G)):null===F||null!==O&&O<F?(C+=2,me=O):(D+=2,me=F,Ae=G),null!==me&&AE(e,t,n,r,me,Ae,m,v),O=C<a.length?a[C]:null,F=D<u.length?u[D]:null}}(a,v,m,m[11],m[u+1],m[u+1]=function PO(e,t,n){if(null==n||""===n)return Tr;const r=[],a=ls(n);if(Array.isArray(a))for(let u=0;u<a.length;u++)e(r,a[u],!0);else if("object"==typeof a)for(const u in a)a.hasOwnProperty(u)&&e(r,u,a[u]);else"string"==typeof a&&t(r,a);return r}(e,t,n),r,u)}}(Us,ou,e,!0)}function ou(e,t){for(let n=function bO(e){return function CE(e){zo.key=0,zo.keyEnd=0,zo.value=0,zo.valueEnd=0,zo.textEnd=e.length}(e),bE(e,Vm(e,0,zo.textEnd))}(t);n>=0;n=bE(t,n))Us(e,xE(t),!0)}function rc(e,t,n,r){const a=pt(),u=dr(),m=ta(2);u.firstUpdatePass&&SE(u,e,m,r),t!==Hn&&Ss(a,m,t)&&AE(u,u.data[A()],a,a[11],e,a[m+1]=function kO(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Mr(ls(e)))),e}(t,n),r,m)}function DE(e,t){return t>=e.expandoStartIndex}function SE(e,t,n,r){const a=e.data;if(null===a[n+1]){const u=a[A()],m=DE(e,n);OE(u,r)&&null===t&&!m&&(t=!1),t=function DO(e,t,n,r){const a=function Ta(e){const t=zn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let u=r?t.residualClasses:t.residualStyles;if(null===a)0===(r?t.classBindings:t.styleBindings)&&(n=R_(n=Sb(null,e,t,n,r),t.attrs,r),u=null);else{const m=t.directiveStylingLast;if(-1===m||e[m]!==a)if(n=Sb(a,e,t,n,r),null===u){let C=function SO(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Fa(r))return e[$s(r)]}(e,t,r);void 0!==C&&Array.isArray(C)&&(C=Sb(null,e,t,C[1],r),C=R_(C,t.attrs,r),function IO(e,t,n,r){e[$s(n?t.classBindings:t.styleBindings)]=r}(e,t,r,C))}else u=function AO(e,t,n){let r;const a=t.directiveEnd;for(let u=1+t.directiveStylingLast;u<a;u++)r=R_(r,e[u].hostAttrs,n);return R_(r,t.attrs,n)}(e,t,r)}return void 0!==u&&(r?t.residualClasses=u:t.residualStyles=u),n}(a,u,t,r),function _O(e,t,n,r,a,u){let m=u?t.classBindings:t.styleBindings,v=$s(m),C=Fa(m);e[r]=n;let O,D=!1;if(Array.isArray(n)){const F=n;O=F[1],(null===O||yd(F,O)>0)&&(D=!0)}else O=n;if(a)if(0!==C){const U=$s(e[v+1]);e[r+1]=wm(U,v),0!==U&&(e[U+1]=Mm(e[U+1],r)),e[v+1]=function Qc(e,t){return 131071&e|t<<17}(e[v+1],r)}else e[r+1]=wm(v,0),0!==v&&(e[v+1]=Mm(e[v+1],r)),v=r;else e[r+1]=wm(C,0),0===v?v=r:e[C+1]=Mm(e[C+1],r),C=r;D&&(e[r+1]=b_(e[r+1])),vE(e,O,r,!0),vE(e,O,r,!1),function yO(e,t,n,r,a){const u=a?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof t&&yd(u,t)>=0&&(n[r+1]=w_(n[r+1]))}(t,O,e,r,u),m=wm(v,C),u?t.classBindings=m:t.styleBindings=m}(a,u,t,n,m,r)}}function Sb(e,t,n,r,a){let u=null;const m=n.directiveEnd;let v=n.directiveStylingLast;for(-1===v?v=n.directiveStart:v++;v<m&&(u=t[v],r=R_(r,u.hostAttrs,a),u!==e);)v++;return null!==e&&(n.directiveStylingLast=v),r}function R_(e,t,n){const r=n?1:2;let a=-1;if(null!==t)for(let u=0;u<t.length;u++){const m=t[u];"number"==typeof m?a=m:a===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Us(e,m,!!n||t[++u]))}return void 0===e?null:e}function AE(e,t,n,r,a,u,m,v){if(!(3&t.type))return;const C=e.data,D=C[v+1];hv(function rp(e){return 1==(1&e)}(D)?PE(C,t,n,a,Fa(D),m):void 0)||(hv(u)||function Cm(e){return 2==(2&e)}(D)&&(u=PE(C,null,n,a,v,m)),function am(e,t,n,r,a){const u=gi(e);if(t)a?u?e.addClass(n,r):n.classList.add(r):u?e.removeClass(n,r):n.classList.remove(r);else{let m=-1===r.indexOf("-")?void 0:Kr.DashCase;if(null==a)u?e.removeStyle(n,r,m):n.style.removeProperty(r);else{const v="string"==typeof a&&a.endsWith("!important");v&&(a=a.slice(0,-10),m|=Kr.Important),u?e.setStyle(n,r,a,m):n.style.setProperty(r,a,v?"important":"")}}}(r,m,zl(A(),n),a,u))}function PE(e,t,n,r,a,u){const m=null===t;let v;for(;a>0;){const C=e[a],D=Array.isArray(C),O=D?C[1]:C,F=null===O;let U=n[a+1];U===Hn&&(U=F?Tr:void 0);let G=F?Eg(U,r):O===r?U:void 0;if(D&&!hv(G)&&(G=Eg(C,r)),hv(G)&&(v=G,m))return v;const me=e[a+1];a=m?$s(me):Fa(me)}if(null!==t){let C=u?t.residualClasses:t.residualStyles;null!=C&&(v=Eg(C,r))}return v}function hv(e){return void 0!==e}function OE(e,t){return 0!=(e.flags&(t?16:32))}function dn(e,t=""){const n=pt(),r=dr(),a=e+22,u=r.firstCreatePass?Vd(r,a,1,t,null):r.data[a],m=n[a]=function Zg(e,t){return gi(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Xf(r,n,m,u),is(u,!1)}function bi(e){return cp("",e,""),bi}function cp(e,t,n){const r=pt(),a=Om(r,e,t,n);return a!==Hn&&si(r,A(),a),cp}const jm="en-US";let eT=jm;function Pb(e,t,n,r,a){if(e=Pn(e),Array.isArray(e))for(let u=0;u<e.length;u++)Pb(e[u],t,n,r,a);else{const u=dr(),m=pt();let v=oh(e)?e:Pn(e.provide),C=d_(e);const D=Oi(),O=1048575&D.providerIndexes,F=D.directiveStart,U=D.providerIndexes>>20;if(oh(e)||!e.multi){const G=new ke(C,a,rt),me=kb(v,t,a?O:O+U,F);-1===me?(Gi(Pr(D,m),u,v),Ob(u,e,t.length),t.push(v),D.directiveStart++,D.directiveEnd++,a&&(D.providerIndexes+=1048576),n.push(G),m.push(G)):(n[me]=G,m[me]=G)}else{const G=kb(v,t,O+U,F),me=kb(v,t,O,O+U),Ae=G>=0&&n[G],We=me>=0&&n[me];if(a&&!We||!a&&!Ae){Gi(Pr(D,m),u,v);const Pe=function Kk(e,t,n,r,a){const u=new ke(e,n,rt);return u.multi=[],u.index=t,u.componentProviders=0,ET(u,a,r&&!n),u}(a?Yk:Xk,n.length,a,r,C);!a&&We&&(n[me].providerFactory=Pe),Ob(u,e,t.length,0),t.push(v),D.directiveStart++,D.directiveEnd++,a&&(D.providerIndexes+=1048576),n.push(Pe),m.push(Pe)}else Ob(u,e,G>-1?G:me,ET(n[a?me:G],C,!a&&r));!a&&r&&We&&n[me].componentProviders++}}}function Ob(e,t,n,r){const a=oh(t),u=function Q1(e){return!!e.useClass}(t);if(a||u){const C=(u?Pn(t.useClass):t).prototype.ngOnDestroy;if(C){const D=e.destroyHooks||(e.destroyHooks=[]);if(!a&&t.multi){const O=D.indexOf(n);-1===O?D.push(n,[r,C]):D[O+1].push(r,C)}else D.push(n,C)}}}function ET(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function kb(e,t,n,r){for(let a=n;a<r;a++)if(t[a]===e)return a;return-1}function Xk(e,t,n,r){return Rb(this.multi,[])}function Yk(e,t,n,r){const a=this.multi;let u;if(this.providerFactory){const m=this.providerFactory.componentProviders,v=ki(n,n[1],this.providerFactory.index,r);u=v.slice(0,m),Rb(a,u);for(let C=m;C<v.length;C++)u.push(v[C])}else u=[],Rb(a,u);return u}function Rb(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function zi(e,t=[]){return n=>{n.providersResolver=(r,a)=>function Wk(e,t,n){const r=dr();if(r.firstCreatePass){const a=Ao(e);Pb(n,r.data,r.blueprint,a,!0),Pb(t,r.data,r.blueprint,a,!1)}}(r,a?a(e):e,t)}}class Qk{resolveComponentFactory(t){throw function Jk(e){const t=Error(`No component factory found for ${Mr(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let B_=(()=>{class e{}return e.NULL=new Qk,e})();class qd{}class DT{}class ST{}function tR(){return Gm(Oi(),pt())}function Gm(e,t){return new Xo(ns(e,t))}let Xo=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=tR,e})();function nR(e){return e instanceof Xo?e.nativeElement:e}class IT{}let vh=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function iR(){const e=pt(),n=go(Oi().index,e);return function rR(e){return e[11]}(mo(n)?n:e)}(),e})(),oR=(()=>{class e{}return e.\u0275prov=gn({token:e,providedIn:"root",factory:()=>null}),e})();class V_{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const sR=new V_("14.0.2"),Lb={};function gv(e,t,n,r,a=!1){for(;null!==n;){const u=t[n.index];if(null!==u&&r.push(_i(u)),ts(u))for(let v=10;v<u.length;v++){const C=u[v],D=C[1].firstChild;null!==D&&gv(C[1],C,D,r)}const m=n.type;if(8&m)gv(e,t,n.child,r);else if(32&m){const v=nh(n,t);let C;for(;C=v();)r.push(C)}else if(16&m){const v=b0(t,n);if(Array.isArray(v))r.push(...v);else{const C=Sd(t[16]);gv(C[1],C,v,r,!0)}}n=a?n.projectionNext:n.next}return r}class U_{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return gv(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ts(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(eo(t,r),Uc(n,r))}this._attachedToViewContainer=!1}ka(this._lView[1],this._lView)}onDestroy(t){I(this._lView[1],this._lView,null,t)}markForCheck(){Or(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function Br(e,t,n){const r=t[10];r.begin&&r.begin();try{gh(e,t,e.template,n)}catch(a){throw Wr(t,a),a}finally{r.end&&r.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Fn(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function $1(e,t){Yf(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Fn(902,"");this._appRef=t}}class aR extends U_{constructor(t){super(t),this._view=t}detectChanges(){Jr(this._view)}checkNoChanges(){}get context(){return null}}class Fb extends B_{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Fr(t);return new zb(n,this.ngModule)}}function AT(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class cR{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){const a=this.injector.get(t,Lb,r);return a!==Lb||n===Lb?a:this.parentInjector.get(t,n,r)}}class zb extends ST{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function P0(e){return e.map(A0).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return AT(this.componentDef.inputs)}get outputs(){return AT(this.componentDef.outputs)}create(t,n,r,a){let u=(a=a||this.ngModule)instanceof sh?a:a?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const m=u?new cR(t,u):t,v=m.get(IT,Iu),C=m.get(oR,null),D=v.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",F=r?function E(e,t,n){if(gi(e))return e.selectRootElement(t,n===So.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(D,r,this.componentDef.encapsulation):rm(v.createRenderer(null,this.componentDef),O,function lR(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(O)),U=this.componentDef.onPush?288:272,G=function WM(e,t){return{components:[],scheduler:e||$f,clean:Ro,playerHandler:t||null,flags:0}}(),me=g(0,null,null,1,0,null,null,null,null,null),Ae=Bd(null,me,G,U,null,null,v,D,C,m,null);let We,Pe;p(Ae);try{const dt=function qM(e,t,n,r,a,u){const m=n[1];n[22]=e;const C=Vd(m,22,2,"#host",null),D=C.mergedAttrs=t.hostAttrs;null!==D&&(Ii(C,D,!0),null!==e&&(Vt(a,e,D),null!==C.classes&&lm(a,e,C.classes),null!==C.styles&&ih(a,e,C.styles)));const O=r.createRenderer(e,t),F=Bd(n,f(t),null,t.onPush?32:16,n[22],C,r,O,u||null,null,null);return m.firstCreatePass&&(Gi(Pr(C,n),m,t.type),Oe(m,C),ht(C,n.length,1)),Qn(n,F),n[22]=F}(F,this.componentDef,Ae,v,D);if(F)if(r)Vt(D,F,["ng-version",sR.full]);else{const{attrs:Ge,classes:Ct}=function t_(e){const t=[],n=[];let r=1,a=2;for(;r<e.length;){let u=e[r];if("string"==typeof u)2===a?""!==u&&t.push(u,e[++r]):8===a&&n.push(u);else{if(!us(a))break;a=u}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Ge&&Vt(D,F,Ge),Ct&&Ct.length>0&&lm(D,F,Ct.join(" "))}if(Pe=Pu(me,22),void 0!==n){const Ge=Pe.projection=[];for(let Ct=0;Ct<this.ngContentSelectors.length;Ct++){const en=n[Ct];Ge.push(null!=en?Array.from(en):null)}}We=function ZM(e,t,n,r,a){const u=n[1],m=function he(e,t,n){const r=Oi();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Ot(e,r,t,Ud(e,t,1,null),n));const a=ki(t,e,r.directiveStart,r);ko(a,t);const u=ns(r,t);return u&&ko(u,t),a}(u,n,t);if(r.components.push(m),e[8]=m,null!==a)for(const C of a)C(m,t);if(t.contentQueries){const C=Oi();t.contentQueries(1,m,C.directiveStart)}const v=Oi();return!u.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(R(v.index),_e(n[1],v,0,v.directiveStart,v.directiveEnd,t),Je(t,m)),m}(dt,this.componentDef,Ae,G,[eO]),mh(me,Ae,null)}finally{w()}return new hR(this.componentType,We,Gm(Pe,Ae),Ae,Pe)}}class hR extends class eR{}{constructor(t,n,r,a,u){super(),this.location=r,this._rootLView=a,this._tNode=u,this.instance=n,this.hostView=this.changeDetectorRef=new aR(a),this.componentType=t}get injector(){return new Lu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class PT extends qd{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Fb(this);const r=so(t);this._bootstrapComponents=ul(r.bootstrap),this._r3Injector=Kc(t,n,[{provide:qd,useValue:this},{provide:B_,useValue:this.componentFactoryResolver}],Mr(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,n=_o.THROW_IF_NOT_FOUND,r=Dn.Default){return t===_o||t===qd||t===a_?this:this._r3Injector.get(t,n,r)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Nb extends DT{constructor(t){super(),this.moduleType=t}create(t){return new PT(this.moduleType,t)}}class fR extends qd{constructor(t,n,r){super(),this.componentFactoryResolver=new Fb(this),this.instance=null;const a=new gm([...t,{provide:qd,useValue:this},{provide:B_,useValue:this.componentFactoryResolver}],n||mm(),r,new Set(["environment"]));this.injector=a,a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function _v(e,t=null,n=null){return new fR(e,t,n).injector}function kT(e,t,n,r,a,u){const m=t+n;return Ss(e,m,a)?tu(e,m+1,u?r.call(u,a):r(a)):function j_(e,t){const n=e[t];return n===Hn?void 0:n}(e,m+1)}function yv(e,t){const n=dr();let r;const a=e+22;n.firstCreatePass?(r=function TR(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}}(t,n.pipeRegistry),n.data[a]=r,r.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(a,r.onDestroy)):r=n.data[a];const u=r.factory||(r.factory=Ji(r.type)),m=Ai(rt);try{const v=hr(!1),C=u();return hr(v),function dO(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,pt(),a,C),C}finally{Ai(m)}}function vv(e,t,n){const r=e+22,a=pt(),u=Nl(a,r);return function $_(e,t){return e[1].data[t].pure}(a,r)?kT(a,Qi(),t,u.transform,n,u):u.transform(n)}function Bb(e){return t=>{setTimeout(e,void 0,t)}}const br=class PR extends Wn{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let a=t,u=n||(()=>null),m=r;if(t&&"object"==typeof t){const C=t;a=C.next?.bind(C),u=C.error?.bind(C),m=C.complete?.bind(C)}this.__isAsync&&(u=Bb(u),a&&(a=Bb(a)),m&&(m=Bb(m)));const v=super.subscribe({next:a,error:u,complete:m});return t instanceof W&&t.add(v),v}};function OR(){return this._results[ap()]()}class Vb{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=ap(),r=Vb.prototype;r[n]||(r[n]=OR)}get changes(){return this._changes||(this._changes=new br)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const a=Vs(t);(this._changesDetected=!function i1(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let a=e[r],u=t[r];if(n&&(a=n(a),u=n(u)),u!==a)return!1}return!0}(r._results,a,n))&&(r._results=a,r.length=a.length,r.last=a[this.length-1],r.first=a[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let xh=(()=>{class e{}return e.__NG_ELEMENT_ID__=LR,e})();const kR=xh,RR=class extends kR{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,a=Bd(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);a[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(a[19]=m.createEmbeddedView(r)),mh(r,a,t),new U_(a)}};function LR(){return xv(Oi(),pt())}function xv(e,t){return 4&e.type?new RR(t,e,Gm(e,t)):null}let oc=(()=>{class e{}return e.__NG_ELEMENT_ID__=FR,e})();function FR(){return VT(Oi(),pt())}const zR=oc,NT=class extends zR{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Gm(this._hostTNode,this._hostLView)}get injector(){return new Lu(this._hostTNode,this._hostLView)}get parentInjector(){const t=li(this._hostTNode,this._hostLView);if(Lt(t)){const n=qt(t,this._hostLView),r=sn(t);return new Lu(n[1].data[r+8],n)}return new Lu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=BT(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,r){let a,u;"number"==typeof r?a=r:null!=r&&(a=r.index,u=r.injector);const m=t.createEmbeddedView(n||{},u);return this.insert(m,a),m}createComponent(t,n,r,a,u){const m=t&&!function gd(e){return"function"==typeof e}(t);let v;if(m)v=n;else{const F=n||{};v=F.index,r=F.injector,a=F.projectableNodes,u=F.environmentInjector||F.ngModuleRef}const C=m?t:new zb(Fr(t)),D=r||this.parentInjector;if(!u&&null==C.ngModule){const U=(m?D:this.parentInjector).get(sh,null);U&&(u=U)}const O=C.create(D,a,void 0,u);return this.insert(O.hostView,v),O}insert(t,n){const r=t._lView,a=r[1];if(function Bp(e){return ts(e[3])}(r)){const O=this.indexOf(t);if(-1!==O)this.detach(O);else{const F=r[3],U=new NT(F,F[6],F[3]);U.detach(U.indexOf(t))}}const u=this._adjustIndex(n),m=this._lContainer;!function H1(e,t,n,r){const a=10+r,u=n.length;r>0&&(n[a-1][4]=t),r<u-10?(t[4]=n[a],Zp(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const m=t[17];null!==m&&n!==m&&function p0(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(m,t);const v=t[19];null!==v&&v.insertView(e),t[2]|=64}(a,r,m,u);const v=Jg(u,m),C=r[11],D=Wc(C,m[7]);return null!==D&&function j1(e,t,n,r,a,u){r[0]=a,r[6]=t,Yf(e,r,n,1,a,u)}(a,m[6],C,r,D,v),t.attachToViewContainerRef(),Zp(Ub(m),u,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=BT(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=eo(this._lContainer,n);r&&(Uc(Ub(this._lContainer),n),ka(r[1],r))}detach(t){const n=this._adjustIndex(t,-1),r=eo(this._lContainer,n);return r&&null!=Uc(Ub(this._lContainer),n)?new U_(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function BT(e){return e[8]}function Ub(e){return e[8]||(e[8]=[])}function VT(e,t){let n;const r=t[e.index];if(ts(r))n=r;else{let a;if(8&e.type)a=_i(r);else{const u=t[11];a=u.createComment("");const m=ns(e,t);Ra(u,Wc(u,m),a,function Nr(e,t){return gi(e)?e.nextSibling(t):t.nextSibling}(u,m),!1)}t[e.index]=n=Zn(r,t,a,e),Qn(t,n)}return new NT(n,e,t)}class jb{constructor(t){this.queryList=t,this.matches=null}clone(){return new jb(this.queryList)}setDirty(){this.queryList.setDirty()}}class $b{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,a=[];for(let u=0;u<r;u++){const m=n.getByIndex(u);a.push(this.queries[m.indexInDeclarationView].clone())}return new $b(a)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==HT(t,n).matches&&this.queries[n].setDirty()}}class UT{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class Gb{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const a=null!==n?n.length:0,u=this.getByIndex(r).embeddedTView(t,a);u&&(u.indexInDeclarationView=r,null!==n?n.push(u):n=[u])}return null!==n?new Gb(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Hb{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new Hb(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let a=0;a<r.length;a++){const u=r[a];this.matchTNodeWithReadOption(t,n,VR(n,u)),this.matchTNodeWithReadOption(t,n,Ns(n,t,u,!1,!1))}else r===xh?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Ns(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const a=this.metadata.read;if(null!==a)if(a===Xo||a===oc||a===xh&&4&n.type)this.addMatch(n.index,-2);else{const u=Ns(n,t,a,!1,!1);null!==u&&this.addMatch(n.index,u)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function VR(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function jR(e,t,n,r){return-1===n?function UR(e,t){return 11&e.type?Gm(e,t):4&e.type?xv(e,t):null}(t,e):-2===n?function $R(e,t,n){return n===Xo?Gm(t,e):n===xh?xv(t,e):n===oc?VT(t,e):void 0}(e,t,r):ki(e,e[1],n,t)}function jT(e,t,n,r){const a=t[19].queries[r];if(null===a.matches){const u=e.data,m=n.matches,v=[];for(let C=0;C<m.length;C+=2){const D=m[C];v.push(D<0?null:jR(t,u[D],m[C+1],n.metadata.read))}a.matches=v}return a.matches}function qb(e,t,n,r){const a=e.queries.getByIndex(n),u=a.matches;if(null!==u){const m=jT(e,t,a,n);for(let v=0;v<u.length;v+=2){const C=u[v];if(C>0)r.push(m[v/2]);else{const D=u[v+1],O=t[-C];for(let F=10;F<O.length;F++){const U=O[F];U[17]===U[3]&&qb(U[1],U,D,r)}if(null!==O[9]){const F=O[9];for(let U=0;U<F.length;U++){const G=F[U];qb(G[1],G,D,r)}}}}}return r}function ds(e){const t=pt(),n=dr(),r=Df();Ru(r+1);const a=HT(n,r);if(e.dirty&&Pi(t)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const u=a.crossesNgTemplate?qb(n,t,r,[]):jT(n,t,a,r);e.reset(u,nR),e.notifyOnChanges()}return!0}return!1}function Hs(e,t,n){const r=dr();r.firstCreatePass&&(function GT(e,t,n){null===e.queries&&(e.queries=new Gb),e.queries.track(new Hb(t,n))}(r,new UT(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function $T(e,t,n){const r=new Vb(4==(4&n));I(e,t,r,r.destroy),null===t[19]&&(t[19]=new $b),t[19].queries.push(new jb(r))}(r,pt(),t)}function fs(){return function GR(e,t){return e[19].queries[t].queryList}(pt(),Df())}function HT(e,t){return e.queries.getByIndex(t)}function wv(...e){}const Jb=new Nn("Application Initializer");let Cv=(()=>{class e{constructor(n){this.appInits=n,this.resolve=wv,this.reject=wv,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,a)=>{this.resolve=r,this.reject=a})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let a=0;a<this.appInits.length;a++){const u=this.appInits[a]();if(k_(u))n.push(u);else if(Mb(u)){const m=new Promise((v,C)=>{u.subscribe({complete:v,error:C})});n.push(m)}}Promise.all(n).then(()=>{r()}).catch(a=>{this.reject(a)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Yt(Jb,8))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const H_=new Nn("AppId",{providedIn:"root",factory:function h2(){return`${Qb()}${Qb()}${Qb()}`}});function Qb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const d2=new Nn("Platform Initializer"),ew=new Nn("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),f2=new Nn("appBootstrapListener");let dL=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const bh=new Nn("LocaleId",{providedIn:"root",factory:()=>function c1(e,t=Dn.Default){return Yt(e,t)}(bh,Dn.Optional|Dn.SkipSelf)||function fL(){return typeof $localize<"u"&&$localize.locale||jm}()});class mL{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let tw=(()=>{class e{compileModuleSync(n){return new Nb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),u=ul(so(n).declarations).reduce((m,v)=>{const C=Fr(v);return C&&m.push(new zb(C)),m},[]);return new mL(r,u)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const _L=(()=>Promise.resolve(0))();function nw(e){typeof Zone>"u"?_L.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class bo{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new br(!1),this.onMicrotaskEmpty=new br(!1),this.onStable=new br(!1),this.onError=new br(!1),typeof Zone>"u")throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!r&&n,a.shouldCoalesceRunChangeDetection=r,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function yL(){let e=Ir.requestAnimationFrame,t=Ir.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function bL(e){const t=()=>{!function xL(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Ir,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,iw(e),e.isCheckStableRunning=!0,rw(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),iw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,a,u,m,v)=>{try{return p2(e),n.invokeTask(a,u,m,v)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&t(),m2(e)}},onInvoke:(n,r,a,u,m,v,C)=>{try{return p2(e),n.invoke(a,u,m,v,C)}finally{e.shouldCoalesceRunChangeDetection&&t(),m2(e)}},onHasTask:(n,r,a,u)=>{n.hasTask(a,u),r===a&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,iw(e),rw(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(n,r,a,u)=>(n.handleError(a,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!bo.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(bo.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,a){const u=this._inner,m=u.scheduleEventTask("NgZoneEvent: "+a,t,vL,wv,wv);try{return u.runTask(m,n,r)}finally{u.cancelTask(m)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const vL={};function rw(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function iw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function p2(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function m2(e){e._nesting--,rw(e)}class wL{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new br,this.onMicrotaskEmpty=new br,this.onStable=new br,this.onError=new br}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,a){return t.apply(n,r)}}const g2=new Nn(""),Mv=new Nn("");let aw,ow=(()=>{class e{constructor(n,r,a){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,aw||(function CL(e){aw=e}(a),a.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{bo.assertNotInAngularZone(),nw(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())nw(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,a){let u=-1;r&&r>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(m=>m.timeoutId!==u),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:u,updateCb:a})}whenStable(n,r,a){if(a&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,a),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,a){return[]}}return e.\u0275fac=function(n){return new(n||e)(Yt(bo),Yt(sw),Yt(Mv))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),sw=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return aw?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Zd=null;const _2=new Nn("AllowMultipleToken"),y2=new Nn("PlatformOnDestroy");class v2{constructor(t,n){this.name=t,this.token=n}}function b2(e,t,n=[]){const r=`Platform: ${t}`,a=new Nn(r);return(u=[])=>{let m=lw();if(!m||m.injector.get(_2,!1)){const v=[...n,...u,{provide:a,useValue:!0}];e?e(v):function TL(e){if(Zd&&!Zd.get(_2,!1))throw new Fn(400,"");Zd=e;const t=e.get(C2);(function x2(e){const t=e.get(d2,null);t&&t.forEach(n=>n())})(e)}(function w2(e=[],t){return _o.create({name:t,providers:[{provide:l_,useValue:"platform"},{provide:y2,useValue:()=>Zd=null},...e]})}(v,r))}return function SL(e){const t=lw();if(!t)throw new Fn(401,"");return t}()}}function lw(){return Zd?.get(C2)??null}let C2=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const a=function IL(e,t){let n;return n="noop"===e?new wL:("zone.js"===e?void 0:e)||new bo(t),n}(r?.ngZone,function M2(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),u=[{provide:bo,useValue:a}];return a.run(()=>{const m=_o.create({providers:u,parent:this.injector,name:n.moduleType.name}),v=n.create(m),C=v.injector.get(Qu,null);if(!C)throw new Fn(402,"");return a.runOutsideAngular(()=>{const D=a.onError.subscribe({next:O=>{C.handleError(O)}});v.onDestroy(()=>{Tv(this._modules,v),D.unsubscribe()})}),function E2(e,t,n){try{const r=n();return k_(r)?r.catch(a=>{throw t.runOutsideAngular(()=>e.handleError(a)),a}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(C,a,()=>{const D=v.injector.get(Cv);return D.runInitializers(),D.donePromise.then(()=>(function tT(e){es(e,"Expected localeId to be defined"),"string"==typeof e&&(eT=e.toLowerCase().replace(/_/g,"-"))}(v.injector.get(bh,jm)||jm),this._moduleDoBootstrap(v),v))})})}bootstrapModule(n,r=[]){const a=T2({},r);return function ML(e,t,n){const r=new Nb(n);return Promise.resolve(r)}(0,0,n).then(u=>this.bootstrapModuleFactory(u,a))}_moduleDoBootstrap(n){const r=n.injector.get(Ev);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(a=>r.bootstrap(a));else{if(!n.instance.ngDoBootstrap)throw new Fn(403,"");n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Fn(404,"");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r()),this._injector.get(y2,null)?.(),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Yt(_o))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function T2(e,t){return Array.isArray(t)?t.reduce(T2,e):{...e,...t}}let Ev=(()=>{class e{constructor(n,r,a,u){this._zone=n,this._injector=r,this._exceptionHandler=a,this._initStatus=u,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const m=new Jt(C=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{C.next(this._stable),C.complete()})}),v=new Jt(C=>{let D;this._zone.runOutsideAngular(()=>{D=this._zone.onStable.subscribe(()=>{bo.assertNotInAngularZone(),nw(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,C.next(!0))})})});const O=this._zone.onUnstable.subscribe(()=>{bo.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{C.next(!1)}))});return()=>{D.unsubscribe(),O.unsubscribe()}});this.isStable=function tr(...e){const t=vr(e),n=mr(e,1/0),r=e;return r.length?1===r.length?B(r[0]):ot(n)(mt(r,t)):Zt}(m,v.pipe(function ks(e={}){const{connector:t=(()=>new Wn),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:a=!0}=e;return u=>{let m=null,v=null,C=null,D=0,O=!1,F=!1;const U=()=>{v?.unsubscribe(),v=null},G=()=>{U(),m=C=null,O=F=!1},me=()=>{const Ae=m;G(),Ae?.unsubscribe()};return nr((Ae,We)=>{D++,!F&&!O&&U();const Pe=C=C??t();We.add(()=>{D--,0===D&&!F&&!O&&(v=ya(me,a))}),Pe.subscribe(We),m||(m=new zt({next:dt=>Pe.next(dt),error:dt=>{F=!0,U(),v=ya(G,n,dt),Pe.error(dt)},complete:()=>{O=!0,U(),v=ya(G,r),Pe.complete()}}),mt(Ae).subscribe(m))})(u)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const a=n instanceof ST;if(!this._initStatus.done)throw!a&&function qm(e){const t=Fr(e)||ho(e)||fo(e);return null!==t&&t.standalone}(n),new Fn(405,false);let u;u=a?n:this._injector.get(B_).resolveComponentFactory(n),this.componentTypes.push(u.componentType);const m=function EL(e){return e.isBoundToModule}(u)?void 0:this._injector.get(qd),C=u.create(_o.NULL,[],r||u.selector,m),D=C.location.nativeElement,O=C.injector.get(g2,null);return O?.registerApplication(D),C.onDestroy(()=>{this.detachView(C.hostView),Tv(this.components,C),O?.unregisterApplication(D)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Fn(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;Tv(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(f2,[]).concat(this._bootstrapListeners).forEach(a=>a(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Tv(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Fn(406,false);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Yt(bo),Yt(_o),Yt(Qu),Yt(Cv))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Tv(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let S2=!0,Dv=(()=>{class e{}return e.__NG_ELEMENT_ID__=OL,e})();function OL(e){return function kL(e,t,n){if(Pc(e)&&!n){const r=go(e.index,t);return new U_(r,r)}return 47&e.type?new U_(t[16],t):null}(Oi(),pt(),16==(16&e))}class k2{constructor(){}supports(t){return P_(t)}create(t){return new BL(t)}}const NL=(e,t)=>t;class BL{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||NL}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,a=0,u=null;for(;n||r;){const m=!r||n&&n.currentIndex<L2(r,a,u)?n:r,v=L2(m,a,u),C=m.currentIndex;if(m===r)a--,r=r._nextRemoved;else if(n=n._next,null==m.previousIndex)a++;else{u||(u=[]);const D=v-a,O=C-a;if(D!=O){for(let U=0;U<D;U++){const G=U<u.length?u[U]:u[U]=0,me=G+U;O<=me&&me<D&&(u[U]=G+1)}u[m.previousIndex]=O-D}}v!==C&&t(m,v,C)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!P_(t))throw new Fn(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let a,u,m,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let v=0;v<this.length;v++)u=t[v],m=this._trackByFn(v,u),null!==n&&Object.is(n.trackById,m)?(r&&(n=this._verifyReinsertion(n,u,m,v)),Object.is(n.item,u)||this._addIdentityChange(n,u)):(n=this._mismatch(n,u,m,v),r=!0),n=n._next}else a=0,function cO(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[ap()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,v=>{m=this._trackByFn(a,v),null!==n&&Object.is(n.trackById,m)?(r&&(n=this._verifyReinsertion(n,v,m,a)),Object.is(n.item,v)||this._addIdentityChange(n,v)):(n=this._mismatch(n,v,m,a),r=!0),n=n._next,a++}),this.length=a;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,a){let u;return null===t?u=this._itTail:(u=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,u,a)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,a))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,u,a)):t=this._addAfter(new VL(n,r),u,a),t}_verifyReinsertion(t,n,r,a){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==u?t=this._reinsertAfter(u,t._prev,a):t.currentIndex!=a&&(t.currentIndex=a,this._addToMoves(t,a)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const a=t._prevRemoved,u=t._nextRemoved;return null===a?this._removalsHead=u:a._nextRemoved=u,null===u?this._removalsTail=a:u._prevRemoved=a,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const a=null===n?this._itHead:n._next;return t._next=a,t._prev=n,null===a?this._itTail=t:a._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new R2),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new R2),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class VL{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class UL{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class R2{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new UL,this.map.set(n,r)),r.add(t)}get(t,n){const a=this.map.get(t);return a?a.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function L2(e,t,n){const r=e.previousIndex;if(null===r)return r;let a=0;return n&&r<n.length&&(a=n[r]),r+t+a}function z2(){return new Av([new k2])}let Av=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const a=r.factories.slice();n=n.concat(a)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||z2()),deps:[[e,new xd,new ra]]}}find(n){const r=this.factories.find(a=>a.supports(n));if(null!=r)return r;throw new Fn(901,"")}}return e.\u0275prov=gn({token:e,providedIn:"root",factory:z2}),e})();const qL=b2(null,"core",[]);let ZL=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Yt(Ev))},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({}),e})();let Pv=null;function au(){return Pv}const ps=new Nn("DocumentToken");let Z_=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:function(){return function KL(){return Yt(B2)}()},providedIn:"platform"}),e})();const JL=new Nn("Location Initialized");let B2=(()=>{class e extends Z_{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return au().getBaseHref(this._doc)}onPopState(n){const r=au().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=au().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,a){V2()?this._history.pushState(n,r,a):this.location.hash=a}replaceState(n,r,a){V2()?this._history.replaceState(n,r,a):this.location.hash=a}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:function(){return function QL(){return new B2(Yt(ps))}()},providedIn:"platform"}),e})();function V2(){return!!window.history.pushState}function fw(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function U2(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Ch(e){return e&&"?"!==e[0]?"?"+e:e}let Wm=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:function(){return function e3(){const e=Yt(ps).location;return new j2(Yt(Z_),e&&e.origin||"")}()},providedIn:"root"}),e})();const pw=new Nn("appBaseHref");let j2=(()=>{class e extends Wm{constructor(n,r){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return fw(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Ch(this._platformLocation.search),a=this._platformLocation.hash;return a&&n?`${r}${a}`:r}pushState(n,r,a,u){const m=this.prepareExternalUrl(a+Ch(u));this._platformLocation.pushState(n,r,m)}replaceState(n,r,a,u){const m=this.prepareExternalUrl(a+Ch(u));this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Yt(Z_),Yt(pw,8))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),t3=(()=>{class e extends Wm{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=fw(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,a,u){let m=this.prepareExternalUrl(a+Ch(u));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.pushState(n,r,m)}replaceState(n,r,a,u){let m=this.prepareExternalUrl(a+Ch(u));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Yt(Z_),Yt(pw,8))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),mw=(()=>{class e{constructor(n){this._subject=new br,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._baseHref=U2($2(r)),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Ch(r))}normalize(n){return e.stripTrailingSlash(function r3(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,$2(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",a=null){this._locationStrategy.pushState(a,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Ch(r)),a)}replaceState(n,r="",a=null){this._locationStrategy.replaceState(a,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Ch(r)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(a=>a(n,r))}subscribe(n,r,a){return this._subject.subscribe({next:n,error:r,complete:a})}}return e.normalizeQueryParams=Ch,e.joinWithSlash=fw,e.stripTrailingSlash=U2,e.\u0275fac=function(n){return new(n||e)(Yt(Wm))},e.\u0275prov=gn({token:e,factory:function(){return function n3(){return new mw(Yt(Wm))}()},providedIn:"root"}),e})();function $2(e){return e.replace(/\/index.html$/,"")}function J2(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[a,u]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(a.trim()===t)return decodeURIComponent(u)}return null}class j3{constructor(t,n,r,a){this.$implicit=t,this.ngForOf=n,this.index=r,this.count=a}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Uv=(()=>{class e{constructor(n,r,a){this._viewContainer=n,this._template=r,this._differs=a,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((a,u,m)=>{if(null==a.previousIndex)r.createEmbeddedView(this._template,new j3(a.item,this._ngForOf,-1,-1),null===m?void 0:m);else if(null==m)r.remove(null===u?void 0:u);else if(null!==u){const v=r.get(u);r.move(v,m),eD(v,a)}});for(let a=0,u=r.length;a<u;a++){const v=r.get(a).context;v.index=a,v.count=u,v.ngForOf=this._ngForOf}n.forEachIdentityChange(a=>{eD(r.get(a.currentIndex),a)})}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(rt(oc),rt(xh),rt(Av))},e.\u0275dir=wn({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();function eD(e,t){e.context.$implicit=t.item}let Va=(()=>{class e{constructor(n,r){this._viewContainer=n,this._context=new $3,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){tD("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){tD("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(rt(oc),rt(xh))},e.\u0275dir=wn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class $3{constructor(){this.$implicit=null,this.ngIf=null}}function tD(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Mr(t)}'.`)}class X3{createSubscription(t,n){return t.subscribe({next:n,error:r=>{throw r}})}dispose(t){t.unsubscribe()}}class Y3{createSubscription(t,n){return t.then(n,r=>{throw r})}dispose(t){}}const K3=new Y3,J3=new X3;let rD=(()=>{class e{constructor(n){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){return this._obj?n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue:(n&&this._subscribe(n),this._latestValue)}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,r=>this._updateLatestValue(n,r))}_selectStrategy(n){if(k_(n))return K3;if(aE(n))return J3;throw function ac(e,t){return new Fn(2100,"")}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,r){n===this._obj&&(this._latestValue=r,this._ref.markForCheck())}}return e.\u0275fac=function(n){return new(n||e)(rt(Dv,16))},e.\u0275pipe=oo({name:"async",type:e,pure:!1}),e})(),mF=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({}),e})();let vF=(()=>{class e{}return e.\u0275prov=gn({token:e,providedIn:"root",factory:()=>new xF(Yt(ps),window)}),e})();class xF{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function bF(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let a=r.currentNode;for(;a;){const u=a.shadowRoot;if(u){const m=u.getElementById(t)||u.querySelector(`[name="${t}"]`);if(m)return m}a=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,a=n.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(r-u[0],a-u[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=sD(this.window.history)||sD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function sD(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class aD{}class Iw extends class wF extends class YL{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function XL(e){Pv||(Pv=e)}(new Iw)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function CF(){return Y_=Y_||document.querySelector("base"),Y_?Y_.getAttribute("href"):null}();return null==n?null:function MF(e){jv=jv||document.createElement("a"),jv.setAttribute("href",e);const t=jv.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Y_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return J2(document.cookie,t)}}let jv,Y_=null;const lD=new Nn("TRANSITION_ID"),TF=[{provide:Jb,useFactory:function EF(e,t,n){return()=>{n.get(Cv).donePromise.then(()=>{const r=au(),a=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let u=0;u<a.length;u++)r.remove(a[u])})}},deps:[lD,ps,_o],multi:!0}];let SF=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const $v=new Nn("EventManagerPlugins");let Gv=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(a=>a.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,a){return this._findPluginFor(r).addEventListener(n,r,a)}addGlobalEventListener(n,r,a){return this._findPluginFor(r).addGlobalEventListener(n,r,a)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const a=this._plugins;for(let u=0;u<a.length;u++){const m=a[u];if(m.supports(n))return this._eventNameToPlugin.set(n,m),m}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Yt($v),Yt(bo))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();class cD{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const a=au().getGlobalEventTarget(this._doc,t);if(!a)throw new Error(`Unsupported event target ${a} for event ${n}`);return this.addEventListener(a,n,r)}}let uD=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(a=>{this._stylesSet.has(a)||(this._stylesSet.add(a),r.add(a))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),K_=(()=>{class e extends uD{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,a){n.forEach(u=>{const m=this._doc.createElement("style");m.textContent=u,a.push(r.appendChild(m))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(hD),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,a)=>{this._addStylesToHost(n,a,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(hD))}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();function hD(e){au().remove(e)}const Aw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Pw=/%COMP%/g;function Hv(e,t,n){for(let r=0;r<t.length;r++){let a=t[r];Array.isArray(a)?Hv(e,a,n):(a=a.replace(Pw,e),n.push(a))}return n}function pD(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let Ow=(()=>{class e{constructor(n,r,a){this.eventManager=n,this.sharedStylesHost=r,this.appId=a,this.rendererByCompId=new Map,this.defaultRenderer=new kw(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case So.Emulated:{let a=this.rendererByCompId.get(r.id);return a||(a=new RF(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,a)),a.applyToHost(n),a}case 1:case So.ShadowDom:return new LF(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const a=Hv(r.id,r.styles,[]);this.sharedStylesHost.addStyles(a),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Yt(Gv),Yt(K_),Yt(H_))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();class kw{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(Aw[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(gD(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(gD(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,a){if(a){n=a+":"+n;const u=Aw[a];u?t.setAttributeNS(u,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const a=Aw[r];a?t.removeAttributeNS(a,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,a){a&(Kr.DashCase|Kr.Important)?t.style.setProperty(n,r,a&Kr.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&Kr.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,pD(r)):this.eventManager.addEventListener(t,n,pD(r))}}function gD(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class RF extends kw{constructor(t,n,r,a){super(t),this.component=r;const u=Hv(a+"-"+r.id,r.styles,[]);n.addStyles(u),this.contentAttr=function PF(e){return"_ngcontent-%COMP%".replace(Pw,e)}(a+"-"+r.id),this.hostAttr=function OF(e){return"_nghost-%COMP%".replace(Pw,e)}(a+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class LF extends kw{constructor(t,n,r,a){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=Hv(a.id,a.styles,[]);for(let m=0;m<u.length;m++){const v=document.createElement("style");v.textContent=u[m],this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let FF=(()=>{class e extends cD{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,a){return n.addEventListener(r,a,!1),()=>this.removeEventListener(n,r,a)}removeEventListener(n,r,a){return n.removeEventListener(r,a)}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const _D=["alt","control","meta","shift"],NF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},yD={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},BF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let VF=(()=>{class e extends cD{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,a){const u=e.parseEventName(r),m=e.eventCallback(u.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>au().onAndCancel(n,u.domEventName,m))}static parseEventName(n){const r=n.toLowerCase().split("."),a=r.shift();if(0===r.length||"keydown"!==a&&"keyup"!==a)return null;const u=e._normalizeKey(r.pop());let m="";if(_D.forEach(C=>{const D=r.indexOf(C);D>-1&&(r.splice(D,1),m+=C+".")}),m+=u,0!=r.length||0===u.length)return null;const v={};return v.domEventName=a,v.fullKey=m,v}static getEventFullKey(n){let r="",a=function UF(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&yD.hasOwnProperty(t)&&(t=yD[t]))}return NF[t]||t}(n);return a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),_D.forEach(u=>{u!=a&&BF[u](n)&&(r+=u+".")}),r+=a,r}static eventCallback(n,r,a){return u=>{e.getEventFullKey(u)===n&&a.runGuarded(()=>r(u))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const HF=b2(qL,"browser",[{provide:ew,useValue:"browser"},{provide:d2,useValue:function jF(){Iw.makeCurrent()},multi:!0},{provide:ps,useFactory:function GF(){return function Lp(e){Fl=e}(document),document},deps:[]}]),xD=new Nn(""),bD=[{provide:Mv,useClass:class DF{addToWindow(t){Ir.getAngularTestability=(r,a=!0)=>{const u=t.findTestabilityInTree(r,a);if(null==u)throw new Error("Could not find testability for element.");return u},Ir.getAllAngularTestabilities=()=>t.getAllTestabilities(),Ir.getAllAngularRootElements=()=>t.getAllRootElements(),Ir.frameworkStabilizers||(Ir.frameworkStabilizers=[]),Ir.frameworkStabilizers.push(r=>{const a=Ir.getAllAngularTestabilities();let u=a.length,m=!1;const v=function(C){m=m||C,u--,0==u&&r(m)};a.forEach(function(C){C.whenStable(v)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?au().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:g2,useClass:ow,deps:[bo,sw,Mv]},{provide:ow,useClass:ow,deps:[bo,sw,Mv]}],wD=[{provide:l_,useValue:"root"},{provide:Qu,useFactory:function $F(){return new Qu},deps:[]},{provide:$v,useClass:FF,multi:!0,deps:[ps,bo,ew]},{provide:$v,useClass:VF,multi:!0,deps:[ps]},{provide:Ow,useClass:Ow,deps:[Gv,K_,H_]},{provide:IT,useExisting:Ow},{provide:uD,useExisting:K_},{provide:K_,useClass:K_,deps:[ps]},{provide:Gv,useClass:Gv,deps:[$v,bo]},{provide:aD,useClass:SF,deps:[]},[]];let qF=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:H_,useValue:n.appId},{provide:lD,useExisting:H_},TF]}}}return e.\u0275fac=function(n){return new(n||e)(Yt(xD,12))},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({providers:[...wD,...bD],imports:[mF,ZL]}),e})(),Lw=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:function(n){let r=null;return r=n?new n:function WF(){return new Lw(Yt(ps))}(),r},providedIn:"root"}),e})();typeof window<"u"&&window;let Xm=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:function(n){let r=null;return r=n?new(n||e):Yt(ED),r},providedIn:"root"}),e})(),ED=(()=>{class e extends Xm{constructor(n){super(),this._doc=n}sanitize(n,r){if(null==r)return null;switch(n){case ci.NONE:return r;case ci.HTML:return oi(r,"HTML")?ls(r):Xl(this._doc,String(r)).toString();case ci.STYLE:return oi(r,"Style")?ls(r):r;case ci.SCRIPT:if(oi(r,"Script"))return ls(r);throw new Error("unsafe value used in a script context");case ci.URL:return Og(r),oi(r,"URL")?ls(r):Yu(String(r));case ci.RESOURCE_URL:if(oi(r,"ResourceURL"))return ls(r);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${n} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(n){return function kf(e){return new Jp(e)}(n)}bypassSecurityTrustStyle(n){return function oa(e){return new ll(e)}(n)}bypassSecurityTrustScript(n){return function _1(e){return new Qp(e)}(n)}bypassSecurityTrustUrl(n){return function y1(e){return new Go(e)}(n)}bypassSecurityTrustResourceUrl(n){return function Hy(e){return new ia(e)}(n)}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps))},e.\u0275prov=gn({token:e,factory:function(n){let r=null;return r=n?new n:function nz(e){return new ED(e.get(ps))}(Yt(_o)),r},providedIn:"root"}),e})();function er(...e){return mt(e,vr(e))}class ms extends Wn{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const{isArray:rz}=Array,{getPrototypeOf:iz,prototype:oz,keys:sz}=Object;function TD(e){if(1===e.length){const t=e[0];if(rz(t))return{args:t,keys:null};if(function az(e){return e&&"object"==typeof e&&iz(e)===oz}(t)){const n=sz(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}const{isArray:lz}=Array;function zw(e){return Mn(t=>function cz(e,t){return lz(t)?e(...t):e(t)}(e,t))}function DD(e,t){return e.reduce((n,r,a)=>(n[r]=t[a],n),{})}function SD(...e){const t=vr(e),n=cr(e),{args:r,keys:a}=TD(e);if(0===r.length)return mt([],t);const u=new Jt(function uz(e,t,n=Rt){return r=>{ID(t,()=>{const{length:a}=e,u=new Array(a);let m=a,v=a;for(let C=0;C<a;C++)ID(t,()=>{const D=mt(e[C],t);let O=!1;D.subscribe(cn(r,F=>{u[C]=F,O||(O=!0,v--),v||r.next(n(u.slice()))},()=>{--m||r.complete()}))},r)},r)}}(r,t,a?m=>DD(a,m):Rt));return n?u.pipe(zw(n)):u}function ID(e,t,n){e?Se(n,e,t):t()}function J_(e,t){const n=$e(e)?e:()=>e,r=a=>a.error(n());return new Jt(t?a=>t.schedule(r,0,a):r)}const Q_=Ue(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function qv(...e){return function hz(){return ot(1)}()(mt(e,vr(e)))}function AD(e){return new Jt(t=>{B(e()).subscribe(t)})}function Nw(){return nr((e,t)=>{let n=null;e._refCount++;const r=cn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const a=e._connection,u=n;n=null,a&&(!u||a===u)&&a.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class PD extends Jt{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Yi(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new W;const n=this.getSubject();t.add(this.source.subscribe(cn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=W.EMPTY)}return t}refCount(){return Nw()(this)}}function lu(e,t){return nr((n,r)=>{let a=null,u=0,m=!1;const v=()=>m&&!a&&r.complete();n.subscribe(cn(r,C=>{a?.unsubscribe();let D=0;const O=u++;B(e(C,O)).subscribe(a=cn(r,F=>r.next(t?t(C,F,O,D++):F),()=>{a=null,v()}))},()=>{m=!0,v()}))})}function fz(e,t,n,r,a){return(u,m)=>{let v=n,C=t,D=0;u.subscribe(cn(m,O=>{const F=D++;C=v?e(C,O,F):(v=!0,O),r&&m.next(C)},a&&(()=>{v&&m.next(C),m.complete()})))}}function OD(e,t){return nr(fz(e,t,arguments.length>=2,!0))}function cu(e,t){return nr((n,r)=>{let a=0;n.subscribe(cn(r,u=>e.call(t,u,a++)&&r.next(u)))})}function Xd(e){return nr((t,n)=>{let u,r=null,a=!1;r=t.subscribe(cn(n,void 0,void 0,m=>{u=B(e(m,Xd(e)(t))),r?(r.unsubscribe(),r=null,u.subscribe(n)):a=!0})),a&&(r.unsubscribe(),r=null,u.subscribe(n))})}function Ym(e,t){return $e(t)?gt(e,t,1):gt(e,1)}function Zv(e){return e<=0?()=>Zt:nr((t,n)=>{let r=[];t.subscribe(cn(n,a=>{r.push(a),e<r.length&&r.shift()},()=>{for(const a of r)n.next(a);n.complete()},void 0,()=>{r=null}))})}function kD(e=pz){return nr((t,n)=>{let r=!1;t.subscribe(cn(n,a=>{r=!0,n.next(a)},()=>r?n.complete():n.error(e())))})}function pz(){return new Q_}function Bw(e){return nr((t,n)=>{let r=!1;t.subscribe(cn(n,a=>{r=!0,n.next(a)},()=>{r||n.next(e),n.complete()}))})}function Bo(e,t){const n=arguments.length>=2;return r=>r.pipe(e?cu((a,u)=>e(a,u,r)):Rt,bn(1),n?Bw(t):kD(()=>new Q_))}function ro(e,t,n){const r=$e(e)||t||n?{next:e,error:t,complete:n}:e;return r?nr((a,u)=>{var m;null===(m=r.subscribe)||void 0===m||m.call(r);let v=!0;a.subscribe(cn(u,C=>{var D;null===(D=r.next)||void 0===D||D.call(r,C),u.next(C)},()=>{var C;v=!1,null===(C=r.complete)||void 0===C||C.call(r),u.complete()},C=>{var D;v=!1,null===(D=r.error)||void 0===D||D.call(r,C),u.error(C)},()=>{var C,D;v&&(null===(C=r.unsubscribe)||void 0===C||C.call(r)),null===(D=r.finalize)||void 0===D||D.call(r)}))}):Rt}function RD(e){return Mn(()=>e)}function Vw(e){return nr((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}class Eh{constructor(t,n){this.id=t,this.url=n}}class Uw extends Eh{constructor(t,n,r="imperative",a=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ey extends Eh{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class LD extends Eh{constructor(t,n,r){super(t,n),this.reason=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class gz extends Eh{constructor(t,n,r){super(t,n),this.error=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class _z extends Eh{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class yz extends Eh{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vz extends Eh{constructor(t,n,r,a,u){super(t,n),this.urlAfterRedirects=r,this.state=a,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class xz extends Eh{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bz extends Eh{constructor(t,n,r,a){super(t,n),this.urlAfterRedirects=r,this.state=a,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wz{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Cz{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Mz{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ez{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Tz{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Dz{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class FD{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const pr="primary";class Sz{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Km(e){return new Sz(e)}const zD="ngNavigationCancelingError";function jw(e){const t=Error("NavigationCancelingError: "+e);return t[zD]=!0,t}function Az(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const a={};for(let u=0;u<r.length;u++){const m=r[u],v=e[u];if(m.startsWith(":"))a[m.substring(1)]=v;else if(m!==v.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}function uu(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let a;for(let u=0;u<n.length;u++)if(a=n[u],!ND(e[a],t[a]))return!1;return!0}function ND(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((a,u)=>r[u]===a)}return e===t}function BD(e){return Array.prototype.concat.apply([],e)}function VD(e){return e.length>0?e[e.length-1]:null}function gs(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function lc(e){return Mb(e)?e:k_(e)?mt(Promise.resolve(e)):er(e)}const kz={exact:function $D(e,t,n){if(!fp(e.segments,t.segments)||!Wv(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!$D(e.children[r],t.children[r],n))return!1;return!0},subset:GD},UD={exact:function Rz(e,t){return uu(e,t)},subset:function Lz(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>ND(e[n],t[n]))},ignored:()=>!0};function jD(e,t,n){return kz[n.paths](e.root,t.root,n.matrixParams)&&UD[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function GD(e,t,n){return HD(e,t,t.segments,n)}function HD(e,t,n,r){if(e.segments.length>n.length){const a=e.segments.slice(0,n.length);return!(!fp(a,n)||t.hasChildren()||!Wv(a,n,r))}if(e.segments.length===n.length){if(!fp(e.segments,n)||!Wv(e.segments,n,r))return!1;for(const a in t.children)if(!e.children[a]||!GD(e.children[a],t.children[a],r))return!1;return!0}{const a=n.slice(0,e.segments.length),u=n.slice(e.segments.length);return!!(fp(e.segments,a)&&Wv(e.segments,a,r)&&e.children[pr])&&HD(e.children[pr],t,u,r)}}function Wv(e,t,n){return t.every((r,a)=>UD[n](e[a].parameters,r.parameters))}class dp{constructor(t,n,r){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Km(this.queryParams)),this._queryParamMap}toString(){return Nz.serialize(this)}}class Dr{constructor(t,n){this.segments=t,this.children=n,this.parent=null,gs(n,(r,a)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Xv(this)}}class ty{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Km(this.parameters)),this._parameterMap}toString(){return YD(this)}}function fp(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}class qD{}class ZD{parse(t){const n=new Zz(t);return new dp(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${ny(t.root,!0)}`,r=function Uz(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(a=>`${Yv(n)}=${Yv(a)}`).join("&"):`${Yv(n)}=${Yv(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function Bz(e){return encodeURI(e)}(t.fragment)}`:""}`}}const Nz=new ZD;function Xv(e){return e.segments.map(t=>YD(t)).join("/")}function ny(e,t){if(!e.hasChildren())return Xv(e);if(t){const n=e.children[pr]?ny(e.children[pr],!1):"",r=[];return gs(e.children,(a,u)=>{u!==pr&&r.push(`${u}:${ny(a,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function zz(e,t){let n=[];return gs(e.children,(r,a)=>{a===pr&&(n=n.concat(t(r,a)))}),gs(e.children,(r,a)=>{a!==pr&&(n=n.concat(t(r,a)))}),n}(e,(r,a)=>a===pr?[ny(e.children[pr],!1)]:[`${a}:${ny(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[pr]?`${Xv(e)}/${n[0]}`:`${Xv(e)}/(${n.join("//")})`}}function WD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Yv(e){return WD(e).replace(/%3B/gi,";")}function $w(e){return WD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Kv(e){return decodeURIComponent(e)}function XD(e){return Kv(e.replace(/\+/g,"%20"))}function YD(e){return`${$w(e.path)}${function Vz(e){return Object.keys(e).map(t=>`;${$w(t)}=${$w(e[t])}`).join("")}(e.parameters)}`}const jz=/^[^\/()?;=#]+/;function Jv(e){const t=e.match(jz);return t?t[0]:""}const $z=/^[^=?&#]+/,Hz=/^[^&#]+/;class Zz{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Dr([],{}):new Dr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[pr]=new Dr(t,n)),r}parseSegment(){const t=Jv(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new ty(Kv(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=Jv(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const a=Jv(this.remaining);a&&(r=a,this.capture(r))}t[Kv(n)]=Kv(r)}parseQueryParam(t){const n=function Gz(e){const t=e.match($z);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const m=function qz(e){const t=e.match(Hz);return t?t[0]:""}(this.remaining);m&&(r=m,this.capture(r))}const a=XD(n),u=XD(r);if(t.hasOwnProperty(a)){let m=t[a];Array.isArray(m)||(m=[m],t[a]=m),m.push(u)}else t[a]=u}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Jv(this.remaining),a=this.remaining[r.length];if("/"!==a&&")"!==a&&";"!==a)throw new Error(`Cannot parse url '${this.url}'`);let u;r.indexOf(":")>-1?(u=r.slice(0,r.indexOf(":")),this.capture(u),this.capture(":")):t&&(u=pr);const m=this.parseChildren();n[u]=1===Object.keys(m).length?m[pr]:new Dr([],m),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class KD{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Gw(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=Gw(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=Hw(t,this._root);return n.length<2?[]:n[n.length-2].children.map(a=>a.value).filter(a=>a!==t)}pathFromRoot(t){return Hw(t,this._root).map(n=>n.value)}}function Gw(e,t){if(e===t.value)return t;for(const n of t.children){const r=Gw(e,n);if(r)return r}return null}function Hw(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Hw(e,n);if(r.length)return r.unshift(t),r}return[]}class Th{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Jm(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class JD extends KD{constructor(t,n){super(t),this.snapshot=n,qw(this,t)}toString(){return this.snapshot.toString()}}function QD(e,t){const n=function Wz(e,t){const m=new Qv([],{},{},"",{},pr,t,null,e.root,-1,{});return new tS("",new Th(m,[]))}(e,t),r=new ms([new ty("",{})]),a=new ms({}),u=new ms({}),m=new ms({}),v=new ms(""),C=new Yd(r,a,m,v,u,pr,t,n.root);return C.snapshot=n.root,new JD(new Th(C,[]),n)}class Yd{constructor(t,n,r,a,u,m,v,C){this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=u,this.outlet=m,this.component=v,this._futureSnapshot=C}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Mn(t=>Km(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Mn(t=>Km(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function eS(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const a=n[r],u=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(u.component)break;r--}}return function Xz(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Qv{constructor(t,n,r,a,u,m,v,C,D,O,F,U){this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=u,this.outlet=m,this.component=v,this.routeConfig=C,this._urlSegment=D,this._lastPathIndex=O,this._correctedLastPathIndex=U??O,this._resolve=F}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Km(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Km(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class tS extends KD{constructor(t,n){super(n),this.url=t,qw(this,n)}toString(){return nS(this._root)}}function qw(e,t){t.value._routerState=e,t.children.forEach(n=>qw(e,n))}function nS(e){const t=e.children.length>0?` { ${e.children.map(nS).join(", ")} } `:"";return`${e.value}${t}`}function Zw(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,uu(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),uu(t.params,n.params)||e.params.next(n.params),function Pz(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!uu(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),uu(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Ww(e,t){const n=uu(e.params,t.params)&&function Fz(e,t){return fp(e,t)&&e.every((n,r)=>uu(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||Ww(e.parent,t.parent))}function ry(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const a=function Kz(e,t,n){return t.children.map(r=>{for(const a of n.children)if(e.shouldReuseRoute(r.value,a.value.snapshot))return ry(e,r,a);return ry(e,r)})}(e,t,n);return new Th(r,a)}{if(e.shouldAttach(t.value)){const u=e.retrieve(t.value);if(null!==u){const m=u.route;return m.value._futureSnapshot=t.value,m.children=t.children.map(v=>ry(e,v)),m}}const r=function Jz(e){return new Yd(new ms(e.url),new ms(e.params),new ms(e.queryParams),new ms(e.fragment),new ms(e.data),e.outlet,e.component,e)}(t.value),a=t.children.map(u=>ry(e,u));return new Th(r,a)}}function ex(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function iy(e){return"object"==typeof e&&null!=e&&e.outlets}function Xw(e,t,n,r,a){let u={};if(r&&gs(r,(v,C)=>{u[C]=Array.isArray(v)?v.map(D=>`${D}`):`${v}`}),e===t)return new dp(n,u,a);const m=rS(e,t,n);return new dp(m,u,a)}function rS(e,t,n){const r={};return gs(e.children,(a,u)=>{r[u]=a===t?n:rS(a,t,n)}),new Dr(e.segments,r)}class iS{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&ex(r[0]))throw new Error("Root segment cannot have matrix parameters");const a=r.find(iy);if(a&&a!==VD(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Yw{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function oS(e,t,n){if(e||(e=new Dr([],{})),0===e.segments.length&&e.hasChildren())return tx(e,t,n);const r=function i4(e,t,n){let r=0,a=t;const u={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(r>=n.length)return u;const m=e.segments[a],v=n[r];if(iy(v))break;const C=`${v}`,D=r<n.length-1?n[r+1]:null;if(a>0&&void 0===C)break;if(C&&D&&"object"==typeof D&&void 0===D.outlets){if(!aS(C,D,m))return u;r+=2}else{if(!aS(C,{},m))return u;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const u=new Dr(e.segments.slice(0,r.pathIndex),{});return u.children[pr]=new Dr(e.segments.slice(r.pathIndex),e.children),tx(u,0,a)}return r.match&&0===a.length?new Dr(e.segments,{}):r.match&&!e.hasChildren()?Kw(e,t,n):r.match?tx(e,0,a):Kw(e,t,n)}function tx(e,t,n){if(0===n.length)return new Dr(e.segments,{});{const r=function r4(e){return iy(e[0])?e[0].outlets:{[pr]:e}}(n),a={};return gs(r,(u,m)=>{"string"==typeof u&&(u=[u]),null!==u&&(a[m]=oS(e.children[m],t,u))}),gs(e.children,(u,m)=>{void 0===r[m]&&(a[m]=u)}),new Dr(e.segments,a)}}function Kw(e,t,n){const r=e.segments.slice(0,t);let a=0;for(;a<n.length;){const u=n[a];if(iy(u)){const C=o4(u.outlets);return new Dr(r,C)}if(0===a&&ex(n[0])){r.push(new ty(e.segments[t].path,sS(n[0]))),a++;continue}const m=iy(u)?u.outlets[pr]:`${u}`,v=a<n.length-1?n[a+1]:null;m&&v&&ex(v)?(r.push(new ty(m,sS(v))),a+=2):(r.push(new ty(m,{})),a++)}return new Dr(r,{})}function o4(e){const t={};return gs(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=Kw(new Dr([],{}),0,n))}),t}function sS(e){const t={};return gs(e,(n,r)=>t[r]=`${n}`),t}function aS(e,t,n){return e==n.path&&uu(t,n.parameters)}class s4{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new oy,this.attachRef=null}}class oy{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const r=this.getOrCreateContext(t);r.outlet=n,this.contexts.set(t,r)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new s4,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let Jw=(()=>{class e{constructor(n,r,a,u,m){this.parentContexts=n,this.location=r,this.changeDetector=u,this.environmentInjector=m,this.activated=null,this._activatedRoute=null,this.activateEvents=new br,this.deactivateEvents=new br,this.attachEvents=new br,this.detachEvents=new br,this.name=a||pr,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const a=this.location,m=n._futureSnapshot.component,v=this.parentContexts.getOrCreateContext(this.name).children,C=new a4(n,v,a.injector);if(r&&function l4(e){return!!e.resolveComponentFactory}(r)){const D=r.resolveComponentFactory(m);this.activated=a.createComponent(D,a.length,C)}else this.activated=a.createComponent(m,{index:a.length,injector:C,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(rt(oy),rt(oc),function fd(e){return function zr(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const r=n.length;let a=0;for(;a<r;){const u=n[a];if(xt(u))break;if(0===u)a+=2;else if("number"==typeof u)for(a++;a<r&&"string"==typeof n[a];)a++;else{if(u===t)return n[a+1];a+=2}}}return null}(Oi(),e)}("name"),rt(Dv),rt(sh))},e.\u0275dir=wn({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class a4{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===Yd?this.route:t===oy?this.childContexts:this.parent.get(t,n)}}let lS=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,r){1&n&&on(0,"router-outlet")},dependencies:[Jw],encapsulation:2}),e})();function cS(e,t){return e.providers&&!e._injector&&(e._injector=_v(e.providers,t,`Route: ${e.path}`)),e._injector??t}function eC(e){const t=e.children&&e.children.map(eC),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==pr&&(n.component=lS),n}function _l(e){return e.outlet||pr}function uS(e,t){const n=e.filter(r=>_l(r)===t);return n.push(...e.filter(r=>_l(r)!==t)),n}function hS(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class f4{constructor(t,n,r,a){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),Zw(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const a=Jm(n);t.children.forEach(u=>{const m=u.value.outlet;this.deactivateRoutes(u,a[m],r),delete a[m]}),gs(a,(u,m)=>{this.deactivateRouteAndItsChildren(u,r)})}deactivateRoutes(t,n,r){const a=t.value,u=n?n.value:null;if(a===u)if(a.component){const m=r.getContext(a.outlet);m&&this.deactivateChildRoutes(t,n,m.children)}else this.deactivateChildRoutes(t,n,r);else u&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),a=r&&t.value.component?r.children:n,u=Jm(t);for(const m of Object.keys(u))this.deactivateRouteAndItsChildren(u[m],a);if(r&&r.outlet){const m=r.outlet.detach(),v=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:m,route:t,contexts:v})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),a=r&&t.value.component?r.children:n,u=Jm(t);for(const m of Object.keys(u))this.deactivateRouteAndItsChildren(u[m],a);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const a=Jm(n);t.children.forEach(u=>{this.activateRoutes(u,a[u.value.outlet],r),this.forwardEvent(new Dz(u.value.snapshot))}),t.children.length&&this.forwardEvent(new Ez(t.value.snapshot))}activateRoutes(t,n,r){const a=t.value,u=n?n.value:null;if(Zw(a),a===u)if(a.component){const m=r.getOrCreateContext(a.outlet);this.activateChildRoutes(t,n,m.children)}else this.activateChildRoutes(t,n,r);else if(a.component){const m=r.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const v=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),m.children.onOutletReAttached(v.contexts),m.attachRef=v.componentRef,m.route=v.route.value,m.outlet&&m.outlet.attach(v.componentRef,v.route.value),Zw(v.route.value),this.activateChildRoutes(t,null,m.children)}else{const v=hS(a.snapshot),C=v?.get(B_)??null;m.attachRef=null,m.route=a,m.resolver=C,m.injector=v,m.outlet&&m.outlet.activateWith(a,m.injector),this.activateChildRoutes(t,null,m.children)}}else this.activateChildRoutes(t,null,r)}}function Kd(e){return"function"==typeof e}function pp(e){return e instanceof dp}const sy=Symbol("INITIAL_VALUE");function ay(){return lu(e=>SD(e.map(t=>t.pipe(bn(1),function dz(...e){const t=vr(e);return nr((n,r)=>{(t?qv(e,n,t):qv(e,n)).subscribe(r)})}(sy)))).pipe(OD((t,n)=>{let r=!1;return n.reduce((a,u,m)=>a!==sy?a:(u===sy&&(r=!0),r||!1!==u&&m!==n.length-1&&!pp(u)?a:u),t)},sy),cu(t=>t!==sy),Mn(t=>pp(t)?t:!0===t),bn(1)))}const dS={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function nx(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...dS}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const a=(t.matcher||Az)(n,e,t);if(!a)return{...dS};const u={};gs(a.posParams,(v,C)=>{u[C]=v.path});const m=a.consumed.length>0?{...u,...a.consumed[a.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:a.consumed,remainingSegments:n.slice(a.consumed.length),parameters:m,positionalParamSegments:a.posParams??{}}}function rx(e,t,n,r,a="corrected"){if(n.length>0&&function b4(e,t,n){return n.some(r=>ix(e,t,r)&&_l(r)!==pr)}(e,n,r)){const m=new Dr(t,function x4(e,t,n,r){const a={};a[pr]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const u of n)if(""===u.path&&_l(u)!==pr){const m=new Dr([],{});m._sourceSegment=e,m._segmentIndexShift=t.length,a[_l(u)]=m}return a}(e,t,r,new Dr(n,e.children)));return m._sourceSegment=e,m._segmentIndexShift=t.length,{segmentGroup:m,slicedSegments:[]}}if(0===n.length&&function w4(e,t,n){return n.some(r=>ix(e,t,r))}(e,n,r)){const m=new Dr(e.segments,function v4(e,t,n,r,a,u){const m={};for(const v of r)if(ix(e,n,v)&&!a[_l(v)]){const C=new Dr([],{});C._sourceSegment=e,C._segmentIndexShift="legacy"===u?e.segments.length:t.length,m[_l(v)]=C}return{...a,...m}}(e,t,n,r,e.children,a));return m._sourceSegment=e,m._segmentIndexShift=t.length,{segmentGroup:m,slicedSegments:n}}const u=new Dr(e.segments,e.children);return u._sourceSegment=e,u._segmentIndexShift=t.length,{segmentGroup:u,slicedSegments:n}}function ix(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function fS(e,t,n,r){return!!(_l(e)===r||r!==pr&&ix(t,n,e))&&("**"===e.path||nx(t,e,n).matched)}function pS(e,t,n){return 0===t.length&&!e.children[n]}class ox{constructor(t){this.segmentGroup=t||null}}class mS{constructor(t){this.urlTree=t}}function ly(e){return J_(new ox(e))}function gS(e){return J_(new mS(e))}class T4{constructor(t,n,r,a,u){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=u,this.allowRedirects=!0}apply(){const t=rx(this.urlTree.root,[],[],this.config).segmentGroup,n=new Dr(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,pr).pipe(Mn(u=>this.createUrlTree(tC(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Xd(u=>{if(u instanceof mS)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof ox?this.noMatchError(u):u}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,pr).pipe(Mn(a=>this.createUrlTree(tC(a),t.queryParams,t.fragment))).pipe(Xd(a=>{throw a instanceof ox?this.noMatchError(a):a}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,r){const a=t.segments.length>0?new Dr([],{[pr]:t}):t;return new dp(a,n,r)}expandSegmentGroup(t,n,r,a){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(Mn(u=>new Dr([],u))):this.expandSegment(t,r,n,r.segments,a,!0)}expandChildren(t,n,r){const a=[];for(const u of Object.keys(r.children))"primary"===u?a.unshift(u):a.push(u);return mt(a).pipe(Ym(u=>{const m=r.children[u],v=uS(n,u);return this.expandSegmentGroup(t,v,m,u).pipe(Mn(C=>({segment:C,outlet:u})))}),OD((u,m)=>(u[m.outlet]=m.segment,u),{}),function mz(e,t){const n=arguments.length>=2;return r=>r.pipe(e?cu((a,u)=>e(a,u,r)):Rt,Zv(1),n?Bw(t):kD(()=>new Q_))}())}expandSegment(t,n,r,a,u,m){return mt(r).pipe(Ym(v=>this.expandSegmentAgainstRoute(t,n,r,v,a,u,m).pipe(Xd(D=>{if(D instanceof ox)return er(null);throw D}))),Bo(v=>!!v),Xd((v,C)=>{if(v instanceof Q_||"EmptyError"===v.name)return pS(n,a,u)?er(new Dr([],{})):ly(n);throw v}))}expandSegmentAgainstRoute(t,n,r,a,u,m,v){return fS(a,n,u,m)?void 0===a.redirectTo?this.matchSegmentAgainstRoute(t,n,a,u,m):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,a,u,m):ly(n):ly(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,a,u,m){return"**"===a.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,a,m):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,a,u,m)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,a){const u=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?gS(u):this.lineralizeSegments(r,u).pipe(gt(m=>{const v=new Dr(m,{});return this.expandSegment(t,v,n,m,a,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,a,u,m){const{matched:v,consumedSegments:C,remainingSegments:D,positionalParamSegments:O}=nx(n,a,u);if(!v)return ly(n);const F=this.applyRedirectCommands(C,a.redirectTo,O);return a.redirectTo.startsWith("/")?gS(F):this.lineralizeSegments(a,F).pipe(gt(U=>this.expandSegment(t,n,r,U.concat(D),m,!1)))}matchSegmentAgainstRoute(t,n,r,a,u){if("**"===r.path)return t=cS(r,t),r.loadChildren?(r._loadedRoutes?er({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(Mn(F=>(r._loadedRoutes=F.routes,r._loadedInjector=F.injector,new Dr(a,{})))):er(new Dr(a,{}));const{matched:m,consumedSegments:v,remainingSegments:C}=nx(n,r,a);return m?(t=cS(r,t),this.getChildConfig(t,r,a).pipe(gt(O=>{const F=O.injector??t,U=O.routes,{segmentGroup:G,slicedSegments:me}=rx(n,v,C,U),Ae=new Dr(G.segments,G.children);if(0===me.length&&Ae.hasChildren())return this.expandChildren(F,U,Ae).pipe(Mn(Ge=>new Dr(v,Ge)));if(0===U.length&&0===me.length)return er(new Dr(v,{}));const We=_l(r)===u;return this.expandSegment(F,Ae,U,me,We?pr:u,!0).pipe(Mn(dt=>new Dr(v.concat(dt.segments),dt.children)))}))):ly(n)}getChildConfig(t,n,r){return n.children?er({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?er({routes:n._loadedRoutes,injector:n._loadedInjector}):this.runCanLoadGuards(t,n,r).pipe(gt(a=>a?this.configLoader.loadChildren(t,n).pipe(ro(u=>{n._loadedRoutes=u.routes,n._loadedInjector=u.injector})):function M4(e){return J_(jw(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`))}(n))):er({routes:[],injector:t})}runCanLoadGuards(t,n,r){const a=n.canLoad;return a&&0!==a.length?er(a.map(m=>{const v=t.get(m);let C;if(function m4(e){return e&&Kd(e.canLoad)}(v))C=v.canLoad(n,r);else{if(!Kd(v))throw new Error("Invalid CanLoad guard");C=v(n,r)}return lc(C)})).pipe(ay(),ro(m=>{if(!pp(m))return;const v=jw(`Redirecting to "${this.urlSerializer.serialize(m)}"`);throw v.url=m,v}),Mn(m=>!0===m)):er(!0)}lineralizeSegments(t,n){let r=[],a=n.root;for(;;){if(r=r.concat(a.segments),0===a.numberOfChildren)return er(r);if(a.numberOfChildren>1||!a.children[pr])return J_(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t.redirectTo}'`));a=a.children[pr]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreatreUrlTree(t,n,r,a){const u=this.createSegmentGroup(t,n.root,r,a);return new dp(u,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return gs(t,(a,u)=>{if("string"==typeof a&&a.startsWith(":")){const v=a.substring(1);r[u]=n[v]}else r[u]=a}),r}createSegmentGroup(t,n,r,a){const u=this.createSegments(t,n.segments,r,a);let m={};return gs(n.children,(v,C)=>{m[C]=this.createSegmentGroup(t,v,r,a)}),new Dr(u,m)}createSegments(t,n,r,a){return n.map(u=>u.path.startsWith(":")?this.findPosParam(t,u,a):this.findOrReturn(u,r))}findPosParam(t,n,r){const a=r[n.path.substring(1)];if(!a)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return a}findOrReturn(t,n){let r=0;for(const a of n){if(a.path===t.path)return n.splice(r),a;r++}return t}}function tC(e){const t={};for(const r of Object.keys(e.children)){const u=tC(e.children[r]);(u.segments.length>0||u.hasChildren())&&(t[r]=u)}return function D4(e){if(1===e.numberOfChildren&&e.children[pr]){const t=e.children[pr];return new Dr(e.segments.concat(t.segments),t.children)}return e}(new Dr(e.segments,t))}class _S{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class sx{constructor(t,n){this.component=t,this.route=n}}function I4(e,t,n){const r=e._root;return cy(r,t?t._root:null,n,[r.value])}function ax(e,t,n){return(hS(t)??n).get(e)}function cy(e,t,n,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=Jm(t);return e.children.forEach(m=>{(function P4(e,t,n,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,m=t?t.value:null,v=n?n.getContext(e.value.outlet):null;if(m&&u.routeConfig===m.routeConfig){const C=function O4(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!fp(e.url,t.url);case"pathParamsOrQueryParamsChange":return!fp(e.url,t.url)||!uu(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ww(e,t)||!uu(e.queryParams,t.queryParams);default:return!Ww(e,t)}}(m,u,u.routeConfig.runGuardsAndResolvers);C?a.canActivateChecks.push(new _S(r)):(u.data=m.data,u._resolvedData=m._resolvedData),cy(e,t,u.component?v?v.children:null:n,r,a),C&&v&&v.outlet&&v.outlet.isActivated&&a.canDeactivateChecks.push(new sx(v.outlet.component,m))}else m&&uy(t,v,a),a.canActivateChecks.push(new _S(r)),cy(e,null,u.component?v?v.children:null:n,r,a)})(m,u[m.value.outlet],n,r.concat([m.value]),a),delete u[m.value.outlet]}),gs(u,(m,v)=>uy(m,n.getContext(v),a)),a}function uy(e,t,n){const r=Jm(e),a=e.value;gs(r,(u,m)=>{uy(u,a.component?t?t.children.getContext(m):null:t,n)}),n.canDeactivateChecks.push(new sx(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}class U4{}function vS(e){return new Jt(t=>t.error(e))}class $4{constructor(t,n,r,a,u,m){this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=m}recognize(){const t=rx(this.urlTree.root,[],[],this.config.filter(m=>void 0===m.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,pr);if(null===n)return null;const r=new Qv([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},pr,this.rootComponentType,null,this.urlTree.root,-1,{}),a=new Th(r,n),u=new tS(this.url,a);return this.inheritParamsAndData(u._root),u}inheritParamsAndData(t){const n=t.value,r=eS(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(a=>this.inheritParamsAndData(a))}processSegmentGroup(t,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,r)}processChildren(t,n){const r=[];for(const u of Object.keys(n.children)){const m=n.children[u],v=uS(t,u),C=this.processSegmentGroup(v,m,u);if(null===C)return null;r.push(...C)}const a=xS(r);return function G4(e){e.sort((t,n)=>t.value.outlet===pr?-1:n.value.outlet===pr?1:t.value.outlet.localeCompare(n.value.outlet))}(a),a}processSegment(t,n,r,a){for(const u of t){const m=this.processSegmentAgainstRoute(u,n,r,a);if(null!==m)return m}return pS(n,r,a)?[]:null}processSegmentAgainstRoute(t,n,r,a){if(t.redirectTo||!fS(t,n,r,a))return null;let u,m=[],v=[];if("**"===t.path){const G=r.length>0?VD(r).parameters:{},me=wS(n)+r.length;u=new Qv(r,G,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MS(t),_l(t),t.component??t._loadedComponent??null,t,bS(n),me,ES(t),me)}else{const G=nx(n,t,r);if(!G.matched)return null;m=G.consumedSegments,v=G.remainingSegments;const me=wS(n)+m.length;u=new Qv(m,G.parameters,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MS(t),_l(t),t.component??t._loadedComponent??null,t,bS(n),me,ES(t),me)}const C=function H4(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(t),{segmentGroup:D,slicedSegments:O}=rx(n,m,v,C.filter(G=>void 0===G.redirectTo),this.relativeLinkResolution);if(0===O.length&&D.hasChildren()){const G=this.processChildren(C,D);return null===G?null:[new Th(u,G)]}if(0===C.length&&0===O.length)return[new Th(u,[])];const F=_l(t)===a,U=this.processSegment(C,D,O,F?pr:a);return null===U?null:[new Th(u,U)]}}function q4(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function xS(e){const t=[],n=new Set;for(const r of e){if(!q4(r)){t.push(r);continue}const a=t.find(u=>r.value.routeConfig===u.value.routeConfig);void 0!==a?(a.children.push(...r.children),n.add(a)):t.push(r)}for(const r of n){const a=xS(r.children);t.push(new Th(r.value,a))}return t.filter(r=>!n.has(r))}function bS(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function wS(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function MS(e){return e.data||{}}function ES(e){return e.resolve||{}}const nC=Symbol("RouteTitle");function TS(e){return"string"==typeof e.title||null===e.title}function rC(e){return lu(t=>{const n=e(t);return n?mt(n).pipe(Mn(()=>t)):er(t)})}class tN extends class eN{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const iC=new Nn("ROUTES");let oC=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return er(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=lc(n.loadComponent()).pipe(ro(u=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=u}),Vw(()=>{this.componentLoaders.delete(n)})),a=new PD(r,()=>new Wn).pipe(Nw());return this.componentLoaders.set(n,a),a}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return er({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const u=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Mn(v=>{this.onLoadEndListener&&this.onLoadEndListener(r);let C,D,O=!1;Array.isArray(v)?D=v:(C=v.create(n).injector,D=BD(C.get(iC,[],Dn.Self|Dn.Optional)));return{routes:D.map(eC),injector:C}}),Vw(()=>{this.childrenLoaders.delete(r)})),m=new PD(u,()=>new Wn).pipe(Nw());return this.childrenLoaders.set(r,m),m}loadModuleFactoryOrRoutes(n){return lc(n()).pipe(gt(r=>r instanceof DT||Array.isArray(r)?er(r):mt(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(n){return new(n||e)(Yt(_o),Yt(tw))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();class rN{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function oN(e){throw e}function sN(e,t,n){return t.parse("/")}const aN={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},lN={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ua=(()=>{class e{constructor(n,r,a,u,m,v,C){this.rootComponentType=n,this.urlSerializer=r,this.rootContexts=a,this.location=u,this.config=C,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Wn,this.errorHandler=oN,this.malformedUriErrorHandler=sN,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>er(void 0),this.urlHandlingStrategy=new rN,this.routeReuseStrategy=new tN,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=m.get(oC),this.configLoader.onLoadEndListener=U=>this.triggerEvent(new Cz(U)),this.configLoader.onLoadStartListener=U=>this.triggerEvent(new wz(U)),this.ngModule=m.get(qd),this.console=m.get(dL);const F=m.get(bo);this.isNgZoneEnabled=F instanceof bo&&bo.isInAngularZone(),this.resetConfig(C),this.currentUrlTree=function Oz(){return new dp(new Dr([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=QD(this.currentUrlTree,this.rootComponentType),this.transitions=new ms({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(n){const r=this.events;return n.pipe(cu(a=>0!==a.id),Mn(a=>({...a,extractedUrl:this.urlHandlingStrategy.extract(a.rawUrl)})),lu(a=>{let u=!1,m=!1;return er(a).pipe(ro(v=>{this.currentNavigation={id:v.id,initialUrl:v.rawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),lu(v=>{const C=this.browserUrlTree.toString(),D=!this.navigated||v.extractedUrl.toString()!==C||C!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||D)&&this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return SS(v.source)&&(this.browserUrlTree=v.extractedUrl),er(v).pipe(lu(F=>{const U=this.transitions.getValue();return r.next(new Uw(F.id,this.serializeUrl(F.extractedUrl),F.source,F.restoredState)),U!==this.transitions.getValue()?Zt:Promise.resolve(F)}),function S4(e,t,n,r){return lu(a=>function E4(e,t,n,r,a){return new T4(e,t,n,r,a).apply()}(e,t,n,a.extractedUrl,r).pipe(Mn(u=>({...a,urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ro(F=>{this.currentNavigation={...this.currentNavigation,finalUrl:F.urlAfterRedirects}}),function Z4(e,t,n,r,a){return gt(u=>function j4(e,t,n,r,a="emptyOnly",u="legacy"){try{const m=new $4(e,t,n,r,a,u).recognize();return null===m?vS(new U4):er(m)}catch(m){return vS(m)}}(e,t,u.urlAfterRedirects,n(u.urlAfterRedirects),r,a).pipe(Mn(m=>({...u,targetSnapshot:m}))))}(this.rootComponentType,this.config,F=>this.serializeUrl(F),this.paramsInheritanceStrategy,this.relativeLinkResolution),ro(F=>{if("eager"===this.urlUpdateStrategy){if(!F.extras.skipLocationChange){const G=this.urlHandlingStrategy.merge(F.urlAfterRedirects,F.rawUrl);this.setBrowserUrl(G,F)}this.browserUrlTree=F.urlAfterRedirects}const U=new _z(F.id,this.serializeUrl(F.extractedUrl),this.serializeUrl(F.urlAfterRedirects),F.targetSnapshot);r.next(U)}));if(D&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:U,extractedUrl:G,source:me,restoredState:Ae,extras:We}=v,Pe=new Uw(U,this.serializeUrl(G),me,Ae);r.next(Pe);const dt=QD(G,this.rootComponentType).snapshot;return er({...v,targetSnapshot:dt,urlAfterRedirects:G,extras:{...We,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=v.rawUrl,v.resolve(null),Zt}),ro(v=>{const C=new yz(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(C)}),Mn(v=>({...v,guards:I4(v.targetSnapshot,v.currentSnapshot,this.rootContexts)})),function k4(e,t){return gt(n=>{const{targetSnapshot:r,currentSnapshot:a,guards:{canActivateChecks:u,canDeactivateChecks:m}}=n;return 0===m.length&&0===u.length?er({...n,guardsResult:!0}):function R4(e,t,n,r){return mt(e).pipe(gt(a=>function V4(e,t,n,r,a){const u=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return u&&0!==u.length?er(u.map(v=>{const C=ax(v,t,a);let D;if(function y4(e){return e&&Kd(e.canDeactivate)}(C))D=lc(C.canDeactivate(e,t,n,r));else{if(!Kd(C))throw new Error("Invalid CanDeactivate guard");D=lc(C(e,t,n,r))}return D.pipe(Bo())})).pipe(ay()):er(!0)}(a.component,a.route,n,t,r)),Bo(a=>!0!==a,!0))}(m,r,a,e).pipe(gt(v=>v&&function p4(e){return"boolean"==typeof e}(v)?function L4(e,t,n,r){return mt(t).pipe(Ym(a=>qv(function z4(e,t){return null!==e&&t&&t(new Mz(e)),er(!0)}(a.route.parent,r),function F4(e,t){return null!==e&&t&&t(new Tz(e)),er(!0)}(a.route,r),function B4(e,t,n){const r=t[t.length-1],u=t.slice(0,t.length-1).reverse().map(m=>function A4(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(m)).filter(m=>null!==m).map(m=>AD(()=>er(m.guards.map(C=>{const D=ax(C,m.node,n);let O;if(function _4(e){return e&&Kd(e.canActivateChild)}(D))O=lc(D.canActivateChild(r,e));else{if(!Kd(D))throw new Error("Invalid CanActivateChild guard");O=lc(D(r,e))}return O.pipe(Bo())})).pipe(ay())));return er(u).pipe(ay())}(e,a.path,n),function N4(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return er(!0);const a=r.map(u=>AD(()=>{const m=ax(u,t,n);let v;if(function g4(e){return e&&Kd(e.canActivate)}(m))v=lc(m.canActivate(t,e));else{if(!Kd(m))throw new Error("Invalid CanActivate guard");v=lc(m(t,e))}return v.pipe(Bo())}));return er(a).pipe(ay())}(e,a.route,n))),Bo(a=>!0!==a,!0))}(r,u,e,t):er(v)),Mn(v=>({...n,guardsResult:v})))})}(this.ngModule.injector,v=>this.triggerEvent(v)),ro(v=>{if(pp(v.guardsResult)){const D=jw(`Redirecting to "${this.serializeUrl(v.guardsResult)}"`);throw D.url=v.guardsResult,D}const C=new vz(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.triggerEvent(C)}),cu(v=>!!v.guardsResult||(this.restoreHistory(v),this.cancelNavigationTransition(v,""),!1)),rC(v=>{if(v.guards.canActivateChecks.length)return er(v).pipe(ro(C=>{const D=new xz(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(D)}),lu(C=>{let D=!1;return er(C).pipe(function W4(e,t){return gt(n=>{const{targetSnapshot:r,guards:{canActivateChecks:a}}=n;if(!a.length)return er(n);let u=0;return mt(a).pipe(Ym(m=>function X4(e,t,n,r){const a=e.routeConfig,u=e._resolve;return void 0!==a?.title&&!TS(a)&&(u[nC]=a.title),function Y4(e,t,n,r){const a=function K4(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===a.length)return er({});const u={};return mt(a).pipe(gt(m=>function J4(e,t,n,r){const a=ax(e,t,r);return lc(a.resolve?a.resolve(t,n):a(t,n))}(e[m],t,n,r).pipe(Bo(),ro(v=>{u[m]=v}))),Zv(1),RD(u),Xd(m=>m instanceof Q_?Zt:J_(m)))}(u,e,t,r).pipe(Mn(m=>(e._resolvedData=m,e.data=eS(e,n).resolve,a&&TS(a)&&(e.data[nC]=a.title),null)))}(m.route,r,e,t)),ro(()=>u++),Zv(1),gt(m=>u===a.length?er(n):Zt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ro({next:()=>D=!0,complete:()=>{D||(this.restoreHistory(C),this.cancelNavigationTransition(C,"At least one route resolver didn't emit any value."))}}))}),ro(C=>{const D=new bz(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);this.triggerEvent(D)}))}),rC(()=>this.afterPreactivation()),rC(v=>{const C=D=>{const O=[];D.routeConfig?.loadComponent&&!D.routeConfig._loadedComponent&&O.push(this.configLoader.loadComponent(D.routeConfig).pipe(ro(F=>{D.component=F}),Mn(()=>{})));for(const F of D.children)O.push(...C(F));return O};return SD(C(v.targetSnapshot.root)).pipe(Bw(),bn(1))}),Mn(v=>{const C=function Yz(e,t,n){const r=ry(e,t._root,n?n._root:void 0);return new JD(r,t)}(this.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return{...v,targetRouterState:C}}),ro(v=>{this.currentUrlTree=v.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl),this.routerState=v.targetRouterState,"deferred"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v),this.browserUrlTree=v.urlAfterRedirects)}),((e,t,n)=>Mn(r=>(new f4(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,this.routeReuseStrategy,v=>this.triggerEvent(v)),ro({next(){u=!0},complete(){u=!0}}),Vw(()=>{u||m||this.cancelNavigationTransition(a,`Navigation ID ${a.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation?.id===a.id&&(this.currentNavigation=null)}),Xd(v=>{if(m=!0,function Iz(e){return e&&e[zD]}(v)){const C=pp(v.url);C||(this.navigated=!0,this.restoreHistory(a,!0));const D=new LD(a.id,this.serializeUrl(a.extractedUrl),v.message);if(r.next(D),C){const O=this.urlHandlingStrategy.merge(v.url,this.rawUrlTree),F={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||SS(a.source)};this.scheduleNavigation(O,"imperative",null,F,{resolve:a.resolve,reject:a.reject,promise:a.promise})}else a.resolve(!1)}else{this.restoreHistory(a,!0);const C=new gz(a.id,this.serializeUrl(a.extractedUrl),v);r.next(C);try{a.resolve(this.errorHandler(v))}catch(D){a.reject(D)}}return Zt}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next({...this.transitions.value,...n})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const a={replaceUrl:!0},u=n.state?.navigationId?n.state:null;if(u){const v={...u};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(a.state=v)}const m=this.parseUrl(n.url);this.scheduleNavigation(m,r,u,a)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){this.config=n.map(eC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:a,queryParams:u,fragment:m,queryParamsHandling:v,preserveFragment:C}=r,D=a||this.routerState.root,O=C?this.currentUrlTree.fragment:m;let F=null;switch(v){case"merge":F={...this.currentUrlTree.queryParams,...u};break;case"preserve":F=this.currentUrlTree.queryParams;break;default:F=u||null}return null!==F&&(F=this.removeEmptyProps(F)),function Qz(e,t,n,r,a){if(0===n.length)return Xw(t.root,t.root,t.root,r,a);const u=function e4(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new iS(!0,0,e);let t=0,n=!1;const r=e.reduce((a,u,m)=>{if("object"==typeof u&&null!=u){if(u.outlets){const v={};return gs(u.outlets,(C,D)=>{v[D]="string"==typeof C?C.split("/"):C}),[...a,{outlets:v}]}if(u.segmentPath)return[...a,u.segmentPath]}return"string"!=typeof u?[...a,u]:0===m?(u.split("/").forEach((v,C)=>{0==C&&"."===v||(0==C&&""===v?n=!0:".."===v?t++:""!=v&&a.push(v))}),a):[...a,u]},[]);return new iS(n,t,r)}(n);return u.toRoot()?Xw(t.root,t.root,new Dr([],{}),r,a):function m(C){const D=function t4(e,t,n,r){return e.isAbsolute?new Yw(t.root,!0,0):-1===r?new Yw(n,n===t.root,0):function n4(e,t,n){let r=e,a=t,u=n;for(;u>a;){if(u-=a,r=r.parent,!r)throw new Error("Invalid number of '../'");a=r.segments.length}return new Yw(r,!1,a-u)}(n,r+(ex(e.commands[0])?0:1),e.numberOfDoubleDots)}(u,t,e.snapshot?._urlSegment,C),O=D.processChildren?tx(D.segmentGroup,D.index,u.commands):oS(D.segmentGroup,D.index,u.commands);return Xw(t.root,D.segmentGroup,O,r,a)}(e.snapshot?._lastPathIndex)}(D,this.currentUrlTree,n,F,O??null)}navigateByUrl(n,r={skipLocationChange:!1}){const a=pp(n)?n:this.parseUrl(n),u=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function cN(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(a){r=this.malformedUriErrorHandler(a,this.urlSerializer,n)}return r}isActive(n,r){let a;if(a=!0===r?{...aN}:!1===r?{...lN}:r,pp(n))return jD(this.currentUrlTree,n,a);const u=this.parseUrl(n);return jD(this.currentUrlTree,u,a)}removeEmptyProps(n){return Object.keys(n).reduce((r,a)=>{const u=n[a];return null!=u&&(r[a]=u),r},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new ey(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,r,a,u,m){if(this.disposed)return Promise.resolve(!1);let v,C,D;m?(v=m.resolve,C=m.reject,D=m.promise):D=new Promise((U,G)=>{v=U,C=G});const O=++this.navigationId;let F;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(a=this.location.getState()),F=a&&a.\u0275routerPageId?a.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):F=0,this.setTransition({id:O,targetPageId:F,source:r,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:u,resolve:v,reject:C,promise:D,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),D.catch(U=>Promise.reject(U))}setBrowserUrl(n,r){const a=this.urlSerializer.serialize(n),u={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(a)||r.extras.replaceUrl?this.location.replaceState(a,"",u):this.location.go(a,"",u)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const a=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===a?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===a&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(a)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,r){const a=new LD(n.id,this.serializeUrl(n.extractedUrl),r);this.triggerEvent(a),n.resolve(!1)}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){y_()},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();function SS(e){return"imperative"!==e}class IS{buildTitle(t){let n,r=t.root;for(;void 0!==r;)n=this.getResolvedTitleForRoute(r)??n,r=r.children.find(a=>a.outlet===pr);return n}getResolvedTitleForRoute(t){return t.data[nC]}}let dN=(()=>{class e extends IS{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(Yt(Lw))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class AS{}class PS{preload(t,n){return er(null)}}let OS=(()=>{class e{constructor(n,r,a,u,m){this.router=n,this.injector=a,this.preloadingStrategy=u,this.loader=m}setUpPreloading(){this.subscription=this.router.events.pipe(cu(n=>n instanceof ey),Ym(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const a=[];for(const u of r){u.providers&&!u._injector&&(u._injector=_v(u.providers,n,`Route: ${u.path}`));const m=u._injector??n,v=u._loadedInjector??m;u.loadChildren&&!u._loadedRoutes||u.loadComponent&&!u._loadedComponent?a.push(this.preloadConfig(m,u)):(u.children||u._loadedRoutes)&&a.push(this.processRoutes(v,u.children??u._loadedRoutes))}return mt(a).pipe(ot())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let a;a=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):er(null);const u=a.pipe(gt(m=>null===m?er(void 0):(r._loadedRoutes=m.routes,r._loadedInjector=m.injector,this.processRoutes(m.injector??n,m.routes))));return r.loadComponent&&!r._loadedComponent?mt([u,this.loader.loadComponent(r)]).pipe(ot()):u})}}return e.\u0275fac=function(n){return new(n||e)(Yt(Ua),Yt(tw),Yt(sh),Yt(AS),Yt(oC))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),lC=(()=>{class e{constructor(n,r,a={}){this.router=n,this.viewportScroller=r,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration=a.scrollPositionRestoration||"disabled",a.anchorScrolling=a.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Uw?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof ey&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof FD&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.router.triggerEvent(new FD(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){y_()},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const mp=new Nn("ROUTER_CONFIGURATION"),kS=new Nn("ROUTER_FORROOT_GUARD"),pN=[mw,{provide:qD,useClass:ZD},{provide:Ua,useFactory:function vN(e,t,n,r,a,u,m={},v,C,D,O){const F=new Ua(null,e,t,n,r,a,BD(u));return D&&(F.urlHandlingStrategy=D),O&&(F.routeReuseStrategy=O),F.titleStrategy=C??v,function xN(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(m,F),F},deps:[qD,oy,mw,_o,tw,iC,mp,dN,[IS,new ra],[class nN{},new ra],[class Q4{},new ra]]},oy,{provide:Yd,useFactory:function bN(e){return e.routerState.root},deps:[Ua]},OS,PS,class fN{preload(t,n){return n().pipe(Xd(()=>er(null)))}},{provide:mp,useValue:{enableTracing:!1}},oC];function mN(){return new v2("Router",Ua)}let RS=(()=>{class e{constructor(n,r){}static forRoot(n,r){return{ngModule:e,providers:[pN,LS(n),{provide:kS,useFactory:yN,deps:[[Ua,new ra,new xd]]},{provide:mp,useValue:r||{}},{provide:Wm,useFactory:_N,deps:[Z_,[new $u(pw),new ra],mp]},{provide:lC,useFactory:gN,deps:[Ua,vF,mp]},{provide:AS,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:PS},{provide:v2,multi:!0,useFactory:mN},[cC,{provide:Jb,multi:!0,useFactory:wN,deps:[cC]},{provide:FS,useFactory:CN,deps:[cC]},{provide:f2,multi:!0,useExisting:FS}]]}}static forChild(n){return{ngModule:e,providers:[LS(n)]}}}return e.\u0275fac=function(n){return new(n||e)(Yt(kS,8),Yt(Ua,8))},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({}),e})();function gN(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new lC(e,t,n)}function _N(e,t,n={}){return n.useHash?new t3(e,t):new j2(e,t)}function yN(e){return"guarded"}function LS(e){return[{provide:t1,multi:!0,useValue:e},{provide:iC,multi:!0,useValue:e}]}let cC=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Wn}appInitializer(){return this.injector.get(JL,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const a=new Promise(v=>r=v),u=this.injector.get(Ua),m=this.injector.get(mp);return"disabled"===m.initialNavigation?(u.setUpLocationChangeListener(),r(!0)):"enabledBlocking"===m.initialNavigation?(u.afterPreactivation=()=>this.initNavigation?er(void 0):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),u.initialNavigation()):r(!0),a})}bootstrapListener(n){const r=this.injector.get(mp),a=this.injector.get(OS),u=this.injector.get(lC),m=this.injector.get(Ua),v=this.injector.get(Ev);n===v.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&m.initialNavigation(),a.setUpPreloading(),u.init(),m.resetRootComponentType(v.componentTypes[0]),this.resultOfPreactivationDone.next(void 0),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(Yt(_o))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();function wN(e){return e.appInitializer.bind(e)}function CN(e){return e.bootstrapListener.bind(e)}const FS=new Nn("Router Initializer"),zS="appowVryh3gfUSkbN",uC="mapbox://styles/atlasmedliq/cl59k9bun000y14rzt3yy5ljt",Mo="#CE0031";var NS=Ne(764);const dC={now:()=>(dC.delegate||Date).now(),delegate:void 0};class Qm extends Wn{constructor(t=1/0,n=1/0,r=dC){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){const{isStopped:n,_buffer:r,_infiniteTimeWindow:a,_timestampProvider:u,_windowTime:m}=this;n||(r.push(t),!a&&r.push(u.now()+m)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const n=this._innerSubscribe(t),{_infiniteTimeWindow:r,_buffer:a}=this,u=a.slice();for(let m=0;m<u.length&&!t.closed;m+=r?1:2)t.next(u[m]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){const{_bufferSize:t,_timestampProvider:n,_buffer:r,_infiniteTimeWindow:a}=this,u=(a?1:2)*t;if(t<1/0&&u<r.length&&r.splice(0,r.length-u),!a){const m=n.now();let v=0;for(let C=1;C<r.length&&r[C]<=m;C+=2)v=C;v&&r.splice(0,v+1)}}}function fC(...e){const t=cr(e),{args:n,keys:r}=TD(e),a=new Jt(u=>{const{length:m}=n;if(!m)return void u.complete();const v=new Array(m);let C=m,D=m;for(let O=0;O<m;O++){let F=!1;B(n[O]).subscribe(cn(u,U=>{F||(F=!0,D--),v[O]=U},()=>C--,void 0,()=>{(!C||!F)&&(D||u.next(r?DD(r,v):v),u.complete())}))}});return t?a.pipe(zw(t)):a}class IN{constructor(t,n){this.api=t,this.baseId=n,this.YEAR_START=1901,this.YEAR_END=2100,this.YEAR_CURRENT=2050,this.TITLE="",this.SUBTITLE="",this.INFOBAR_TITLE="",this.INFOBAR_SUBTITLE="",this.ABOUT="",this.CONTRIBUTE_MESSAGE="",this.LOGO_URL="",this.ready=new Qm(1),this.data=new Qm(1),this.authorsMap={},this.authorsList=[],this.timeline=[],this.contribCount=0}fetchSettings(){return this.api.airtableFetch(this.baseId,"Settings","website").pipe(Mn(t=>{const n={};return t.records.forEach(r=>{n[r.fields.key]=r.fields.value||r.fields.image}),n}))}fetchAudioTimestamps(){return this.api.airtableFetch(this.baseId,"AudioTimestamps","website").pipe(this.api.airtableToMapping())}fetchMapLayers(){return this.api.airtableFetch(this.baseId,"MapLayers","website").pipe(this.api.airtableToMapping())}fetchMapViews(){return this.api.airtableFetch(this.baseId,"MapViews","website").pipe(this.api.airtableToMapping())}fetchContent(){return this.api.airtableFetch(this.baseId,this.api.CONTENT_TABLE,"website").pipe(this.api.airtableToArray())}fetchMapData(){return fC([this.fetchMapLayers(),this.fetchMapViews(),this.ready]).pipe(Mn(([t,n,r])=>{const a=new Set;return Object.values(n).forEach(u=>{const m=[];(u.map_layers||[]).forEach(v=>{m.push(...t[v].onLayers)}),m.forEach(a.add,a),u.onLayers=m}),this.timeline.forEach(u=>{if(u.onLayers=[],(!u.map_view||0==u.map_view.length)&&u.map_layer&&u.map_layer.length>0){const m=t[u.map_layer[0]];m.onLayers.forEach(v=>a.add(v)),u.onLayers=m.onLayers}}),Object.values(n).forEach(u=>{u.offLayers=[...a].filter(m=>u.onLayers.indexOf(m)<0)}),this.timeline.forEach(u=>{u.offLayers=[...a].filter(m=>u.onLayers.indexOf(m)<0)}),n}))}hashCode(t){let a,n=0;if(0===t.length)return n;for(let u=0;u<t.length;u++)a=t.charCodeAt(u),n=(n<<5)-n+a,n|=0;return Math.abs(n).toString(16)}fetchData(){return this.fetchSettings().pipe(lu(t=>(this.YEAR_START=parseInt(t["from year"]),this.YEAR_END=parseInt(t["to year"]),this.YEAR_CURRENT=parseInt(t["start year"]),this.ABOUT=t.about,this.TITLE=t.title,this.SUBTITLE=t.subtitle,this.INFOBAR_TITLE=t.infobar_title,this.INFOBAR_SUBTITLE=t.infobar_subtitle,this.CONTRIBUTE_MESSAGE=t.contribute_message,this.LOGO_URL=(t.logo||[])[0]?.thumbnails?.large?.url||"assets/img/st_logo.svg",fC([this.fetchAudioTimestamps(),this.fetchContent()]))),Mn(([t,n])=>{const r={};return n.forEach(a=>{a.audio_timestamps=a.audio_timestamps?a.audio_timestamps.map(C=>t[C]):[],a.hasContent=!0,a.timestamp=NS(a.post_timestamp).toDate(),a.year=a.timestamp.getFullYear(),a.year>this.YEAR_END&&(this.YEAR_END=a.year),a.year<this.YEAR_START&&(this.YEAR_START=a.year);const u=a.existing_author_email||a.new_author_email,m=a.new_author_name,v=!!a.original_author;a.author=u,r[u]||(r[u]={email:u,count:0,hash:this.hashCode(u)}),r[u].count++,m&&(r[u].name=m),r[u].originalAuthor=r[u].originalAuthor||v,r[u].selected=r[u].selected||v}),this.authorsMap=r,this.authorsList=[],Object.values(r).sort((a,u)=>(a.originalAuthor?0:1)-(u.originalAuthor?0:1)).forEach(a=>{this.authorsList.push(a)}),n.sort((a,u)=>a.post_timestamp-u.post_timestamp)}),Mn(t=>{this.timeline=t,this.contribCount=this.authorsList.filter(r=>!r.originalAuthor).length;const n=this.updateTimeline(!1);this.ready.next(!0),this.ready.complete(),this.data.next(n)}))}explodeTimeline(){}updateTimeline(t=!0){console.log("UPDATING TIMELINE...");const n=[],a=this.timeline.slice();for(let m=this.YEAR_START;m<=this.YEAR_END;m++){let v=!1;for(;a.length>0&&a[0].year===m;){const C=a.shift();this.authorsMap[C.author]?.selected&&(n.push(C),v=!0)}}const u={};for(const m in n)u[m]=n[m];return n.forEach((m,v)=>{m.index=v,m.next=u[v+1]||null,m.prev=u[v-1]||null}),t&&this.data.next(n),n}}class BS{}class VS{}class Dh{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const r=n.indexOf(":");if(r>0){const a=n.slice(0,r),u=a.toLowerCase(),m=n.slice(r+1).trim();this.maybeSetNormalizedName(a,u),this.headers.has(u)?this.headers.get(u).push(m):this.headers.set(u,[m])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let r=t[n];const a=n.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(a,r),this.maybeSetNormalizedName(n,a))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof Dh?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new Dh;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Dh?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,n);const a=("a"===t.op?this.headers.get(n):void 0)||[];a.push(...r),this.headers.set(n,a);break;case"d":const u=t.value;if(u){let m=this.headers.get(n);if(!m)return;m=m.filter(v=>-1===u.indexOf(v)),0===m.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,m)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class AN{encodeKey(t){return US(t)}encodeValue(t){return US(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const ON=/%(\d[a-f0-9])/gi,kN={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function US(e){return encodeURIComponent(e).replace(ON,(t,n)=>kN[n]??t)}function lx(e){return`${e}`}class Jd{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new AN,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function PN(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(a=>{const u=a.indexOf("="),[m,v]=-1==u?[t.decodeKey(a),""]:[t.decodeKey(a.slice(0,u)),t.decodeValue(a.slice(u+1))],C=n.get(m)||[];C.push(v),n.set(m,C)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const r=t.fromObject[n],a=Array.isArray(r)?r.map(lx):[lx(r)];this.map.set(n,a)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(r=>{const a=t[r];Array.isArray(a)?a.forEach(u=>{n.push({param:r,value:u,op:"a"})}):n.push({param:r,value:a,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(r=>n+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Jd({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(lx(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let r=this.map.get(t.param)||[];const a=r.indexOf(lx(t.value));-1!==a&&r.splice(a,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class RN{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function jS(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function $S(e){return typeof Blob<"u"&&e instanceof Blob}function GS(e){return typeof FormData<"u"&&e instanceof FormData}class hy{constructor(t,n,r,a){let u;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function LN(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||a?(this.body=void 0!==r?r:null,u=a):u=r,u&&(this.reportProgress=!!u.reportProgress,this.withCredentials=!!u.withCredentials,u.responseType&&(this.responseType=u.responseType),u.headers&&(this.headers=u.headers),u.context&&(this.context=u.context),u.params&&(this.params=u.params)),this.headers||(this.headers=new Dh),this.context||(this.context=new RN),this.params){const m=this.params.toString();if(0===m.length)this.urlWithParams=n;else{const v=n.indexOf("?");this.urlWithParams=n+(-1===v?"?":v<n.length-1?"&":"")+m}}else this.params=new Jd,this.urlWithParams=n}serializeBody(){return null===this.body?null:jS(this.body)||$S(this.body)||GS(this.body)||function FN(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Jd?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||GS(this.body)?null:$S(this.body)?this.body.type||null:jS(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Jd?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,u=void 0!==t.body?t.body:this.body,m=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,v=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let C=t.headers||this.headers,D=t.params||this.params;const O=t.context??this.context;return void 0!==t.setHeaders&&(C=Object.keys(t.setHeaders).reduce((F,U)=>F.set(U,t.setHeaders[U]),C)),t.setParams&&(D=Object.keys(t.setParams).reduce((F,U)=>F.set(U,t.setParams[U]),D)),new hy(n,r,u,{params:D,headers:C,context:O,reportProgress:v,responseType:a,withCredentials:m})}}var Eo=(()=>((Eo=Eo||{})[Eo.Sent=0]="Sent",Eo[Eo.UploadProgress=1]="UploadProgress",Eo[Eo.ResponseHeader=2]="ResponseHeader",Eo[Eo.DownloadProgress=3]="DownloadProgress",Eo[Eo.Response=4]="Response",Eo[Eo.User=5]="User",Eo))();class pC{constructor(t,n=200,r="OK"){this.headers=t.headers||new Dh,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class mC extends pC{constructor(t={}){super(t),this.type=Eo.ResponseHeader}clone(t={}){return new mC({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class cx extends pC{constructor(t={}){super(t),this.type=Eo.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new cx({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class HS extends pC{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function gC(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let _C=(()=>{class e{constructor(n){this.handler=n}request(n,r,a={}){let u;if(n instanceof hy)u=n;else{let C,D;C=a.headers instanceof Dh?a.headers:new Dh(a.headers),a.params&&(D=a.params instanceof Jd?a.params:new Jd({fromObject:a.params})),u=new hy(n,r,void 0!==a.body?a.body:null,{headers:C,context:a.context,params:D,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials})}const m=er(u).pipe(Ym(C=>this.handler.handle(C)));if(n instanceof hy||"events"===a.observe)return m;const v=m.pipe(cu(C=>C instanceof cx));switch(a.observe||"body"){case"body":switch(u.responseType){case"arraybuffer":return v.pipe(Mn(C=>{if(null!==C.body&&!(C.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return C.body}));case"blob":return v.pipe(Mn(C=>{if(null!==C.body&&!(C.body instanceof Blob))throw new Error("Response is not a Blob.");return C.body}));case"text":return v.pipe(Mn(C=>{if(null!==C.body&&"string"!=typeof C.body)throw new Error("Response is not a string.");return C.body}));default:return v.pipe(Mn(C=>C.body))}case"response":return v;default:throw new Error(`Unreachable: unhandled observe type ${a.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new Jd).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,a={}){return this.request("PATCH",n,gC(a,r))}post(n,r,a={}){return this.request("POST",n,gC(a,r))}put(n,r,a={}){return this.request("PUT",n,gC(a,r))}}return e.\u0275fac=function(n){return new(n||e)(Yt(BS))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();class qS{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const ZS=new Nn("HTTP_INTERCEPTORS");let zN=(()=>{class e{intercept(n,r){return r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const NN=/^\)\]\}',?\n/;let WS=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Jt(r=>{const a=this.xhrFactory.build();if(a.open(n.method,n.urlWithParams),n.withCredentials&&(a.withCredentials=!0),n.headers.forEach((G,me)=>a.setRequestHeader(G,me.join(","))),n.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const G=n.detectContentTypeHeader();null!==G&&a.setRequestHeader("Content-Type",G)}if(n.responseType){const G=n.responseType.toLowerCase();a.responseType="json"!==G?G:"text"}const u=n.serializeBody();let m=null;const v=()=>{if(null!==m)return m;const G=a.statusText||"OK",me=new Dh(a.getAllResponseHeaders()),Ae=function BN(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(a)||n.url;return m=new mC({headers:me,status:a.status,statusText:G,url:Ae}),m},C=()=>{let{headers:G,status:me,statusText:Ae,url:We}=v(),Pe=null;204!==me&&(Pe=typeof a.response>"u"?a.responseText:a.response),0===me&&(me=Pe?200:0);let dt=me>=200&&me<300;if("json"===n.responseType&&"string"==typeof Pe){const Ge=Pe;Pe=Pe.replace(NN,"");try{Pe=""!==Pe?JSON.parse(Pe):null}catch(Ct){Pe=Ge,dt&&(dt=!1,Pe={error:Ct,text:Pe})}}dt?(r.next(new cx({body:Pe,headers:G,status:me,statusText:Ae,url:We||void 0})),r.complete()):r.error(new HS({error:Pe,headers:G,status:me,statusText:Ae,url:We||void 0}))},D=G=>{const{url:me}=v(),Ae=new HS({error:G,status:a.status||0,statusText:a.statusText||"Unknown Error",url:me||void 0});r.error(Ae)};let O=!1;const F=G=>{O||(r.next(v()),O=!0);let me={type:Eo.DownloadProgress,loaded:G.loaded};G.lengthComputable&&(me.total=G.total),"text"===n.responseType&&!!a.responseText&&(me.partialText=a.responseText),r.next(me)},U=G=>{let me={type:Eo.UploadProgress,loaded:G.loaded};G.lengthComputable&&(me.total=G.total),r.next(me)};return a.addEventListener("load",C),a.addEventListener("error",D),a.addEventListener("timeout",D),a.addEventListener("abort",D),n.reportProgress&&(a.addEventListener("progress",F),null!==u&&a.upload&&a.upload.addEventListener("progress",U)),a.send(u),r.next({type:Eo.Sent}),()=>{a.removeEventListener("error",D),a.removeEventListener("abort",D),a.removeEventListener("load",C),a.removeEventListener("timeout",D),n.reportProgress&&(a.removeEventListener("progress",F),null!==u&&a.upload&&a.upload.removeEventListener("progress",U)),a.readyState!==a.DONE&&a.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(Yt(aD))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})();const yC=new Nn("XSRF_COOKIE_NAME"),vC=new Nn("XSRF_HEADER_NAME");class XS{}let VN=(()=>{class e{constructor(n,r,a){this.doc=n,this.platform=r,this.cookieName=a,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=J2(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(Yt(ps),Yt(ew),Yt(yC))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),xC=(()=>{class e{constructor(n,r){this.tokenService=n,this.headerName=r}intercept(n,r){const a=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||a.startsWith("http://")||a.startsWith("https://"))return r.handle(n);const u=this.tokenService.getToken();return null!==u&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,u)})),r.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(Yt(XS),Yt(vC))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),UN=(()=>{class e{constructor(n,r){this.backend=n,this.injector=r,this.chain=null}handle(n){if(null===this.chain){const r=this.injector.get(ZS,[]);this.chain=r.reduceRight((a,u)=>new qS(a,u),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(Yt(VS),Yt(_o))},e.\u0275prov=gn({token:e,factory:e.\u0275fac}),e})(),jN=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:xC,useClass:zN}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:yC,useValue:n.cookieName}:[],n.headerName?{provide:vC,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({providers:[xC,{provide:ZS,useExisting:xC,multi:!0},{provide:XS,useClass:VN},{provide:yC,useValue:"XSRF-TOKEN"},{provide:vC,useValue:"X-XSRF-TOKEN"}]}),e})(),$N=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({providers:[_C,{provide:BS,useClass:UN},WS,{provide:VS,useExisting:WS}],imports:[jN.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),e})(),YS=(()=>{class e{constructor(n){this.http=n,this.API_KEY="keysbVnYZk16tqIT0",this.AIRTABLE_BASE="https://api.airtable.com/v0",this.CONTENT_TABLE="Content"}airtableToMapping(){return Mn(n=>{const r={};return n.records.forEach(a=>{r[a.id]=Object.assign(a.fields,{id:a.id})}),r})}airtableToArray(){return Mn(n=>n.records.map(a=>Object.assign({id:a.id},a.fields)))}airtableFetch(n,r,a,u,m){const v={Authorization:`Bearer ${this.API_KEY}`};let C=`${this.AIRTABLE_BASE}/${n}/${r}`,D={};return u?C+=`/${u}`:(D={maxRecords:1e3,view:a},m&&(D.fields=m)),this.http.get(C,{headers:v,params:D})}}return e.\u0275fac=function(n){return new(n||e)(Yt(_C))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),bC=(()=>{class e{constructor(){this.showMapSelector=!1,this.results=new Wn}submitResult(n){this.showMapSelector=!1,console.log("SUBMITTING RESULT",n),this.results.next(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var yl=Ne(898);class GN extends W{constructor(t,n){super()}schedule(t,n=0){return this}}const ux={setInterval(e,t,...n){const{delegate:r}=ux;return r?.setInterval?r.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=ux;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class dy{constructor(t,n=dy.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,r){return new this.schedulerActionCtor(this,t).schedule(r,n)}}dy.now=dC.now;const hx=new class qN extends dy{constructor(t,n=dy.now){super(t,n),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let r;this._active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,r){for(;t=n.shift();)t.unsubscribe();throw r}}}(class HN extends GN{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){if(this.closed)return this;this.state=t;const r=this.id,a=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(a,r,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(a,this.id,n),this}requestAsyncId(t,n,r=0){return ux.setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,n,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return n;ux.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,n);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let a,r=!1;try{this.work(t)}catch(u){r=!0,a=u||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),a}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:r}=n;this.work=this.state=this.scheduler=null,this.pending=!1,d(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),ZN=hx;function KS(e,t){return t?n=>qv(t.pipe(bn(1),function WN(){return nr((e,t)=>{e.subscribe(cn(t,tt))})}()),n.pipe(KS(e))):gt((n,r)=>e(n,r).pipe(bn(1),RD(n)))}function ha(e=0,t,n=ZN){let r=-1;return null!=t&&(fn(t)?n=t:r=t),new Jt(a=>{let u=function XN(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;u<0&&(u=0);let m=0;return n.schedule(function(){a.closed||(a.next(m++),0<=r?this.schedule(void 0,r):a.complete())},u)})}function dx(e,t=hx){const n=ha(e,t);return KS(()=>n)}class JS{constructor(t){this.activatedRoute=t,this.timeline=[],this.mapViews=new Qm(1)}initialize(t){this._api=t,t.data.subscribe(n=>{this.timeline.length||(this.activatedRoute.fragment.pipe(Bo(),dx(1e3)).subscribe(r=>{r&&this.goto(r)}),this.activatedRoute.snapshot.fragment||this.goto("")),this.setTimeline(n)})}loadMapViews(){this._api.fetchMapData().subscribe(t=>{this._api.data.subscribe(n=>{n.forEach(r=>{if(r.hasContent&&!r.map_view&&!t[r.title]){if(r.map_view&&r.map_view.length>0)return;r.map_view=[r.title],t[r.title]=r}})}),this.mapViews.next(t)})}parseMapView(t){if(!t.geo)return{};const r=/center:\s*\{\s*lon:\s*([-0-9.]+),\s*lat:\s*([-0-9.]+)\s*\},\s*zoom:\s*([-0-9.]+),\s*pitch:\s*([-0-9.]+),\s*bearing:\s*([-0-9.]+)/g.exec(t.geo);if(null!==r){const a={center:{lon:parseFloat(r[1]),lat:parseFloat(r[2])},zoom:parseFloat(r[3]),pitch:parseFloat(r[4]),bearing:parseFloat(r[5])};return t.curve&&(a.curve=t.curve),t.speed&&(a.speed=t.speed),a}return{}}applyMapView(t,n,r=null){this.mapViews.pipe(Bo()).subscribe(a=>{const u=a[t],m=Object.assign({},this.parseMapView(u),r||{});for(const v of u.onLayers||[])n.getLayer(v)&&n.setLayoutProperty(v,"visibility","visible");for(const v of u.offLayers||[])n.getLayer(v)&&n.setLayoutProperty(v,"visibility","none");n.flyTo(m)})}goto(t){}updateLocation(t){location.replace(location.pathname+"#"+t)}setTimeline(t){this.timeline=t}}let wC=(()=>{class e{constructor(n){this.http=n,this.ACCESS_TOKEN="pk.eyJ1IjoiYXRsYXNtZWRsaXEiLCJhIjoiY2tpbXgzNW5qMHhhcjJ5cGtydHpkNnJqYyJ9.vfietFuvTA8S1vaGlm3CUQ",yl.accessToken=this.ACCESS_TOKEN,yl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",console.error,!0)}setLayerSource(n,r,a){const u=n.getStyle().layers,m=u.findIndex(D=>D.id===r),v=u[m],C=u[m+1]&&u[m+1].id;v.source=a,v["source-layer"]&&delete v["source-layer"],n.removeLayer(r),n.addLayer(v,C)}}return e.\u0275fac=function(n){return new(n||e)(Yt(_C))},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function QS(e,t=Rt){return e=e??YN,nr((n,r)=>{let a,u=!0;n.subscribe(cn(r,m=>{const v=t(m);(u||!e(a,v))&&(u=!1,a=v,r.next(m))}))})}function YN(e,t){return e===t}class CC{constructor(){this.visible$=new Wn,this.detected=this.visible$.pipe(QS()),this.visible$.next(!1)}initVisibilityDetector(t,n,r){this.observer=new IntersectionObserver(m=>{this.visible$.next(m[0].isIntersecting)},{root:n,rootMargin:{active:"0% -50% 0% -50%",visible:"100% 0% 100% 0%"}[r],threshold:0}),this.observer.observe(t)}}const KN=["addListener","removeListener"],JN=["addEventListener","removeEventListener"],QN=["on","off"];function hu(e,t,n,r){if($e(n)&&(r=n,n=void 0),r)return hu(e,t,n).pipe(zw(r));const[a,u]=function nB(e){return $e(e.addEventListener)&&$e(e.removeEventListener)}(e)?JN.map(m=>v=>e[m](t,v,n)):function eB(e){return $e(e.addListener)&&$e(e.removeListener)}(e)?KN.map(eI(e,t)):function tB(e){return $e(e.on)&&$e(e.off)}(e)?QN.map(eI(e,t)):[];if(!a&&vc(e))return gt(m=>hu(m,t,n))(B(e));if(!a)throw new TypeError("Invalid event target");return new Jt(m=>{const v=(...C)=>m.next(1<C.length?C:C[0]);return a(v),()=>u(v)})}function eI(e,t){return n=>r=>e[n](t,r)}class iB{constructor(t,n){this.url=t,this.playerService=n,this.subscriptions=[],this.playing=new ms(!1),this.ready=new ms(!1),this.hiResTimestamp=new ms(0),this.textTimestamp=new ms("-00:00"),this.position=new ms(0),this.ended=new Wn,this.audio=new Audio(t),hu(this.audio,"canplaythrough").pipe(Bo()).subscribe(()=>{this.ready.next(!0),this.updateTextTimestamp()}),this.subscriptions.push(hu(this.audio,"play").subscribe(()=>{this.playing.next(!0)}),hu(this.audio,"pause").subscribe(()=>{this.playing.next(!1)}),hu(this.audio,"ended").subscribe(()=>{this.ended.next(null),this.playing.next(!1),this.audio&&(this.audio.currentTime=0)}),hu(this.audio,"timeupdate").pipe(Mn(()=>{if(null!==this.audio){const r=Math.floor(10*this.audio.currentTime),a=this.hiResTimestamp.getValue();if(r!==a)if(a<r&&r-a<20)for(let m=a+1;m<=r;m++)this.hiResTimestamp.next(m);else this.hiResTimestamp.next(r);return Math.floor(this.audio.currentTime),this.updateTextTimestamp(),Math.round(this.audio.currentTime/this.audio.duration*1e3)}return 0}),QS()).subscribe(r=>{this.position.next(r)})),this.playing.next(!1),this.audio.load()}seek(t){this.audio&&(this.audio.currentTime=this.audio.duration*t)}seekTime(t){return this.ready.pipe(cu(n=>n),Bo(),ro(()=>{null!==this.audio&&(this.audio.currentTime=t)})).toPromise()}play(){this.playing.getValue()||this.ready.pipe(cu(t=>t),Bo()).subscribe(()=>{this.audio&&this.audio.play().then(()=>{this.playerService.playing(this)}).catch(()=>{console.log("FAILED TO PLAY...")})})}pause(){this.playing.getValue()&&this.audio&&(this.audio.pause(),this.playerService.stopped(this))}toggle(){this.playing.getValue()?this.pause():this.play()}cleanup(){for(null!==this.audio&&(this.pause(),this.audio.remove(),this.audio=null);this.subscriptions.length>0;)this.subscriptions.shift()?.unsubscribe()}updateTextTimestamp(){if(!this.audio||!Number.isFinite(this.audio.duration))return;const t=Math.floor(this.audio.duration-this.audio.currentTime);let n=""+t%60;n.length<2&&(n="0"+n),n=Math.floor(t/60)+":"+n,n.length<5&&(n="0"+n),n="-"+n,n!==this.textTimestamp.getValue()&&this.textTimestamp.next(n)}}let oB=(()=>{class e{constructor(){this.current=null,this.clock=new Qm(1),this.clockSub=null,this.playingSub=null,this.isPlaying=new ms(!1),this.last=null,hu(window,"keyup").subscribe(n=>{"Space"===n.code&&(null!==this.current?this.current.toggle():null!==this.last&&(this.last.toggle(),this.last=null))})}playing(n){this.current!==n&&(null!==this.current&&this.current.pause(),this.current=n,this.clockSub&&this.clockSub.unsubscribe(),this.clockSub=n.textTimestamp.subscribe(r=>{this.clock.next(r)}),this.playingSub&&this.playingSub.unsubscribe(),this.playingSub=n.playing.subscribe(r=>{this.isPlaying.next(r)}))}stopped(n){this.current===n&&(this.last=n,this.current=null,this.isPlaying.next(!1),this.clockSub&&(this.clockSub.unsubscribe(),this.clockSub=null),this.playingSub&&(this.playingSub.unsubscribe(),this.playingSub=null))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const sB=["handle"],aB=["component"];function lB(e,t){1&e&&on(0,"img",12)}function cB(e,t){1&e&&on(0,"img",13)}function uB(e,t){if(1&e){const n=Fo();N(),Z(),nu(0),Ze(1,"div",7,8),xn("mousedown",function(){return ni(n),Vr(_n().drag())}),nt(),Jn(3,lB,1,0,"img",9),yv(4,"async"),Jn(5,cB,1,0,"img",10),yv(6,"async"),Ze(7,"span",11),dn(8),yv(9,"async"),nt(),ru()}if(2&e){const n=_n();Qe(1),Ti("left",n.handleX+"px")("top",n.handleY+"px")("background",n.color),Qe(2),jt("ngIf",vv(4,9,n.player.playing)),Qe(2),jt("ngIf",!vv(6,11,n.player.playing)),Qe(3),bi(vv(9,13,n.player.textTimestamp))}}let tI=(()=>{class e{constructor(n,r){this.playerService=n,this.el=r,this.size=280,this.PADDING=2,this.BAR_WIDTH=4,this.player=null,this.progressBarPath=""}ngOnInit(){}ngAfterViewInit(){}drag(){const n=this.component.nativeElement.getBoundingClientRect();hu(window,"mousemove").pipe(function rB(e){return nr((t,n)=>{B(e).subscribe(cn(n,()=>n.complete(),tt)),!n.closed&&t.subscribe(n)})}(hu(window,"mouseup")),ro(r=>{const u=r.clientX-n.left-this.size/2,v=Math.atan((r.clientY-n.top-this.size/2)/u)+Math.PI/2+(u<0?Math.PI:0);this.player?.seek(v/2/Math.PI)}),Zv(1)).subscribe(r=>{})}click(n){if(!this.player)return!1;const r=n.offsetX-this.size/2,a=n.offsetY-this.size/2,u=Math.atan(a/r)+Math.PI/2+(r<0?Math.PI:0),m=Math.sqrt(r*r+a*a);return Math.abs(m-this.size/2)<10?this.player.seek(u/2/Math.PI):m<this.size/2&&this.player.toggle(),!0}createPlayer(){this.audio&&(this.player=new iB(this.audio,this.playerService),this.positionSub=this.player.position.subscribe(n=>{this.calculateProgressBarPath(n/1e3*2*Math.PI)}))}cleanupPlayer(){null!==this.player&&(this.player.cleanup(),this.positionSub.unsubscribe(),this.player=null,this.progressBarPath="")}ngOnChanges(){this.cleanupPlayer(),this.createPlayer()}ngOnDestroy(){this.cleanupPlayer()}calculateProgressBarPath(n){const r=this.size/2,a=(this.size-this.BAR_WIDTH)/2,u=r+a*Math.sin(n),m=r-a*Math.cos(n),v=n>=Math.PI?"1 1":"0 1";this.progressBarPath=`M${r} ${r-a} A ${a} ${a} 0 ${v} ${u} ${m}`,this.handleX=u,this.handleY=m}}return e.\u0275fac=function(n){return new(n||e)(rt(oB),rt(Xo))},e.\u0275cmp=kr({type:e,selectors:[["app-audio-player"]],viewQuery:function(n,r){if(1&n&&(Hs(sB,7),Hs(aB,7)),2&n){let a;ds(a=fs())&&(r.handle=a.first),ds(a=fs())&&(r.component=a.first)}},inputs:{audio:"audio",image:"image",color:"color",size:"size"},features:[mi],decls:7,vars:16,consts:[[1,"wrapper"],[1,"component"],["viewport","0 0 280 280",3,"click"],["component",""],["stroke","#dedede","stroke-width","4","fill","none"],["stroke-width","4","fill","none"],[4,"ngIf"],[1,"handle",3,"mousedown"],["handle",""],["src","assets/img/player-control-pause.svg",4,"ngIf"],["src","assets/img/player-control-play.svg",4,"ngIf"],[1,"timestamp"],["src","assets/img/player-control-pause.svg"],["src","assets/img/player-control-play.svg"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1),N(),Ze(2,"svg",2,3),xn("click",function(u){return r.click(u)}),on(4,"circle",4)(5,"path",5),nt(),Jn(6,uB,10,15,"ng-container",6),nt()()),2&n&&(Ti("width",r.size+4+"px")("height",r.size+4+"px")("padding","2px"),Qe(1),Ti("background-image","url("+r.image+")")("border-radius",r.size/2+"px"),Qe(3),xi("cx",r.size/2)("cy",r.size/2)("r",r.size/2-2),Qe(1),xi("d",r.progressBarPath)("stroke",r.color),Qe(1),jt("ngIf",r.player))},dependencies:[Va,rD],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:flex;flex-flow:column;align-items:center;position:relative}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:center;justify-content:center;background-repeat:no-repeat;background-position:center;background-size:cover;position:relative;cursor:pointer;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:60px;height:60px}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:100%;width:100%;overflow:visible}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .handle[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:6px;border:2px solid white;background:#0AB239;transform:translate(-50%) translateY(-50%);position:absolute;pointer-events:all;z-index:1}[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;color:#fff;display:block;line-height:16px;text-shadow:0px 0px 6px #000000;height:0px}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:700;font-size:16px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .component[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-weight:400;font-size:12px}}']}),e})();function hB(e,t){if(1&e){const n=Fo();Ze(0,"a",6),xn("mouseover",function(){return ni(n),Vr(_n(2).linkHover=!0)})("mouseleave",function(){return ni(n),Vr(_n(2).linkHover=!1)}),dn(1),nt()}if(2&e){const n=_n(2);Ti("color",n.PRIMARY_COLOR),uv("href",n.item.link_domain,Yl),Qe(1),bi(n.item.link_title)}}function dB(e,t){if(1&e){const n=Fo();Ze(0,"a",7),xn("mouseover",function(){return ni(n),Vr(_n(2).linkHover=!0)})("mouseleave",function(){return ni(n),Vr(_n(2).linkHover=!1)}),dn(1),nt()}if(2&e){const n=_n(2);Ti("background-color",n.PRIMARY_COLOR),uv("href",n.item.link_domain,Yl),Qe(1),bi(n.item.link_title)}}function fB(e,t){if(1&e&&(Ze(0,"div",2)(1,"div",3),Jn(2,hB,2,4,"a",4),Jn(3,dB,2,4,"a",5),nt()()),2&e){const n=_n();Qe(2),jt("ngIf",!n.linkHover),Qe(1),jt("ngIf",n.linkHover)}}let pB=(()=>{class e{constructor(){this.mapView=new br,this.sub=null,this.linkHover=!1,this.PRIMARY_COLOR=Mo}ngOnInit(){}ngOnChanges(){this.update()}ngAfterViewInit(){this.update()}update(){this.player&&this.player.player&&(this.activeItem===this.item?(this.player.player.play(),null===this.sub&&this.item.audio_timestamps&&this.item.audio_timestamps.length&&(this.sub=this.player.player.hiResTimestamp.subscribe(n=>{const r=this.item.audio_timestamps.filter(a=>10*a.timestamp===n);r.length&&r[0].map_view&&r[0].map_view.length&&this.mapView.emit(r[0].map_view[0])}))):(this.player.player.pause(),null!==this.sub&&(this.sub.unsubscribe(),this.sub=null)))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-content-audio"]],viewQuery:function(n,r){if(1&n&&Hs(tI,7),2&n){let a;ds(a=fs())&&(r.player=a.first)}},inputs:{item:"item",activeItem:"activeItem"},outputs:{mapView:"mapView"},features:[mi],decls:3,vars:4,consts:[[3,"audio","image","color"],["class","link",4,"ngIf"],[1,"link"],[1,"link-container"],["target","blank","class","link-title",3,"href","color","mouseover","mouseleave",4,"ngIf"],["target","blank","class","link-title hover",3,"href","background-color","mouseover","mouseleave",4,"ngIf"],["target","blank",1,"link-title",3,"href","mouseover","mouseleave"],["target","blank",1,"link-title","hover",3,"href","mouseover","mouseleave"]],template:function(n,r){1&n&&(Ze(0,"div"),on(1,"app-audio-player",0),Jn(2,fB,4,2,"div",1),nt()),2&n&&(Qe(1),jt("audio",r.item.audio_s3url||r.item.audio[0].url)("image",r.item.image[0].thumbnails.large.url)("color",r.PRIMARY_COLOR),Qe(1),jt("ngIf",r.item.link_title))},dependencies:[Va,tI],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{margin-top:auto;margin-bottom:auto}@media only screen and (min-width: 601px){app-player[_ngcontent-%COMP%]{align-items:flex-start}}.link-container[_ngcontent-%COMP%]{z-index:1;position:relative;bottom:70px;font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;text-transform:uppercase;font-size:14px;font-weight:700;text-align:center}.link-container[_ngcontent-%COMP%]   a.link-title[_ngcontent-%COMP%]{padding:4px 16px;border-radius:16px;text-decoration:none;background:white}.link-container[_ngcontent-%COMP%]   a.link-title.hover[_ngcontent-%COMP%]{background:#CE0031;color:#fff}']}),e})();const mB=["frame"];let gB=(()=>{class e{constructor(n){this.sanitizer=n,this.playerReady=new Qm(1)}ngOnInit(){}ngOnChanges(){const n=this.activeItem===this.item;n?this.playerReady.pipe(Bo()).subscribe(()=>{n&&this.player.getPlayerState()!==YT.PlayerState.PLAYING&&this.player.playVideo()}):this.playerReady.pipe(Bo()).subscribe(()=>{!n&&this.player.getPlayerState()!==YT.PlayerState.PAUSED&&this.player.getPlayerState()!==YT.PlayerState.ENDED&&this.player.pauseVideo()})}ngAfterViewInit(){const n=this.frame.nativeElement,r=Math.min(n.offsetWidth,640);this.player=new YT.Player(n,{videoId:this.item.youtube_video_id,height:3*r/4+"px",width:r+"px",events:{onReady:()=>{this.playerReady.next(),this.playerReady.complete()}},playerVars:{enablejsapi:1}})}}return e.\u0275fac=function(n){return new(n||e)(rt(Xm))},e.\u0275cmp=kr({type:e,selectors:[["app-content-video"]],viewQuery:function(n,r){if(1&n&&Hs(mB,7),2&n){let a;ds(a=fs())&&(r.frame=a.first)}},inputs:{item:"item",activeItem:"activeItem"},features:[mi],decls:2,vars:0,consts:[["frame",""]],template:function(n,r){1&n&&on(0,"div",null,0)}}),e})(),_B=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-content-image"]],inputs:{item:"item"},decls:1,vars:1,consts:[[3,"src"]],template:function(n,r){1&n&&on(0,"img",0),2&n&&jt("src",r.item.image[0].url,Yl)},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:auto;display:flex;flex-flow:column;align-items:center;padding-bottom:8px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-fit:contain;max-width:100%;max-height:100vh}@media only screen and (min-width: 601px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{object-position:left;max-width:min(600px,100%);max-height:75vh}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100vh}}']}),e})();let eg={baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1};const vB=/[&<>"']/,xB=/[&<>"']/g,bB=/[<>"']|&(?!#?\w+;)/,wB=/[<>"']|&(?!#?\w+;)/g,CB={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},rI=e=>CB[e];function Yo(e,t){if(t){if(vB.test(e))return e.replace(xB,rI)}else if(bB.test(e))return e.replace(wB,rI);return e}const MB=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function iI(e){return e.replace(MB,(t,n)=>"colon"===(n=n.toLowerCase())?":":"#"===n.charAt(0)?"x"===n.charAt(1)?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):"")}const EB=/(^|[^\[])\^/g;function wi(e,t){e="string"==typeof e?e:e.source,t=t||"";const n={replace:(r,a)=>(a=(a=a.source||a).replace(EB,"$1"),e=e.replace(r,a),n),getRegex:()=>new RegExp(e,t)};return n}const TB=/[^\w:]/g,DB=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function oI(e,t,n){if(e){let r;try{r=decodeURIComponent(iI(n)).replace(TB,"").toLowerCase()}catch{return null}if(0===r.indexOf("javascript:")||0===r.indexOf("vbscript:")||0===r.indexOf("data:"))return null}t&&!DB.test(n)&&(n=function PB(e,t){fx[" "+e]||(fx[" "+e]=SB.test(e)?e+"/":mx(e,"/",!0));const n=-1===(e=fx[" "+e]).indexOf(":");return"//"===t.substring(0,2)?n?t:e.replace(IB,"$1")+t:"/"===t.charAt(0)?n?t:e.replace(AB,"$1")+t:e+t}(t,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const fx={},SB=/^[^:]+:\/*[^/]*$/,IB=/^([^:]+:)[\s\S]*$/,AB=/^([^:]+:\/*[^/]*)[\s\S]*$/,px={exec:function(){}};function cc(e){let n,r,t=1;for(;t<arguments.length;t++)for(r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}function sI(e,t){const r=e.replace(/\|/g,(u,m,v)=>{let C=!1,D=m;for(;--D>=0&&"\\"===v[D];)C=!C;return C?"|":" |"}).split(/ \|/);let a=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(/\\\|/g,"|");return r}function mx(e,t,n){const r=e.length;if(0===r)return"";let a=0;for(;a<r;){const u=e.charAt(r-a-1);if(u!==t||n){if(u===t||!n)break;a++}else a++}return e.slice(0,r-a)}function aI(e){e&&e.sanitize&&!e.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function lI(e,t){if(t<1)return"";let n="";for(;t>1;)1&t&&(n+=e),t>>=1,e+=e;return n+e}function cI(e,t,n,r){const a=t.href,u=t.title?Yo(t.title):null,m=e[1].replace(/\\([\[\]])/g,"$1");if("!"!==e[0].charAt(0)){r.state.inLink=!0;const v={type:"link",raw:n,href:a,title:u,text:m,tokens:r.inlineTokens(m,[])};return r.state.inLink=!1,v}return{type:"image",raw:n,href:a,title:u,text:Yo(m)}}class MC{constructor(t){this.options=t||eg}space(t){const n=this.rules.block.newline.exec(t);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(t){const n=this.rules.block.code.exec(t);if(n){const r=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?r:mx(r,"\n")}}}fences(t){const n=this.rules.block.fences.exec(t);if(n){const r=n[0],a=function kB(e,t){const n=e.match(/^(\s+)(?:```)/);if(null===n)return t;const r=n[1];return t.split("\n").map(a=>{const u=a.match(/^\s+/);if(null===u)return a;const[m]=u;return m.length>=r.length?a.slice(r.length):a}).join("\n")}(r,n[3]||"");return{type:"code",raw:r,lang:n[2]?n[2].trim():n[2],text:a}}}heading(t){const n=this.rules.block.heading.exec(t);if(n){let r=n[2].trim();if(/#$/.test(r)){const u=mx(r,"#");(this.options.pedantic||!u||/ $/.test(u))&&(r=u.trim())}const a={type:"heading",raw:n[0],depth:n[1].length,text:r,tokens:[]};return this.lexer.inline(a.text,a.tokens),a}}hr(t){const n=this.rules.block.hr.exec(t);if(n)return{type:"hr",raw:n[0]}}blockquote(t){const n=this.rules.block.blockquote.exec(t);if(n){const r=n[0].replace(/^ *>[ \t]?/gm,"");return{type:"blockquote",raw:n[0],tokens:this.lexer.blockTokens(r,[]),text:r}}}list(t){let n=this.rules.block.list.exec(t);if(n){let r,a,u,m,v,C,D,O,F,U,G,me,Ae=n[1].trim();const We=Ae.length>1,Pe={type:"list",raw:"",ordered:We,start:We?+Ae.slice(0,-1):"",loose:!1,items:[]};Ae=We?`\\d{1,9}\\${Ae.slice(-1)}`:`\\${Ae}`,this.options.pedantic&&(Ae=We?Ae:"[*+-]");const dt=new RegExp(`^( {0,3}${Ae})((?:[\t ][^\\n]*)?(?:\\n|$))`);for(;t&&(me=!1,(n=dt.exec(t))&&!this.rules.block.hr.test(t));){if(r=n[0],t=t.substring(r.length),O=n[2].split("\n",1)[0],F=t.split("\n",1)[0],this.options.pedantic?(m=2,G=O.trimLeft()):(m=n[2].search(/[^ ]/),m=m>4?1:m,G=O.slice(m),m+=n[1].length),C=!1,!O&&/^ *$/.test(F)&&(r+=F+"\n",t=t.substring(F.length+1),me=!0),!me){const Ct=new RegExp(`^ {0,${Math.min(3,m-1)}}(?:[*+-]|\\d{1,9}[.)])((?: [^\\n]*)?(?:\\n|$))`),en=new RegExp(`^ {0,${Math.min(3,m-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),Tt=new RegExp(`^( {0,${Math.min(3,m-1)}})(\`\`\`|~~~)`);for(;t&&(U=t.split("\n",1)[0],O=U,this.options.pedantic&&(O=O.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(Tt.test(O)||this.rules.block.heading.test(O)||Ct.test(O)||en.test(t)));){if(O.search(/[^ ]/)>=m||!O.trim())G+="\n"+O.slice(m);else{if(C)break;G+="\n"+O}!C&&!O.trim()&&(C=!0),r+=U+"\n",t=t.substring(U.length+1)}}Pe.loose||(D?Pe.loose=!0:/\n *\n *$/.test(r)&&(D=!0)),this.options.gfm&&(a=/^\[[ xX]\] /.exec(G),a&&(u="[ ] "!==a[0],G=G.replace(/^\[[ xX]\] +/,""))),Pe.items.push({type:"list_item",raw:r,task:!!a,checked:u,loose:!1,text:G}),Pe.raw+=r}Pe.items[Pe.items.length-1].raw=r.trimRight(),Pe.items[Pe.items.length-1].text=G.trimRight(),Pe.raw=Pe.raw.trimRight();const Ge=Pe.items.length;for(v=0;v<Ge;v++){this.lexer.state.top=!1,Pe.items[v].tokens=this.lexer.blockTokens(Pe.items[v].text,[]);const Ct=Pe.items[v].tokens.filter(Tt=>"space"===Tt.type),en=Ct.every(Tt=>{const Yn=Tt.raw.split("");let Zi=0;for(const _s of Yn)if("\n"===_s&&(Zi+=1),Zi>1)return!0;return!1});!Pe.loose&&Ct.length&&en&&(Pe.loose=!0,Pe.items[v].loose=!0)}return Pe}}html(t){const n=this.rules.block.html.exec(t);if(n){const r={type:"html",raw:n[0],pre:!this.options.sanitizer&&("pre"===n[1]||"script"===n[1]||"style"===n[1]),text:n[0]};return this.options.sanitize&&(r.type="paragraph",r.text=this.options.sanitizer?this.options.sanitizer(n[0]):Yo(n[0]),r.tokens=[],this.lexer.inline(r.text,r.tokens)),r}}def(t){const n=this.rules.block.def.exec(t);if(n)return n[3]&&(n[3]=n[3].substring(1,n[3].length-1)),{type:"def",tag:n[1].toLowerCase().replace(/\s+/g," "),raw:n[0],href:n[2],title:n[3]}}table(t){const n=this.rules.block.table.exec(t);if(n){const r={type:"table",header:sI(n[1]).map(a=>({text:a})),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split("\n"):[]};if(r.header.length===r.align.length){r.raw=n[0];let u,m,v,C,a=r.align.length;for(u=0;u<a;u++)r.align[u]=/^ *-+: *$/.test(r.align[u])?"right":/^ *:-+: *$/.test(r.align[u])?"center":/^ *:-+ *$/.test(r.align[u])?"left":null;for(a=r.rows.length,u=0;u<a;u++)r.rows[u]=sI(r.rows[u],r.header.length).map(D=>({text:D}));for(a=r.header.length,m=0;m<a;m++)r.header[m].tokens=[],this.lexer.inline(r.header[m].text,r.header[m].tokens);for(a=r.rows.length,m=0;m<a;m++)for(C=r.rows[m],v=0;v<C.length;v++)C[v].tokens=[],this.lexer.inline(C[v].text,C[v].tokens);return r}}}lheading(t){const n=this.rules.block.lheading.exec(t);if(n){const r={type:"heading",raw:n[0],depth:"="===n[2].charAt(0)?1:2,text:n[1],tokens:[]};return this.lexer.inline(r.text,r.tokens),r}}paragraph(t){const n=this.rules.block.paragraph.exec(t);if(n){const r={type:"paragraph",raw:n[0],text:"\n"===n[1].charAt(n[1].length-1)?n[1].slice(0,-1):n[1],tokens:[]};return this.lexer.inline(r.text,r.tokens),r}}text(t){const n=this.rules.block.text.exec(t);if(n){const r={type:"text",raw:n[0],text:n[0],tokens:[]};return this.lexer.inline(r.text,r.tokens),r}}escape(t){const n=this.rules.inline.escape.exec(t);if(n)return{type:"escape",raw:n[0],text:Yo(n[1])}}tag(t){const n=this.rules.inline.tag.exec(t);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Yo(n[0]):n[0]}}link(t){const n=this.rules.inline.link.exec(t);if(n){const r=n[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;const m=mx(r.slice(0,-1),"\\");if((r.length-m.length)%2==0)return}else{const m=function OB(e,t){if(-1===e.indexOf(t[1]))return-1;const n=e.length;let r=0,a=0;for(;a<n;a++)if("\\"===e[a])a++;else if(e[a]===t[0])r++;else if(e[a]===t[1]&&(r--,r<0))return a;return-1}(n[2],"()");if(m>-1){const C=(0===n[0].indexOf("!")?5:4)+n[1].length+m;n[2]=n[2].substring(0,m),n[0]=n[0].substring(0,C).trim(),n[3]=""}}let a=n[2],u="";if(this.options.pedantic){const m=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);m&&(a=m[1],u=m[3])}else u=n[3]?n[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(a=this.options.pedantic&&!/>$/.test(r)?a.slice(1):a.slice(1,-1)),cI(n,{href:a&&a.replace(this.rules.inline._escapes,"$1"),title:u&&u.replace(this.rules.inline._escapes,"$1")},n[0],this.lexer)}}reflink(t,n){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){let a=(r[2]||r[1]).replace(/\s+/g," ");if(a=n[a.toLowerCase()],!a||!a.href){const u=r[0].charAt(0);return{type:"text",raw:u,text:u}}return cI(r,a,r[0],this.lexer)}}emStrong(t,n,r=""){let a=this.rules.inline.emStrong.lDelim.exec(t);if(!a||a[3]&&r.match(/[\p{L}\p{N}]/u))return;const u=a[1]||a[2]||"";if(!u||u&&(""===r||this.rules.inline.punctuation.exec(r))){const m=a[0].length-1;let v,C,D=m,O=0;const F="*"===a[0][0]?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(F.lastIndex=0,n=n.slice(-1*t.length+m);null!=(a=F.exec(n));){if(v=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!v)continue;if(C=v.length,a[3]||a[4]){D+=C;continue}if((a[5]||a[6])&&m%3&&!((m+C)%3)){O+=C;continue}if(D-=C,D>0)continue;if(C=Math.min(C,C+D+O),Math.min(m,C)%2){const G=t.slice(1,m+a.index+C);return{type:"em",raw:t.slice(0,m+a.index+C+1),text:G,tokens:this.lexer.inlineTokens(G,[])}}const U=t.slice(2,m+a.index+C-1);return{type:"strong",raw:t.slice(0,m+a.index+C+1),text:U,tokens:this.lexer.inlineTokens(U,[])}}}}codespan(t){const n=this.rules.inline.code.exec(t);if(n){let r=n[2].replace(/\n/g," ");const a=/[^ ]/.test(r),u=/^ /.test(r)&&/ $/.test(r);return a&&u&&(r=r.substring(1,r.length-1)),r=Yo(r,!0),{type:"codespan",raw:n[0],text:r}}}br(t){const n=this.rules.inline.br.exec(t);if(n)return{type:"br",raw:n[0]}}del(t){const n=this.rules.inline.del.exec(t);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2],[])}}autolink(t,n){const r=this.rules.inline.autolink.exec(t);if(r){let a,u;return"@"===r[2]?(a=Yo(this.options.mangle?n(r[1]):r[1]),u="mailto:"+a):(a=Yo(r[1]),u=a),{type:"link",raw:r[0],text:a,href:u,tokens:[{type:"text",raw:a,text:a}]}}}url(t,n){let r;if(r=this.rules.inline.url.exec(t)){let a,u;if("@"===r[2])a=Yo(this.options.mangle?n(r[0]):r[0]),u="mailto:"+a;else{let m;do{m=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0]}while(m!==r[0]);a=Yo(r[0]),u="www."===r[1]?"http://"+a:a}return{type:"link",raw:r[0],text:a,href:u,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t,n){const r=this.rules.inline.text.exec(t);if(r){let a;return a=this.lexer.state.inRawBlock?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):Yo(r[0]):r[0]:Yo(this.options.smartypants?n(r[0]):r[0]),{type:"text",raw:r[0],text:a}}}}const kn={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?<?([^\s>]+)>?(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:px,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\.|[^\[\]\\])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};kn.def=wi(kn.def).replace("label",kn._label).replace("title",kn._title).getRegex(),kn.bullet=/(?:[*+-]|\d{1,9}[.)])/,kn.listItemStart=wi(/^( *)(bull) */).replace("bull",kn.bullet).getRegex(),kn.list=wi(kn.list).replace(/bull/g,kn.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+kn.def.source+")").getRegex(),kn._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",kn._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,kn.html=wi(kn.html,"i").replace("comment",kn._comment).replace("tag",kn._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),kn.paragraph=wi(kn._paragraph).replace("hr",kn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kn._tag).getRegex(),kn.blockquote=wi(kn.blockquote).replace("paragraph",kn.paragraph).getRegex(),kn.normal=cc({},kn),kn.gfm=cc({},kn.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),kn.gfm.table=wi(kn.gfm.table).replace("hr",kn.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kn._tag).getRegex(),kn.gfm.paragraph=wi(kn._paragraph).replace("hr",kn.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",kn.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",kn._tag).getRegex(),kn.pedantic=cc({},kn.normal,{html:wi("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",kn._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:px,paragraph:wi(kn.normal._paragraph).replace("hr",kn.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",kn.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const an={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:px,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^[^_*]*?\_\_[^_*]*?\*[^_*]*?(?=\_\_)|[^*]+(?=[^*])|[punct_](\*+)(?=[\s]|$)|[^punct*_\s](\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|[^punct*_\s](\*+)(?=[^punct*_\s])/,rDelimUnd:/^[^_*]*?\*\*[^_*]*?\_[^_*]*?(?=\*\*)|[^_]+(?=[^_])|[punct*](\_+)(?=[\s]|$)|[^punct*_\s](\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:px,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};function RB(e){return e.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026")}function uI(e){let n,r,t="";const a=e.length;for(n=0;n<a;n++)r=e.charCodeAt(n),Math.random()>.5&&(r="x"+r.toString(16)),t+="&#"+r+";";return t}an._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",an.punctuation=wi(an.punctuation).replace(/punctuation/g,an._punctuation).getRegex(),an.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g,an.escapedEmSt=/\\\*|\\_/g,an._comment=wi(kn._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),an.emStrong.lDelim=wi(an.emStrong.lDelim).replace(/punct/g,an._punctuation).getRegex(),an.emStrong.rDelimAst=wi(an.emStrong.rDelimAst,"g").replace(/punct/g,an._punctuation).getRegex(),an.emStrong.rDelimUnd=wi(an.emStrong.rDelimUnd,"g").replace(/punct/g,an._punctuation).getRegex(),an._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,an._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,an._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,an.autolink=wi(an.autolink).replace("scheme",an._scheme).replace("email",an._email).getRegex(),an._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,an.tag=wi(an.tag).replace("comment",an._comment).replace("attribute",an._attribute).getRegex(),an._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,an._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,an._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,an.link=wi(an.link).replace("label",an._label).replace("href",an._href).replace("title",an._title).getRegex(),an.reflink=wi(an.reflink).replace("label",an._label).replace("ref",kn._label).getRegex(),an.nolink=wi(an.nolink).replace("ref",kn._label).getRegex(),an.reflinkSearch=wi(an.reflinkSearch,"g").replace("reflink",an.reflink).replace("nolink",an.nolink).getRegex(),an.normal=cc({},an),an.pedantic=cc({},an.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:wi(/^!?\[(label)\]\((.*?)\)/).replace("label",an._label).getRegex(),reflink:wi(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",an._label).getRegex()}),an.gfm=cc({},an.normal,{escape:wi(an.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/}),an.gfm.url=wi(an.gfm.url,"i").replace("email",an.gfm._extended_email).getRegex(),an.breaks=cc({},an.gfm,{br:wi(an.br).replace("{2,}","*").getRegex(),text:wi(an.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});class Sh{constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||eg,this.options.tokenizer=this.options.tokenizer||new MC,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:kn.normal,inline:an.normal};this.options.pedantic?(n.block=kn.pedantic,n.inline=an.pedantic):this.options.gfm&&(n.block=kn.gfm,n.inline=this.options.breaks?an.breaks:an.gfm),this.tokenizer.rules=n}static get rules(){return{block:kn,inline:an}}static lex(t,n){return new Sh(n).lex(t)}static lexInline(t,n){return new Sh(n).inlineTokens(t)}lex(t){let n;for(t=t.replace(/\r\n|\r/g,"\n"),this.blockTokens(t,this.tokens);n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(t,n=[]){let r,a,u,m;for(t=this.options.pedantic?t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t.replace(/^( *)(\t+)/gm,(v,C,D)=>C+"    ".repeat(D.length));t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(v=>!!(r=v.call({lexer:this},t,n))&&(t=t.substring(r.raw.length),n.push(r),!0)))){if(r=this.tokenizer.space(t)){t=t.substring(r.raw.length),1===r.raw.length&&n.length>0?n[n.length-1].raw+="\n":n.push(r);continue}if(r=this.tokenizer.code(t)){t=t.substring(r.raw.length),a=n[n.length-1],!a||"paragraph"!==a.type&&"text"!==a.type?n.push(r):(a.raw+="\n"+r.raw,a.text+="\n"+r.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text);continue}if(r=this.tokenizer.fences(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.heading(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.hr(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.blockquote(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.list(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.html(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.def(t)){t=t.substring(r.raw.length),a=n[n.length-1],!a||"paragraph"!==a.type&&"text"!==a.type?this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title}):(a.raw+="\n"+r.raw,a.text+="\n"+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text);continue}if(r=this.tokenizer.table(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.lheading(t)){t=t.substring(r.raw.length),n.push(r);continue}if(u=t,this.options.extensions&&this.options.extensions.startBlock){let v=1/0;const C=t.slice(1);let D;this.options.extensions.startBlock.forEach(function(O){D=O.call({lexer:this},C),"number"==typeof D&&D>=0&&(v=Math.min(v,D))}),v<1/0&&v>=0&&(u=t.substring(0,v+1))}if(this.state.top&&(r=this.tokenizer.paragraph(u))){a=n[n.length-1],m&&"paragraph"===a.type?(a.raw+="\n"+r.raw,a.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):n.push(r),m=u.length!==t.length,t=t.substring(r.raw.length);continue}if(r=this.tokenizer.text(t)){t=t.substring(r.raw.length),a=n[n.length-1],a&&"text"===a.type?(a.raw+="\n"+r.raw,a.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):n.push(r);continue}if(t){const v="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(v);break}throw new Error(v)}}return this.state.top=!0,n}inline(t,n){this.inlineQueue.push({src:t,tokens:n})}inlineTokens(t,n=[]){let r,a,u,v,C,D,m=t;if(this.tokens.links){const O=Object.keys(this.tokens.links);if(O.length>0)for(;null!=(v=this.tokenizer.rules.inline.reflinkSearch.exec(m));)O.includes(v[0].slice(v[0].lastIndexOf("[")+1,-1))&&(m=m.slice(0,v.index)+"["+lI("a",v[0].length-2)+"]"+m.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(v=this.tokenizer.rules.inline.blockSkip.exec(m));)m=m.slice(0,v.index)+"["+lI("a",v[0].length-2)+"]"+m.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(v=this.tokenizer.rules.inline.escapedEmSt.exec(m));)m=m.slice(0,v.index)+"++"+m.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex);for(;t;)if(C||(D=""),C=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(O=>!!(r=O.call({lexer:this},t,n))&&(t=t.substring(r.raw.length),n.push(r),!0)))){if(r=this.tokenizer.escape(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.tag(t)){t=t.substring(r.raw.length),a=n[n.length-1],a&&"text"===r.type&&"text"===a.type?(a.raw+=r.raw,a.text+=r.text):n.push(r);continue}if(r=this.tokenizer.link(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(r.raw.length),a=n[n.length-1],a&&"text"===r.type&&"text"===a.type?(a.raw+=r.raw,a.text+=r.text):n.push(r);continue}if(r=this.tokenizer.emStrong(t,m,D)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.codespan(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.br(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.del(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.autolink(t,uI)){t=t.substring(r.raw.length),n.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(t,uI))){t=t.substring(r.raw.length),n.push(r);continue}if(u=t,this.options.extensions&&this.options.extensions.startInline){let O=1/0;const F=t.slice(1);let U;this.options.extensions.startInline.forEach(function(G){U=G.call({lexer:this},F),"number"==typeof U&&U>=0&&(O=Math.min(O,U))}),O<1/0&&O>=0&&(u=t.substring(0,O+1))}if(r=this.tokenizer.inlineText(u,RB)){t=t.substring(r.raw.length),"_"!==r.raw.slice(-1)&&(D=r.raw.slice(-1)),C=!0,a=n[n.length-1],a&&"text"===a.type?(a.raw+=r.raw,a.text+=r.text):n.push(r);continue}if(t){const O="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(O);break}throw new Error(O)}}return n}}class EC{constructor(t){this.options=t||eg}code(t,n,r){const a=(n||"").match(/\S*/)[0];if(this.options.highlight){const u=this.options.highlight(t,a);null!=u&&u!==t&&(r=!0,t=u)}return t=t.replace(/\n$/,"")+"\n",a?'<pre><code class="'+this.options.langPrefix+Yo(a,!0)+'">'+(r?t:Yo(t,!0))+"</code></pre>\n":"<pre><code>"+(r?t:Yo(t,!0))+"</code></pre>\n"}blockquote(t){return`<blockquote>\n${t}</blockquote>\n`}html(t){return t}heading(t,n,r,a){return this.options.headerIds?`<h${n} id="${this.options.headerPrefix+a.slug(r)}">${t}</h${n}>\n`:`<h${n}>${t}</h${n}>\n`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(t,n,r){const a=n?"ol":"ul";return"<"+a+(n&&1!==r?' start="'+r+'"':"")+">\n"+t+"</"+a+">\n"}listitem(t){return`<li>${t}</li>\n`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(t){return`<p>${t}</p>\n`}table(t,n){return n&&(n=`<tbody>${n}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+n+"</table>\n"}tablerow(t){return`<tr>\n${t}</tr>\n`}tablecell(t,n){const r=n.header?"th":"td";return(n.align?`<${r} align="${n.align}">`:`<${r}>`)+t+`</${r}>\n`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(t){return`<del>${t}</del>`}link(t,n,r){if(null===(t=oI(this.options.sanitize,this.options.baseUrl,t)))return r;let a='<a href="'+Yo(t)+'"';return n&&(a+=' title="'+n+'"'),a+=">"+r+"</a>",a}image(t,n,r){if(null===(t=oI(this.options.sanitize,this.options.baseUrl,t)))return r;let a=`<img src="${t}" alt="${r}"`;return n&&(a+=` title="${n}"`),a+=this.options.xhtml?"/>":">",a}text(t){return t}}class hI{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,n,r){return""+r}image(t,n,r){return""+r}br(){return""}}class dI{constructor(){this.seen={}}serialize(t){return t.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(t,n){let r=t,a=0;if(this.seen.hasOwnProperty(r)){a=this.seen[t];do{a++,r=t+"-"+a}while(this.seen.hasOwnProperty(r))}return n||(this.seen[t]=a,this.seen[r]=0),r}slug(t,n={}){const r=this.serialize(t);return this.getNextSafeSlug(r,n.dryrun)}}class Ih{constructor(t){this.options=t||eg,this.options.renderer=this.options.renderer||new EC,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new hI,this.slugger=new dI}static parse(t,n){return new Ih(n).parse(t)}static parseInline(t,n){return new Ih(n).parseInline(t)}parse(t,n=!0){let a,u,m,v,C,D,O,F,U,G,me,Ae,We,Pe,dt,Ge,Ct,en,Tt,r="";const Yn=t.length;for(a=0;a<Yn;a++)if(G=t[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[G.type]&&(Tt=this.options.extensions.renderers[G.type].call({parser:this},G),!1!==Tt||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(G.type)))r+=Tt||"";else switch(G.type){case"space":continue;case"hr":r+=this.renderer.hr();continue;case"heading":r+=this.renderer.heading(this.parseInline(G.tokens),G.depth,iI(this.parseInline(G.tokens,this.textRenderer)),this.slugger);continue;case"code":r+=this.renderer.code(G.text,G.lang,G.escaped);continue;case"table":for(F="",O="",v=G.header.length,u=0;u<v;u++)O+=this.renderer.tablecell(this.parseInline(G.header[u].tokens),{header:!0,align:G.align[u]});for(F+=this.renderer.tablerow(O),U="",v=G.rows.length,u=0;u<v;u++){for(D=G.rows[u],O="",C=D.length,m=0;m<C;m++)O+=this.renderer.tablecell(this.parseInline(D[m].tokens),{header:!1,align:G.align[m]});U+=this.renderer.tablerow(O)}r+=this.renderer.table(F,U);continue;case"blockquote":U=this.parse(G.tokens),r+=this.renderer.blockquote(U);continue;case"list":for(me=G.ordered,Ae=G.start,We=G.loose,v=G.items.length,U="",u=0;u<v;u++)dt=G.items[u],Ge=dt.checked,Ct=dt.task,Pe="",dt.task&&(en=this.renderer.checkbox(Ge),We?dt.tokens.length>0&&"paragraph"===dt.tokens[0].type?(dt.tokens[0].text=en+" "+dt.tokens[0].text,dt.tokens[0].tokens&&dt.tokens[0].tokens.length>0&&"text"===dt.tokens[0].tokens[0].type&&(dt.tokens[0].tokens[0].text=en+" "+dt.tokens[0].tokens[0].text)):dt.tokens.unshift({type:"text",text:en}):Pe+=en),Pe+=this.parse(dt.tokens,We),U+=this.renderer.listitem(Pe,Ct,Ge);r+=this.renderer.list(U,me,Ae);continue;case"html":r+=this.renderer.html(G.text);continue;case"paragraph":r+=this.renderer.paragraph(this.parseInline(G.tokens));continue;case"text":for(U=G.tokens?this.parseInline(G.tokens):G.text;a+1<Yn&&"text"===t[a+1].type;)G=t[++a],U+="\n"+(G.tokens?this.parseInline(G.tokens):G.text);r+=n?this.renderer.paragraph(U):U;continue;default:{const Zi='Token with "'+G.type+'" type was not found.';if(this.options.silent)return void console.error(Zi);throw new Error(Zi)}}return r}parseInline(t,n){n=n||this.renderer;let a,u,m,r="";const v=t.length;for(a=0;a<v;a++)if(u=t[a],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[u.type]&&(m=this.options.extensions.renderers[u.type].call({parser:this},u),!1!==m||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)))r+=m||"";else switch(u.type){case"escape":case"text":r+=n.text(u.text);break;case"html":r+=n.html(u.text);break;case"link":r+=n.link(u.href,u.title,this.parseInline(u.tokens,n));break;case"image":r+=n.image(u.href,u.title,u.text);break;case"strong":r+=n.strong(this.parseInline(u.tokens,n));break;case"em":r+=n.em(this.parseInline(u.tokens,n));break;case"codespan":r+=n.codespan(u.text);break;case"br":r+=n.br();break;case"del":r+=n.del(this.parseInline(u.tokens,n));break;default:{const C='Token with "'+u.type+'" type was not found.';if(this.options.silent)return void console.error(C);throw new Error(C)}}return r}}function An(e,t,n){if(typeof e>"u"||null===e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if("function"==typeof t&&(n=t,t=null),aI(t=cc({},An.defaults,t||{})),n){const r=t.highlight;let a;try{a=Sh.lex(e,t)}catch(v){return n(v)}const u=function(v){let C;if(!v)try{t.walkTokens&&An.walkTokens(a,t.walkTokens),C=Ih.parse(a,t)}catch(D){v=D}return t.highlight=r,v?n(v):n(null,C)};if(!r||r.length<3||(delete t.highlight,!a.length))return u();let m=0;return An.walkTokens(a,function(v){"code"===v.type&&(m++,setTimeout(()=>{r(v.text,v.lang,function(C,D){if(C)return u(C);null!=D&&D!==v.text&&(v.text=D,v.escaped=!0),m--,0===m&&u()})},0))}),void(0===m&&u())}try{const r=Sh.lex(e,t);return t.walkTokens&&An.walkTokens(r,t.walkTokens),Ih.parse(r,t)}catch(r){if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+Yo(r.message+"",!0)+"</pre>";throw r}}function LB(e,t){1&e&&on(0,"div",18),2&e&&Ti("background-image","url("+_n().item.image[0].url+")")}function FB(e,t){1&e&&on(0,"div",24),2&e&&Ti("background-image","url("+_n(2).item.image[0].url+")")}function zB(e,t){if(1&e&&(Ze(0,"div",19),Jn(1,FB,1,2,"div",20),Ze(2,"div",21)(3,"div",22),dn(4),nt(),Ze(5,"div",23),dn(6),nt()()()),2&e){const n=_n();Qe(1),jt("ngIf",n.item.image),Qe(3),bi(n.item.link_title),Qe(2),bi(n.item.link_domain)}}An.options=An.setOptions=function(e){return cc(An.defaults,e),function yB(e){eg=e}(An.defaults),An},An.getDefaults=function nI(){return{baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}},An.defaults=eg,An.use=function(...e){const t=cc({},...e),n=An.defaults.extensions||{renderers:{},childTokens:{}};let r;e.forEach(a=>{if(a.extensions&&(r=!0,a.extensions.forEach(u=>{if(!u.name)throw new Error("extension name required");if(u.renderer){const m=n.renderers?n.renderers[u.name]:null;n.renderers[u.name]=m?function(...v){let C=u.renderer.apply(this,v);return!1===C&&(C=m.apply(this,v)),C}:u.renderer}if(u.tokenizer){if(!u.level||"block"!==u.level&&"inline"!==u.level)throw new Error("extension level must be 'block' or 'inline'");n[u.level]?n[u.level].unshift(u.tokenizer):n[u.level]=[u.tokenizer],u.start&&("block"===u.level?n.startBlock?n.startBlock.push(u.start):n.startBlock=[u.start]:"inline"===u.level&&(n.startInline?n.startInline.push(u.start):n.startInline=[u.start]))}u.childTokens&&(n.childTokens[u.name]=u.childTokens)})),a.renderer){const u=An.defaults.renderer||new EC;for(const m in a.renderer){const v=u[m];u[m]=(...C)=>{let D=a.renderer[m].apply(u,C);return!1===D&&(D=v.apply(u,C)),D}}t.renderer=u}if(a.tokenizer){const u=An.defaults.tokenizer||new MC;for(const m in a.tokenizer){const v=u[m];u[m]=(...C)=>{let D=a.tokenizer[m].apply(u,C);return!1===D&&(D=v.apply(u,C)),D}}t.tokenizer=u}if(a.walkTokens){const u=An.defaults.walkTokens;t.walkTokens=function(m){a.walkTokens.call(this,m),u&&u.call(this,m)}}r&&(t.extensions=n),An.setOptions(t)})},An.walkTokens=function(e,t){for(const n of e)switch(t.call(An,n),n.type){case"table":for(const r of n.header)An.walkTokens(r.tokens,t);for(const r of n.rows)for(const a of r)An.walkTokens(a.tokens,t);break;case"list":An.walkTokens(n.items,t);break;default:An.defaults.extensions&&An.defaults.extensions.childTokens&&An.defaults.extensions.childTokens[n.type]?An.defaults.extensions.childTokens[n.type].forEach(function(r){An.walkTokens(n[r],t)}):n.tokens&&An.walkTokens(n.tokens,t)}},An.parseInline=function(e,t){if(typeof e>"u"||null===e)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");aI(t=cc({},An.defaults,t||{}));try{const n=Sh.lexInline(e,t);return t.walkTokens&&An.walkTokens(n,t.walkTokens),Ih.parseInline(n,t)}catch(n){if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",t.silent)return"<p>An error occurred:</p><pre>"+Yo(n.message+"",!0)+"</pre>";throw n}},An.Parser=Ih,An.parser=Ih.parse,An.Renderer=EC,An.TextRenderer=hI,An.Lexer=Sh,An.lexer=Sh.lex,An.Tokenizer=MC,An.Slugger=dI,An.parse=An;let NB=(()=>{class e{constructor(){this.marked=An}ngOnInit(){}get timestamp(){return NS(this.item.post_timestamp).format("h:mm A - MMM D, YYYY")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-content-twitter"]],inputs:{item:"item"},decls:23,vars:10,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"username"],["src","assets/img/spectours-twitter-logo.svg",1,"twitter-logo"],[1,"caption",3,"innerHtml"],["class","image",3,"background-image",4,"ngIf"],["class","link",4,"ngIf"],[1,"deets"],[1,"timestamp"],["src","assets/img/spectours-twitter-info-icon.svg",1,"info"],[1,"social"],["src","assets/img/spectours-twitter-heart-icon.svg",1,"heart","icon"],[1,"like","count"],["src","assets/img/spectours-twitter-comment-icon.svg",1,"comment","icon"],[1,"comment","count"],[1,"image"],[1,"link"],["class","link-image",3,"background-image",4,"ngIf"],[1,"link-container"],[1,"link-title"],[1,"link-domain"],[1,"link-image"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1),on(2,"div",2),Ze(3,"div",3)(4,"div",4),dn(5),nt(),Ze(6,"div",5),dn(7),nt()(),on(8,"img",6),nt(),on(9,"div",7),Jn(10,LB,1,2,"div",8),Jn(11,zB,7,3,"div",9),Ze(12,"div",10)(13,"div",11),dn(14),nt(),on(15,"img",12),nt(),Ze(16,"div",13),on(17,"img",14),Ze(18,"div",15),dn(19),nt(),on(20,"img",16),Ze(21,"div",17),dn(22),nt()()()),2&n&&(Qe(2),Ti("background-image","url("+r.item.profile_image[0].thumbnails.large.url+")"),Qe(3),bi(r.item.name),Qe(2),cp("@",r.item.username,""),Qe(2),jt("innerHtml",r.marked(r.item.content),Cd),Qe(1),jt("ngIf",!r.item.link_title&&r.item.image),Qe(1),jt("ngIf",r.item.link_title),Qe(3),bi(r.timestamp),Qe(5),bi(r.item.like_count),Qe(3),bi(r.item.comment_count))},dependencies:[Va],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.twitter-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif}.card[_ngcontent-%COMP%]{background:white;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:16px;padding:16px;display:flex;flex-flow:column;align-items:stretch;width:344px;max-width:100%}.card[_ngcontent-%COMP%]     a, .card[_ngcontent-%COMP%]     a:hover, .card[_ngcontent-%COMP%]     a:visited{color:#1b97f0}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin-bottom:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:24px;background-position:center;background-size:cover;background-repeat:no-repeat}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{margin:0 10px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:700;font-size:15px;line-height:18px;color:#141719}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:15px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .twitter-logo[_ngcontent-%COMP%]{width:23px;height:19px;align-self:flex-start;margin:6px 0 6px auto}.card[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;font-size:19px;line-height:23px;color:#141719;margin-bottom:8px}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:250px;background-position:center;background-size:cover;background-repeat:no-repeat;border-radius:16px;margin:0 0 8px}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{height:250px;display:flex;flex-flow:column;border:1px solid #C5D0D8;box-sizing:border-box;border-radius:2px;margin:8px 0}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-image[_ngcontent-%COMP%]{flex:1 1 auto;background-position:center;background-size:cover;background-repeat:no-repeat;width:100%}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]{padding:8px;flex:0 0 auto}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-title[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:16px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]   .link-container[_ngcontent-%COMP%]   .link-domain[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:400;font-size:14px;line-height:17px;color:#828282;margin-top:2px}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]{border-bottom:1px solid #C5D0D8;padding-bottom:8px;display:flex;flex-flow:row;align-items:center}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .deets[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{margin-left:auto;width:20px;height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding-top:8px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-weight:500;font-size:15px;line-height:18px;color:#5a6c7b}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:6px;width:20px;max-height:20px}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]   .icon.comment[_ngcontent-%COMP%]{margin-left:auto}']}),e})(),BB=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-content-instagram"]],inputs:{item:"item"},decls:26,vars:9,consts:[[1,"card"],[1,"header"],[1,"profile-image"],[1,"user"],[1,"name"],[1,"followers"],["src","assets/img/spectours-ig-view-profile.svg",1,"ig-view-profile"],[1,"image"],[1,"view-more"],[1,"buttons"],["src","assets/img/spectours-ig-heart-icon.svg",1,"heart","icon"],["src","assets/img/spectours-ig-comment-icon.svg",1,"comment","icon"],["src","assets/img/spectours-ig-share-icon.svg",1,"share","icon"],["src","assets/img/spectours-ig-save-icon.svg",1,"save","icon"],[1,"social"],[1,"comments"],[1,"username"],[1,"comment"],[1,"footer"],["src","assets/img/spectours-ig-logo.svg",1,"logo"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1),on(2,"div",2),Ze(3,"div",3)(4,"div",4),dn(5),nt(),Ze(6,"div",5),dn(7),nt()(),on(8,"img",6),nt(),on(9,"div",7),Ze(10,"div",8),dn(11," View More on Instagram "),nt(),Ze(12,"div",9),on(13,"img",10)(14,"img",11)(15,"img",12)(16,"img",13),nt(),Ze(17,"div",14),dn(18),nt(),Ze(19,"div",15)(20,"div",16),dn(21),nt(),Ze(22,"div",17),dn(23),nt()(),Ze(24,"div",18),on(25,"img",19),nt()()),2&n&&(Qe(2),Ti("background-image","url("+r.item.profile_image[0].thumbnails.small.url+")"),Qe(3),bi(r.item.name),Qe(2),cp("",r.item.follower_count," followers"),Qe(2),Ti("background-image","url("+r.item.image[0].url+")"),Qe(9),cp(" ",r.item.like_count," likes "),Qe(3),bi(r.item.username),Qe(2),bi(r.item.content))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.ig-font[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal}.card[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;background:white;border:1px solid #D6D6D6;border-radius:3px}@media only screen and (min-width: 601px){.card[_ngcontent-%COMP%]{width:344px}}@media only screen and (max-width: 600px){.card[_ngcontent-%COMP%]{width:100%}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;padding:12px;width:100%}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:15px;background-size:cover;background-repeat:no-repeat;background-position:center;margin-right:8px}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{display:block}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:600;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]   .followers[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:500;font-size:12px;line-height:14px;color:#848484}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .ig-view-profile[_ngcontent-%COMP%]{margin-left:auto}.card[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:100%;height:100%;padding-bottom:100%;background-size:cover;background-repeat:no-repeat;background-position:center}.card[_ngcontent-%COMP%]   .view-more[_ngcontent-%COMP%]{margin:0 16px;padding:13px 0;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#008af5;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;margin:0 16px;padding:8px 0}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:14px}.card[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:last-child{margin-left:auto;margin-right:0}.card[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{margin:0 16px;padding:0 0 8px;font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-weight:700;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{margin:0 16px 2px;padding:12px 0;border-bottom:1px solid #EFEFEF}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-style:normal;font-size:12px;line-height:14px;color:#000}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-weight:700}.card[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{margin-top:6px;font-weight:400}.card[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-end;margin:8px 16px}']}),e})();function VB(e,t){1&e&&on(0,"div",8),2&e&&Ti("background-image","url("+_n().item.image[0].url+")")}let UB=(()=>{class e{constructor(){this.marked=An}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-content-wikipedia"]],inputs:{item:"item"},decls:13,vars:4,consts:[[1,"article"],[1,"title"],[1,"content"],[1,"text"],[1,"excerpt",3,"innerHtml"],["class","image",3,"background-image",4,"ngIf"],[1,"bottom"],["target","_blank",1,"link",3,"href"],[1,"image"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1)(2,"h1"),dn(3),nt(),Ze(4,"h2"),dn(5,"From Wikipedia, the free encyclopedia"),nt()(),Ze(6,"div",2)(7,"div",3),on(8,"div",4),nt(),Jn(9,VB,1,2,"div",5),Ze(10,"div",6)(11,"a",7),dn(12,"Learn more at the English Wikipedia"),nt()()()()),2&n&&(Qe(3),bi(r.item.title),Qe(5),jt("innerHtml",r.marked(r.item.content),Cd),Qe(1),jt("ngIf",r.item.image&&r.item.image.length),Qe(2),jt("href",r.item.link_domain,Yl))},dependencies:[Va],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.font-wikipedia-georgia[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal}.font-wikipedia-sans-serif[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal}.article[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;width:400px;max-width:100%;background:white;padding:8px 10px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:32px;line-height:36px;color:#000;border-bottom:1px solid #a2a2a2;margin:0 0 9px}.article[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:13px;line-height:15px;color:#000}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{flex:0 0 auto;width:100%;height:0px;padding-bottom:66%;background-position:center;background-size:cover;background-repeat:no-repeat}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-flow:column}.article[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .excerpt[_ngcontent-%COMP%]{font-family:sans-serif;font-style:normal;font-weight:400;font-size:18px;line-height:21px;color:#000;margin-bottom:6px;text-align:justify}.article[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{background-image:url(spectours-wikipedia-logo.b2e05984da61f3ad.png);background-repeat:no-repeat;background-position:bottom 4px right 4px;background-size:66px 64px;padding-top:47px;margin-top:-37px;padding-bottom:8px;margin-right:-10px}.article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .article[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .article[_ngcontent-%COMP%]   a.visited[_ngcontent-%COMP%]{font-family:Linux Libertine,Georgia,Times,serif;font-style:normal;font-weight:400;font-size:15px;line-height:17px;color:#36b;text-decoration:none}.article[_ngcontent-%COMP%]   a.link[_ngcontent-%COMP%]{margin-bottom:30px}.article[_ngcontent-%COMP%]   a.source-link[_ngcontent-%COMP%]{margin-bottom:10px}']}),e})();function jB(e,t){if(1&e){const n=Fo();Ze(0,"app-content-audio",4),xn("mapView",function(a){return ni(n),Vr(_n(2).mapView.emit(a))}),nt()}if(2&e){const n=_n(2);jt("item",n.content)("activeItem",n.activeItem)}}function $B(e,t){if(1&e&&on(0,"app-content-video",5),2&e){const n=_n(2);jt("item",n.content)("activeItem",n.activeItem)}}function GB(e,t){1&e&&on(0,"app-content-image",6),2&e&&jt("item",_n(2).content)}function HB(e,t){1&e&&on(0,"app-content-twitter",6),2&e&&jt("item",_n(2).content)}function qB(e,t){1&e&&on(0,"app-content-instagram",6),2&e&&jt("item",_n(2).content)}function ZB(e,t){1&e&&on(0,"app-content-wikipedia",6),2&e&&jt("item",_n(2).content)}function WB(e,t){if(1&e&&(nu(0),Jn(1,jB,1,2,"app-content-audio",1),Jn(2,$B,1,2,"app-content-video",2),Jn(3,GB,1,1,"app-content-image",3),Jn(4,HB,1,1,"app-content-twitter",3),Jn(5,qB,1,1,"app-content-instagram",3),Jn(6,ZB,1,1,"app-content-wikipedia",3),ru()),2&e){const n=_n();Qe(1),jt("ngIf","audio"===n.contentType),Qe(1),jt("ngIf","video"===n.contentType),Qe(1),jt("ngIf","image"===n.contentType),Qe(1),jt("ngIf","twitter"===n.contentType),Qe(1),jt("ngIf","instagram"===n.contentType),Qe(1),jt("ngIf","wikipedia"===n.contentType)}}let fI=(()=>{class e{constructor(n){this.el=n,this.mapView=new br,this.activated=new br,this.contentVisible=!1,this.visibleDetector=new CC,this.activeDetector=new CC}ngOnInit(){this.activeDetector.detected.subscribe(n=>{n&&this.activated.next(this.content)}),this.visibleDetector.detected.subscribe(n=>{this.contentVisible=this.contentVisible||n})}ngAfterViewInit(){const n=this.el.nativeElement;this.visibleDetector.initVisibilityDetector(n,this.parentElement,"visible"),this.activeDetector.initVisibilityDetector(n,this.parentElement,"active")}}return e.\u0275fac=function(n){return new(n||e)(rt(Xo))},e.\u0275cmp=kr({type:e,selectors:[["app-content-item"]],inputs:{content:"content",contentType:"contentType",activeItem:"activeItem",parentElement:"parentElement"},outputs:{mapView:"mapView",activated:"activated"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"item","activeItem","mapView",4,"ngIf"],[3,"item","activeItem",4,"ngIf"],[3,"item",4,"ngIf"],[3,"item","activeItem","mapView"],[3,"item","activeItem"],[3,"item"]],template:function(n,r){1&n&&Jn(0,WB,7,6,"ng-container",0),2&n&&jt("ngIf",r.contentVisible)},dependencies:[Va,pB,gB,_B,NB,BB,UB]}),e})(),XB=(()=>{class e{constructor(n){this.el=n,this.activeItem=null,this.mapView=new br,this.activated=new br,this.contentType="",this.content=null}ngOnInit(){this.item.hasContent&&(this.content=this.item,this.contentType=this.content.type)}onActivated(n){n&&(this.handleGeo(),this.activated.next(n))}handleGeo(){let n=null;this.item.map_view&&this.item.map_view.length?(n=this.item.map_view[0],this.mapView.next(n)):this.mapView.next(this.item.title)}classes(){return this.item&&this.item.variants?this.item.variants.join(" "):""}}return e.\u0275fac=function(n){return new(n||e)(rt(Xo))},e.\u0275cmp=kr({type:e,selectors:[["app-content"]],inputs:{item:"item",activeItem:"activeItem"},outputs:{mapView:"mapView",activated:"activated"},decls:9,vars:8,consts:[[1,"header"],[1,"year"],[1,"title"],[1,"content"],[3,"content","contentType","activeItem","parentElement","mapView","activated"],[1,"timeline","layout-desktop"]],template:function(n,r){1&n&&(Ze(0,"div")(1,"div",0)(2,"div",1),dn(3),nt(),Ze(4,"div",2),dn(5),nt()(),Ze(6,"div",3)(7,"app-content-item",4),xn("mapView",function(u){return r.mapView.emit(u)})("activated",function(u){return r.onActivated(u)}),nt()(),on(8,"div",5),nt()),2&n&&(TE("wrapper "+r.classes()),Qe(3),bi(r.item.year),Qe(2),bi(r.item.title),Qe(2),jt("content",r.content)("contentType",r.content.type)("activeItem",r.activeItem)("parentElement",r.el.nativeElement.parentElement))},dependencies:[fI],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;pointer-events:none;display:block}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]{min-height:calc(100vh - 64px);width:100%;display:flex;flex-flow:column;align-items:flex-start;background:linear-gradient(270deg,rgba(0,0,0,0) 55.4%,rgba(0,0,0,.1) 67.51%);position:relative;z-index:0;overflow:hidden;outline:1px dashed #c5c5c5;border-top:2px solid #fff;border-bottom:3px solid #fff}[_nghost-%COMP%]   .wrapper.medium[_ngcontent-%COMP%]{min-height:75vh}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;align-items:flex-start;padding:8px 16px;height:40px;position:relative;z-index:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:16px;color:#ce0031}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:16px;color:#fff;text-shadow:0 0 5px #000;text-transform:uppercase;margin-left:20px}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .timeline[_ngcontent-%COMP%]{flex:1 1 100%;width:70px;height:100%;background-image:url(spectours-timeline-dots.b1ed30ec2ae7e989.svg);background-repeat:repeat-y;background-position-x:center;background-position-y:top;position:absolute;top:40px;left:0;z-index:1}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;z-index:0;pointer-events:all;overflow:hidden;flex:1 1 auto;display:flex;flex-flow:column-reverse}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding:8px;margin-top:50vh}}[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-image, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-audio, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-video, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-twitter, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-instagram, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-wikipedia{display:flex;flex-flow:column;justify-content:flex-end;height:calc(100% - 80px)}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-image, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-audio, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-video, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-twitter, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-instagram, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-wikipedia{width:calc(100% - 140px);margin:40px 70px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-image, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-audio, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-video, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-twitter, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-instagram, [_nghost-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     app-content-wikipedia{width:100%;margin:40px 0 0}}']}),e})(),YB=(()=>{class e{constructor(n){this.el=n,this.active=!1,this.activeDetector=new CC}ngOnInit(){this.activeDetector.detected.subscribe(n=>{this.active=n,n&&(location.hash="")})}ngAfterViewInit(){const n=this.el.nativeElement;this.activeDetector.initVisibilityDetector(n,n.parentElement,"active")}}return e.\u0275fac=function(n){return new(n||e)(rt(Xo))},e.\u0275cmp=kr({type:e,selectors:[["app-content-placeholder"]],inputs:{item:"item"},decls:3,vars:3,consts:[[1,"placeholder"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"span"),dn(2),nt()()),2&n&&(to("active",r.active),Qe(2),bi(r.item.year))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .placeholder[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;border-bottom:1px dashed #C5C5C5;height:80px;padding:0 16px;background-color:#fff}[_nghost-%COMP%]   .placeholder[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-style:normal;font-weight:400;font-size:16px;font-feature-settings:"tnum" on,"lnum" on;color:#828282}[_nghost-%COMP%]   .placeholder.active[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}']}),e})();function KB(e,t){if(1&e&&(Ze(0,"div",13),dn(1),nt()),2&e){const n=_n();Ti("color",n.PRIMARY_COLOR),Qe(1),bi(n.api.contribCount)}}const JB=[[["",8,"content"]],[["",8,"header-title"]]],QB=[".content",".header-title"];let e5=(()=>{class e{constructor(){this.hideHeader=!1,this.info=new br,this.addNew=new br,this.layers=new br,this.PRIMARY_COLOR=Mo}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-layout"]],inputs:{hideHeader:"hideHeader",api:"api"},outputs:{info:"info",addNew:"addNew",layers:"layers"},ngContentSelectors:QB,decls:15,vars:8,consts:[[1,"layout"],[1,"header"],["href","/"],[1,"logo","layout-mobile",3,"src"],[1,"logo","layout-desktop",3,"src"],[1,"text"],[1,"layers"],["src","assets/img/icon-add-new.svg",3,"click"],["class","contrib",3,"color",4,"ngIf"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",1,"info",3,"click"],["d","M6.86098 4.30891C8.38213 3.2925 10.1705 2.75 12 2.75C13.2147 2.75 14.4176 2.98926 15.5398 3.45411C16.6621 3.91897 17.6818 4.60032 18.5407 5.45926C19.3997 6.3182 20.081 7.33792 20.5459 8.46018C21.0107 9.58244 21.25 10.7853 21.25 12C21.25 13.8295 20.7075 15.6179 19.6911 17.139C18.6747 18.6602 17.23 19.8458 15.5398 20.5459C13.8496 21.246 11.9897 21.4292 10.1954 21.0723C8.4011 20.7154 6.7529 19.8344 5.45927 18.5407C4.16563 17.2471 3.28465 15.5989 2.92774 13.8046C2.57083 12.0103 2.75401 10.1504 3.45412 8.46018C4.15423 6.76996 5.33982 5.32531 6.86098 4.30891Z","stroke-width","1.5"],["d","M12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9Z"],["d","M12 10C11.7348 10 11.4804 10.1054 11.2929 10.2929C11.1054 10.4804 11 10.7348 11 11V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V11C13 10.7348 12.8946 10.4804 12.7071 10.2929C12.5196 10.1054 12.2652 10 12 10Z"],[1,"contrib"]],template:function(n,r){1&n&&(Tb(JB),Ze(0,"div",0),cv(1),Ze(2,"div",1)(3,"a",2),on(4,"img",3)(5,"img",4),nt(),Ze(6,"div",5),cv(7,1),nt(),Ze(8,"div",6)(9,"img",7),xn("click",function(){return r.layers.emit(!0)}),nt(),Jn(10,KB,2,3,"div",8),nt(),N(),Ze(11,"svg",9),xn("click",function(){return r.info.emit(!0)}),on(12,"path",10)(13,"path",11)(14,"path",12),nt()()()),2&n&&(Qe(2),to("hidden",r.hideHeader),Qe(2),jt("src",r.api.LOGO_URL,Yl),Qe(1),jt("src",r.api.LOGO_URL,Yl),Qe(5),jt("ngIf",r.api.contribCount>0),Qe(2),xi("stroke",r.PRIMARY_COLOR),Qe(1),xi("fill",r.PRIMARY_COLOR),Qe(1),xi("fill",r.PRIMARY_COLOR))},dependencies:[Va],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{width:100%;max-width:100%;height:100%;display:flex;align-items:stretch}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:row}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]{flex-flow:column-reverse}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{flex:0 0 auto;background:white;display:flex;align-items:center}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{width:96px;min-width:96px;flex-flow:column;padding:16px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{height:64px;min-height:64px;flex-flow:row;padding:8px 8px 8px 0;margin-top:0;transition-property:margin-top;transition-duration:.5s;border-bottom:solid 1px #6e0023}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header.hidden[_ngcontent-%COMP%]{margin-top:-64px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{margin:0;object-fit:contain;cursor:pointer}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:80px;height:64px;margin-bottom:0}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:60px;height:48px;margin-top:12px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{transform:rotate(90deg);transform-origin:96px/2 96px/2;flex-flow:row;align-items:center;width:96px;height:96px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{flex-flow:column;align-items:flex-start;margin-right:12px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1, [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-family:Source Code Pro,monospace;font-style:normal;color:#6e0023;margin:0;white-space:nowrap}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-weight:700;text-transform:uppercase}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:30px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h1{font-size:14px;line-height:18px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-weight:500}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]  h2{font-size:14px;line-height:18px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{position:relative}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{margin-top:auto}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{margin-left:auto}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]   .contrib[_ngcontent-%COMP%]{width:24px;height:24px;position:absolute;bottom:-4px;right:-4px;border-radius:12px;border:1px solid #E0E0E0;background-color:#fff;color:#ce0031;font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:10px;line-height:14px;display:flex;flex-flow:row;align-items:center;justify-content:center}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{width:48px;height:48px}}[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{cursor:pointer}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{margin-bottom:12px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%], [_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{width:20px;height:20px;margin-right:12px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .addNew[_ngcontent-%COMP%]{display:none}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .layout[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .layers[_ngcontent-%COMP%]{width:40px;height:40px}}']}),e})(),t5=(()=>{class e{constructor(n){this.sanitizer=n,this.close=new br,this.PRIMARY_COLOR=Mo,this.marked=An,this.aboutContent=""}ngOnInit(){this.api.ready.pipe(Bo()).subscribe(()=>{this.aboutContent=this.sanitizer.bypassSecurityTrustHtml(An(this.api.ABOUT))})}}return e.\u0275fac=function(n){return new(n||e)(rt(Xm))},e.\u0275cmp=kr({type:e,selectors:[["app-infobar"]],inputs:{title:"title",subtitle:"subtitle",api:"api"},outputs:{close:"close"},decls:9,vars:5,consts:[[1,"title"],["width","44","height","44","viewBox","0 0 44 44","fill","none","xmlns","http://www.w3.org/2000/svg",1,"close",3,"click"],["d","M11.3936 11.3936L32.6068 32.6068"],["d","M32.6064 11.3936L11.3932 32.6068"],[3,"innerHtml"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"h1"),dn(2),nt(),Ze(3,"h2"),dn(4),nt(),N(),Ze(5,"svg",1),xn("click",function(){return r.close.emit()}),on(6,"path",2)(7,"path",3),nt()(),Z(),on(8,"p",4)),2&n&&(Qe(2),bi(r.title),Qe(2),bi(r.subtitle),Qe(2),xi("stroke",r.PRIMARY_COLOR),Qe(1),xi("stroke",r.PRIMARY_COLOR),Qe(1),jt("innerHtml",r.aboutContent,Cd))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;flex-flow:column;justify-content:flex-start;align-items:center;background:white;position:relative;z-index:2}@media only screen and (min-width: 601px){[_nghost-%COMP%]{max-width:360px;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:10px 24px;box-shadow:0 -1px 8px #00000026;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{position:relative;border-bottom:.5px solid #333333;margin-bottom:20px}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], [_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;max-width:calc(100% - 46px);color:#333}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;letter-spacing:.02em;text-transform:uppercase;color:#333}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;line-height:21px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:17px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:400;font-size:15px;letter-spacing:-.01em}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px;line-height:21px}}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;position:absolute;top:-5px;right:0;width:30px;height:30px}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{color:#6e0023;font-weight:500}@media only screen and (min-width: 601px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 16px -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 16px 0}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:first-child{margin:0 0 -4px}[_nghost-%COMP%]   app-player[_ngcontent-%COMP%]:last-child{margin:-4px 0 0}}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{width:100%;background-color:#fff;padding-top:0}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{padding:24px 0 0}}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{border-top:.5px solid #333333}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .notes[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;width:100%;letter-spacing:.01em;color:#333;border-bottom:.5px solid #BDBDBD;padding:8px 0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:13px;width:100%;letter-spacing:.02em;color:#333;padding:8px 0;display:flex;align-items:center;flex-flow:row}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{margin-left:auto;cursor:pointer}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .expander.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:13px;font-weight:400;letter-spacing:.01em;color:#000;margin:0}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, [_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;display:block;font-size:13px;font-weight:400;letter-spacing:.01em;color:#2d9cdb;margin:6px 0 0}[_nghost-%COMP%]{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:0}']}),e})(),pI=(()=>{class e{constructor(n,r){this._renderer=n,this._elementRef=r,this.onChange=a=>{},this.onTouched=()=>{}}setProperty(n,r){this._renderer.setProperty(this._elementRef.nativeElement,n,r)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return e.\u0275fac=function(n){return new(n||e)(rt(vh),rt(Xo))},e.\u0275dir=wn({type:e}),e})(),gp=(()=>{class e extends pI{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function Oo(e){return bs(()=>{const t=e.prototype.constructor,n=t[Un]||Sf(t),r=Object.prototype;let a=Object.getPrototypeOf(e.prototype).constructor;for(;a&&a!==r;){const u=a[Un]||Sf(a);if(u&&u!==n)return u;a=Object.getPrototypeOf(a)}return u=>new u})}(e)))(r||e)}}(),e.\u0275dir=wn({type:e,features:[Xr]}),e})();const du=new Nn("NgValueAccessor"),i5={provide:du,useExisting:En(()=>gx),multi:!0},s5=new Nn("CompositionEventMode");let gx=(()=>{class e extends pI{constructor(n,r,a){super(n,r),this._compositionMode=a,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function o5(){const e=au()?au().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return e.\u0275fac=function(n){return new(n||e)(rt(vh),rt(Xo),rt(s5,8))},e.\u0275dir=wn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){1&n&&xn("input",function(u){return r._handleInput(u.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(u){return r._compositionEnd(u.target.value)})},features:[zi([i5]),Xr]}),e})();const Is=new Nn("NgValidators"),ef=new Nn("NgAsyncValidators");function EI(e){return null!=e}function TI(e){const t=k_(e)?mt(e):e;return Mb(t),t}function DI(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function SI(e,t){return t.map(n=>n(e))}function II(e){return e.map(t=>function l5(e){return!e.validate}(t)?t:n=>t.validate(n))}function TC(e){return null!=e?function AI(e){if(!e)return null;const t=e.filter(EI);return 0==t.length?null:function(n){return DI(SI(n,t))}}(II(e)):null}function DC(e){return null!=e?function PI(e){if(!e)return null;const t=e.filter(EI);return 0==t.length?null:function(n){return fC(SI(n,t).map(TI)).pipe(Mn(DI))}}(II(e)):null}function OI(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function SC(e){return e?Array.isArray(e)?e:[e]:[]}function yx(e,t){return Array.isArray(e)?e.includes(t):e===t}function LI(e,t){const n=SC(t);return SC(e).forEach(a=>{yx(n,a)||n.push(a)}),n}function FI(e,t){return SC(t).filter(n=>!yx(e,n))}class zI{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=TC(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=DC(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class Zs extends zI{get formDirective(){return null}get path(){return null}}class tf extends zI{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let BI=(()=>{class e extends class NI{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}{constructor(n){super(n)}}return e.\u0275fac=function(n){return new(n||e)(rt(tf,2))},e.\u0275dir=wn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){2&n&&to("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Xr]}),e})();const fy="VALID",xx="INVALID",tg="PENDING",py="DISABLED";function UI(e){return Array.isArray(e)?TC(e):e||null}function jI(e){return Array.isArray(e)?DC(e):e||null}function bx(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function my(e,t){(function LC(e,t){const n=function kI(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(OI(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=function RI(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(OI(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const a=()=>e.updateValueAndValidity();Mx(t._rawValidators,a),Mx(t._rawAsyncValidators,a)})(e,t),t.valueAccessor.writeValue(e.value),e.disabled&&t.valueAccessor.setDisabledState?.(!0),function y5(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&qI(e,t)})}(e,t),function x5(e,t){const n=(r,a)=>{t.valueAccessor.writeValue(r),a&&t.viewToModelUpdate(r)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function v5(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&qI(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function _5(e,t){if(t.valueAccessor.setDisabledState){const n=r=>{t.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Mx(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function qI(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function YI(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function KI(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const S5={provide:tf,useExisting:En(()=>BC)},tA=(()=>Promise.resolve(null))();let BC=(()=>{class e extends tf{constructor(n,r,a,u,m){super(),this._changeDetectorRef=m,this.control=new class extends class HI{constructor(t,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=n,this._composedValidatorFn=UI(this._rawValidators),this._composedAsyncValidatorFn=jI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===fy}get invalid(){return this.status===xx}get pending(){return this.status==tg}get disabled(){return this.status===py}get enabled(){return this.status!==py}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=UI(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=jI(t)}addValidators(t){this.setValidators(LI(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(LI(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(FI(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(FI(t,this._rawAsyncValidators))}hasValidator(t){return yx(this._rawValidators,t)}hasAsyncValidator(t){return yx(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=tg,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=py,this.errors=null,this._forEachChild(r=>{r.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=fy,this._forEachChild(r=>{r.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===fy||this.status===tg)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?py:fy}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=tg,this._hasOwnPendingAsyncValidator=!0;const n=TI(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((r,a)=>r&&r._find(a),this)}getError(t,n){const r=n?this.get(n):this;return r&&r.errors?r.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new br,this.statusChanges=new br}_calculateStatus(){return this._allControlsDisabled()?py:this.errors?xx:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(tg)?tg:this._anyControlsHaveStatus(xx)?xx:fy}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){bx(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}}{constructor(t=null,n,r){super(function OC(e){return(bx(e)?e.validators:e)||null}(n),function kC(e,t){return(bx(t)?t.asyncValidators:e)||null}(r,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),bx(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=KI(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){YI(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){YI(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){KI(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},this._registered=!1,this.update=new br,this._parent=n,this._setValidators(r),this._setAsyncValidators(a),this.valueAccessor=function zC(e,t){if(!t)return null;let n,r,a;return Array.isArray(t),t.forEach(u=>{u.constructor===gx?n=u:function C5(e){return Object.getPrototypeOf(e.constructor)===gp}(u)?r=u:a=u}),a||r||n||null}(0,u)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const r=n.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function FC(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){my(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){tA.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const r=n.isDisabled.currentValue,a=0!==r&&function wh(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}(r);tA.then(()=>{a&&!this.control.disabled?this.control.disable():!a&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?function wx(e,t){return[...t.path,e]}(n,this._parent):[n]}}return e.\u0275fac=function(n){return new(n||e)(rt(Zs,9),rt(Is,10),rt(ef,10),rt(du,10),rt(Dv,8))},e.\u0275dir=wn({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[zi([S5]),Xr,mi]}),e})(),rA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({}),e})(),Q5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({imports:[rA]}),e})(),e6=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({imports:[Q5]}),e})();function r6(e,t){if(1&e){const n=Fo();Ze(0,"img",30),xn("click",function(){ni(n);const a=_n();return Vr(a.slide=a.slide-1)}),nt()}}function i6(e,t){if(1&e){const n=Fo();Ze(0,"button",11),xn("click",function(){ni(n);const a=_n();return Vr(a.slide=a.slide+1)}),dn(1,"next"),nt()}}function o6(e,t){if(1&e){const n=Fo();Ze(0,"div",10)(1,"button",11),xn("click",function(){ni(n);const a=_n();return Vr(a.slide=a.slide+1)}),dn(2,"next"),nt()()}}function s6(e,t){1&e&&on(0,"iframe",31),2&e&&jt("src",_n().iframeSrc,Lg)}function a6(e,t){if(1&e&&(nu(0),on(1,"div",32)(2,"div",32)(3,"div",32)(4,"div",32),ru()),2&e){const n=_n();Qe(1),to("active",1==n.slide),Qe(1),to("active",2==n.slide),Qe(1),to("active",3==n.slide),Qe(1),to("active",4==n.slide)}}let l6=(()=>{class e{constructor(n,r,a){this.sanitizer=n,this.mapSelector=r,this.airtable=a,this.close=new br,this.PRIMARY_COLOR=Mo,this.marked=An,this.contributeMessage="",this.slide=0,this.contentType="",this.iframeURL=null,this.subscription=null}ngOnInit(){this.api.ready.pipe(Bo()).subscribe(()=>{this.contributeMessage=this.sanitizer.bypassSecurityTrustHtml(An(this.api.CONTRIBUTE_MESSAGE))}),this.nonce=""+Math.floor(1e9*Math.random())}selectCT(n){this.contentType=n,this.slide+=1}get iframeSrc(){if(!this.selectedDate||!this.contentType||!this.selectedGeo)return null;const n=encodeURIComponent(this.selectedGeo),r=`https://airtable.com/embed/shrQYzUght6QWpzs2?prefill_type=${this.contentType}&hide_type=true&prefill_post_timestamp=${this.selectedDate}T00:00:00.000&hide_post_timestamp=true&prefill_geo=${n}&hide_geo=true&prefill_nonce=${this.nonce}&hide_nonce=true`;return this.iframeURL||this.initPolling(),this.iframeURL!==r&&(this.iframeURL=r,this.iframeSafeURL=this.sanitizer.bypassSecurityTrustResourceUrl(r)),this.iframeSafeURL}openMap(){this.mapSelector.showMapSelector=!0,this.mapSelector.results.pipe(Bo()).subscribe(n=>{console.log("GOT GEO",n),n&&(this.selectedGeo=n)})}closeMe(){this.subscription?.unsubscribe(),this.subscription=null,this.close.emit()}initPolling(){this.subscription=function n5(e=0,t=hx){return e<0&&(e=0),ha(e,e,t)}(5e3).pipe(lu(()=>this.airtable.airtableFetch(zS,this.airtable.CONTENT_TABLE,"incoming")),this.airtable.airtableToArray()).subscribe(n=>{n.forEach(r=>{r.nonce===this.nonce&&(this.subscription?.unsubscribe(),this.subscription=null,this.slide=5)})})}}return e.\u0275fac=function(n){return new(n||e)(rt(Xm),rt(bC),rt(YS))},e.\u0275cmp=kr({type:e,selectors:[["app-add-new-bar"]],inputs:{api:"api"},outputs:{close:"close"},decls:93,vars:34,consts:[[1,"controls"],[1,"control"],["src","assets/img/button-back.svg",3,"click",4,"ngIf"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"click"],["d","M1.39453 1.39355L22.6077 22.6068"],["d","M22.6074 1.39355L1.39422 22.6068"],[1,"slides"],[1,"slide"],[1,"header"],[3,"innerHtml"],[1,"bottom"],[3,"click"],[1,"content-types"],[1,"content-type",3,"click"],[1,"icon"],["src","assets/img/icon-audio-clip.svg"],[1,"name"],["src","assets/img/icon-twitter.svg"],["src","assets/img/icon-instagram.svg"],["src","assets/img/icon-youtube.svg"],["src","assets/img/icon-wikipedia.svg"],["src","assets/img/icon-image.svg"],[1,"center"],["src","assets/img/icon-pin.svg"],[3,"click",4,"ngIf"],["type","date","placeholder","pick the date",1,"date-selector",3,"ngModel","ngModelChange"],["class","bottom",4,"ngIf"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src",4,"ngIf"],[1,"progress"],[4,"ngIf"],["src","assets/img/button-back.svg",3,"click"],["frameborder","0","onmousewheel","","width","100%","height","100%",3,"src"],[1,"progress-item"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1),Jn(2,r6,1,0,"img",2),nt(),Ze(3,"div",1),N(),Ze(4,"svg",3),xn("click",function(){return r.closeMe()}),on(5,"path",4)(6,"path",5),nt()()(),Z(),Ze(7,"div",6)(8,"div",7)(9,"div",8)(10,"h1"),dn(11,"Be a part of this story"),nt(),Ze(12,"h2"),dn(13,"what other aspect of the past, present or future would you like to add to this timeline?"),nt()(),on(14,"p",9),Ze(15,"div",10)(16,"button",11),xn("click",function(){return r.slide=r.slide+1}),dn(17,"Add a moment"),nt()()(),Ze(18,"div",7)(19,"div",8)(20,"h1"),dn(21,"what?"),nt(),Ze(22,"h2"),dn(23,"What format would you choose for your contribution to the timeline?"),nt()(),Ze(24,"div",12)(25,"div",13),xn("click",function(){return r.selectCT("audio")}),Ze(26,"div",14),on(27,"img",15),nt(),Ze(28,"div",16),dn(29,"Audio clip"),nt()(),Ze(30,"div",13),xn("click",function(){return r.selectCT("twitter")}),Ze(31,"div",14),on(32,"img",17),nt(),Ze(33,"div",16),dn(34,"Twitter post"),nt()(),Ze(35,"div",13),xn("click",function(){return r.selectCT("instagram")}),Ze(36,"div",14),on(37,"img",18),nt(),Ze(38,"div",16),dn(39,"Instagram post"),nt()(),Ze(40,"div",13),xn("click",function(){return r.selectCT("video")}),Ze(41,"div",14),on(42,"img",19),nt(),Ze(43,"div",16),dn(44,"Youtube video"),nt()(),Ze(45,"div",13),xn("click",function(){return r.selectCT("wikipedia")}),Ze(46,"div",14),on(47,"img",20),nt(),Ze(48,"div",16),dn(49,"Wikipedia article"),nt()(),Ze(50,"div",13),xn("click",function(){return r.selectCT("image")}),Ze(51,"div",14),on(52,"img",21),nt(),Ze(53,"div",16),dn(54,"Image"),nt()()()(),Ze(55,"div",7)(56,"div",8)(57,"h1"),dn(58,"Where?"),nt(),Ze(59,"h2"),dn(60,"Position the camera on your location of choice"),nt()(),Ze(61,"div",22)(62,"button",11),xn("click",function(){return r.openMap()}),on(63,"img",23),dn(64,"Choose from the map"),nt()(),Ze(65,"div",10),Jn(66,i6,2,0,"button",24),nt()(),Ze(67,"div",7)(68,"div",8)(69,"h1"),dn(70,"When?"),nt(),Ze(71,"h2"),dn(72,"The exact year is less important than the order of events"),nt()(),Ze(73,"input",25),xn("ngModelChange",function(u){return r.selectedDate=u}),nt(),Jn(74,o6,3,0,"div",26),nt(),Ze(75,"div",7)(76,"div",8)(77,"h1"),dn(78,"Add The Details"),nt(),Ze(79,"h2"),dn(80),nt()(),Jn(81,s6,1,1,"iframe",27),nt(),Ze(82,"div",7)(83,"div",8)(84,"h1"),dn(85,"Thank you!"),nt(),Ze(86,"h2"),dn(87,"We will review your contribution and email you if it is added to the timeline"),nt()(),Ze(88,"div",10)(89,"button",11),xn("click",function(){return r.closeMe()}),dn(90,"close"),nt()()()(),Ze(91,"div",28),Jn(92,a6,5,8,"ng-container",29),nt()),2&n&&(Qe(2),jt("ngIf",r.slide>0&&r.slide<5),Qe(3),xi("stroke",r.PRIMARY_COLOR),Qe(1),xi("stroke",r.PRIMARY_COLOR),Qe(2),to("pre",r.slide<0)("post",r.slide>0),Qe(6),jt("innerHtml",r.contributeMessage,Cd),Qe(4),to("pre",r.slide<1)("post",r.slide>1),Qe(37),to("pre",r.slide<2)("post",r.slide>2),Qe(11),jt("ngIf",r.selectedGeo),Qe(1),to("pre",r.slide<3)("post",r.slide>3),Qe(6),jt("ngModel",r.selectedDate),Qe(1),jt("ngIf",!!r.selectedDate),Qe(1),to("pre",r.slide<4)("post",r.slide>4),Qe(5),cp("Now that we know time and space, let\u2019s add the details of your ",r.contentType,""),Qe(1),jt("ngIf",r.iframeSrc),Qe(1),to("pre",r.slide<5)("post",r.slide>5),Qe(10),jt("ngIf",r.slide>0&&r.slide<5))},dependencies:[Va,gx,BI,BC],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;background:white;position:relative;z-index:2;overflow:hidden}@media only screen and (min-width: 601px){[_nghost-%COMP%]{max-width:360px;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:10px 24px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{color:#6e0023;font-weight:500}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;letter-spacing:.01em;color:#333;margin:0 8px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;justify-content:space-between;align-items:center}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]{height:100%;overflow:hidden;flex:1 1 auto;position:relative}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]{display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;width:100%;height:100%;transform:translate(0);transition:transform .25s linear;position:absolute;top:0;left:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.pre[_ngcontent-%COMP%]{transform:translate(100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide.post[_ngcontent-%COMP%]{transform:translate(-100%)}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;justify-content:flex-start;gap:4px;padding-top:16px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:700;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#333;margin:0}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:15px;line-height:21px;letter-spacing:-.01em;color:#333;padding-bottom:8px;border-bottom:.5px solid #333333;margin-bottom:32px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]     p{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;line-height:23px;letter-spacing:.01em;color:#333}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .bottom[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;width:100%;margin-top:auto}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:12px;padding:8px 24px;height:40px;background:rgba(255,255,255,.5);border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:flex-start;justify-content:flex-start;gap:8px}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:center;justify-content:flex-start;gap:16px;cursor:pointer}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:48px;height:48px;overflow:auto;border-radius:24px;border:1px solid rgba(252,13,28,.25);display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px;object-fit:contain}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .content-types[_ngcontent-%COMP%]   .content-type[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:23px;color:#ce0031}[_nghost-%COMP%]   .slides[_ngcontent-%COMP%]   .slide[_ngcontent-%COMP%]   .date-selector[_ngcontent-%COMP%]{border:1px solid rgba(252,13,28,.25);height:48px;padding-left:44px;padding-right:16px;border-radius:4px;color:#ce0031;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;letter-spacing:.02em;text-transform:uppercase;background-image:url(icon-calendar.37810a4105ea3292.svg);background-repeat:no-repeat;background-position:12px center}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]{flex:0 0 auto;margin-top:16px;height:7px;display:flex;flex-flow:row;align-items:stretch;justify-content:stretch;gap:8px}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-item[_ngcontent-%COMP%]{flex:1 1 auto;height:100%;border-radius:2px;background:#E0E0E0;transition:background .25s linear}[_nghost-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-item.active[_ngcontent-%COMP%]{background:#CE0031}']}),e})(),c6=(()=>{class e{constructor(){this.changed=new br}ngOnInit(){}toggle(){this.author.selected=!this.author.selected,this.changed.emit()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-layers-bar-item"]],inputs:{author:"author"},outputs:{changed:"changed"},decls:6,vars:4,consts:[[1,"item",3,"click"],[1,"checkbox"],[1,"name"],[1,"count"]],template:function(n,r){1&n&&(Ze(0,"div",0),xn("click",function(){return r.toggle()}),on(1,"div",1),Ze(2,"div",2),dn(3),nt(),Ze(4,"div",3),dn(5),nt()()),2&n&&(to("selected",r.author.selected),Qe(3),bi(r.author.name),Qe(2),bi(r.author.count))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%}[_nghost-%COMP%]   .item[_ngcontent-%COMP%]{width:100%;height:32px;display:flex;flex-flow:row;align-items:center;justify-content:flex-start;gap:8px;padding:0 12px 0 8px;font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:600;font-size:15px;letter-spacing:.01em;background:#FAFAFA;border-radius:4px;cursor:pointer}[_nghost-%COMP%]   .item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{color:gray2}[_nghost-%COMP%]   .item[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{width:16px;height:16px;background:#FFFFFF;border:1px solid #BDBDBD;border-radius:2px}[_nghost-%COMP%]   .item[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{font-weight:400;margin-left:auto}[_nghost-%COMP%]   .item.selected[_ngcontent-%COMP%]{background:rgba(252,13,28,.07)}[_nghost-%COMP%]   .item.selected[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], [_nghost-%COMP%]   .item.selected[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{color:#ce0031}[_nghost-%COMP%]   .item.selected[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{border:none;background-image:url(icon-red-check.7e35a1bfc3ab3329.svg);background-size:contain;background-repeat:no-repeat;background-position:center}']}),e})();function u6(e,t){if(1&e){const n=Fo();Ze(0,"app-layers-bar-item",13),xn("changed",function(){return ni(n),Vr(_n(2).api.updateTimeline())}),nt()}2&e&&jt("author",_n().$implicit)}function h6(e,t){if(1&e&&(Ze(0,"div",8),Jn(1,u6,1,1,"app-layers-bar-item",12),nt()),2&e){const n=t.$implicit;Qe(1),jt("ngIf",n.originalAuthor)}}function d6(e,t){if(1&e){const n=Fo();Ze(0,"app-layers-bar-item",13),xn("changed",function(){return ni(n),Vr(_n(2).api.updateTimeline())}),nt()}2&e&&jt("author",_n().$implicit)}function f6(e,t){if(1&e&&(nu(0),Jn(1,d6,1,1,"app-layers-bar-item",12),ru()),2&e){const n=t.$implicit;Qe(1),jt("ngIf",!n.originalAuthor)}}let p6=(()=>{class e{constructor(){this.close=new br,this.addNew=new br,this.PRIMARY_COLOR=Mo}ngOnInit(){}closeMe(){this.close.emit()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-layers-bar"]],inputs:{api:"api"},outputs:{close:"close",addNew:"addNew"},decls:21,vars:4,consts:[[1,"controls"],[1,"control"],["width","24","height","24","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg",3,"click"],["d","M1.39453 1.39355L22.6077 22.6068"],["d","M22.6074 1.39355L1.39422 22.6068"],[1,"header"],["class","items",4,"ngFor","ngForOf"],[1,"contributors"],[1,"items"],[4,"ngFor","ngForOf"],[1,"bottom"],[3,"click"],[3,"author","changed",4,"ngIf"],[3,"author","changed"]],template:function(n,r){1&n&&(Ze(0,"div",0)(1,"div",1),N(),Ze(2,"svg",2),xn("click",function(){return r.closeMe()}),on(3,"path",3)(4,"path",4),nt()()(),Z(),Ze(5,"div",5)(6,"h1"),dn(7,"Perspective Layers"),nt(),Ze(8,"h2"),dn(9,"This timeline features additional media fragments contributed by speculative tourists like you. Each adds another perspective to the original storyline."),nt()(),Ze(10,"p"),dn(11,"Original Author(s):"),nt(),Jn(12,h6,2,1,"div",6),Ze(13,"div",7)(14,"p"),dn(15,"Contributors:"),nt(),Ze(16,"div",8),Jn(17,f6,2,1,"ng-container",9),nt()(),Ze(18,"div",10)(19,"button",11),xn("click",function(){return r.addNew.emit()}),dn(20,"Add a moment"),nt()()),2&n&&(Qe(3),xi("stroke",r.PRIMARY_COLOR),Qe(1),xi("stroke",r.PRIMARY_COLOR),Qe(8),jt("ngForOf",r.api.authorsList),Qe(5),jt("ngForOf",r.api.authorsList))},dependencies:[Uv,Va,c6],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;justify-content:flex-start;align-items:stretch;background:white;position:relative;z-index:2;overflow:hidden}@media only screen and (min-width: 601px){[_nghost-%COMP%]{max-width:360px;padding:24px}}@media only screen and (max-width: 600px){[_nghost-%COMP%]{max-height:100%;overflow-y:scroll;padding:10px 24px;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}[_nghost-%COMP%]::-webkit-scrollbar{display:none}}[_nghost-%COMP%]     a, [_nghost-%COMP%]     a:visited, [_nghost-%COMP%]     a:hover{color:#6e0023;font-weight:500}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:15px;line-height:23px;letter-spacing:.01em;color:#4f4f4f;margin:0 0 8px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:row;justify-content:flex-end;align-items:center}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   .control[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:stretch;justify-content:flex-start;gap:4px;padding-top:16px}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:700;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#333;margin:0}[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:15px;line-height:21px;letter-spacing:-.01em;color:#333;padding-bottom:8px;border-bottom:.5px solid #333333;margin-bottom:16px}[_nghost-%COMP%]   .items[_ngcontent-%COMP%]{width:100%;display:flex;flex-flow:column;align-items:stretch;gap:8px}[_nghost-%COMP%]   .contributors[_ngcontent-%COMP%]{width:100%;padding-top:8px;margin-top:8px;border-top:.5px solid #BDBDBD}[_nghost-%COMP%]   .bottom[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;width:100%;margin-top:auto;margin-bottom:24px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:12px;padding:8px 24px;height:40px;background:rgba(255,255,255,.5);border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}']}),e})();function m6(e,t){if(1&e){const n=Fo();Ze(0,"app-add-new-bar",6),xn("close",function(){return ni(n),Vr(_n().addNew=!1)}),nt()}if(2&e){const n=_n();to("open",n.addNewOpen),jt("api",n.api)}}function g6(e,t){if(1&e){const n=Fo();Ze(0,"app-layers-bar",7),xn("close",function(){return ni(n),Vr(_n().layers=!1)})("addNew",function(){return ni(n),Vr(_n().addNew=!0)}),nt()}if(2&e){const n=_n();to("open",n.layersOpen),jt("api",n.api)}}const _6=["*"];let bA=(()=>{class e{constructor(){this._info=!1,this._addNew=!1,this._layers=!1,this.addNewOpen=!1,this.layersOpen=!1,this.PRIMARY_COLOR=Mo}ngOnInit(){this._info="opened"!==localStorage.getItem(this.id)}get info(){return this._info}set info(n){console.log("INFO=",n),this._addNew=!1,this._layers=!1,this._info=n,localStorage.setItem(this.id,"opened")}get addNew(){return this._addNew}set addNew(n){this._info=!1,this._layers=!1,this._addNew=n,ha(0).subscribe(()=>{this.addNewOpen=n})}get layers(){return this._layers}set layers(n){this._info=!1,this._addNew=!1,this._layers=n,ha(0).subscribe(()=>{this.layersOpen=n})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-timeline-map-base"]],inputs:{id:"id",title:"title",subtitle:"subtitle",infobarTitle:"infobarTitle",infobarSubtitle:"infobarSubtitle",api:"api"},ngContentSelectors:_6,decls:11,vars:14,consts:[[3,"api","info","addNew","layers"],[1,"content"],[3,"api","title","subtitle","close"],[3,"open","api","close",4,"ngIf"],[3,"open","api","close","addNew",4,"ngIf"],[1,"header-title"],[3,"api","close"],[3,"api","close","addNew"]],template:function(n,r){1&n&&(Tb(),Ze(0,"app-layout",0),xn("info",function(u){return r.info=u})("addNew",function(u){return r.addNew=u})("layers",function(u){return r.layers=u}),Ze(1,"div",1),cv(2),Ze(3,"app-infobar",2),xn("close",function(){return r.info=!1}),nt(),Jn(4,m6,1,3,"app-add-new-bar",3),Jn(5,g6,1,3,"app-layers-bar",4),nt(),Ze(6,"div",5)(7,"h1"),dn(8),nt(),Ze(9,"h2"),dn(10),nt()()()),2&n&&(jt("api",r.api),Qe(3),to("open",r.info),jt("api",r.api)("title",r.infobarTitle)("subtitle",r.infobarSubtitle),Qe(1),jt("ngIf",r.addNew),Qe(1),jt("ngIf",r.layers),Qe(2),Ti("color",r.PRIMARY_COLOR),Qe(1),bi(r.title),Qe(1),Ti("color",r.PRIMARY_COLOR),Qe(1),bi(r.subtitle))},dependencies:[Va,e5,t5,l6,p6],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;overflow:hidden}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{display:flex;flex-flow:row}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{transition-property:transform margin-left;transition-duration:.5s;z-index:20}@media only screen and (min-width: 601px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{top:0;height:100%;transform:translate(100%);width:360px;margin-left:-360px;flex:0 0 auto}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar.open[_ngcontent-%COMP%]{margin-left:4px;transform:translate(0)}}@media only screen and (max-width: 600px){[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;width:100%;height:auto;transform:translateY(100%)}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-infobar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar.open[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar.open[_ngcontent-%COMP%]{transform:translateY(0)}}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-add-new-bar[_ngcontent-%COMP%], [_nghost-%COMP%]   .content[_ngcontent-%COMP%]   app-layers-bar[_ngcontent-%COMP%]{min-height:80vh}']}),e})();const y6=["mapEl"];function v6(e,t){if(1&e&&on(0,"app-content-placeholder",7),2&e){const n=_n().$implicit;jt("item",n),xi("data-year","Y"+n.year)}}function x6(e,t){if(1&e){const n=Fo();Ze(0,"app-content",8),xn("mapView",function(a){return ni(n),Vr(_n(2).changeMapView(a))})("activated",function(a){return ni(n),Vr(_n(2).contentActivated(a))}),nt()}if(2&e){const n=_n().$implicit;jt("activeItem",_n().activeItem)("item",n),xi("data-year","Y"+n.year)}}function b6(e,t){if(1&e&&(nu(0),Jn(1,v6,1,2,"app-content-placeholder",5),Jn(2,x6,1,3,"app-content",6),ru()),2&e){const n=t.$implicit;Qe(1),jt("ngIf",!n.hasContent),Qe(1),jt("ngIf",n.hasContent)}}let w6=(()=>{class e extends JS{constructor(n,r){super(n),this.mapSvc=r,this.activeYear=-1}ngOnInit(){this.initialize(this.api),this.theMap=new yl.Map({container:this.mapEl.nativeElement,style:uC,minZoom:3}),this.theMap.on("style.load",()=>{this.loadMapViews()})}goto(n){this.activeYear=this.api.YEAR_CURRENT,n&&(this.activeYear=parseInt(n.slice(1)),this.activeYear||(this.activeYear=this.api.YEAR_CURRENT)),n="Y"+this.activeYear;const r=document.querySelector(`[data-year=${n}]`);r&&r.scrollIntoView({block:"center",behavior:"auto"})}changeMapView(n){this.applyMapView(n,this.theMap)}contentActivated(n){this.activeItem=n,this.updateLocation("Y"+n.year)}}return e.\u0275fac=function(n){return new(n||e)(rt(Yd),rt(wC))},e.\u0275cmp=kr({type:e,selectors:[["app-timeline-map"]],viewQuery:function(n,r){if(1&n&&Hs(y6,7),2&n){let a;ds(a=fs())&&(r.mapEl=a.first)}},inputs:{id:"id",title:"title",subtitle:"subtitle",infobarTitle:"infobarTitle",infobarSubtitle:"infobarSubtitle",api:"api"},features:[Xr],decls:6,vars:7,consts:[[3,"id","title","subtitle","infobarTitle","infobarSubtitle","api"],[1,"map"],["mapEl",""],[1,"timeline"],[4,"ngFor","ngForOf"],[3,"item",4,"ngIf"],[3,"activeItem","item","mapView","activated",4,"ngIf"],[3,"item"],[3,"activeItem","item","mapView","activated"]],template:function(n,r){1&n&&(Ze(0,"app-timeline-map-base",0)(1,"div",1),on(2,"div",null,2),nt(),Ze(4,"div",3),Jn(5,b6,3,2,"ng-container",4),nt()()),2&n&&(jt("id",r.id)("title",r.title)("subtitle",r.subtitle)("infobarTitle",r.infobarTitle)("infobarSubtitle",r.infobarSubtitle)("api",r.api),Qe(5),jt("ngForOf",r.timeline))},dependencies:[Uv,Va,XB,YB,bA],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}.map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.timeline[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;z-index:10}.timeline[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}']}),e})();var C6=Ne(545);const M6=["mapEl"];let E6=(()=>{class e{constructor(n,r){this.mapSvc=n,this.mapSelector=r}ngOnInit(){this.theMap=new yl.Map({container:this.mapEl.nativeElement,style:uC,minZoom:3});var n=new C6({accessToken:yl.accessToken});this.theMap.addControl(n),this.theMap.addControl(new yl.NavigationControl({visualizePitch:!0}))}submit(){const n=this.theMap.getCenter(),r=`center: { lon: ${n.lng}, lat: ${n.lat} },\n    zoom: ${this.theMap.getZoom()},\n    pitch: ${this.theMap.getPitch()},\n    bearing: ${this.theMap.getBearing()}`;this.mapSelector.submitResult(r)}cancel(){this.mapSelector.submitResult(null)}}return e.\u0275fac=function(n){return new(n||e)(rt(wC),rt(bC))},e.\u0275cmp=kr({type:e,selectors:[["app-map-selector"]],viewQuery:function(n,r){if(1&n&&Hs(M6,7),2&n){let a;ds(a=fs())&&(r.mapEl=a.first)}},decls:8,vars:0,consts:[[1,"map"],["mapEl",""],[1,"controls"],[3,"click"]],template:function(n,r){1&n&&(Ze(0,"div",0),on(1,"div",null,1),nt(),Ze(3,"div",2)(4,"button",3),xn("click",function(){return r.cancel()}),dn(5,"cancel"),nt(),Ze(6,"button",3),xn("click",function(){return r.submit()}),dn(7,"select"),nt()())},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;z-index:10;display:flex;flex-flow:row;align-items:center;gap:32px}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:8px 24px;height:40px;background:rgba(255,255,255,.5);border:1px solid rgba(252,13,28,.25);border-radius:24px;font-family:Source Code Pro,monospace;font-style:normal;font-weight:400;font-size:18px;line-height:21px;letter-spacing:.02em;text-transform:uppercase;color:#ce0031;cursor:pointer}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{color:#333;border-color:#333}']}),e})();function qC(e,t=hx){return nr((n,r)=>{let a=null,u=null,m=null;const v=()=>{if(a){a.unsubscribe(),a=null;const D=u;u=null,r.next(D)}};function C(){const D=m+e,O=t.now();if(O<D)return a=this.schedule(void 0,D-O),void r.add(a);v()}n.subscribe(cn(r,D=>{u=D,m=t.now(),a||(a=t.schedule(C,e),r.add(a))},()=>{v(),r.complete()},void 0,()=>{u=a=null}))})}var T6={value:()=>{}};function wA(){for(var r,e=0,t=arguments.length,n={};e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Tx(n)}function Tx(e){this._=e}function D6(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}function S6(e,t){for(var a,n=0,r=e.length;n<r;++n)if((a=e[n]).name===t)return a.value}function CA(e,t,n){for(var r=0,a=e.length;r<a;++r)if(e[r].name===t){e[r]=T6,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}Tx.prototype=wA.prototype={constructor:Tx,on:function(e,t){var a,n=this._,r=D6(e+"",n),u=-1,m=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++u<m;)if(a=(e=r[u]).type)n[a]=CA(n[a],e.name,t);else if(null==t)for(a in n)n[a]=CA(n[a],e.name,null);return this}for(;++u<m;)if((a=(e=r[u]).type)&&(a=S6(n[a],e.name)))return a},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Tx(e)},call:function(e,t){if((a=arguments.length-2)>0)for(var a,u,n=new Array(a),r=0;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,a=(u=this._[e]).length;r<a;++r)u[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],a=0,u=r.length;a<u;++a)r[a].value.apply(t,n)}};const MA=wA;function I6(){}function ZC(e){return null==e?I6:function(){return this.querySelector(e)}}function P6(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function O6(){return[]}function EA(e){return null==e?O6:function(){return this.querySelectorAll(e)}}function TA(e){return function(){return this.matches(e)}}function DA(e){return function(t){return t.matches(e)}}var L6=Array.prototype.find;function z6(){return this.firstElementChild}var B6=Array.prototype.filter;function V6(){return Array.from(this.children)}function SA(e){return new Array(e.length)}function Dx(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function H6(e){return function(){return e}}function q6(e,t,n,r,a,u){for(var v,m=0,C=t.length,D=u.length;m<D;++m)(v=t[m])?(v.__data__=u[m],r[m]=v):n[m]=new Dx(e,u[m]);for(;m<C;++m)(v=t[m])&&(a[m]=v)}function Z6(e,t,n,r,a,u,m){var v,C,G,D=new Map,O=t.length,F=u.length,U=new Array(O);for(v=0;v<O;++v)(C=t[v])&&(U[v]=G=m.call(C,C.__data__,v,t)+"",D.has(G)?a[v]=C:D.set(G,C));for(v=0;v<F;++v)G=m.call(e,u[v],v,u)+"",(C=D.get(G))?(r[v]=C,C.__data__=u[v],D.delete(G)):n[v]=new Dx(e,u[v]);for(v=0;v<O;++v)(C=t[v])&&D.get(U[v])===C&&(a[v]=C)}function W6(e){return e.__data__}function Y6(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function nV(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Dx.prototype={constructor:Dx,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var WC="http://www.w3.org/1999/xhtml";const IA={svg:"http://www.w3.org/2000/svg",xhtml:WC,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Sx(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),IA.hasOwnProperty(t)?{space:IA[t],local:e}:e}function cV(e){return function(){this.removeAttribute(e)}}function uV(e){return function(){this.removeAttributeNS(e.space,e.local)}}function hV(e,t){return function(){this.setAttribute(e,t)}}function dV(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function fV(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function pV(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function AA(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function gV(e){return function(){this.style.removeProperty(e)}}function _V(e,t,n){return function(){this.style.setProperty(e,t,n)}}function yV(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function ng(e,t){return e.style.getPropertyValue(t)||AA(e).getComputedStyle(e,null).getPropertyValue(t)}function xV(e){return function(){delete this[e]}}function bV(e,t){return function(){this[e]=t}}function wV(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function PA(e){return e.trim().split(/^|\s+/)}function XC(e){return e.classList||new OA(e)}function OA(e){this._node=e,this._names=PA(e.getAttribute("class")||"")}function kA(e,t){for(var n=XC(e),r=-1,a=t.length;++r<a;)n.add(t[r])}function RA(e,t){for(var n=XC(e),r=-1,a=t.length;++r<a;)n.remove(t[r])}function MV(e){return function(){kA(this,e)}}function EV(e){return function(){RA(this,e)}}function TV(e,t){return function(){(t.apply(this,arguments)?kA:RA)(this,e)}}function SV(){this.textContent=""}function IV(e){return function(){this.textContent=e}}function AV(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function OV(){this.innerHTML=""}function kV(e){return function(){this.innerHTML=e}}function RV(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function FV(){this.nextSibling&&this.parentNode.appendChild(this)}function NV(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function VV(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===WC&&t.documentElement.namespaceURI===WC?t.createElement(e):t.createElementNS(n,e)}}function UV(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function LA(e){var t=Sx(e);return(t.local?UV:VV)(t)}function $V(){return null}function HV(){var e=this.parentNode;e&&e.removeChild(this)}function ZV(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function WV(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function JV(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function QV(e){return function(){var t=this.__on;if(t){for(var u,n=0,r=-1,a=t.length;n<a;++n)u=t[n],e.type&&u.type!==e.type||u.name!==e.name?t[++r]=u:this.removeEventListener(u.type,u.listener,u.options);++r?t.length=r:delete this.__on}}}function e8(e,t,n){return function(){var a,r=this.__on,u=function KV(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var m=0,v=r.length;m<v;++m)if((a=r[m]).type===e.type&&a.name===e.name)return this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=u,a.options=n),void(a.value=t);this.addEventListener(e.type,u,n),a={type:e.type,name:e.name,value:t,listener:u,options:n},r?r.push(a):this.__on=[a]}}function FA(e,t,n){var r=AA(e),a=r.CustomEvent;"function"==typeof a?a=new a(t,n):(a=r.document.createEvent("Event"),n?(a.initEvent(t,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(t,!1,!1)),e.dispatchEvent(a)}function n8(e,t){return function(){return FA(this,e,t)}}function r8(e,t){return function(){return FA(this,e,t.apply(this,arguments))}}OA.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var zA=[null];function ja(e,t){this._groups=e,this._parents=t}function NA(){return new ja([[document.documentElement]],zA)}ja.prototype=NA.prototype={constructor:ja,select:function A6(e){"function"!=typeof e&&(e=ZC(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var C,D,u=t[a],m=u.length,v=r[a]=new Array(m),O=0;O<m;++O)(C=u[O])&&(D=e.call(C,C.__data__,O,u))&&("__data__"in C&&(D.__data__=C.__data__),v[O]=D);return new ja(r,this._parents)},selectAll:function R6(e){e="function"==typeof e?function k6(e){return function(){return P6(e.apply(this,arguments))}}(e):EA(e);for(var t=this._groups,n=t.length,r=[],a=[],u=0;u<n;++u)for(var C,m=t[u],v=m.length,D=0;D<v;++D)(C=m[D])&&(r.push(e.call(C,C.__data__,D,m)),a.push(C));return new ja(r,a)},selectChild:function N6(e){return this.select(null==e?z6:function F6(e){return function(){return L6.call(this.children,e)}}("function"==typeof e?e:DA(e)))},selectChildren:function j6(e){return this.selectAll(null==e?V6:function U6(e){return function(){return B6.call(this.children,e)}}("function"==typeof e?e:DA(e)))},filter:function $6(e){"function"!=typeof e&&(e=TA(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var C,u=t[a],m=u.length,v=r[a]=[],D=0;D<m;++D)(C=u[D])&&e.call(C,C.__data__,D,u)&&v.push(C);return new ja(r,this._parents)},data:function X6(e,t){if(!arguments.length)return Array.from(this,W6);var n=t?Z6:q6,r=this._parents,a=this._groups;"function"!=typeof e&&(e=H6(e));for(var u=a.length,m=new Array(u),v=new Array(u),C=new Array(u),D=0;D<u;++D){var O=r[D],F=a[D],U=F.length,G=Y6(e.call(O,O&&O.__data__,D,r)),me=G.length,Ae=v[D]=new Array(me),We=m[D]=new Array(me),Pe=C[D]=new Array(U);n(O,F,Ae,We,Pe,G,t);for(var Ct,en,dt=0,Ge=0;dt<me;++dt)if(Ct=Ae[dt]){for(dt>=Ge&&(Ge=dt+1);!(en=We[Ge])&&++Ge<me;);Ct._next=en||null}}return(m=new ja(m,r))._enter=v,m._exit=C,m},enter:function G6(){return new ja(this._enter||this._groups.map(SA),this._parents)},exit:function K6(){return new ja(this._exit||this._groups.map(SA),this._parents)},join:function J6(e,t,n){var r=this.enter(),a=this,u=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(a=t(a))&&(a=a.selection()),null==n?u.remove():n(u),r&&a?r.merge(a).order():a},merge:function Q6(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,a=n.length,m=Math.min(a,r.length),v=new Array(a),C=0;C<m;++C)for(var G,D=n[C],O=r[C],F=D.length,U=v[C]=new Array(F),me=0;me<F;++me)(G=D[me]||O[me])&&(U[me]=G);for(;C<a;++C)v[C]=n[C];return new ja(v,this._parents)},selection:function s8(){return this},order:function eV(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var m,r=e[t],a=r.length-1,u=r[a];--a>=0;)(m=r[a])&&(u&&4^m.compareDocumentPosition(u)&&u.parentNode.insertBefore(m,u),u=m);return this},sort:function tV(e){function t(F,U){return F&&U?e(F.__data__,U.__data__):!F-!U}e||(e=nV);for(var n=this._groups,r=n.length,a=new Array(r),u=0;u<r;++u){for(var D,m=n[u],v=m.length,C=a[u]=new Array(v),O=0;O<v;++O)(D=m[O])&&(C[O]=D);C.sort(t)}return new ja(a,this._parents).order()},call:function rV(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function iV(){return Array.from(this)},node:function oV(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],a=0,u=r.length;a<u;++a){var m=r[a];if(m)return m}return null},size:function sV(){let e=0;for(const t of this)++e;return e},empty:function aV(){return!this.node()},each:function lV(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var v,a=t[n],u=0,m=a.length;u<m;++u)(v=a[u])&&e.call(v,v.__data__,u,a);return this},attr:function mV(e,t){var n=Sx(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?uV:cV:"function"==typeof t?n.local?pV:fV:n.local?dV:hV)(n,t))},style:function vV(e,t,n){return arguments.length>1?this.each((null==t?gV:"function"==typeof t?yV:_V)(e,t,n??"")):ng(this.node(),e)},property:function CV(e,t){return arguments.length>1?this.each((null==t?xV:"function"==typeof t?wV:bV)(e,t)):this.node()[e]},classed:function DV(e,t){var n=PA(e+"");if(arguments.length<2){for(var r=XC(this.node()),a=-1,u=n.length;++a<u;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof t?TV:t?MV:EV)(n,t))},text:function PV(e){return arguments.length?this.each(null==e?SV:("function"==typeof e?AV:IV)(e)):this.node().textContent},html:function LV(e){return arguments.length?this.each(null==e?OV:("function"==typeof e?RV:kV)(e)):this.node().innerHTML},raise:function zV(){return this.each(FV)},lower:function BV(){return this.each(NV)},append:function jV(e){var t="function"==typeof e?e:LA(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function GV(e,t){var n="function"==typeof e?e:LA(e),r=null==t?$V:"function"==typeof t?t:ZC(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function qV(){return this.each(HV)},clone:function XV(e){return this.select(e?WV:ZV)},datum:function YV(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function t8(e,t,n){var a,m,r=JV(e+""),u=r.length;if(!(arguments.length<2)){for(v=t?e8:QV,a=0;a<u;++a)this.each(v(r[a],t,n));return this}var v=this.node().__on;if(v)for(var O,C=0,D=v.length;C<D;++C)for(a=0,O=v[C];a<u;++a)if((m=r[a]).type===O.type&&m.name===O.name)return O.value},dispatch:function i8(e,t){return this.each(("function"==typeof t?r8:n8)(e,t))},[Symbol.iterator]:function*o8(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var m,r=e[t],a=0,u=r.length;a<u;++a)(m=r[a])&&(yield m)}};const _y=NA;function Ah(e){return"string"==typeof e?new ja([[document.querySelector(e)]],[document.documentElement]):new ja([[e]],zA)}const YC={capture:!0,passive:!1};function KC(e){e.preventDefault(),e.stopImmediatePropagation()}function a8(e){var t=e.document.documentElement,n=Ah(e).on("dragstart.drag",KC,YC);"onselectstart"in t?n.on("selectstart.drag",KC,YC):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function l8(e,t){var n=e.document.documentElement,r=Ah(e).on("dragstart.drag",null);t&&(r.on("click.drag",KC,YC),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function BA(e){return((e=Math.exp(e))+1/e)/2}const d8=function e(t,n,r){function a(u,m){var We,Pe,v=u[0],C=u[1],D=u[2],U=m[2],G=m[0]-v,me=m[1]-C,Ae=G*G+me*me;if(Ae<1e-12)Pe=Math.log(U/D)/t,We=function(Yn){return[v+Yn*G,C+Yn*me,D*Math.exp(t*Yn*Pe)]};else{var dt=Math.sqrt(Ae),Ge=(U*U-D*D+r*Ae)/(2*D*n*dt),Ct=(U*U-D*D-r*Ae)/(2*U*n*dt),en=Math.log(Math.sqrt(Ge*Ge+1)-Ge),Tt=Math.log(Math.sqrt(Ct*Ct+1)-Ct);Pe=(Tt-en)/t,We=function(Yn){var Zi=Yn*Pe,_s=BA(en),As=D/(n*dt)*(_s*function h8(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*Zi+en)-function u8(e){return((e=Math.exp(e))-1/e)/2}(en));return[v+As*G,C+As*me,D*_s/BA(t*Zi+en)]}}return We.duration=1e3*Pe*t/Math.SQRT2,We}return a.rho=function(u){var m=Math.max(.001,+u),v=m*m;return e(m,v,v*v)},a}(Math.SQRT2,2,4);function yp(e,t){if(e=function f8(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}}return[e.pageX,e.pageY]}var Ix,xy,rg=0,yy=0,vy=0,Ax=0,vp=0,Px=0,by="object"==typeof performance&&performance.now?performance:Date,UA="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function JC(){return vp||(UA(p8),vp=by.now()+Px)}function p8(){vp=0}function Ox(){this._call=this._time=this._next=null}function jA(e,t,n){var r=new Ox;return r.restart(e,t,n),r}function $A(){vp=(Ax=by.now())+Px,rg=yy=0;try{!function m8(){JC(),++rg;for(var t,e=Ix;e;)(t=vp-e._time)>=0&&e._call.call(void 0,t),e=e._next;--rg}()}finally{rg=0,function _8(){for(var e,n,t=Ix,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ix=n);xy=e,QC(r)}(),vp=0}}function g8(){var e=by.now(),t=e-Ax;t>1e3&&(Px-=t,Ax=e)}function QC(e){rg||(yy&&(yy=clearTimeout(yy)),e-vp>24?(e<1/0&&(yy=setTimeout($A,e-by.now()-Px)),vy&&(vy=clearInterval(vy))):(vy||(Ax=by.now(),vy=setInterval(g8,1e3)),rg=1,UA($A)))}function GA(e,t,n){var r=new Ox;return r.restart(a=>{r.stop(),e(a+t)},t=null==t?0:+t,n),r}Ox.prototype=jA.prototype={constructor:Ox,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?JC():+n)+(null==t?0:+t),!this._next&&xy!==this&&(xy?xy._next=this:Ix=this,xy=this),this._call=e,this._time=n,QC()},stop:function(){this._call&&(this._call=null,this._time=1/0,QC())}};var y8=MA("start","end","cancel","interrupt"),v8=[];function Lx(e,t,n,r,a,u){var m=e.__transition;if(m){if(n in m)return}else e.__transition={};!function x8(e,t,n){var a,r=e.__transition;function m(D){var O,F,U,G;if(1!==n.state)return C();for(O in r)if((G=r[O]).name===n.name){if(3===G.state)return GA(m);4===G.state?(G.state=6,G.timer.stop(),G.on.call("interrupt",e,e.__data__,G.index,G.group),delete r[O]):+O<t&&(G.state=6,G.timer.stop(),G.on.call("cancel",e,e.__data__,G.index,G.group),delete r[O])}if(GA(function(){3===n.state&&(n.state=4,n.timer.restart(v,n.delay,n.time),v(D))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,a=new Array(U=n.tween.length),O=0,F=-1;O<U;++O)(G=n.tween[O].value.call(e,e.__data__,n.index,n.group))&&(a[++F]=G);a.length=F+1}}function v(D){for(var O=D<n.duration?n.ease.call(null,D/n.duration):(n.timer.restart(C),n.state=5,1),F=-1,U=a.length;++F<U;)a[F].call(e,O);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),C())}function C(){for(var D in n.state=6,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=jA(function u(D){n.state=1,n.timer.restart(m,n.delay,n.time),n.delay<=D&&m(D-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:a,on:y8,tween:v8,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:0})}function nM(e,t){var n=uc(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function fu(e,t){var n=uc(e,t);if(n.state>3)throw new Error("too late; already running");return n}function uc(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Fx(e,t){var r,a,m,n=e.__transition,u=!0;if(n){for(m in t=null==t?null:t+"",n)(r=n[m]).name===t?(a=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(a?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[m]):u=!1;u&&delete e.__transition}}function hc(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var zx,WA=180/Math.PI,rM={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function XA(e,t,n,r,a,u){var m,v,C;return(m=Math.sqrt(e*e+t*t))&&(e/=m,t/=m),(C=e*n+t*r)&&(n-=e*C,r-=t*C),(v=Math.sqrt(n*n+r*r))&&(n/=v,r/=v,C/=v),e*r<t*n&&(e=-e,t=-t,C=-C,m=-m),{translateX:a,translateY:u,rotate:Math.atan2(t,e)*WA,skewX:Math.atan(C)*WA,scaleX:m,scaleY:v}}function YA(e,t,n,r){function a(D){return D.length?D.pop()+" ":""}return function(D,O){var F=[],U=[];return D=e(D),O=e(O),function u(D,O,F,U,G,me){if(D!==F||O!==U){var Ae=G.push("translate(",null,t,null,n);me.push({i:Ae-4,x:hc(D,F)},{i:Ae-2,x:hc(O,U)})}else(F||U)&&G.push("translate("+F+t+U+n)}(D.translateX,D.translateY,O.translateX,O.translateY,F,U),function m(D,O,F,U){D!==O?(D-O>180?O+=360:O-D>180&&(D+=360),U.push({i:F.push(a(F)+"rotate(",null,r)-2,x:hc(D,O)})):O&&F.push(a(F)+"rotate("+O+r)}(D.rotate,O.rotate,F,U),function v(D,O,F,U){D!==O?U.push({i:F.push(a(F)+"skewX(",null,r)-2,x:hc(D,O)}):O&&F.push(a(F)+"skewX("+O+r)}(D.skewX,O.skewX,F,U),function C(D,O,F,U,G,me){if(D!==F||O!==U){var Ae=G.push(a(G)+"scale(",null,",",null,")");me.push({i:Ae-4,x:hc(D,F)},{i:Ae-2,x:hc(O,U)})}else(1!==F||1!==U)&&G.push(a(G)+"scale("+F+","+U+")")}(D.scaleX,D.scaleY,O.scaleX,O.scaleY,F,U),D=O=null,function(G){for(var We,me=-1,Ae=U.length;++me<Ae;)F[(We=U[me]).i]=We.x(G);return F.join("")}}}var M8=YA(function w8(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?rM:XA(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),E8=YA(function C8(e){return null!=e&&(zx||(zx=document.createElementNS("http://www.w3.org/2000/svg","g")),zx.setAttribute("transform",e),e=zx.transform.baseVal.consolidate())?XA((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):rM},", ",")",")");function T8(e,t){var n,r;return function(){var a=fu(this,e),u=a.tween;if(u!==n)for(var m=0,v=(r=n=u).length;m<v;++m)if(r[m].name===t){(r=r.slice()).splice(m,1);break}a.tween=r}}function D8(e,t,n){var r,a;if("function"!=typeof n)throw new Error;return function(){var u=fu(this,e),m=u.tween;if(m!==r){a=(r=m).slice();for(var v={name:t,value:n},C=0,D=a.length;C<D;++C)if(a[C].name===t){a[C]=v;break}C===D&&a.push(v)}u.tween=a}}function iM(e,t,n){var r=e._id;return e.each(function(){var a=fu(this,r);(a.value||(a.value={}))[t]=n.apply(this,arguments)}),function(a){return uc(a,r).value[t]}}function oM(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function KA(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function wy(){}var Nx=1/.7,ig="\\s*([+-]?\\d+)\\s*",My="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",pu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",I8=/^#([0-9a-f]{3,8})$/,A8=new RegExp(`^rgb\\(${ig},${ig},${ig}\\)$`),P8=new RegExp(`^rgb\\(${pu},${pu},${pu}\\)$`),O8=new RegExp(`^rgba\\(${ig},${ig},${ig},${My}\\)$`),k8=new RegExp(`^rgba\\(${pu},${pu},${pu},${My}\\)$`),R8=new RegExp(`^hsl\\(${My},${pu},${pu}\\)$`),L8=new RegExp(`^hsla\\(${My},${pu},${pu},${My}\\)$`),JA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function QA(){return this.rgb().formatHex()}function eP(){return this.rgb().formatRgb()}function xp(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=I8.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?tP(t):3===n?new da(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Bx(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Bx(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=A8.exec(e))?new da(t[1],t[2],t[3],1):(t=P8.exec(e))?new da(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=O8.exec(e))?Bx(t[1],t[2],t[3],t[4]):(t=k8.exec(e))?Bx(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=R8.exec(e))?iP(t[1],t[2]/100,t[3]/100,1):(t=L8.exec(e))?iP(t[1],t[2]/100,t[3]/100,t[4]):JA.hasOwnProperty(e)?tP(JA[e]):"transparent"===e?new da(NaN,NaN,NaN,0):null}function tP(e){return new da(e>>16&255,e>>8&255,255&e,1)}function Bx(e,t,n,r){return r<=0&&(e=t=n=NaN),new da(e,t,n,r)}function N8(e){return e instanceof wy||(e=xp(e)),e?new da((e=e.rgb()).r,e.g,e.b,e.opacity):new da}function Vx(e,t,n,r){return 1===arguments.length?N8(e):new da(e,t,n,r??1)}function da(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function nP(){return`#${wp(this.r)}${wp(this.g)}${wp(this.b)}`}function rP(){const e=Ux(this.opacity);return`${1===e?"rgb(":"rgba("}${bp(this.r)}, ${bp(this.g)}, ${bp(this.b)}${1===e?")":`, ${e})`}`}function Ux(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function bp(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function wp(e){return((e=bp(e))<16?"0":"")+e.toString(16)}function iP(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new dc(e,t,n,r)}function oP(e){if(e instanceof dc)return new dc(e.h,e.s,e.l,e.opacity);if(e instanceof wy||(e=xp(e)),!e)return new dc;if(e instanceof dc)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,a=Math.min(t,n,r),u=Math.max(t,n,r),m=NaN,v=u-a,C=(u+a)/2;return v?(m=t===u?(n-r)/v+6*(n<r):n===u?(r-t)/v+2:(t-n)/v+4,v/=C<.5?u+a:2-u-a,m*=60):v=C>0&&C<1?0:m,new dc(m,v,C,e.opacity)}function dc(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function sP(e){return(e=(e||0)%360)<0?e+360:e}function jx(e){return Math.max(0,Math.min(1,e||0))}function sM(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function aP(e,t,n,r,a){var u=e*e,m=u*e;return((1-3*e+3*u-m)*t+(4-6*u+3*m)*n+(1+3*e+3*u-3*m)*r+m*a)/6}oM(wy,xp,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:QA,formatHex:QA,formatHex8:function F8(){return this.rgb().formatHex8()},formatHsl:function z8(){return oP(this).formatHsl()},formatRgb:eP,toString:eP}),oM(da,Vx,KA(wy,{brighter(e){return e=null==e?Nx:Math.pow(Nx,e),new da(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new da(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new da(bp(this.r),bp(this.g),bp(this.b),Ux(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nP,formatHex:nP,formatHex8:function B8(){return`#${wp(this.r)}${wp(this.g)}${wp(this.b)}${wp(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:rP,toString:rP})),oM(dc,function V8(e,t,n,r){return 1===arguments.length?oP(e):new dc(e,t,n,r??1)},KA(wy,{brighter(e){return e=null==e?Nx:Math.pow(Nx,e),new dc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new dc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,a=2*n-r;return new da(sM(e>=240?e-240:e+120,a,r),sM(e,a,r),sM(e<120?e+240:e-120,a,r),this.opacity)},clamp(){return new dc(sP(this.h),jx(this.s),jx(this.l),Ux(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ux(this.opacity);return`${1===e?"hsl(":"hsla("}${sP(this.h)}, ${100*jx(this.s)}%, ${100*jx(this.l)}%${1===e?")":`, ${e})`}`}}));const aM=e=>()=>e;function cP(e,t){var n=t-e;return n?function lP(e,t){return function(n){return e+n*t}}(e,n):aM(isNaN(e)?t:e)}const $x=function e(t){var n=function G8(e){return 1==(e=+e)?cP:function(t,n){return n-t?function $8(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):aM(isNaN(t)?n:t)}}(t);function r(a,u){var m=n((a=Vx(a)).r,(u=Vx(u)).r),v=n(a.g,u.g),C=n(a.b,u.b),D=cP(a.opacity,u.opacity);return function(O){return a.r=m(O),a.g=v(O),a.b=C(O),a.opacity=D(O),a+""}}return r.gamma=e,r}(1);function uP(e){return function(t){var m,v,n=t.length,r=new Array(n),a=new Array(n),u=new Array(n);for(m=0;m<n;++m)v=Vx(t[m]),r[m]=v.r||0,a[m]=v.g||0,u[m]=v.b||0;return r=e(r),a=e(a),u=e(u),v.opacity=1,function(C){return v.r=r(C),v.g=a(C),v.b=u(C),v+""}}}uP(function U8(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),a=e[r],u=e[r+1];return aP((n-r/t)*t,r>0?e[r-1]:2*a-u,a,u,r<t-1?e[r+2]:2*u-a)}}),uP(function j8(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return aP((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}});var lM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cM=new RegExp(lM.source,"g");function hP(e,t){var r,a,u,n=lM.lastIndex=cM.lastIndex=0,m=-1,v=[],C=[];for(e+="",t+="";(r=lM.exec(e))&&(a=cM.exec(t));)(u=a.index)>n&&(u=t.slice(n,u),v[m]?v[m]+=u:v[++m]=u),(r=r[0])===(a=a[0])?v[m]?v[m]+=a:v[++m]=a:(v[++m]=null,C.push({i:m,x:hc(r,a)})),n=cM.lastIndex;return n<t.length&&(u=t.slice(n),v[m]?v[m]+=u:v[++m]=u),v.length<2?C[0]?function q8(e){return function(t){return e(t)+""}}(C[0].x):function H8(e){return function(){return e}}(t):(t=C.length,function(D){for(var F,O=0;O<t;++O)v[(F=C[O]).i]=F.x(D);return v.join("")})}function dP(e,t){var n;return("number"==typeof t?hc:t instanceof xp?$x:(n=xp(t))?(t=n,$x):hP)(e,t)}function Z8(e){return function(){this.removeAttribute(e)}}function W8(e){return function(){this.removeAttributeNS(e.space,e.local)}}function X8(e,t,n){var r,u,a=n+"";return function(){var m=this.getAttribute(e);return m===a?null:m===r?u:u=t(r=m,n)}}function Y8(e,t,n){var r,u,a=n+"";return function(){var m=this.getAttributeNS(e.space,e.local);return m===a?null:m===r?u:u=t(r=m,n)}}function K8(e,t,n){var r,a,u;return function(){var m,C,v=n(this);return null==v?void this.removeAttribute(e):(m=this.getAttribute(e))===(C=v+"")?null:m===r&&C===a?u:(a=C,u=t(r=m,v))}}function J8(e,t,n){var r,a,u;return function(){var m,C,v=n(this);return null==v?void this.removeAttributeNS(e.space,e.local):(m=this.getAttributeNS(e.space,e.local))===(C=v+"")?null:m===r&&C===a?u:(a=C,u=t(r=m,v))}}function eU(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function tU(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function nU(e,t){var n,r;function a(){var u=t.apply(this,arguments);return u!==r&&(n=(r=u)&&tU(e,u)),n}return a._value=t,a}function rU(e,t){var n,r;function a(){var u=t.apply(this,arguments);return u!==r&&(n=(r=u)&&eU(e,u)),n}return a._value=t,a}function oU(e,t){return function(){nM(this,e).delay=+t.apply(this,arguments)}}function sU(e,t){return t=+t,function(){nM(this,e).delay=t}}function lU(e,t){return function(){fu(this,e).duration=+t.apply(this,arguments)}}function cU(e,t){return t=+t,function(){fu(this,e).duration=t}}function hU(e,t){if("function"!=typeof t)throw new Error;return function(){fu(this,e).ease=t}}function yU(e,t,n){var r,a,u=function _U(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(t)?nM:fu;return function(){var m=u(this,e),v=m.on;v!==r&&(a=(r=v).copy()).on(t,n),m.on=a}}var MU=_y.prototype.constructor;function fP(e){return function(){this.style.removeProperty(e)}}function PU(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}function OU(e,t,n){var r,a;function u(){var m=t.apply(this,arguments);return m!==a&&(r=(a=m)&&PU(e,m,n)),r}return u._value=t,u}function zU(e){return function(t){this.textContent=e.call(this,t)}}function NU(e){var t,n;function r(){var a=e.apply(this,arguments);return a!==n&&(t=(n=a)&&zU(a)),t}return r._value=e,r}var jU=0;function Ph(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function pP(){return++jU}var Oh=_y.prototype;Ph.prototype=function $U(e){return _y().transition(e)}.prototype={constructor:Ph,select:function wU(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=ZC(e));for(var r=this._groups,a=r.length,u=new Array(a),m=0;m<a;++m)for(var O,F,v=r[m],C=v.length,D=u[m]=new Array(C),U=0;U<C;++U)(O=v[U])&&(F=e.call(O,O.__data__,U,v))&&("__data__"in O&&(F.__data__=O.__data__),D[U]=F,Lx(D[U],t,n,U,D,uc(O,n)));return new Ph(u,this._parents,t,n)},selectAll:function CU(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=EA(e));for(var r=this._groups,a=r.length,u=[],m=[],v=0;v<a;++v)for(var O,C=r[v],D=C.length,F=0;F<D;++F)if(O=C[F]){for(var G,U=e.call(O,O.__data__,F,C),me=uc(O,n),Ae=0,We=U.length;Ae<We;++Ae)(G=U[Ae])&&Lx(G,t,n,Ae,U,me);u.push(U),m.push(O)}return new Ph(u,m,t,n)},selectChild:Oh.selectChild,selectChildren:Oh.selectChildren,filter:function mU(e){"function"!=typeof e&&(e=TA(e));for(var t=this._groups,n=t.length,r=new Array(n),a=0;a<n;++a)for(var C,u=t[a],m=u.length,v=r[a]=[],D=0;D<m;++D)(C=u[D])&&e.call(C,C.__data__,D,u)&&v.push(C);return new Ph(r,this._parents,this._name,this._id)},merge:function gU(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,u=Math.min(r,n.length),m=new Array(r),v=0;v<u;++v)for(var U,C=t[v],D=n[v],O=C.length,F=m[v]=new Array(O),G=0;G<O;++G)(U=C[G]||D[G])&&(F[G]=U);for(;v<r;++v)m[v]=t[v];return new Ph(m,this._parents,this._name,this._id)},selection:function EU(){return new MU(this._groups,this._parents)},transition:function VU(){for(var e=this._name,t=this._id,n=pP(),r=this._groups,a=r.length,u=0;u<a;++u)for(var C,m=r[u],v=m.length,D=0;D<v;++D)if(C=m[D]){var O=uc(C,t);Lx(C,e,n,D,m,{time:O.time+O.delay+O.duration,delay:0,duration:O.duration,ease:O.ease})}return new Ph(r,this._parents,e,n)},call:Oh.call,nodes:Oh.nodes,node:Oh.node,size:Oh.size,empty:Oh.empty,each:Oh.each,on:function vU(e,t){var n=this._id;return arguments.length<2?uc(this.node(),n).on.on(e):this.each(yU(n,e,t))},attr:function Q8(e,t){var n=Sx(e),r="transform"===n?E8:dP;return this.attrTween(e,"function"==typeof t?(n.local?J8:K8)(n,r,iM(this,"attr."+e,t)):null==t?(n.local?W8:Z8)(n):(n.local?Y8:X8)(n,r,t))},attrTween:function iU(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=Sx(e);return this.tween(n,(r.local?nU:rU)(r,t))},style:function AU(e,t,n){var r="transform"==(e+="")?M8:dP;return null==t?this.styleTween(e,function TU(e,t){var n,r,a;return function(){var u=ng(this,e),m=(this.style.removeProperty(e),ng(this,e));return u===m?null:u===n&&m===r?a:a=t(n=u,r=m)}}(e,r)).on("end.style."+e,fP(e)):"function"==typeof t?this.styleTween(e,function SU(e,t,n){var r,a,u;return function(){var m=ng(this,e),v=n(this),C=v+"";return null==v&&(this.style.removeProperty(e),C=v=ng(this,e)),m===C?null:m===r&&C===a?u:(a=C,u=t(r=m,v))}}(e,r,iM(this,"style."+e,t))).each(function IU(e,t){var n,r,a,v,u="style."+t,m="end."+u;return function(){var C=fu(this,e),D=C.on,O=null==C.value[u]?v||(v=fP(t)):void 0;(D!==n||a!==O)&&(r=(n=D).copy()).on(m,a=O),C.on=r}}(this._id,e)):this.styleTween(e,function DU(e,t,n){var r,u,a=n+"";return function(){var m=ng(this,e);return m===a?null:m===r?u:u=t(r=m,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function kU(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,OU(e,t,n??""))},text:function FU(e){return this.tween("text","function"==typeof e?function LU(e){return function(){var t=e(this);this.textContent=t??""}}(iM(this,"text",e)):function RU(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function BU(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,NU(e))},remove:function bU(){return this.on("end.remove",function xU(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function S8(e,t){var n=this._id;if(e+="",arguments.length<2){for(var m,r=uc(this.node(),n).tween,a=0,u=r.length;a<u;++a)if((m=r[a]).name===e)return m.value;return null}return this.each((null==t?T8:D8)(n,e,t))},delay:function aU(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?oU:sU)(t,e)):uc(this.node(),t).delay},duration:function uU(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?lU:cU)(t,e)):uc(this.node(),t).duration},ease:function dU(e){var t=this._id;return arguments.length?this.each(hU(t,e)):uc(this.node(),t).ease},easeVarying:function pU(e){if("function"!=typeof e)throw new Error;return this.each(function fU(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;fu(this,e).ease=n}}(this._id,e))},end:function UU(){var e,t,n=this,r=n._id,a=n.size();return new Promise(function(u,m){var v={value:m},C={value:function(){0==--a&&u()}};n.each(function(){var D=fu(this,r),O=D.on;O!==e&&((t=(e=O).copy())._.cancel.push(v),t._.interrupt.push(v),t._.end.push(C)),D.on=t}),0===a&&u()})},[Symbol.iterator]:Oh[Symbol.iterator]};var HU={time:null,delay:0,duration:250,ease:function GU(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function qU(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}_y.prototype.interrupt=function b8(e){return this.each(function(){Fx(this,e)})},_y.prototype.transition=function ZU(e){var t,n;e instanceof Ph?(t=e._id,e=e._name):(t=pP(),(n=HU).time=JC(),e=null==e?null:e+"");for(var r=this._groups,a=r.length,u=0;u<a;++u)for(var C,m=r[u],v=m.length,D=0;D<v;++D)(C=m[D])&&Lx(C,e,t,D,m,n||qU(C,t));return new Ph(r,this._parents,e,t)};const Gx=e=>()=>e;function WU(e,{sourceEvent:t,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function kh(e,t,n){this.k=e,this.x=t,this.y=n}kh.prototype={constructor:kh,scale:function(e){return 1===e?this:new kh(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new kh(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Ey=new kh(1,0,0);function uM(e){e.stopImmediatePropagation()}function Ty(e){e.preventDefault(),e.stopImmediatePropagation()}function YU(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function KU(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function mP(){return this.__zoom||Ey}function JU(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function QU(){return navigator.maxTouchPoints||"ontouchstart"in this}function e9(e,t,n){var r=e.invertX(t[0][0])-n[0][0],a=e.invertX(t[1][0])-n[1][0],u=e.invertY(t[0][1])-n[0][1],m=e.invertY(t[1][1])-n[1][1];return e.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),m>u?(u+m)/2:Math.min(0,u)||Math.max(0,m))}function Hx(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function n9(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function hM(e){let t,n,r;function a(v,C,D=0,O=v.length){if(D<O){if(0!==t(C,C))return O;do{const F=D+O>>>1;n(v[F],C)<0?D=F+1:O=F}while(D<O)}return D}return 2!==e.length?(t=Hx,n=(v,C)=>Hx(e(v),C),r=(v,C)=>e(v)-C):(t=e===Hx||e===n9?e:r9,n=e,r=e),{left:a,center:function m(v,C,D=0,O=v.length){const F=a(v,C,D,O-1);return F>D&&r(v[F-1],C)>-r(v[F],C)?F-1:F},right:function u(v,C,D=0,O=v.length){if(D<O){if(0!==t(C,C))return O;do{const F=D+O>>>1;n(v[F],C)<=0?D=F+1:O=F}while(D<O)}return D}}}function r9(){return 0}var dM=Math.sqrt(50),fM=Math.sqrt(10),pM=Math.sqrt(2);function gP(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),u=r/a;return u>=dM?a*=10:u>=fM?a*=5:u>=pM&&(a*=2),t<e?-a:a}const Rh=1e3,vl=6e4,Lh=60*vl,Cp=24*Lh,mM=7*Cp,_P=30*Cp,gM=365*Cp;var _M=new Date,yM=new Date;function Ko(e,t,n,r){function a(u){return e(u=0===arguments.length?new Date:new Date(+u)),u}return a.floor=function(u){return e(u=new Date(+u)),u},a.ceil=function(u){return e(u=new Date(u-1)),t(u,1),e(u),u},a.round=function(u){var m=a(u),v=a.ceil(u);return u-m<v-u?m:v},a.offset=function(u,m){return t(u=new Date(+u),null==m?1:Math.floor(m)),u},a.range=function(u,m,v){var D,C=[];if(u=a.ceil(u),v=null==v?1:Math.floor(v),!(u<m&&v>0))return C;do{C.push(D=new Date(+u)),t(u,v),e(u)}while(D<u&&u<m);return C},a.filter=function(u){return Ko(function(m){if(m>=m)for(;e(m),!u(m);)m.setTime(m-1)},function(m,v){if(m>=m)if(v<0)for(;++v<=0;)for(;t(m,-1),!u(m););else for(;--v>=0;)for(;t(m,1),!u(m););})},n&&(a.count=function(u,m){return _M.setTime(+u),yM.setTime(+m),e(_M),e(yM),Math.floor(n(_M,yM))},a.every=function(u){return u=Math.floor(u),isFinite(u)&&u>0?u>1?a.filter(r?function(m){return r(m)%u==0}:function(m){return a.count(0,m)%u==0}):a:null}),a}var qx=Ko(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});qx.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Ko(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):qx:null};const o9=qx;const Dy=Ko(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Rh)},function(e,t){return(t-e)/Rh},function(e){return e.getUTCSeconds()});const xP=Ko(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Rh)},function(e,t){e.setTime(+e+t*vl)},function(e,t){return(t-e)/vl},function(e){return e.getMinutes()});const wP=Ko(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Rh-e.getMinutes()*vl)},function(e,t){e.setTime(+e+t*Lh)},function(e,t){return(t-e)/Lh},function(e){return e.getHours()});const Zx=Ko(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*vl)/Cp,e=>e.getDate()-1);function Mp(e){return Ko(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+7*n)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*vl)/mM})}var Wx=Mp(0),Xx=Mp(1),og=(Mp(2),Mp(3),Mp(4));const EP=(Mp(5),Mp(6),Ko(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}));var vM=Ko(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});vM.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ko(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};const Ep=vM;const u9=Ko(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*vl)},function(e,t){return(t-e)/vl},function(e){return e.getUTCMinutes()});const h9=Ko(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Lh)},function(e,t){return(t-e)/Lh},function(e){return e.getUTCHours()});const xM=Ko(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Cp},function(e){return e.getUTCDate()-1});function Tp(e){return Ko(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+7*n)},function(t,n){return(n-t)/mM})}var bM=Tp(0),Yx=Tp(1),sg=(Tp(2),Tp(3),Tp(4));const g9=(Tp(5),Tp(6),Ko(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}));var wM=Ko(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});wM.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Ko(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};const ag=wM;function AP(e,t,n,r,a,u){const m=[[Dy,1,Rh],[Dy,5,5e3],[Dy,15,15e3],[Dy,30,3e4],[u,1,vl],[u,5,5*vl],[u,15,15*vl],[u,30,30*vl],[a,1,Lh],[a,3,3*Lh],[a,6,6*Lh],[a,12,12*Lh],[r,1,Cp],[r,2,2*Cp],[n,1,mM],[t,1,_P],[t,3,3*_P],[e,1,gM]];function C(D,O,F){const U=Math.abs(O-D)/F,G=hM(([,,We])=>We).right(m,U);if(G===m.length)return e.every(gP(D/gM,O/gM,F));if(0===G)return o9.every(Math.max(gP(D,O,F),1));const[me,Ae]=m[U/m[G-1][2]<m[G][2]/U?G-1:G];return me.every(Ae)}return[function v(D,O,F){const U=O<D;U&&([D,O]=[O,D]);const G=F&&"function"==typeof F.range?F:C(D,O,F),me=G?G.range(D,+O+1):[];return U?me.reverse():me},C]}const[vq,xq]=AP(ag,g9,bM,xM,h9,u9),[_9,y9]=AP(Ep,EP,Wx,Zx,wP,xP);function CM(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function MM(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Sy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var lg,EM,PP={"-":"",_:" ",0:"0"},Jo=/^\s*\d+/,x9=/^%/,b9=/[\\^$*+?|[\]().{}]/g;function jr(e,t,n){var r=e<0?"-":"",a=(r?-e:e)+"",u=a.length;return r+(u<n?new Array(n-u+1).join(t)+a:a)}function w9(e){return e.replace(b9,"\\$&")}function Iy(e){return new RegExp("^(?:"+e.map(w9).join("|")+")","i")}function Ay(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function C9(e,t,n){var r=Jo.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function M9(e,t,n){var r=Jo.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function E9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function T9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function D9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function OP(e,t,n){var r=Jo.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function kP(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function S9(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function I9(e,t,n){var r=Jo.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function A9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function RP(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function P9(e,t,n){var r=Jo.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function LP(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function O9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function k9(e,t,n){var r=Jo.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function R9(e,t,n){var r=Jo.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function L9(e,t,n){var r=Jo.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function F9(e,t,n){var r=x9.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function z9(e,t,n){var r=Jo.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function N9(e,t,n){var r=Jo.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function FP(e,t){return jr(e.getDate(),t,2)}function B9(e,t){return jr(e.getHours(),t,2)}function V9(e,t){return jr(e.getHours()%12||12,t,2)}function U9(e,t){return jr(1+Zx.count(Ep(e),e),t,3)}function zP(e,t){return jr(e.getMilliseconds(),t,3)}function j9(e,t){return zP(e,t)+"000"}function $9(e,t){return jr(e.getMonth()+1,t,2)}function G9(e,t){return jr(e.getMinutes(),t,2)}function H9(e,t){return jr(e.getSeconds(),t,2)}function q9(e){var t=e.getDay();return 0===t?7:t}function Z9(e,t){return jr(Wx.count(Ep(e)-1,e),t,2)}function NP(e){var t=e.getDay();return t>=4||0===t?og(e):og.ceil(e)}function W9(e,t){return e=NP(e),jr(og.count(Ep(e),e)+(4===Ep(e).getDay()),t,2)}function X9(e){return e.getDay()}function Y9(e,t){return jr(Xx.count(Ep(e)-1,e),t,2)}function K9(e,t){return jr(e.getFullYear()%100,t,2)}function J9(e,t){return jr((e=NP(e)).getFullYear()%100,t,2)}function Q9(e,t){return jr(e.getFullYear()%1e4,t,4)}function ej(e,t){var n=e.getDay();return jr((e=n>=4||0===n?og(e):og.ceil(e)).getFullYear()%1e4,t,4)}function tj(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+jr(t/60|0,"0",2)+jr(t%60,"0",2)}function BP(e,t){return jr(e.getUTCDate(),t,2)}function nj(e,t){return jr(e.getUTCHours(),t,2)}function rj(e,t){return jr(e.getUTCHours()%12||12,t,2)}function ij(e,t){return jr(1+xM.count(ag(e),e),t,3)}function VP(e,t){return jr(e.getUTCMilliseconds(),t,3)}function oj(e,t){return VP(e,t)+"000"}function sj(e,t){return jr(e.getUTCMonth()+1,t,2)}function aj(e,t){return jr(e.getUTCMinutes(),t,2)}function lj(e,t){return jr(e.getUTCSeconds(),t,2)}function cj(e){var t=e.getUTCDay();return 0===t?7:t}function uj(e,t){return jr(bM.count(ag(e)-1,e),t,2)}function UP(e){var t=e.getUTCDay();return t>=4||0===t?sg(e):sg.ceil(e)}function hj(e,t){return e=UP(e),jr(sg.count(ag(e),e)+(4===ag(e).getUTCDay()),t,2)}function dj(e){return e.getUTCDay()}function fj(e,t){return jr(Yx.count(ag(e)-1,e),t,2)}function pj(e,t){return jr(e.getUTCFullYear()%100,t,2)}function mj(e,t){return jr((e=UP(e)).getUTCFullYear()%100,t,2)}function gj(e,t){return jr(e.getUTCFullYear()%1e4,t,4)}function _j(e,t){var n=e.getUTCDay();return jr((e=n>=4||0===n?sg(e):sg.ceil(e)).getUTCFullYear()%1e4,t,4)}function yj(){return"+0000"}function jP(){return"%"}function $P(e){return+e}function GP(e){return Math.floor(+e/1e3)}!function wj(e){lg=function v9(e){var t=e.dateTime,n=e.date,r=e.time,a=e.periods,u=e.days,m=e.shortDays,v=e.months,C=e.shortMonths,D=Iy(a),O=Ay(a),F=Iy(u),U=Ay(u),G=Iy(m),me=Ay(m),Ae=Iy(v),We=Ay(v),Pe=Iy(C),dt=Ay(C),Ge={a:function Cn(ln){return m[ln.getDay()]},A:function ir(ln){return u[ln.getDay()]},b:function yr(ln){return C[ln.getMonth()]},B:function Cr(ln){return v[ln.getMonth()]},c:null,d:FP,e:FP,f:j9,g:J9,G:ej,H:B9,I:V9,j:U9,L:zP,m:$9,M:G9,p:function hi(ln){return a[+(ln.getHours()>=12)]},q:function Wi(ln){return 1+~~(ln.getMonth()/3)},Q:$P,s:GP,S:H9,u:q9,U:Z9,V:W9,w:X9,W:Y9,x:null,X:null,y:K9,Y:Q9,Z:tj,"%":jP},Ct={a:function bl(ln){return m[ln.getUTCDay()]},A:function Vo(ln){return u[ln.getUTCDay()]},b:function Ga(ln){return C[ln.getUTCMonth()]},B:function fc(ln){return v[ln.getUTCMonth()]},c:null,d:BP,e:BP,f:oj,g:mj,G:_j,H:nj,I:rj,j:ij,L:VP,m:sj,M:aj,p:function Ha(ln){return a[+(ln.getUTCHours()>=12)]},q:function pc(ln){return 1+~~(ln.getUTCMonth()/3)},Q:$P,s:GP,S:lj,u:cj,U:uj,V:hj,w:dj,W:fj,x:null,X:null,y:pj,Y:gj,Z:yj,"%":jP},en={a:function As(ln,Sr,$r){var kt=G.exec(Sr.slice($r));return kt?(ln.w=me.get(kt[0].toLowerCase()),$r+kt[0].length):-1},A:function $a(ln,Sr,$r){var kt=F.exec(Sr.slice($r));return kt?(ln.w=U.get(kt[0].toLowerCase()),$r+kt[0].length):-1},b:function Ps(ln,Sr,$r){var kt=Pe.exec(Sr.slice($r));return kt?(ln.m=dt.get(kt[0].toLowerCase()),$r+kt[0].length):-1},B:function xl(ln,Sr,$r){var kt=Ae.exec(Sr.slice($r));return kt?(ln.m=We.get(kt[0].toLowerCase()),$r+kt[0].length):-1},c:function et(ln,Sr,$r){return Zi(ln,t,Sr,$r)},d:RP,e:RP,f:L9,g:kP,G:OP,H:LP,I:LP,j:P9,L:R9,m:A9,M:O9,p:function _s(ln,Sr,$r){var kt=D.exec(Sr.slice($r));return kt?(ln.p=O.get(kt[0].toLowerCase()),$r+kt[0].length):-1},q:I9,Q:z9,s:N9,S:k9,u:M9,U:E9,V:T9,w:C9,W:D9,x:function pn(ln,Sr,$r){return Zi(ln,n,Sr,$r)},X:function St(ln,Sr,$r){return Zi(ln,r,Sr,$r)},y:kP,Y:OP,Z:S9,"%":F9};function Tt(ln,Sr){return function($r){var Za,Dp,JP,kt=[],fa=-1,Si=0,qa=ln.length;for($r instanceof Date||($r=new Date(+$r));++fa<qa;)37===ln.charCodeAt(fa)&&(kt.push(ln.slice(Si,fa)),null!=(Dp=PP[Za=ln.charAt(++fa)])?Za=ln.charAt(++fa):Dp="e"===Za?" ":"0",(JP=Sr[Za])&&(Za=JP($r,Dp)),kt.push(Za),Si=fa+1);return kt.push(ln.slice(Si,fa)),kt.join("")}}function Yn(ln,Sr){return function($r){var Si,qa,kt=Sy(1900,void 0,1);if(Zi(kt,ln,$r+="",0)!=$r.length)return null;if("Q"in kt)return new Date(kt.Q);if("s"in kt)return new Date(1e3*kt.s+("L"in kt?kt.L:0));if(Sr&&!("Z"in kt)&&(kt.Z=0),"p"in kt&&(kt.H=kt.H%12+12*kt.p),void 0===kt.m&&(kt.m="q"in kt?kt.q:0),"V"in kt){if(kt.V<1||kt.V>53)return null;"w"in kt||(kt.w=1),"Z"in kt?(qa=(Si=MM(Sy(kt.y,0,1))).getUTCDay(),Si=qa>4||0===qa?Yx.ceil(Si):Yx(Si),Si=xM.offset(Si,7*(kt.V-1)),kt.y=Si.getUTCFullYear(),kt.m=Si.getUTCMonth(),kt.d=Si.getUTCDate()+(kt.w+6)%7):(qa=(Si=CM(Sy(kt.y,0,1))).getDay(),Si=qa>4||0===qa?Xx.ceil(Si):Xx(Si),Si=Zx.offset(Si,7*(kt.V-1)),kt.y=Si.getFullYear(),kt.m=Si.getMonth(),kt.d=Si.getDate()+(kt.w+6)%7)}else("W"in kt||"U"in kt)&&("w"in kt||(kt.w="u"in kt?kt.u%7:"W"in kt?1:0),qa="Z"in kt?MM(Sy(kt.y,0,1)).getUTCDay():CM(Sy(kt.y,0,1)).getDay(),kt.m=0,kt.d="W"in kt?(kt.w+6)%7+7*kt.W-(qa+5)%7:kt.w+7*kt.U-(qa+6)%7);return"Z"in kt?(kt.H+=kt.Z/100|0,kt.M+=kt.Z%100,MM(kt)):CM(kt)}}function Zi(ln,Sr,$r,kt){for(var Za,Dp,fa=0,Si=Sr.length,qa=$r.length;fa<Si;){if(kt>=qa)return-1;if(37===(Za=Sr.charCodeAt(fa++))){if(Za=Sr.charAt(fa++),!(Dp=en[Za in PP?Sr.charAt(fa++):Za])||(kt=Dp(ln,$r,kt))<0)return-1}else if(Za!=$r.charCodeAt(kt++))return-1}return kt}return Ge.x=Tt(n,Ge),Ge.X=Tt(r,Ge),Ge.c=Tt(t,Ge),Ct.x=Tt(n,Ct),Ct.X=Tt(r,Ct),Ct.c=Tt(t,Ct),{format:function(ln){var Sr=Tt(ln+="",Ge);return Sr.toString=function(){return ln},Sr},parse:function(ln){var Sr=Yn(ln+="",!1);return Sr.toString=function(){return ln},Sr},utcFormat:function(ln){var Sr=Tt(ln+="",Ct);return Sr.toString=function(){return ln},Sr},utcParse:function(ln){var Sr=Yn(ln+="",!0);return Sr.toString=function(){return ln},Sr}}}(e),EM=lg.format}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});const Mj=hM(Hx).right,Ej=(hM(function Cj(e){return null===e?NaN:+e}),Mj);function qP(e,t){var m,n=t?t.length:0,r=e?Math.min(n,e.length):0,a=new Array(r),u=new Array(n);for(m=0;m<r;++m)a[m]=TM(e[m],t[m]);for(;m<n;++m)u[m]=t[m];return function(v){for(m=0;m<r;++m)u[m]=a[m](v);return u}}function Tj(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Dj(e,t){var a,n={},r={};for(a in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)a in e?n[a]=TM(e[a],t[a]):r[a]=t[a];return function(u){for(a in n)r[a]=n[a](u);return r}}function Sj(e,t){t||(t=[]);var a,n=e?Math.min(t.length,e.length):0,r=t.slice();return function(u){for(a=0;a<n;++a)r[a]=e[a]*(1-u)+t[a]*u;return r}}function TM(e,t){var r,n=typeof t;return null==t||"boolean"===n?aM(t):("number"===n?hc:"string"===n?(r=xp(t))?(t=r,$x):hP:t instanceof xp?$x:t instanceof Date?Tj:function Ij(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?Sj:Array.isArray(t)?qP:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Dj:hc)(e,t)}function Aj(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Oj(e){return+e}var ZP=[0,1];function cg(e){return e}function DM(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function Pj(e){return function(){return e}}(isNaN(t)?NaN:.5)}function Rj(e,t,n){var r=e[0],a=e[1],u=t[0],m=t[1];return a<r?(r=DM(a,r),u=n(m,u)):(r=DM(r,a),u=n(u,m)),function(v){return u(r(v))}}function Lj(e,t,n){var r=Math.min(e.length,t.length)-1,a=new Array(r),u=new Array(r),m=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++m<r;)a[m]=DM(e[m],e[m+1]),u[m]=n(t[m],t[m+1]);return function(v){var C=Ej(e,v,1,r)-1;return u[C](a[C](v))}}function Bj(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Uj(e){return new Date(e)}function jj(e){return e instanceof Date?+e:+new Date(+e)}function WP(e,t,n,r,a,u,m,v,C,D){var O=function Nj(){return function zj(){var r,a,u,v,C,D,e=ZP,t=ZP,n=TM,m=cg;function O(){var U=Math.min(e.length,t.length);return m!==cg&&(m=function kj(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}(e[0],e[U-1])),v=U>2?Lj:Rj,C=D=null,F}function F(U){return null==U||isNaN(U=+U)?u:(C||(C=v(e.map(r),t,n)))(r(m(U)))}return F.invert=function(U){return m(a((D||(D=v(t,e.map(r),hc)))(U)))},F.domain=function(U){return arguments.length?(e=Array.from(U,Oj),O()):e.slice()},F.range=function(U){return arguments.length?(t=Array.from(U),O()):t.slice()},F.rangeRound=function(U){return t=Array.from(U),n=Aj,O()},F.clamp=function(U){return arguments.length?(m=!!U||cg,O()):m!==cg},F.interpolate=function(U){return arguments.length?(n=U,O()):n},F.unknown=function(U){return arguments.length?(u=U,F):u},function(U,G){return r=U,a=G,O()}}()(cg,cg)}(),F=O.invert,U=O.domain,G=D(".%L"),me=D(":%S"),Ae=D("%I:%M"),We=D("%I %p"),Pe=D("%a %d"),dt=D("%b %d"),Ge=D("%B"),Ct=D("%Y");function en(Tt){return(C(Tt)<Tt?G:v(Tt)<Tt?me:m(Tt)<Tt?Ae:u(Tt)<Tt?We:r(Tt)<Tt?a(Tt)<Tt?Pe:dt:n(Tt)<Tt?Ge:Ct)(Tt)}return O.invert=function(Tt){return new Date(F(Tt))},O.domain=function(Tt){return arguments.length?U(Array.from(Tt,jj)):U().map(Uj)},O.ticks=function(Tt){var Yn=U();return e(Yn[0],Yn[Yn.length-1],Tt??10)},O.tickFormat=function(Tt,Yn){return null==Yn?en:D(Yn)},O.nice=function(Tt){var Yn=U();return(!Tt||"function"!=typeof Tt.range)&&(Tt=t(Yn[0],Yn[Yn.length-1],Tt??10)),Tt?U(function Vj(e,t){var m,n=0,r=(e=e.slice()).length-1,a=e[n],u=e[r];return u<a&&(m=n,n=r,r=m,m=a,a=u,u=m),e[n]=t.floor(a),e[r]=t.ceil(u),e}(Yn,Tt)):O},O.copy=function(){return function Fj(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}(O,WP(e,t,n,r,a,u,m,v,C,D))},O}function Gj(e){return e}function Hj(e){return"translate("+e+",0)"}function qj(e){return"translate(0,"+e+")"}function Zj(e){return t=>+e(t)}function Wj(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function Xj(){return!this.__axis}function Qx(e,t){var n=[],r=null,a=null,u=6,m=6,v=3,C=typeof window<"u"&&window.devicePixelRatio>1?0:.5,D=1===e||4===e?-1:1,O=4===e||2===e?"x":"y",F=1===e||3===e?Hj:qj;function U(G){var me=r??(t.ticks?t.ticks.apply(t,n):t.domain()),Ae=a??(t.tickFormat?t.tickFormat.apply(t,n):Gj),We=Math.max(u,0)+v,Pe=t.range(),dt=+Pe[0]+C,Ge=+Pe[Pe.length-1]+C,Ct=(t.bandwidth?Wj:Zj)(t.copy(),C),en=G.selection?G.selection():G,Tt=en.selectAll(".domain").data([null]),Yn=en.selectAll(".tick").data(me,t).order(),Zi=Yn.exit(),_s=Yn.enter().append("g").attr("class","tick"),As=Yn.select("line"),$a=Yn.select("text");Tt=Tt.merge(Tt.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Yn=Yn.merge(_s),As=As.merge(_s.append("line").attr("stroke","currentColor").attr(O+"2",D*u)),$a=$a.merge(_s.append("text").attr("fill","currentColor").attr(O,D*We).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),G!==en&&(Tt=Tt.transition(G),Yn=Yn.transition(G),As=As.transition(G),$a=$a.transition(G),Zi=Zi.transition(G).attr("opacity",1e-6).attr("transform",function(Ps){return isFinite(Ps=Ct(Ps))?F(Ps+C):this.getAttribute("transform")}),_s.attr("opacity",1e-6).attr("transform",function(Ps){var xl=this.parentNode.__axis;return F((xl&&isFinite(xl=xl(Ps))?xl:Ct(Ps))+C)})),Zi.remove(),Tt.attr("d",4===e||2===e?m?"M"+D*m+","+dt+"H"+C+"V"+Ge+"H"+D*m:"M"+C+","+dt+"V"+Ge:m?"M"+dt+","+D*m+"V"+C+"H"+Ge+"V"+D*m:"M"+dt+","+C+"H"+Ge),Yn.attr("opacity",1).attr("transform",function(Ps){return F(Ct(Ps)+C)}),As.attr(O+"2",D*u),$a.attr(O,D*We).text(Ae),en.filter(Xj).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),en.each(function(){this.__axis=Ct})}return U.scale=function(G){return arguments.length?(t=G,U):t},U.ticks=function(){return n=Array.from(arguments),U},U.tickArguments=function(G){return arguments.length?(n=null==G?[]:Array.from(G),U):n.slice()},U.tickValues=function(G){return arguments.length?(r=null==G?null:Array.from(G),U):r&&r.slice()},U.tickFormat=function(G){return arguments.length?(a=G,U):a},U.tickSize=function(G){return arguments.length?(u=m=+G,U):u},U.tickSizeInner=function(G){return arguments.length?(u=+G,U):u},U.tickSizeOuter=function(G){return arguments.length?(m=+G,U):m},U.tickPadding=function(G){return arguments.length?(v=+G,U):v},U.offset=function(G){return arguments.length?(C=+G,U):C},U}function YP(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}const{isArray:Kj}=Array;let KP=(()=>{class e{constructor(n){this.sanitizer=n,this.marker="Media",this.breathing=!1}ngOnInit(){}ngOnChanges(){"Media"!==this.marker&&(this.type=this.marker),this.update()}static getCodeForType(n,r,a=!1){let u={wikipedia:'d="M12.081 12.932C11.301 14.543 10.232 16.724 9.702 17.708C9.189 18.604 8.762 18.484 8.424 17.732C7.252 14.962 4.844 10.107 3.712 7.38499C3.503 6.88299 3.345 6.56199 3.196 6.43499C3.045 6.30999 2.734 6.23499 2.26 6.20799C2.086 6.18899 2 6.14699 2 6.07699V5.69799L2.043 5.65999C2.814 5.65599 6.546 5.65999 6.546 5.65999L6.588 5.69799V6.05999C6.588 6.15999 6.525 6.20699 6.4 6.20699L5.93 6.23099C5.527 6.25699 5.325 6.36799 5.325 6.59599C5.325 6.70799 5.369 6.87099 5.464 7.09699C6.366 9.30299 9.481 15.869 9.481 15.869L9.595 15.908L11.605 11.896L11.203 11.006L9.82 8.28499C9.82 8.28499 9.555 7.73999 9.463 7.55799C8.856 6.35499 8.87 6.29299 8.257 6.21099C8.084 6.19099 7.996 6.16899 7.996 6.08599V5.69599L8.046 5.65899H11.624L11.719 5.68899V6.06499C11.719 6.15299 11.656 6.18999 11.53 6.18999L11.273 6.22899C10.613 6.27999 10.722 6.54699 11.16 7.41499L12.479 10.127L13.944 7.20499C14.188 6.67199 14.138 6.53699 14.037 6.41599C13.979 6.34599 13.782 6.23099 13.36 6.21599L13.192 6.19799C13.1479 6.19805 13.1052 6.18286 13.071 6.15499C13.0534 6.14334 13.039 6.12741 13.0292 6.1087C13.0194 6.08999 13.0145 6.0691 13.015 6.04799V5.69099L13.066 5.65399C14.106 5.64699 16.437 5.65399 16.437 5.65399L16.487 5.69099V6.05499C16.487 6.15599 16.437 6.20299 16.326 6.20299C15.787 6.22699 15.674 6.28199 15.472 6.56899C15.372 6.72299 15.159 7.05899 14.934 7.43399L13.015 10.997L12.961 11.109L15.289 15.872L15.431 15.913L19.096 7.20899C19.225 6.85699 19.203 6.60699 19.043 6.46299C18.878 6.31899 18.754 6.23499 18.327 6.21699L17.977 6.20299C17.9318 6.20459 17.8873 6.19162 17.85 6.16599C17.8328 6.15527 17.8184 6.14061 17.8079 6.12322C17.7975 6.10583 17.7914 6.08622 17.79 6.06599V5.70499L17.839 5.66699H21.976L22.01 5.70499V6.06899C22.01 6.16899 21.948 6.21899 21.836 6.21899C21.295 6.24299 20.896 6.36899 20.633 6.56999C20.37 6.78299 20.168 7.08399 20.019 7.45999C20.019 7.45999 16.648 15.18 15.495 17.749C15.057 18.589 14.617 18.514 14.242 17.723C13.765 16.746 12.764 14.567 12.036 12.962L12.081 12.932Z"',audio:'fill-rule="evenodd" clip-rule="evenodd" d="M20 10.2928V11.9998C21.103 11.9998 22 12.8968 22 13.9998V17.9998C22 19.1028 21.103 19.9998 20 19.9998H18V10.2928C18 6.92082 15.392 4.09882 12.184 4.00282C11.3804 3.97674 10.5798 4.11306 9.83014 4.40362C9.08047 4.69417 8.39712 5.133 7.821 5.69382C7.24245 6.25141 6.78282 6.92041 6.46985 7.66047C6.15688 8.40053 5.99705 9.19631 6 9.99982V19.9998H4C2.897 19.9998 2 19.1028 2 17.9998V13.9998C2 12.8968 2.897 11.9998 4 11.9998V9.99982C3.99623 8.92846 4.2095 7.86743 4.62697 6.88074C5.04444 5.89405 5.65744 5.00214 6.429 4.25882C7.994 2.73882 10.041 1.95182 12.245 2.00282C16.521 2.13182 20 5.85082 20 10.2928ZM9 12H7V20H9V12ZM17 12H15V20H17V12Z"',image:'d="M5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V5C21 4.46957 20.7893 3.96086 20.4142 3.58579C20.0391 3.21071 19.5304 3 19 3H5C4.46957 3 3.96086 3.21071 3.58579 3.58579C3.21071 3.96086 3 4.46957 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21ZM8 14L10.363 16.363L14 11L19 18H5L8 14Z"',instagram:'fill-rule="evenodd" clip-rule="evenodd" d="M20.5271 6.08896C20.7942 6.79773 20.936 7.54758 20.9461 8.30496C21.0018 9.25754 21.0021 9.56909 21.0041 11.9803L21.0041 12.014C21.0041 14.457 20.9911 14.762 20.9481 15.724C20.9331 16.473 20.7921 17.211 20.5291 17.911C20.2972 18.5086 19.9433 19.0515 19.4899 19.5048C19.0366 19.9581 18.4938 20.312 17.8961 20.544C17.1965 20.8066 16.4572 20.9482 15.7101 20.963C14.7551 21.019 14.4421 21.019 12.0001 21.019C9.55809 21.019 9.25309 21.006 8.29009 20.963C7.54147 20.9383 6.80253 20.7862 6.10509 20.513C5.50716 20.2815 4.96407 19.9279 4.51053 19.4747C4.05699 19.0215 3.70297 18.4787 3.47109 17.881C3.20809 17.18 3.06709 16.442 3.05209 15.694C2.99609 14.738 2.99609 14.426 2.99609 11.984C2.99609 9.54196 3.00909 9.23696 3.05209 8.27396C3.06622 7.52707 3.20792 6.78809 3.47109 6.08896C3.70258 5.49102 4.05634 4.94798 4.50973 4.49459C4.96311 4.0412 5.50615 3.68745 6.10409 3.45596C6.80344 3.19343 7.54225 3.05141 8.28909 3.03596C9.24409 2.98096 9.55709 2.98096 11.9991 2.98096C14.4411 2.98096 14.7461 2.99296 15.7081 3.03596C16.4553 3.0513 17.1944 3.19331 17.8941 3.45596C18.4919 3.68761 19.0349 4.04142 19.4883 4.49479C19.9416 4.94816 20.2954 5.49111 20.5271 6.08896ZM7.37009 11.979C7.37009 14.533 9.43909 16.602 11.9931 16.602C13.2192 16.602 14.3951 16.1149 15.262 15.2479C16.129 14.3809 16.6161 13.2051 16.6161 11.979C16.6161 10.7529 16.129 9.57698 15.262 8.71C14.3951 7.84302 13.2192 7.35596 11.9931 7.35596C9.43909 7.35596 7.37009 9.42496 7.37009 11.979ZM15.7221 7.18496C15.7221 7.78096 16.2031 8.26296 16.8001 8.26296C17.3951 8.26296 17.8771 7.78096 17.8771 7.18496C17.8771 7.04346 17.8492 6.90334 17.7951 6.77262C17.7409 6.64189 17.6616 6.5231 17.5615 6.42305C17.4614 6.32299 17.3427 6.24363 17.2119 6.18948C17.0812 6.13533 16.9411 6.10746 16.7996 6.10746C16.6581 6.10746 16.518 6.13533 16.3873 6.18948C16.2565 6.24363 16.1377 6.32299 16.0377 6.42305C15.9376 6.5231 15.8583 6.64189 15.8041 6.77262C15.75 6.90334 15.7221 7.04346 15.7221 7.18496ZM14.9962 11.9791C14.9962 13.6376 13.6517 14.9821 11.9932 14.9821C10.3347 14.9821 8.99023 13.6376 8.99023 11.9791C8.99023 10.3206 10.3347 8.97607 11.9932 8.97607C13.6517 8.97607 14.9962 10.3206 14.9962 11.9791Z"',twitter:'d="M19.633 7.99704C19.646 8.17204 19.646 8.34604 19.646 8.52004C19.646 13.845 15.593 19.981 8.186 19.981C5.904 19.981 3.784 19.32 2 18.172C2.324 18.209 2.636 18.222 2.973 18.222C4.78599 18.2264 6.54765 17.6202 7.974 16.501C7.13342 16.4858 6.31858 16.2085 5.64324 15.7078C4.9679 15.2071 4.46578 14.5079 4.207 13.708C4.456 13.745 4.706 13.77 4.968 13.77C5.329 13.77 5.692 13.72 6.029 13.633C5.11676 13.4489 4.29647 12.9544 3.70762 12.2337C3.11876 11.5131 2.79769 10.6107 2.799 9.68004V9.63004C3.336 9.92904 3.959 10.116 4.619 10.141C4.06609 9.77363 3.61272 9.27507 3.29934 8.68983C2.98596 8.1046 2.82231 7.4509 2.823 6.78704C2.823 6.03904 3.022 5.35304 3.371 4.75504C4.38314 6.00006 5.6455 7.0186 7.07634 7.7447C8.50717 8.4708 10.0746 8.88826 11.677 8.97004C11.615 8.67004 11.577 8.35904 11.577 8.04704C11.5767 7.518 11.6807 6.9941 11.8831 6.50528C12.0854 6.01647 12.3821 5.57232 12.7562 5.19823C13.1303 4.82414 13.5744 4.52745 14.0632 4.32512C14.5521 4.12279 15.076 4.01878 15.605 4.01904C16.765 4.01904 17.812 4.50504 18.548 5.29104C19.4498 5.11666 20.3145 4.78747 21.104 4.31804C20.8034 5.24886 20.1738 6.03815 19.333 6.53804C20.1328 6.44682 20.9144 6.2365 21.652 5.91404C21.1011 6.71714 20.4185 7.42139 19.633 7.99704Z"',video:'d="M21.5914 7.20301C21.4775 6.78041 21.2549 6.39501 20.9457 6.08518C20.6366 5.77534 20.2517 5.55187 19.8294 5.43701C18.2634 5.00701 11.9984 5.00001 11.9984 5.00001C11.9984 5.00001 5.73438 4.99301 4.16738 5.40401C3.7453 5.52415 3.3612 5.75078 3.05194 6.06214C2.74269 6.3735 2.51866 6.75913 2.40138 7.18201C1.98838 8.74801 1.98438 11.996 1.98438 11.996C1.98438 11.996 1.98038 15.26 2.39038 16.81C2.62038 17.667 3.29538 18.344 4.15338 18.575C5.73538 19.005 11.9834 19.012 11.9834 19.012C11.9834 19.012 18.2484 19.019 19.8144 18.609C20.2369 18.4943 20.6221 18.2714 20.932 17.9622C21.2419 17.653 21.4658 17.2682 21.5814 16.846C21.9954 15.281 21.9984 12.034 21.9984 12.034C21.9984 12.034 22.0184 8.76901 21.5914 7.20301ZM9.99438 15.005L9.99938 9.00501L15.2064 12.01L9.99438 15.005Z"',Marker:'fill-rule="evenodd" clip-rule="evenodd" d="M18 12.7052C18 16.0373 15.3137 18.7385 12 18.7385C8.68629 18.7385 6 16.0373 6 12.7052C6 9.37309 8.68629 6.67188 12 6.67188C15.3137 6.67188 18 9.37309 18 12.7052ZM17 12.7052C17 15.482 14.7614 17.733 12 17.733C9.23858 17.733 7 15.482 7 12.7052C7 9.92844 9.23858 7.67743 12 7.67743C14.7614 7.67743 17 9.92844 17 12.7052ZM12 15.7219C13.6569 15.7219 15 14.3713 15 12.7052C15 11.0391 13.6569 9.68854 12 9.68854C10.3431 9.68854 9 11.0391 9 12.7052C9 14.3713 10.3431 15.7219 12 15.7219Z"',Map:'d="M20.4102 5.89L16.4102 4.09H15.5902L12.0002 5.7L8.41024 4.09H8.36024L8.24024 4H7.64024L3.64024 5.8C3.44073 5.87645 3.27095 6.01479 3.15578 6.19474C3.0406 6.3747 2.9861 6.58681 3.00024 6.8V19C3.00052 19.1673 3.04278 19.3319 3.12314 19.4786C3.20351 19.6254 3.31941 19.7496 3.46024 19.84C3.6212 19.944 3.80863 19.9995 4.00024 20C4.14174 19.9993 4.28148 19.9687 4.41024 19.91L8.00024 18.3L11.5902 19.91H11.6402C11.7529 19.9627 11.8758 19.99 12.0002 19.99C12.1247 19.99 12.2475 19.9627 12.3602 19.91H12.4102L16.0002 18.3L19.5902 19.91C19.719 19.9687 19.8587 19.9993 20.0002 20C20.1919 19.9995 20.3793 19.944 20.5402 19.84C20.6811 19.7496 20.797 19.6254 20.8773 19.4786C20.9577 19.3319 21 19.1673 21.0002 19V6.8C20.9998 6.60764 20.944 6.41948 20.8393 6.25807C20.7347 6.09667 20.5857 5.96887 20.4102 5.89ZM9.00024 6.55L11.0002 7.44V17.44L9.00024 16.55V6.55ZM19.0002 17.45L17.0002 16.56V6.56L19.0002 7.45V17.45Z"',None:""}[n];return a?`\n      <style>.a {\n        transform-origin: 25% 25%;\n        animation: 3s ease-out 0s 1 normal forwards running a;\n        animation-iteration-count: infinite;\n        opacity: 1;\n      }\n      @keyframes a {\n        0% {transform: scaleX(1) scaleY(1);opacity: 0.8;}\n        50% {opacity: 0;}\n        100% {transform: scaleX(3) scaleY(3);opacity: 0;}\n      }\n      </style>\n      \n      <defs>\n      <filter id="blur" x="0" y="0" width="24" height="24">\n      <feGaussianBlur stdDeviation="0.4"/>\n      </filter>\n      </defs>\n      \n      <path ${u} filter="url(#blur)" stroke="${r}" class='a'/>\n      <path ${u} fill="${r}" />\n      `:`<path ${u} fill="${r}" />`}update(){this.svg=this.sanitizer.bypassSecurityTrustHtml(e.getCodeForType(this.type,this.color,this.breathing))}}return e.\u0275fac=function(n){return new(n||e)(rt(Xm))},e.\u0275cmp=kr({type:e,selectors:[["app-media-icon"]],inputs:{marker:"marker",type:"type",color:"color",breathing:"breathing"},features:[mi],decls:2,vars:1,consts:[["width","48","height","48","viewBox","-12 -12 48 48","fill","none","xmlns","http://www.w3.org/2000/svg",3,"innerHtml"]],template:function(n,r){1&n&&(N(),Ze(0,"svg",0),dn(1,"\n>\n"),nt()),2&n&&jt("innerHtml",r.svg,Cd)},styles:["[_nghost-%COMP%]{display:inline-block;width:24px;height:24px;overflow:visible}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{margin-top:-12px;margin-left:-12px}"]}),e})();const t$=["timeLine"];let n$=(()=>{class e{constructor(n){this.el=n,this.minDate=new Date(1920,0,1),this.maxDate=new Date(2020,0,1),this.items=[],this.changed=new br,this.selected=new br,this.WIDTH=1e3,this.TEXT_HEIGHT=16,this.TICK_HEIGHT=48,this.CIRCLE_RADIUS=24,this.HOVER_HEIGHT=34,this.HEIGHT=this.TEXT_HEIGHT+this.TICK_HEIGHT+2*this.CIRCLE_RADIUS+this.HOVER_HEIGHT,this.RANDOM_CENTERS={},this.PRIMARY_COLOR=Mo,this.tickIndicator=0,this.firstInit=!1,this.zoomK=1,this._changed=new Qm(1),this._changeCandidates=new Wn,this.currentHover=null,this.resizeObserver=new ResizeObserver(()=>{this._changed.next()}),this._changeCandidates.pipe(qC(500)).subscribe(r=>{this.changed.next(r)})}ngOnInit(){const n=this.state.split(":");n.length>=2?(this.zoomX=new Date(parseFloat(n[0])),this.zoomK=parseFloat(n[1]),console.log("STATE",this.state,this.zoomX,this.zoomK)):console.log("timelineState empty")}ngAfterViewInit(){this.resizeObserver.observe(this.el.nativeElement),this._changed.pipe(function e$(...e){return function Qj(...e){const t=vr(e),n=mr(e,1/0);return e=function Jj(e){return 1===e.length&&Kj(e[0])?e[0]:e}(e),nr((r,a)=>{ot(n)(mt([r,...e],t)).subscribe(a)})}(...e)}(ha(0))).subscribe(()=>{this.WIDTH=this.el.nativeElement.offsetWidth,this.init()})}ngOnChanges(){this._changed.next()}init(){if(this.timeline.nativeElement.innerHTML="",this.zoomBehaviour=function t9(){var O,F,U,e=YU,t=KU,n=e9,r=JU,a=QU,u=[0,1/0],m=[[-1/0,-1/0],[1/0,1/0]],v=250,C=d8,D=MA("start","zoom","end"),G=500,Ae=0,We=10;function Pe(et){et.property("__zoom",mP).on("wheel.zoom",Zi,{passive:!1}).on("mousedown.zoom",_s).on("dblclick.zoom",As).filter(a).on("touchstart.zoom",$a).on("touchmove.zoom",Ps).on("touchend.zoom touchcancel.zoom",xl).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function dt(et,pn){return(pn=Math.max(u[0],Math.min(u[1],pn)))===et.k?et:new kh(pn,et.x,et.y)}function Ge(et,pn,St){var Cn=pn[0]-St[0]*et.k,ir=pn[1]-St[1]*et.k;return Cn===et.x&&ir===et.y?et:new kh(et.k,Cn,ir)}function Ct(et){return[(+et[0][0]+ +et[1][0])/2,(+et[0][1]+ +et[1][1])/2]}function en(et,pn,St,Cn){et.on("start.zoom",function(){Tt(this,arguments).event(Cn).start()}).on("interrupt.zoom end.zoom",function(){Tt(this,arguments).event(Cn).end()}).tween("zoom",function(){var ir=this,yr=arguments,Cr=Tt(ir,yr).event(Cn),hi=t.apply(ir,yr),Wi=null==St?Ct(hi):"function"==typeof St?St.apply(ir,yr):St,bl=Math.max(hi[1][0]-hi[0][0],hi[1][1]-hi[0][1]),Vo=ir.__zoom,Ga="function"==typeof pn?pn.apply(ir,yr):pn,fc=C(Vo.invert(Wi).concat(bl/Vo.k),Ga.invert(Wi).concat(bl/Ga.k));return function(Ha){if(1===Ha)Ha=Ga;else{var pc=fc(Ha),ln=bl/pc[2];Ha=new kh(ln,Wi[0]-pc[0]*ln,Wi[1]-pc[1]*ln)}Cr.zoom(null,Ha)}})}function Tt(et,pn,St){return!St&&et.__zooming||new Yn(et,pn)}function Yn(et,pn){this.that=et,this.args=pn,this.active=0,this.sourceEvent=null,this.extent=t.apply(et,pn),this.taps=0}function Zi(et,...pn){if(e.apply(this,arguments)){var St=Tt(this,pn).event(et),Cn=this.__zoom,ir=Math.max(u[0],Math.min(u[1],Cn.k*Math.pow(2,r.apply(this,arguments)))),yr=yp(et);if(St.wheel)(St.mouse[0][0]!==yr[0]||St.mouse[0][1]!==yr[1])&&(St.mouse[1]=Cn.invert(St.mouse[0]=yr)),clearTimeout(St.wheel);else{if(Cn.k===ir)return;St.mouse=[yr,Cn.invert(yr)],Fx(this),St.start()}Ty(et),St.wheel=setTimeout(Cr,150),St.zoom("mouse",n(Ge(dt(Cn,ir),St.mouse[0],St.mouse[1]),St.extent,m))}function Cr(){St.wheel=null,St.end()}}function _s(et,...pn){if(!U&&e.apply(this,arguments)){var St=et.currentTarget,Cn=Tt(this,pn,!0).event(et),ir=Ah(et.view).on("mousemove.zoom",Wi,!0).on("mouseup.zoom",bl,!0),yr=yp(et,St),Cr=et.clientX,hi=et.clientY;a8(et.view),uM(et),Cn.mouse=[yr,this.__zoom.invert(yr)],Fx(this),Cn.start()}function Wi(Vo){if(Ty(Vo),!Cn.moved){var Ga=Vo.clientX-Cr,fc=Vo.clientY-hi;Cn.moved=Ga*Ga+fc*fc>Ae}Cn.event(Vo).zoom("mouse",n(Ge(Cn.that.__zoom,Cn.mouse[0]=yp(Vo,St),Cn.mouse[1]),Cn.extent,m))}function bl(Vo){ir.on("mousemove.zoom mouseup.zoom",null),l8(Vo.view,Cn.moved),Ty(Vo),Cn.event(Vo).end()}}function As(et,...pn){if(e.apply(this,arguments)){var St=this.__zoom,Cn=yp(et.changedTouches?et.changedTouches[0]:et,this),ir=St.invert(Cn),Cr=n(Ge(dt(St,St.k*(et.shiftKey?.5:2)),Cn,ir),t.apply(this,pn),m);Ty(et),v>0?Ah(this).transition().duration(v).call(en,Cr,Cn,et):Ah(this).call(Pe.transform,Cr,Cn,et)}}function $a(et,...pn){if(e.apply(this,arguments)){var yr,Cr,hi,Wi,St=et.touches,Cn=St.length,ir=Tt(this,pn,et.changedTouches.length===Cn).event(et);for(uM(et),Cr=0;Cr<Cn;++Cr)Wi=[Wi=yp(hi=St[Cr],this),this.__zoom.invert(Wi),hi.identifier],ir.touch0?!ir.touch1&&ir.touch0[2]!==Wi[2]&&(ir.touch1=Wi,ir.taps=0):(ir.touch0=Wi,yr=!0,ir.taps=1+!!O);O&&(O=clearTimeout(O)),yr&&(ir.taps<2&&(F=Wi[0],O=setTimeout(function(){O=null},G)),Fx(this),ir.start())}}function Ps(et,...pn){if(this.__zooming){var yr,Cr,hi,Wi,St=Tt(this,pn).event(et),Cn=et.changedTouches,ir=Cn.length;for(Ty(et),yr=0;yr<ir;++yr)hi=yp(Cr=Cn[yr],this),St.touch0&&St.touch0[2]===Cr.identifier?St.touch0[0]=hi:St.touch1&&St.touch1[2]===Cr.identifier&&(St.touch1[0]=hi);if(Cr=St.that.__zoom,St.touch1){var bl=St.touch0[0],Vo=St.touch0[1],Ga=St.touch1[0],fc=St.touch1[1],Ha=(Ha=Ga[0]-bl[0])*Ha+(Ha=Ga[1]-bl[1])*Ha,pc=(pc=fc[0]-Vo[0])*pc+(pc=fc[1]-Vo[1])*pc;Cr=dt(Cr,Math.sqrt(Ha/pc)),hi=[(bl[0]+Ga[0])/2,(bl[1]+Ga[1])/2],Wi=[(Vo[0]+fc[0])/2,(Vo[1]+fc[1])/2]}else{if(!St.touch0)return;hi=St.touch0[0],Wi=St.touch0[1]}St.zoom("touch",n(Ge(Cr,hi,Wi),St.extent,m))}}function xl(et,...pn){if(this.__zooming){var yr,Cr,St=Tt(this,pn).event(et),Cn=et.changedTouches,ir=Cn.length;for(uM(et),U&&clearTimeout(U),U=setTimeout(function(){U=null},G),yr=0;yr<ir;++yr)Cr=Cn[yr],St.touch0&&St.touch0[2]===Cr.identifier?delete St.touch0:St.touch1&&St.touch1[2]===Cr.identifier&&delete St.touch1;if(St.touch1&&!St.touch0&&(St.touch0=St.touch1,delete St.touch1),St.touch0)St.touch0[1]=this.__zoom.invert(St.touch0[0]);else if(St.end(),2===St.taps&&(Cr=yp(Cr,this),Math.hypot(F[0]-Cr[0],F[1]-Cr[1])<We)){var hi=Ah(this).on("dblclick.zoom");hi&&hi.apply(this,arguments)}}}return Pe.transform=function(et,pn,St,Cn){var ir=et.selection?et.selection():et;ir.property("__zoom",mP),et!==ir?en(et,pn,St,Cn):ir.interrupt().each(function(){Tt(this,arguments).event(Cn).start().zoom(null,"function"==typeof pn?pn.apply(this,arguments):pn).end()})},Pe.scaleBy=function(et,pn,St,Cn){Pe.scaleTo(et,function(){return this.__zoom.k*("function"==typeof pn?pn.apply(this,arguments):pn)},St,Cn)},Pe.scaleTo=function(et,pn,St,Cn){Pe.transform(et,function(){var ir=t.apply(this,arguments),yr=this.__zoom,Cr=null==St?Ct(ir):"function"==typeof St?St.apply(this,arguments):St,hi=yr.invert(Cr),Wi="function"==typeof pn?pn.apply(this,arguments):pn;return n(Ge(dt(yr,Wi),Cr,hi),ir,m)},St,Cn)},Pe.translateBy=function(et,pn,St,Cn){Pe.transform(et,function(){return n(this.__zoom.translate("function"==typeof pn?pn.apply(this,arguments):pn,"function"==typeof St?St.apply(this,arguments):St),t.apply(this,arguments),m)},null,Cn)},Pe.translateTo=function(et,pn,St,Cn,ir){Pe.transform(et,function(){var yr=t.apply(this,arguments),Cr=this.__zoom,hi=null==Cn?Ct(yr):"function"==typeof Cn?Cn.apply(this,arguments):Cn;return n(Ey.translate(hi[0],hi[1]).scale(Cr.k).translate("function"==typeof pn?-pn.apply(this,arguments):-pn,"function"==typeof St?-St.apply(this,arguments):-St),yr,m)},Cn,ir)},Yn.prototype={event:function(et){return et&&(this.sourceEvent=et),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(et,pn){return this.mouse&&"mouse"!==et&&(this.mouse[1]=pn.invert(this.mouse[0])),this.touch0&&"touch"!==et&&(this.touch0[1]=pn.invert(this.touch0[0])),this.touch1&&"touch"!==et&&(this.touch1[1]=pn.invert(this.touch1[0])),this.that.__zoom=pn,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(et){var pn=Ah(this.that).datum();D.call(et,this.that,new WU(et,{sourceEvent:this.sourceEvent,target:Pe,type:et,transform:this.that.__zoom,dispatch:D}),pn)}},Pe.wheelDelta=function(et){return arguments.length?(r="function"==typeof et?et:Gx(+et),Pe):r},Pe.filter=function(et){return arguments.length?(e="function"==typeof et?et:Gx(!!et),Pe):e},Pe.touchable=function(et){return arguments.length?(a="function"==typeof et?et:Gx(!!et),Pe):a},Pe.extent=function(et){return arguments.length?(t="function"==typeof et?et:Gx([[+et[0][0],+et[0][1]],[+et[1][0],+et[1][1]]]),Pe):t},Pe.scaleExtent=function(et){return arguments.length?(u[0]=+et[0],u[1]=+et[1],Pe):[u[0],u[1]]},Pe.translateExtent=function(et){return arguments.length?(m[0][0]=+et[0][0],m[1][0]=+et[1][0],m[0][1]=+et[0][1],m[1][1]=+et[1][1],Pe):[[m[0][0],m[0][1]],[m[1][0],m[1][1]]]},Pe.constrain=function(et){return arguments.length?(n=et,Pe):n},Pe.duration=function(et){return arguments.length?(v=+et,Pe):v},Pe.interpolate=function(et){return arguments.length?(C=et,Pe):C},Pe.on=function(){var et=D.on.apply(D,arguments);return et===D?Pe:et},Pe.clickDistance=function(et){return arguments.length?(Ae=(et=+et)*et,Pe):Math.sqrt(Ae)},Pe.tapDistance=function(et){return arguments.length?(We=+et,Pe):We},Pe}().scaleExtent([1,1e5]).translateExtent([[0,0],[this.WIDTH,0]]).on("zoom",n=>this.onZoom(n)),this.svg=Ah(this.timeline.nativeElement).append("svg").attr("width","100%").attr("height","100%").call(this.zoomBehaviour),this.svg.append("rect").attr("transform",`translate(0, ${this.HEIGHT-this.TEXT_HEIGHT})`).attr("width",this.WIDTH).attr("height",this.TEXT_HEIGHT).attr("fill","#fff"),this.hovers=Ah(this.timeline.nativeElement).append("div").attr("class","hovers"),this.g=this.svg.append("g").attr("transform",`translate(0, ${this.HEIGHT-this.TEXT_HEIGHT})`).attr("class","axis axis--x"),this.points=this.svg.append("g").attr("class","points"),this.svg.attr("viewBox",`0 0 ${this.WIDTH} ${this.HEIGHT}`),this.x=function $j(){return Bj.apply(WP(_9,y9,Ep,EP,Wx,Zx,wP,xP,Dy,EM).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}().domain([this.minDate,this.maxDate]).range([0,this.WIDTH]),this.xt=this.x,this.xAxis=function Yj(e){return Qx(1,e)}(this.x).ticks(40).tickSizeInner(this.TICK_HEIGHT).tickFormat((n,r)=>this.tickFormat(n,r)),this.updateAxis(),this.zoomX){const n=this.x(this.zoomX)*this.zoomK;this.svg.call(this.zoomBehaviour.transform,Ey.translate(this.WIDTH/2-n,0).scale(this.zoomK))}}zoomBy(n){this.svg.transition().duration(300).ease(YP).call(this.zoomBehaviour.scaleBy,n)}scrollTo(n,r){const a=this.x(n)*this.zoomK;this.svg.transition().duration(1e3).ease(YP).call(this.zoomBehaviour.transform,Ey.translate(this.WIDTH/2-a,56).scale(this.zoomK)),r.niceTimestamp=this.tickFormat(n,-1)}clusterPoints(n){const r=(v,C)=>{if(v.length){const D=v.reduce((Ae,We)=>We.x+Ae,0)/v.length,O=v[0].timestamp,F=v[v.length-1].timestamp,U=this.x(F)-this.x(O),G=new Date((O.valueOf()+F.valueOf())/2);let me=1e4;U>0&&(me=this.WIDTH/2/U,me<1&&(me=1)),v.forEach((Ae,We)=>{Ae.x=D,Ae.centerTimestamp=G,Ae.k=me,Ae.clustered=v.length,Ae.indexes=v.map(Pe=>Pe.index),We!==v.length-1&&(this.RANDOM_CENTERS[We]||(this.RANDOM_CENTERS[We]={cx:3*Math.random(),cy:3*Math.random()}),Object.assign(Ae,this.RANDOM_CENTERS[We]))}),C.push(...v)}return[]};n.forEach(v=>{v.x=this.xt(v.timestamp),v.cx=0,v.cy=0});const a=[];let u=[],m=null;for(const v of this.items){const C=v.x;null===m||C-m<2*this.CIRCLE_RADIUS||(u=r(u,a)),u.push(v),m=C}return r(u,a),a}onPointClick(n){n.clustered>1?(this.zoomK=n.k,this.scrollTo(n.centerTimestamp,n)):(this.scrollTo(n.timestamp,n),this.selected.next(n))}iconDataUrl(n){let r=KP.getCodeForType(n.type,Mo);return r=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">${r}</svg>`,r="data:image/svg+xml;base64,"+btoa(r),r}updateHovers(n=-1){-1!==n&&(this.currentHover=n),this.hovers.selectAll(".hover").style("display",r=>r.index===this.currentHover?"flex":"none").style("transform",r=>`translate(${r.x}px, 0)`),this.updatePoints()}updatePoints(){const n=this.points.selectAll(".point");n.attr("transform",r=>`translate(${r.x}, ${this.CIRCLE_RADIUS+this.HOVER_HEIGHT})`),n.select("circle").attr("cx",r=>r.cx).attr("cy",r=>r.cy).style("fill",r=>r.indexes.indexOf(this.currentHover)>=0?Mo+"40":"#fff"),n.select("image").style("display",r=>r.clustered>1?"none":null),n.select(".cluster-size").text(r=>r.clustered).style("display",r=>1===r.clustered?"none":null)}updateAxis(){this.g.call(this.xAxis.scale(this.xt)).call(m=>m.select(".domain").remove()).call(m=>m.selectAll(".tick line").attr("y2",(v,C)=>(this.updateIndicator(v=`${v}`,C),C%2===this.tickIndicator?-this.TICK_HEIGHT:-this.TICK_HEIGHT/3))),this.g.selectAll("text").style("text-anchor","middle").attr("dy",this.TEXT_HEIGHT+this.TICK_HEIGHT);const n=this.clusterPoints(this.items);let r=this.points.selectAll(".point").data(n,m=>m.id);const a=r.enter().append("g").attr("class","point").on("click",(m,v)=>this.onPointClick(v)).on("mouseenter",(m,v)=>{null===this.currentHover&&this.updateHovers(v.index)}).on("mouseleave",(m,v)=>{v.indexes.indexOf(this.currentHover)>=0&&this.updateHovers(null)});a.append("circle").attr("r",this.CIRCLE_RADIUS-1).style("stroke",Mo).style("stroke-opacity",.25).style("fill","#fff");let u=this.hovers.selectAll(".hover").data(n,m=>m.id);u.enter().append("div").attr("class","hover").style("display","none").append("span").style("border-color",Mo).style("color",Mo).style("background",`linear-gradient(90deg, ${Mo}40, ${Mo}40), #fff`).text(m=>m.title),u.exit().remove(),a.append("image").attr("x",-this.CIRCLE_RADIUS/2).attr("y",-this.CIRCLE_RADIUS/2).attr("width",this.CIRCLE_RADIUS).attr("height",this.CIRCLE_RADIUS).attr("xlink:href",m=>this.iconDataUrl(m)),a.append("text").attr("class","cluster-size").style("fill",Mo).attr("dominant-baseline","middle").attr("text-anchor","middle"),r.exit().remove(),this.updatePoints(),this.updateHovers()}onZoom(n){this.xt=n.transform.rescaleX(this.x),this.zoomX=this.xt.invert(this.WIDTH/2),this.zoomK=n.transform.k,this._changeCandidates.next(`${this.zoomX.valueOf()}:${this.zoomK}`),this.updateAxis()}updateIndicator(n,r){0===r&&n!==this.firstTickValue&&(this.firstTickValue=n,this.tickIndicator=1-this.tickIndicator)}tickFormat(n,r){if(-1!==r&&(this.updateIndicator(`${n}`,r),r%2!==this.tickIndicator))return"";let a=this.xt.invert(this.WIDTH).getTime()-this.xt.invert(0).getTime(),u="";const v=0===n.getMinutes()&&0===n.getSeconds()&&0===n.getMilliseconds()&&0===n.getHours(),C=v&&1===n.getDate()&&0===n.getMonth();return a=a/1e3/60/60,u=a<5?v?"%Y %b %-d %H:%M:%S":"%H:%M:%S":a<168?v?"%Y %b %-d":"%-I%p":a<3600?C?"%Y %b %-d":"%b %-d":a<43830?C?"%b %Y":"%b":"%Y",`${EM(u)(n)}`}}return e.\u0275fac=function(n){return new(n||e)(rt(Xo))},e.\u0275cmp=kr({type:e,selectors:[["app-time-line"]],viewQuery:function(n,r){if(1&n&&Hs(t$,5),2&n){let a;ds(a=fs())&&(r.timeline=a.first)}},inputs:{minDate:"minDate",maxDate:"maxDate",items:"items",state:"state"},outputs:{changed:"changed",selected:"selected"},features:[mi],decls:10,vars:3,consts:[[1,"timeline"],["timeLine",""],[1,"zoom-controls"],[3,"click"],["width","25","height","24","viewBox","0 0 25 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["x","6.31055","y","11","width","12.4138","height","2","rx","1"],["x","11.4824","y","18","width","12","height","2.06897","rx","1","transform","rotate(-90 11.4824 18)"],["d","M6.31055 12C6.31055 11.4477 6.75826 11 7.31055 11H17.7243C18.2766 11 18.7243 11.4477 18.7243 12C18.7243 12.5523 18.2766 13 17.7243 13H7.31055C6.75826 13 6.31055 12.5523 6.31055 12Z"]],template:function(n,r){1&n&&(on(0,"div",0,1),Ze(2,"div",2)(3,"div",3),xn("click",function(){return r.zoomBy(2)}),N(),Ze(4,"svg",4),on(5,"rect",5)(6,"rect",6),nt()(),Z(),Ze(7,"div",3),xn("click",function(){return r.zoomBy(.5)}),N(),Ze(8,"svg",4),on(9,"path",7),nt()()()),2&n&&(Qe(5),xi("fill",r.PRIMARY_COLOR),Qe(1),xi("fill",r.PRIMARY_COLOR),Qe(3),xi("fill",r.PRIMARY_COLOR))},styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}[_nghost-%COMP%]{width:100%;background:linear-gradient(180deg,rgba(255,255,255,0) 0%,#FFF 86%);display:flex;flex-flow:row;align-items:center;position:relative;padding-bottom:4px}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]{width:100%;display:flex;flex-flow:column;justify-content:flex-end;position:relative}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .tick line{stroke:#828282}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .tick text{fill:#828282;font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:700;font-size:10;stroke:transparent}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .point{cursor:pointer}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .point text{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:800;font-size:16px}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .hovers .hover{position:absolute;top:0;left:0;display:flex;flex-flow:column;align-items:center;overflow:visible;width:0}[_nghost-%COMP%]   .timeline[_ngcontent-%COMP%]     .hovers .hover span{white-space:nowrap;border:1px solid;font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-weight:400;font-size:16px;line-height:22px;text-transform:uppercase;padding:4px 8px;border-radius:4px}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:8px;display:flex;flex-flow:column;align-items:center}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:30px;height:30px;border:1px solid #E0E0E0;background:white;cursor:pointer;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{border-radius:4px 4px 0 0}[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{border-radius:0 0 4px 4px;margin-top:-1px}@media screen and (max-width: 600px){[_nghost-%COMP%]   .zoom-controls[_ngcontent-%COMP%]{display:none}}']}),e})();const r$=["baseMapEl"],i$=["detailMapEl"],o$=["timeLine"],s$=["scroller"],a$=["baseMarkers"],l$=["detailMarkers"],c$=["description"];function u$(e,t){if(1&e){const n=Fo();Ze(0,"app-time-line",34,35),xn("changed",function(a){return ni(n),Vr(_n().timelineStateChanged(a))})("selected",function(a){return ni(n),Vr(_n().itemSelected(a))}),nt()}if(2&e){const n=_n();jt("minDate",n.minDate)("maxDate",n.maxDate)("items",n.timeline)("state",n.initialTimelineState)}}function h$(e,t){if(1&e){const n=Fo();Ze(0,"app-content-item",38),xn("activated",function(a){return ni(n),Vr(_n(2).itemActivated(a))}),nt()}if(2&e){const n=_n().$implicit,r=_n(),a=function oE(e){return Nl(function Cf(){return zn.lFrame.contextLView}(),22+e)}(12);jt("content",n)("contentType",n.type)("activeItem",r.currentItem)("parentElement",a),xi("data-id",n.id)}}function d$(e,t){if(1&e&&(Ze(0,"div",36),Jn(1,h$,1,5,"app-content-item",37),nt()),2&e){const n=_n();Ti("width",n.detailWidthPx),Qe(1),jt("ngIf",n.contentVisible)}}function f$(e,t){if(1&e){const n=Fo();Ze(0,"div",39),xn("click",function(){ni(n);const a=_n();return Vr(a.itemSelected(a.currentItem.prev))}),nt()}}function p$(e,t){if(1&e){const n=Fo();Ze(0,"div",40),xn("click",function(){ni(n);const a=_n();return Vr(a.itemSelected(a.currentItem.next))}),nt()}}function m$(e,t){if(1&e){const n=Fo();Ze(0,"div",41),xn("click",function(){ni(n);const a=_n();return Vr(a.itemSelected(a.currentItem.prev))}),on(1,"app-media-icon",18),nt()}if(2&e){const n=_n();Qe(1),jt("type",n.currentItem.prev.type)}}function g$(e,t){if(1&e){const n=Fo();Ze(0,"div",42),xn("click",function(){ni(n);const a=_n();return Vr(a.itemSelected(a.currentItem.next))}),on(1,"app-media-icon",18),nt()}if(2&e){const n=_n();Qe(1),jt("type",n.currentItem.next.type)}}const _$=function(){return{marker_style:"dark"}};function y$(e,t){if(1&e&&(nu(0),Ze(1,"div",43),on(2,"app-media-icon",44),nt(),ru()),2&e){const n=t.$implicit,r=_n();Qe(1),Ti("border-color",r.PRIMARY_COLOR),Qe(1),jt("marker",n.marker)("type",n.type)("color",r.markerColor(function OT(e,t,n){const r=Qi()+e,a=pt();return a[r]===Hn?tu(a,r,n?t.call(n):t()):function O_(e,t){return e[t]}(a,r)}(6,_$)))("breathing",n===r.currentItem)}}function v$(e,t){if(1&e&&(nu(0),Ze(1,"div",43),on(2,"app-media-icon",44),nt(),ru()),2&e){const n=t.$implicit,r=_n();Qe(1),Ti("border-color",r.PRIMARY_COLOR),Qe(1),jt("marker",n.marker)("type",n.type)("color",r.markerColor(n))("breathing",n===r.currentItem)}}let x$=(()=>{class e extends JS{constructor(n,r,a){super(n),this.mapSvc=r,this.sanitizer=a,this.maps=[],this.moveEnd=new Wn,this.initialTimelineState=null,this.currentItem={},this.selectedItemId=null,this.itemActivations=new Wn,this.mapMode="Media",this.baseWidthPx="100%",this.detailWidthPx="50%",this.changing=0,this.markers=[],this.markersTimeline=[],this.PRIMARY_COLOR=Mo,this.resizeObserver=new ResizeObserver(()=>{ha(0).subscribe(()=>{this.syncWidths()})}),this.itemActivations.pipe(cu(()=>0===this.changing),qC(1e3)).subscribe(u=>{console.log("ACTIVATED",u.title),this.itemSelected(u)}),this.moveEnded=this.moveEnd.pipe(qC(1e3))}ngOnInit(){this.initialize(this.api),this.api.data.subscribe(()=>{this.saveState(),this.updateMarkers()}),this.backdropBackground=this.sanitizer.bypassSecurityTrustStyle(`linear-gradient(180deg, ${Mo}00 10.32%, ${Mo}80 35.85%)`),console.log("CT BG",this.contentBackground)}ngAfterViewInit(){this.baseMap=new yl.Map({container:this.baseMapEl.nativeElement,style:"mapbox://styles/atlasmedliq/cl59k9bun000y14rzt3yy5ljt",minZoom:3,attributionControl:!1,logoPosition:"top-right"}),this.baseMap.addControl(new yl.AttributionControl({compact:!0}),"top-right"),this.detailMap=new yl.Map({container:this.detailMapEl.nativeElement,style:uC,minZoom:3,attributionControl:!1,logoPosition:window.innerWidth<600?"top-left":"bottom-right"}),window.innerWidth>600&&(this.baseMap.addControl(new yl.NavigationControl,"top-left"),this.detailMap.addControl(new yl.NavigationControl,"top-left")),this.detailMap.on("style.load",()=>{this.loadMapViews(),this.syncMaps(),ha(0).subscribe(()=>{console.log("RESIZE"),window.dispatchEvent(new Event("resize"))})}),this.resizeObserver.observe(this.baseMapEl.nativeElement),ha(0).subscribe(()=>{this.syncWidths(),this.updateMarkers()})}syncMaps(){this.maps=[this.baseMap,this.detailMap];for(const n of this.maps)n.on("move",()=>{if(!this.syncing){this.syncing=!0,this.lastMapState={center:n.getCenter(),zoom:n.getZoom(),pitch:n.getPitch(),bearing:n.getBearing()};const r=Object.assign({padding:n.getPadding()},this.lastMapState);for(const a of this.maps)n!==a&&a.jumpTo(r);this.syncing=!1}}),n.on("moveend",()=>{ha(1e3).subscribe(()=>{this.moveEnd.next()})})}get baseWidth(){return this.baseMapEl?.nativeElement?.offsetWidth}syncWidths(){this.baseWidthPx=this.baseWidth+"px",this.detailWidth=Math.min(this.baseWidth,Math.max(450,this.baseWidth/2)),this.detailWidthPx=this.detailWidth+"px"}getDetailWidth(){return this.detailOpen?"Map"===this.mapMode?"100%":this.detailWidthPx:"0px"}setTimeline(n){super.setTimeline(n),console.log("TIMELINE",n);const r=this.timeline[0].timestamp.valueOf(),a=this.timeline[this.timeline.length-1].timestamp.valueOf(),u=a-r;this.minDate=new Date(r-u/10),this.maxDate=new Date(a+u/10)}goto(n){console.log("GOTO",n);const r=n.split("/");if(r.length>0){if(this.initialTimelineState=r[0],r.length>1){const a=r[1].split(",").filter(u=>u.length>0);for(const u of this.api.authorsList)u.selected=!!(a.includes(u.hash)||0===a.length&&u.originalAuthor);if(this.api.updateTimeline(),r.length>2){const u=this.timeline.find(m=>m.id===r[2]);u&&ha(1e3).subscribe(()=>{this.itemSelected(u)})}}}else console.log("NO STATE"),this.initialTimelineState=""}saveState(){if(!this.zoomState)return;let n=`${this.zoomState}`;n+=`/${this.api.authorsList.filter(a=>a.selected).map(a=>a.hash).join(",")}`,this.selectedItemId&&(n+=`/${this.selectedItemId}`),this.updateLocation(n)}timelineStateChanged(n){this.zoomState=n,this.saveState()}itemActivated(n){n&&this.itemActivations.next(n)}itemSelected(n){if(console.log("SELECTING ITEM",n),!n)return this.selectedItemId=null,this.saveState(),void ha(0).pipe(ro(()=>{this.detailOpen&&this.baseMap.flyTo({center:this.selectItemMapState.center,zoom:this.selectItemMapState.zoom,bearing:this.selectItemMapState.bearing,pitch:this.selectItemMapState.pitch,padding:0}),this.detailOpen=!1}),dx(1e3)).subscribe(()=>{this.currentItem={},this.contentVisible=!1,this.updateMarkers()});this.currentItem=n,this.selectedItemId=n.id,this.saveState(),this.changing+=1,ha(0).pipe(ro(()=>{this.timeLineComponent?.scrollTo(n.timestamp,n)}),dx(0),ro(()=>{this.detailOpen||(this.mapMode="Media",this.selectItemMapState=this.lastMapState),this.detailOpen=!0,this.contentVisible=!0;this.applyMapView(n.map_view&&n.map_view.length?n.map_view[0]:n.title,this.detailMap,{speed:2}),this.updateMarkers()}),dx(100),ro(()=>{this.scrollerComponent.nativeElement.scrollLeft=(n.index+.5)*this.detailWidth,ha(1e3).subscribe(()=>{this.changing-=1})}),lu(()=>this.moveEnded)).subscribe(()=>{if(window.innerWidth>600&&this.detailOpen){const r=window.innerHeight,a=2*this.descriptionElement.nativeElement.getBoundingClientRect().top+24-r;for(const u of this.maps)u.flyTo(Object.assign({},this.lastMapState,{padding:{top:a}}))}})}markerColor(n){if(n){if("Light"===n.marker_style)return"#e0e0e0";if("Dark"===n.marker_style)return"#333333"}return Mo}updateMarkers(){this.markers.forEach(n=>{n.remove()}),this.markersTimeline=this.timeline.slice(),ha(100).subscribe(()=>{const n=[{el:this.baseMarkersElement.nativeElement,map:this.baseMap},{el:this.detailMarkersElement.nativeElement,map:this.detailMap}];this.mapViews.pipe(Bo()).subscribe(r=>{for(const a of n){const u=a.el.children;for(let m=0;m<u.length;m++){const v=u[m],C=this.timeline[m];if("None"===C.marker)continue;let D=C.title;C.map_view&&C.map_view.length&&(D=C.map_view[0]);const U=this.parseMapView(r[D]).center,G=v.cloneNode(!0);G.addEventListener("click",()=>{console.log("CLICK",C.title),this.itemSelected(C)}),G.addEventListener("mouseenter",()=>{this.timeLineComponent.updateHovers(C.index)}),G.addEventListener("mouseleave",()=>{this.timeLineComponent.updateHovers(null)}),this.markers.push(new yl.Marker(G).setLngLat(U).addTo(a.map))}}})})}toggleMapMode(){this.mapMode="Map"===this.mapMode?"Media":"Map"}mapModeColor(n){return n===this.mapMode?Mo:"#ffffffc0"}}return e.\u0275fac=function(n){return new(n||e)(rt(Yd),rt(wC),rt(Xm))},e.\u0275cmp=kr({type:e,selectors:[["app-timeline-map-h"]],viewQuery:function(n,r){if(1&n&&(Hs(r$,7),Hs(i$,7),Hs(o$,5),Hs(s$,5),Hs(a$,5),Hs(l$,5),Hs(c$,5)),2&n){let a;ds(a=fs())&&(r.baseMapEl=a.first),ds(a=fs())&&(r.detailMapEl=a.first),ds(a=fs())&&(r.timeLineComponent=a.first),ds(a=fs())&&(r.scrollerComponent=a.first),ds(a=fs())&&(r.baseMarkersElement=a.first),ds(a=fs())&&(r.detailMarkersElement=a.first),ds(a=fs())&&(r.descriptionElement=a.first)}},inputs:{id:"id",title:"title",subtitle:"subtitle",infobarTitle:"infobarTitle",infobarSubtitle:"infobarSubtitle",api:"api"},features:[Xr],decls:39,vars:42,consts:[[3,"id","title","subtitle","infobarTitle","infobarSubtitle","api"],[1,"wrapper"],[1,"base-map"],["baseMapEl",""],[3,"minDate","maxDate","items","state","changed","selected",4,"ngIf"],[1,"detail-bg"],[1,"detail"],[1,"detail-map"],["detailMapEl",""],[1,"content"],[1,"scroller"],["scroller",""],["class","scroll-card",3,"width",4,"ngFor","ngForOf"],[1,"button-close",3,"click"],[1,"description"],["description",""],[1,"backdrop"],[1,"inner"],["color","#fff",3,"type"],[1,"title"],[1,"date"],["class","arrow",3,"click",4,"ngIf"],["class","arrow rev",3,"click",4,"ngIf"],["class","arrow-icon",3,"click",4,"ngIf"],["class","arrow-icon rev",3,"click",4,"ngIf"],[1,"map-toggle",3,"click"],[1,"circle"],[1,"icons"],["marker","Media",3,"type","color"],["type","","marker","Map",3,"color"],[2,"display","none"],["baseMarkers",""],[4,"ngFor","ngForOf"],["detailMarkers",""],[3,"minDate","maxDate","items","state","changed","selected"],["timeLine",""],[1,"scroll-card"],[3,"content","contentType","activeItem","parentElement","activated",4,"ngIf"],[3,"content","contentType","activeItem","parentElement","activated"],[1,"arrow",3,"click"],[1,"arrow","rev",3,"click"],[1,"arrow-icon",3,"click"],[1,"arrow-icon","rev",3,"click"],[1,"mapmarker"],[3,"marker","type","color","breathing"]],template:function(n,r){1&n&&(Ze(0,"app-timeline-map-base",0)(1,"div",1)(2,"div",2),on(3,"div",null,3),nt(),Jn(5,u$,2,4,"app-time-line",4),Ze(6,"div",5)(7,"div",6),on(8,"div",7,8),Ze(10,"div",9)(11,"div",10,11),Jn(13,d$,2,3,"div",12),nt(),Ze(14,"div",13),xn("click",function(){return r.itemSelected(null)}),nt(),Ze(15,"div",14,15),on(17,"div",16),Ze(18,"div",17),on(19,"app-media-icon",18),Ze(20,"span",19),dn(21),nt(),Ze(22,"span",20),dn(23),nt()()(),Jn(24,f$,1,0,"div",21),Jn(25,p$,1,0,"div",22),Jn(26,m$,2,1,"div",23),Jn(27,g$,2,1,"div",24),nt(),Ze(28,"div",25),xn("click",function(){return r.toggleMapMode()}),on(29,"div",26),Ze(30,"div",27),on(31,"app-media-icon",28)(32,"app-media-icon",29),nt()()()()()(),Ze(33,"div",30,31),Jn(35,y$,3,7,"ng-container",32),nt(),Ze(36,"div",30,33),Jn(38,v$,3,6,"ng-container",32),nt()),2&n&&(jt("id",r.id)("title",r.title)("subtitle",r.subtitle)("infobarTitle",r.infobarTitle)("infobarSubtitle",r.infobarSubtitle)("api",r.api),Qe(5),jt("ngIf",null!==r.initialTimelineState),Qe(2),Ti("width",r.getDetailWidth())("border-color",r.PRIMARY_COLOR),to("open",r.detailOpen)("map-mode","Map"===r.mapMode),Qe(1),Ti("width",r.baseWidthPx),Qe(2),Ti("background-color","Map"===r.mapMode?"#00000000":r.PRIMARY_COLOR+"66"),Qe(1),Ti("width",r.detailWidthPx),Qe(2),jt("ngForOf",r.timeline),Qe(6),jt("type",r.currentItem.type),Qe(1),Ti("color","#fff"),Qe(1),bi(r.currentItem.title),Qe(1),Ti("color","#fff"),Qe(1),bi(r.currentItem.niceTimestamp),Qe(1),jt("ngIf",r.currentItem.prev),Qe(1),jt("ngIf",r.currentItem.next),Qe(1),jt("ngIf",r.currentItem.prev),Qe(1),jt("ngIf",r.currentItem.next),Qe(1),Ti("background",r.markerColor(null)),Qe(1),to("map","Map"===r.mapMode),Qe(2),jt("type",r.currentItem.type)("color",r.mapModeColor("Media")),Qe(1),jt("color",r.mapModeColor("Map")),Qe(3),jt("ngForOf",r.timeline),Qe(3),jt("ngForOf",r.timeline))},dependencies:[Uv,Va,bA,n$,fI,KP],styles:['.font-sourcecode[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-style:normal}.font-manrope[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal}.font-inter[_ngcontent-%COMP%]{font-family:Inter,sans-serif;font-style:normal}.no-scrollbars[_ngcontent-%COMP%]{scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.no-scrollbars[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.unselecteble[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}@media only screen and (max-width: 600px){  .layout-desktop{display:none!important}}@media only screen and (min-width: 601px){  .layout-mobile{display:none!important}}.wrapper[_ngcontent-%COMP%]{width:100%;height:100%;position:relative;display:block}.wrapper[_ngcontent-%COMP%]   .base-map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .base-map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]{position:absolute;z-index:2;top:0;left:0;width:100%;height:100%;pointer-events:none;display:flex;flex-flow:column;align-items:center}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]{width:0vw;transition:width .35s ease-in-out;height:100%;overflow:hidden;display:flex;flex-flow:column;align-items:center;pointer-events:all;position:relative}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .detail-map[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;display:flex;flex-flow:column;align-items:center;pointer-events:none;transition:background-color .35s ease-in-out}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-top:100px;padding-bottom:200px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{display:flex;flex-flow:row;align-items:flex-start;overflow-x:scroll;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar;width:50%;height:100%;overflow-y:hidden;overscroll-behavior:contain;scroll-behavior:smooth;scroll-snap-type:x mandatory;padding:0 450px;opacity:0;transition:opacity .35s ease-in-out}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;flex-flow:column;align-items:center;justify-content:center;scroll-snap-align:center;height:100%;overflow-y:scroll;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:-ms-autohiding-scrollbar}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{display:flex;flex-flow:column;justify-content:flex-start;align-items:center;width:100%;height:100%}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{padding:0 24px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item{width:100%;margin:100px 0 0}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item:after{content:"";flex:0 0 auto;display:block;width:100%;height:120px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]   .scroll-card[_ngcontent-%COMP%]     app-content-item app-content-video{width:100%;height:100%}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .button-close[_ngcontent-%COMP%]{pointer-events:all;width:24px;height:24px;background-image:url(detail-button-close.da2e963000196751.svg);background-repeat:no-repeat;background-size:contain;background-position:center;cursor:pointer;position:absolute;top:16px;right:16px;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out;transition-property:right}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%;transition:padding-bottom .35s ease-in-out;transition-delay:0s}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{padding-bottom:40px;padding-top:30px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{padding-bottom:10px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block;position:absolute;bottom:0;left:0;width:100%;height:100%;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);background:linear-gradient(180deg,#00000000 10.32%,#00000080 35.85%)}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:center;color:#fff;gap:5px;text-align:center;padding:0 24px;z-index:1;position:relative}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{padding-top:32px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-family:Manrope,sans-serif;font-feature-settings:"tnum" on,"lnum" on;font-style:normal;font-size:16px;line-height:22px;text-transform:uppercase;color:#e0e0e0}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-weight:400}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{pointer-events:all;width:33px;height:14px;background-image:url(arrow-next.e5fa61535aa55d94.svg);background-repeat:no-repeat;background-size:contain;background-position:center;cursor:pointer;position:absolute;z-index:1;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:48px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{bottom:20px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){transition-property:left}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:-200px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:-200px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{transition-property:right;transform:scaleX(-1)}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:-200px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:-200px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{pointer-events:all;cursor:pointer;position:absolute;height:24px;width:24px;z-index:1;transition-delay:0s;transition-duration:.35s;transition-timing-function:ease-out}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{bottom:43px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{bottom:15px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]:not(.rev){transition-property:left;left:-200px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon.rev[_ngcontent-%COMP%]{transition-property:right;right:-200px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]{position:absolute;top:16px;width:70px;height:36px;border-radius:18px;cursor:pointer;padding:2px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:16px;position:absolute;top:2px;left:2px;transition:left .35s ease-in-out;background-color:#fff}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]   .circle.map[_ngcontent-%COMP%]{left:36px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   .map-toggle[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-flow:row;align-items:center;justify-content:space-evenly;position:relative;gap:6px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{transition-delay:2s}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:40px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:not(.rev){left:16px}}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:40px}}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow.rev[_ngcontent-%COMP%]{right:16px}}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{transition-delay:2s}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]:not(.rev){left:81px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .arrow-icon.rev[_ngcontent-%COMP%]{right:81px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open.map-mode[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{width:100%;bottom:0;padding-bottom:40px;padding-top:16px}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open.map-mode[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode){border-left:1px solid;border-right:1px solid}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]{pointer-events:all}.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]   .scroller[_ngcontent-%COMP%]{opacity:1}@media only screen and (max-width: 600px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]   .backdrop[_ngcontent-%COMP%]{display:block}}@media only screen and (min-width: 601px){.wrapper[_ngcontent-%COMP%]   .detail-bg[_ngcontent-%COMP%]   .detail.open[_ngcontent-%COMP%]:not(.map-mode)   .content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{transition-delay:2s;padding-bottom:70px}}.wrapper[_ngcontent-%COMP%]   app-time-line[_ngcontent-%COMP%]{position:absolute;width:100%;bottom:0;left:0}.wrapper[_ngcontent-%COMP%]   .mapmarker[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:16px;border:1px solid;background:white;display:flex;flex-flow:column;align-items:center;justify-content:center;cursor:pointer}']}),e})();function b$(e,t){if(1&e&&on(0,"app-timeline-map",2),2&e){const n=_n();jt("api",n.timelineService)("title",n.title)("subtitle",n.subtitle)("infobarTitle",n.infobarTitle)("infobarSubtitle",n.infobarSubtitle)}}function w$(e,t){if(1&e&&on(0,"app-timeline-map-h",2),2&e){const n=_n();jt("api",n.timelineService)("title",n.title)("subtitle",n.subtitle)("infobarTitle",n.infobarTitle)("infobarSubtitle",n.infobarSubtitle)}}function C$(e,t){1&e&&on(0,"app-map-selector")}const M$=[{path:"",component:(()=>{class e{constructor(n,r,a){this.api=n,this.titleSvc=r,this.mapSelector=a,this.title=null}ngOnInit(){this.timelineService=new IN(this.api,zS),this.timelineService.ready.pipe(Bo()).subscribe(()=>{this.title=this.timelineService.TITLE||"",this.titleSvc.setTitle(this.title),this.subtitle=this.timelineService.SUBTITLE||"",this.infobarTitle=this.timelineService.INFOBAR_TITLE||"",this.infobarSubtitle=this.timelineService.INFOBAR_SUBTITLE||""}),this.timelineService.fetchData().subscribe(()=>{console.log("fetchData")})}get hLayout(){return!0}}return e.\u0275fac=function(n){return new(n||e)(rt(YS),rt(Lw),rt(bC))},e.\u0275cmp=kr({type:e,selectors:[["app-spectours"]],decls:3,vars:3,consts:[["id","Speculatron",3,"api","title","subtitle","infobarTitle","infobarSubtitle",4,"ngIf"],[4,"ngIf"],["id","Speculatron",3,"api","title","subtitle","infobarTitle","infobarSubtitle"]],template:function(n,r){1&n&&(Jn(0,b$,1,5,"app-timeline-map",0),Jn(1,w$,1,5,"app-timeline-map-h",0),Jn(2,C$,1,0,"app-map-selector",1)),2&n&&(jt("ngIf",r.title&&!r.hLayout),Qe(1),jt("ngIf",r.title&&r.hLayout),Qe(1),jt("ngIf",r.mapSelector.showMapSelector))},dependencies:[Va,w6,E6,x$],styles:["app-map-selector[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;z-index:20;background-color:#fff}"]}),e})()}];let E$=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e}),e.\u0275inj=Vi({imports:[RS.forRoot(M$),RS]}),e})(),T$=(()=>{class e{constructor(){const n=new An.Renderer,r=n.link;n.link=(a,u,m)=>{const v=a.startsWith(`${location.protocol}//${location.hostname}`),C=r.call(n,a,u,m);return v?C:C.replace(/^<a /,'<a target="_blank" rel="noreferrer noopener nofollow" ')},An.use({renderer:n})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=kr({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&on(0,"router-outlet")},dependencies:[Jw]}),e})(),D$=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ws({type:e,bootstrap:[T$]}),e.\u0275inj=Vi({imports:[qF,$N,e6,E$]}),e})();(function PL(){S2=!1})(),HF().bootstrapModule(D$).catch(e=>console.error(e))},49:function(Ft,At,Ne){var $e;Ft=Ne.nmd(Ft),function(Ue){"object"==typeof global&&global;var Te=function(vt){this.message=vt};(Te.prototype=new Error).name="InvalidCharacterError";var Me=function(vt){throw new Te(vt)},ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",De=/[\t\n\f\r ]/g,tt={encode:function(vt){vt=String(vt),/[^\0-\xFF]/.test(vt)&&Me("The string to be encoded contains characters outside of the Latin1 range.");for(var je,Le,xe,st,_t=vt.length%3,le="",Be=-1,He=vt.length-_t;++Be<He;)je=vt.charCodeAt(Be)<<16,Le=vt.charCodeAt(++Be)<<8,xe=vt.charCodeAt(++Be),le+=ce.charAt((st=je+Le+xe)>>18&63)+ce.charAt(st>>12&63)+ce.charAt(st>>6&63)+ce.charAt(63&st);return 2==_t?(je=vt.charCodeAt(Be)<<8,Le=vt.charCodeAt(++Be),le+=ce.charAt((st=je+Le)>>10)+ce.charAt(st>>4&63)+ce.charAt(st<<2&63)+"="):1==_t&&(st=vt.charCodeAt(Be),le+=ce.charAt(st>>2)+ce.charAt(st<<4&63)+"=="),le},decode:function(vt){var _t=(vt=String(vt).replace(De,"")).length;_t%4==0&&(_t=(vt=vt.replace(/==?$/,"")).length),(_t%4==1||/[^+a-zA-Z0-9/]/.test(vt))&&Me("Invalid character: the string to be decoded is not correctly encoded.");for(var Be,je,le=0,Le="",xe=-1;++xe<_t;)je=ce.indexOf(vt.charAt(xe)),Be=le%4?64*Be+je:je,le++%4&&(Le+=String.fromCharCode(255&Be>>(-2*le&6)));return Le},version:"0.1.0"};void 0!==($e=function(){return tt}.call(At,Ne,At,Ft))&&(Ft.exports=$e)}()},764:function(Ft){Ft.exports=function(){"use strict";var Ue="millisecond",be="second",d="minute",W="hour",Te="day",Me="week",ce="month",De="quarter",lt="year",$t="date",tt="Invalid Date",Mt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,vt=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_t={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},le=function(Wt,It,Pt){var nn=String(Wt);return!nn||nn.length>=It?Wt:""+Array(It+1-nn.length).join(Pt)+Wt},Be={s:le,z:function(Wt){var It=-Wt.utcOffset(),Pt=Math.abs(It),nn=Math.floor(Pt/60),Rt=Pt%60;return(It<=0?"+":"-")+le(nn,2,"0")+":"+le(Rt,2,"0")},m:function Wt(It,Pt){if(It.date()<Pt.date())return-Wt(Pt,It);var nn=12*(Pt.year()-It.year())+(Pt.month()-It.month()),Rt=It.clone().add(nn,ce),mn=Pt-Rt<0,yn=It.clone().add(nn+(mn?-1:1),ce);return+(-(nn+(Pt-Rt)/(mn?Rt-yn:yn-Rt))||0)},a:function(Wt){return Wt<0?Math.ceil(Wt)||0:Math.floor(Wt)},p:function(Wt){return{M:ce,y:lt,w:Me,d:Te,D:$t,h:W,m:d,s:be,ms:Ue,Q:De}[Wt]||String(Wt||"").toLowerCase().replace(/s$/,"")},u:function(Wt){return void 0===Wt}},je="en",Le={};Le[je]=_t;var xe=function(Wt){return Wt instanceof zt},Xe=function Wt(It,Pt,nn){var Rt;if(!It)return je;if("string"==typeof It){var mn=It.toLowerCase();Le[mn]&&(Rt=mn),Pt&&(Le[mn]=Pt,Rt=mn);var yn=It.split("-");if(!Rt&&yn.length>1)return Wt(yn[0])}else{var Jt=It.name;Le[Jt]=It,Rt=Jt}return!nn&&Rt&&(je=Rt),Rt||!nn&&je},st=function(Wt,It){if(xe(Wt))return Wt.clone();var Pt="object"==typeof It?It:{};return Pt.date=Wt,Pt.args=arguments,new zt(Pt)},He=Be;He.l=Xe,He.i=xe,He.w=function(Wt,It){return st(Wt,{locale:It.$L,utc:It.$u,x:It.$x,$offset:It.$offset})};var zt=function(){function Wt(Pt){this.$L=Xe(Pt.locale,null,!0),this.parse(Pt)}var It=Wt.prototype;return It.parse=function(Pt){this.$d=function(nn){var Rt=nn.date,mn=nn.utc;if(null===Rt)return new Date(NaN);if(He.u(Rt))return new Date;if(Rt instanceof Date)return new Date(Rt);if("string"==typeof Rt&&!/Z$/i.test(Rt)){var yn=Rt.match(Mt);if(yn){var Jt=yn[2]-1||0,Lr=(yn[7]||"0").substring(0,3);return mn?new Date(Date.UTC(yn[1],Jt,yn[3]||1,yn[4]||0,yn[5]||0,yn[6]||0,Lr)):new Date(yn[1],Jt,yn[3]||1,yn[4]||0,yn[5]||0,yn[6]||0,Lr)}}return new Date(Rt)}(Pt),this.$x=Pt.x||{},this.init()},It.init=function(){var Pt=this.$d;this.$y=Pt.getFullYear(),this.$M=Pt.getMonth(),this.$D=Pt.getDate(),this.$W=Pt.getDay(),this.$H=Pt.getHours(),this.$m=Pt.getMinutes(),this.$s=Pt.getSeconds(),this.$ms=Pt.getMilliseconds()},It.$utils=function(){return He},It.isValid=function(){return this.$d.toString()!==tt},It.isSame=function(Pt,nn){var Rt=st(Pt);return this.startOf(nn)<=Rt&&Rt<=this.endOf(nn)},It.isAfter=function(Pt,nn){return st(Pt)<this.startOf(nn)},It.isBefore=function(Pt,nn){return this.endOf(nn)<st(Pt)},It.$g=function(Pt,nn,Rt){return He.u(Pt)?this[nn]:this.set(Rt,Pt)},It.unix=function(){return Math.floor(this.valueOf()/1e3)},It.valueOf=function(){return this.$d.getTime()},It.startOf=function(Pt,nn){var Rt=this,mn=!!He.u(nn)||nn,yn=He.p(Pt),Jt=function(nr,cn){var Gr=He.w(Rt.$u?Date.UTC(Rt.$y,cn,nr):new Date(Rt.$y,cn,nr),Rt);return mn?Gr:Gr.endOf(Te)},Lr=function(nr,cn){return He.w(Rt.toDate()[nr].apply(Rt.toDate("s"),(mn?[0,0,0,0]:[23,59,59,999]).slice(cn)),Rt)},On=this.$W,lr=this.$M,di=this.$D,Wn="set"+(this.$u?"UTC":"");switch(yn){case lt:return mn?Jt(1,0):Jt(31,11);case ce:return mn?Jt(1,lr):Jt(0,lr+1);case Me:var Xi=this.$locale().weekStart||0,Yi=(On<Xi?On+7:On)-Xi;return Jt(mn?di-Yi:di+(6-Yi),lr);case Te:case $t:return Lr(Wn+"Hours",0);case W:return Lr(Wn+"Minutes",1);case d:return Lr(Wn+"Seconds",2);case be:return Lr(Wn+"Milliseconds",3);default:return this.clone()}},It.endOf=function(Pt){return this.startOf(Pt,!1)},It.$set=function(Pt,nn){var Rt,mn=He.p(Pt),yn="set"+(this.$u?"UTC":""),Jt=(Rt={},Rt[Te]=yn+"Date",Rt[$t]=yn+"Date",Rt[ce]=yn+"Month",Rt[lt]=yn+"FullYear",Rt[W]=yn+"Hours",Rt[d]=yn+"Minutes",Rt[be]=yn+"Seconds",Rt[Ue]=yn+"Milliseconds",Rt)[mn],Lr=mn===Te?this.$D+(nn-this.$W):nn;if(mn===ce||mn===lt){var On=this.clone().set($t,1);On.$d[Jt](Lr),On.init(),this.$d=On.set($t,Math.min(this.$D,On.daysInMonth())).$d}else Jt&&this.$d[Jt](Lr);return this.init(),this},It.set=function(Pt,nn){return this.clone().$set(Pt,nn)},It.get=function(Pt){return this[He.p(Pt)]()},It.add=function(Pt,nn){var Rt,mn=this;Pt=Number(Pt);var yn=He.p(nn),Jt=function(lr){var di=st(mn);return He.w(di.date(di.date()+Math.round(lr*Pt)),mn)};if(yn===ce)return this.set(ce,this.$M+Pt);if(yn===lt)return this.set(lt,this.$y+Pt);if(yn===Te)return Jt(1);if(yn===Me)return Jt(7);var Lr=(Rt={},Rt[d]=6e4,Rt[W]=36e5,Rt[be]=1e3,Rt)[yn]||1,On=this.$d.getTime()+Pt*Lr;return He.w(On,this)},It.subtract=function(Pt,nn){return this.add(-1*Pt,nn)},It.format=function(Pt){var nn=this,Rt=this.$locale();if(!this.isValid())return Rt.invalidDate||tt;var mn=Pt||"YYYY-MM-DDTHH:mm:ssZ",yn=He.z(this),Jt=this.$H,Lr=this.$m,On=this.$M,lr=Rt.weekdays,di=Rt.months,Wn=function(cn,Gr,Mn,io){return cn&&(cn[Gr]||cn(nn,mn))||Mn[Gr].slice(0,io)},Xi=function(cn){return He.s(Jt%12||12,cn,"0")},Yi=Rt.meridiem||function(cn,Gr,Mn){var io=cn<12?"AM":"PM";return Mn?io.toLowerCase():io},nr={YY:String(this.$y).slice(-2),YYYY:this.$y,M:On+1,MM:He.s(On+1,2,"0"),MMM:Wn(Rt.monthsShort,On,di,3),MMMM:Wn(di,On),D:this.$D,DD:He.s(this.$D,2,"0"),d:String(this.$W),dd:Wn(Rt.weekdaysMin,this.$W,lr,2),ddd:Wn(Rt.weekdaysShort,this.$W,lr,3),dddd:lr[this.$W],H:String(Jt),HH:He.s(Jt,2,"0"),h:Xi(1),hh:Xi(2),a:Yi(Jt,Lr,!0),A:Yi(Jt,Lr,!1),m:String(Lr),mm:He.s(Lr,2,"0"),s:String(this.$s),ss:He.s(this.$s,2,"0"),SSS:He.s(this.$ms,3,"0"),Z:yn};return mn.replace(vt,function(cn,Gr){return Gr||nr[cn]||yn.replace(":","")})},It.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},It.diff=function(Pt,nn,Rt){var mn,yn=He.p(nn),Jt=st(Pt),Lr=6e4*(Jt.utcOffset()-this.utcOffset()),On=this-Jt,lr=He.m(this,Jt);return lr=(mn={},mn[lt]=lr/12,mn[ce]=lr,mn[De]=lr/3,mn[Me]=(On-Lr)/6048e5,mn[Te]=(On-Lr)/864e5,mn[W]=On/36e5,mn[d]=On/6e4,mn[be]=On/1e3,mn)[yn]||On,Rt?lr:He.a(lr)},It.daysInMonth=function(){return this.endOf(ce).$D},It.$locale=function(){return Le[this.$L]},It.locale=function(Pt,nn){if(!Pt)return this.$L;var Rt=this.clone(),mn=Xe(Pt,nn,!0);return mn&&(Rt.$L=mn),Rt},It.clone=function(){return He.w(this.$d,this)},It.toDate=function(){return new Date(this.valueOf())},It.toJSON=function(){return this.isValid()?this.toISOString():null},It.toISOString=function(){return this.$d.toISOString()},It.toString=function(){return this.$d.toUTCString()},Wt}(),tn=zt.prototype;return st.prototype=tn,[["$ms",Ue],["$s",be],["$m",d],["$H",W],["$W",Te],["$M",ce],["$y",lt],["$D",$t]].forEach(function(Wt){tn[Wt[1]]=function(It){return this.$g(It,Wt[0],Wt[1])}}),st.extend=function(Wt,It){return Wt.$i||(Wt(It,zt,st),Wt.$i=!0),st},st.locale=Xe,st.isDayjs=xe,st.unix=function(Wt){return st(1e3*Wt)},st.en=Le[je],st.Ls=Le,st.p={},st}()},69:Ft=>{"use strict";var $e,At="object"==typeof Reflect?Reflect:null,Ne=At&&"function"==typeof At.apply?At.apply:function(xe,Xe,st){return Function.prototype.apply.call(xe,Xe,st)};$e=At&&"function"==typeof At.ownKeys?At.ownKeys:Object.getOwnPropertySymbols?function(xe){return Object.getOwnPropertyNames(xe).concat(Object.getOwnPropertySymbols(xe))}:function(xe){return Object.getOwnPropertyNames(xe)};var be=Number.isNaN||function(xe){return xe!=xe};function d(){d.init.call(this)}Ft.exports=d,Ft.exports.once=function le(Le,xe){return new Promise(function(Xe,st){function He(tn){Le.removeListener(xe,zt),st(tn)}function zt(){"function"==typeof Le.removeListener&&Le.removeListener("error",He),Xe([].slice.call(arguments))}je(Le,xe,zt,{once:!0}),"error"!==xe&&function Be(Le,xe,Xe){"function"==typeof Le.on&&je(Le,"error",xe,Xe)}(Le,He,{once:!0})})},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var W=10;function Te(Le){if("function"!=typeof Le)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Le)}function Me(Le){return void 0===Le._maxListeners?d.defaultMaxListeners:Le._maxListeners}function ce(Le,xe,Xe,st){var He,zt,tn;if(Te(Xe),void 0===(zt=Le._events)?(zt=Le._events=Object.create(null),Le._eventsCount=0):(void 0!==zt.newListener&&(Le.emit("newListener",xe,Xe.listener?Xe.listener:Xe),zt=Le._events),tn=zt[xe]),void 0===tn)tn=zt[xe]=Xe,++Le._eventsCount;else if("function"==typeof tn?tn=zt[xe]=st?[Xe,tn]:[tn,Xe]:st?tn.unshift(Xe):tn.push(Xe),(He=Me(Le))>0&&tn.length>He&&!tn.warned){tn.warned=!0;var Wt=new Error("Possible EventEmitter memory leak detected. "+tn.length+" "+String(xe)+" listeners added. Use emitter.setMaxListeners() to increase limit");Wt.name="MaxListenersExceededWarning",Wt.emitter=Le,Wt.type=xe,Wt.count=tn.length,function Ue(Le){console&&console.warn&&console.warn(Le)}(Wt)}return Le}function De(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function lt(Le,xe,Xe){var st={fired:!1,wrapFn:void 0,target:Le,type:xe,listener:Xe},He=De.bind(st);return He.listener=Xe,st.wrapFn=He,He}function $t(Le,xe,Xe){var st=Le._events;if(void 0===st)return[];var He=st[xe];return void 0===He?[]:"function"==typeof He?Xe?[He.listener||He]:[He]:Xe?function _t(Le){for(var xe=new Array(Le.length),Xe=0;Xe<xe.length;++Xe)xe[Xe]=Le[Xe].listener||Le[Xe];return xe}(He):Mt(He,He.length)}function tt(Le){var xe=this._events;if(void 0!==xe){var Xe=xe[Le];if("function"==typeof Xe)return 1;if(void 0!==Xe)return Xe.length}return 0}function Mt(Le,xe){for(var Xe=new Array(xe),st=0;st<xe;++st)Xe[st]=Le[st];return Xe}function je(Le,xe,Xe,st){if("function"==typeof Le.on)st.once?Le.once(xe,Xe):Le.on(xe,Xe);else{if("function"!=typeof Le.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Le);Le.addEventListener(xe,function He(zt){st.once&&Le.removeEventListener(xe,He),Xe(zt)})}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return W},set:function(Le){if("number"!=typeof Le||Le<0||be(Le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Le+".");W=Le}}),d.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(xe){if("number"!=typeof xe||xe<0||be(xe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+xe+".");return this._maxListeners=xe,this},d.prototype.getMaxListeners=function(){return Me(this)},d.prototype.emit=function(xe){for(var Xe=[],st=1;st<arguments.length;st++)Xe.push(arguments[st]);var He="error"===xe,zt=this._events;if(void 0!==zt)He=He&&void 0===zt.error;else if(!He)return!1;if(He){var tn;if(Xe.length>0&&(tn=Xe[0]),tn instanceof Error)throw tn;var Wt=new Error("Unhandled error."+(tn?" ("+tn.message+")":""));throw Wt.context=tn,Wt}var It=zt[xe];if(void 0===It)return!1;if("function"==typeof It)Ne(It,this,Xe);else{var Pt=It.length,nn=Mt(It,Pt);for(st=0;st<Pt;++st)Ne(nn[st],this,Xe)}return!0},d.prototype.on=d.prototype.addListener=function(xe,Xe){return ce(this,xe,Xe,!1)},d.prototype.prependListener=function(xe,Xe){return ce(this,xe,Xe,!0)},d.prototype.once=function(xe,Xe){return Te(Xe),this.on(xe,lt(this,xe,Xe)),this},d.prototype.prependOnceListener=function(xe,Xe){return Te(Xe),this.prependListener(xe,lt(this,xe,Xe)),this},d.prototype.off=d.prototype.removeListener=function(xe,Xe){var st,He,zt,tn,Wt;if(Te(Xe),void 0===(He=this._events))return this;if(void 0===(st=He[xe]))return this;if(st===Xe||st.listener===Xe)0==--this._eventsCount?this._events=Object.create(null):(delete He[xe],He.removeListener&&this.emit("removeListener",xe,st.listener||Xe));else if("function"!=typeof st){for(zt=-1,tn=st.length-1;tn>=0;tn--)if(st[tn]===Xe||st[tn].listener===Xe){Wt=st[tn].listener,zt=tn;break}if(zt<0)return this;0===zt?st.shift():function vt(Le,xe){for(;xe+1<Le.length;xe++)Le[xe]=Le[xe+1];Le.pop()}(st,zt),1===st.length&&(He[xe]=st[0]),void 0!==He.removeListener&&this.emit("removeListener",xe,Wt||Xe)}return this},d.prototype.removeAllListeners=function(xe){var Xe,st,He;if(void 0===(st=this._events))return this;if(void 0===st.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==st[xe]&&(0==--this._eventsCount?this._events=Object.create(null):delete st[xe]),this;if(0===arguments.length){var tn,zt=Object.keys(st);for(He=0;He<zt.length;++He)"removeListener"!==(tn=zt[He])&&this.removeAllListeners(tn);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(Xe=st[xe]))this.removeListener(xe,Xe);else if(void 0!==Xe)for(He=Xe.length-1;He>=0;He--)this.removeListener(xe,Xe[He]);return this},d.prototype.listeners=function(xe){return $t(this,xe,!0)},d.prototype.rawListeners=function(xe){return $t(this,xe,!1)},d.listenerCount=function(Le,xe){return"function"==typeof Le.listenerCount?Le.listenerCount(xe):tt.call(Le,xe)},d.prototype.listenerCount=tt,d.prototype.eventNames=function(){return this._eventsCount>0?$e(this._events):[]}},780:Ft=>{var Ne;Ft.exports=Ne={},Ne.simpleFilter=function($e,Ue){return Ue.filter(function(be){return Ne.test($e,be)})},Ne.test=function($e,Ue){return null!==Ne.match($e,Ue)},Ne.match=function($e,Ue,be){var tt,d=0,W=[],Te=Ue.length,Me=0,ce=0,De=(be=be||{}).pre||"",lt=be.post||"",$t=be.caseSensitive&&Ue||Ue.toLowerCase();$e=be.caseSensitive&&$e||$e.toLowerCase();for(var Mt=0;Mt<Te;Mt++)tt=Ue[Mt],$t[Mt]===$e[d]?(tt=De+tt+lt,d+=1,ce+=1+ce):ce=0,Me+=ce,W[W.length]=tt;return d===$e.length?(Me=$t===$e?1/0:Me,{rendered:W.join(""),score:Me}):null},Ne.filter=function($e,Ue,be){return Ue&&0!==Ue.length?"string"!=typeof $e?Ue:(be=be||{},Ue.reduce(function(d,W,Te,Me){var ce=W;be.extract&&(ce=be.extract(W));var De=Ne.match($e,ce,be);return null!=De&&(d[d.length]={string:De.rendered,score:De.score,index:Te,original:W}),d},[]).sort(function(d,W){return W.score-d.score||d.index-W.index})):[]}},82:Ft=>{var Ue=/^\s+|\s+$/g,be=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,W=/^0o[0-7]+$/i,Te=parseInt,Me="object"==typeof global&&global&&global.Object===Object&&global,ce="object"==typeof self&&self&&self.Object===Object&&self,De=Me||ce||Function("return this")(),$t=Object.prototype.toString,tt=Math.max,Mt=Math.min,vt=function(){return De.Date.now()};function le(xe){var Xe=typeof xe;return!!xe&&("object"==Xe||"function"==Xe)}function Le(xe){if("number"==typeof xe)return xe;if(function je(xe){return"symbol"==typeof xe||function Be(xe){return!!xe&&"object"==typeof xe}(xe)&&"[object Symbol]"==$t.call(xe)}(xe))return NaN;if(le(xe)){var Xe="function"==typeof xe.valueOf?xe.valueOf():xe;xe=le(Xe)?Xe+"":Xe}if("string"!=typeof xe)return 0===xe?xe:+xe;xe=xe.replace(Ue,"");var st=d.test(xe);return st||W.test(xe)?Te(xe.slice(2),st?2:8):be.test(xe)?NaN:+xe}Ft.exports=function _t(xe,Xe,st){var He,zt,tn,Wt,It,Pt,nn=0,Rt=!1,mn=!1,yn=!0;if("function"!=typeof xe)throw new TypeError("Expected a function");function Jt(cn){var Gr=He,Mn=zt;return He=zt=void 0,nn=cn,Wt=xe.apply(Mn,Gr)}function Lr(cn){return nn=cn,It=setTimeout(di,Xe),Rt?Jt(cn):Wt}function lr(cn){var Gr=cn-Pt;return void 0===Pt||Gr>=Xe||Gr<0||mn&&cn-nn>=tn}function di(){var cn=vt();if(lr(cn))return Wn(cn);It=setTimeout(di,function On(cn){var io=Xe-(cn-Pt);return mn?Mt(io,tn-(cn-nn)):io}(cn))}function Wn(cn){return It=void 0,yn&&He?Jt(cn):(He=zt=void 0,Wt)}function nr(){var cn=vt(),Gr=lr(cn);if(He=arguments,zt=this,Pt=cn,Gr){if(void 0===It)return Lr(Pt);if(mn)return It=setTimeout(di,Xe),Jt(Pt)}return void 0===It&&(It=setTimeout(di,Xe)),Wt}return Xe=Le(Xe)||0,le(st)&&(Rt=!!st.leading,tn=(mn="maxWait"in st)?tt(Le(st.maxWait)||0,Xe):tn,yn="trailing"in st?!!st.trailing:yn),nr.cancel=function Xi(){void 0!==It&&clearTimeout(It),nn=0,He=Pt=zt=It=void 0},nr.flush=function Yi(){return void 0===It?Wt:Wn(vt())},nr}},898:function(Ft){Ft.exports=function(){"use strict";var At,Ne,$e;function Ue(d,W){if(At)if(Ne){var Te="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+At+")(sharedChunk); ("+Ne+")(sharedChunk); self.onerror = null;",Me={};At(Me),$e=W(Me),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&($e.workerUrl=window.URL.createObjectURL(new Blob([Te],{type:"text/javascript"})))}else Ne=W;else At=W}return Ue(0,function(d){var W=typeof self<"u"?self:{},Te=Me;function Me(s,i,l,c){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=c,this.p2x=l,this.p2y=c}Me.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},Me.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},Me.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},Me.prototype.solveCurveX=function(s,i){var l,c,f,g,y;for(void 0===i&&(i=1e-6),f=s,y=0;y<8;y++){if(g=this.sampleCurveX(f)-s,Math.abs(g)<i)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=g/b}if((f=s)<(l=0))return l;if(f>(c=1))return c;for(;l<c;){if(g=this.sampleCurveX(f),Math.abs(g-s)<i)return f;s>g?l=f:c=f,f=.5*(c-l)+l}return f},Me.prototype.solve=function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))};var ce=De;function De(s,i){this.x=s,this.y=i}De.prototype={clone:function(){return new De(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),c=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=c,this},_rotateAround:function(s,i){var l=Math.cos(s),c=Math.sin(s),f=i.y+c*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-c*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},De.convert=function(s){return s instanceof De?s:Array.isArray(s)?new De(s[0],s[1]):s};const lt=Math.PI/180,$t=180/Math.PI;function tt(s){return s*lt}function Mt(s){return s*$t}const vt=[[0,0],[1,0],[1,1],[0,1]];function _t(s){if(s<=0)return 0;if(s>=1)return 1;const i=s*s,l=i*s;return 4*(s<.5?l:3*(s-i)+l-.75)}function le(s,i,l,c){const f=new Te(s,i,l,c);return function(g){return f.solve(g)}}const Be=le(.25,.1,.25,1);function je(s,i,l){return Math.min(l,Math.max(i,s))}function Le(s,i,l){return(l=je((l-s)/(i-s),0,1))*l*(3-2*l)}function xe(s,i,l){const c=l-i,f=((s-i)%c+c)%c+i;return f===i?l:f}function Xe(s,i,l){if(!s.length)return l(null,[]);let c=s.length;const f=new Array(s.length);let g=null;s.forEach((y,b)=>{i(y,(M,E)=>{M&&(g=M),f[b]=E,0==--c&&l(g,f)})})}function st(s){const i=[];for(const l in s)i.push(s[l]);return i}function He(s,...i){for(const l of i)for(const c in l)s[c]=l[c];return s}let zt=1;function tn(){return zt++}function Wt(){return function s(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function It(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Pt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function nn(s,i){s.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function Rt(s,i){return-1!==s.indexOf(i,s.length-i.length)}function mn(s,i,l){const c={};for(const f in s)c[f]=i.call(l||this,s[f],f,s);return c}function yn(s,i,l){const c={};for(const f in s)i.call(l||this,s[f],f,s)&&(c[f]=s[f]);return c}function Jt(s){return Array.isArray(s)?s.map(Jt):"object"==typeof s&&s?mn(s,Jt):s}const Lr={};function On(s){Lr[s]||(typeof console<"u"&&console.warn(s),Lr[s]=!0)}function lr(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function di(s){let i=0;for(let l,c,f=0,g=s.length,y=g-1;f<g;y=f++)l=s[f],c=s[y],i+=(c.x-l.x)*(l.y+c.y);return i}function Wn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xi(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,c,f,g)=>{const y=f||g;return i[c]=!y||y.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let Yi=null;function nr(s){if(null==Yi){const i=s.navigator?s.navigator.userAgent:null;Yi=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Yi}function cn(s){try{const i=W[s];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function Gr(s,i){return[s[4*i],s[4*i+1],s[4*i+2],s[4*i+3]]}const Mn=W.performance;function io(s){const i=s?s.url.toString():void 0;return Mn.getEntriesByName(i)}let rr,Wa,gc,pa;const Os={now:()=>void 0!==gc?gc:W.performance.now(),setNow(s){gc=s},restoreNow(){gc=void 0},frame(s){const i=W.requestAnimationFrame(s);return{cancel:()=>W.cancelAnimationFrame(i)}},getImageData(s,i=0){const{width:l,height:c}=s;pa||(pa=W.document.createElement("canvas"));const f=pa.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(l>pa.width||c>pa.height)&&(pa.width=l,pa.height=c),f.clearRect(-i,-i,l+2*i,c+2*i),f.drawImage(s,0,0,l,c),f.getImageData(-i,-i,l+2*i,c+2*i)},resolveURL:s=>(rr||(rr=W.document.createElement("a")),rr.href=s,rr.href),get devicePixelRatio(){return W.devicePixelRatio},get prefersReducedMotion(){return!!W.matchMedia&&(null==Wa&&(Wa=W.matchMedia("(prefers-reduced-motion: reduce)")),Wa.matches)}};let _c;const or={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==_c){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{_c=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{_c=s}}return _c},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ma={supported:!1,testSupport:function(s){!wl&&Ws&&(mu?Fh(s):Xa=s)}};let Xa,Ws,wl=!1,mu=!1;function Fh(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Ws),s.isContextLost())return;ma.supported=!0}catch{}s.deleteTexture(i),wl=!0}W.document&&(Ws=W.document.createElement("img"),Ws.onload=function(){Xa&&Fh(Xa),Xa=null,mu=!0},Ws.onerror=function(){wl=!0,Xa=null},Ws.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zh="01",Ni="NO_ACCESS_TOKEN";function Xs(s){return 0===s.indexOf("mapbox:")}function yc(s){return or.API_URL_REGEX.test(s)}const Nh=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ys(s){const i=s.match(Nh);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ga(s){const i=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${i}`}function nf(s){if(!s)return null;const i=s.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(W.atob(i[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Bh{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=nf(or.ACCESS_TOKEN);let c="";return c=l&&l.u?W.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(Number("0x"+g)))):or.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const i=cn("localStorage"),l=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const f=W.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const g=W.localStorage.getItem(c);g&&(this.anonId=g)}catch{On("Unable to read from LocalStorage")}}saveEventData(){const i=cn("localStorage"),l=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{W.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&W.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{On("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,c,f){if(!or.EVENTS_URL)return;const g=ys(or.EVENTS_URL);g.params.push(`access_token=${f||or.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.1",skuId:zh,userId:this.anonId},b=l?He(y,l):y,M={url:ga(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=Se(M,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(f)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const Vh=new class extends Bh{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,i){or.EVENTS_URL&&or.ACCESS_TOKEN&&Array.isArray(s)&&s.some(l=>Xs(l)||yc(l))&&this.queueRequest(Date.now(),i)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=nf(or.ACCESS_TOKEN),l=i?i.u:or.ACCESS_TOKEN;let c=l!==this.eventData.tokenU;Pt(this.anonId)||(this.anonId=Wt(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(f),b=(f-this.eventData.lastSuccess)/864e5;c=c||b>=1||b<-1||g.getDate()!==y.getDate()}else c=!0;c?this.postEvent(f,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},s):this.processRequests()}},Uh=Vh.postTurnstileEvent.bind(Vh),jh=new class extends Bh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,i,l,c){this.skuToken=i,this.errorCb=c,or.EVENTS_URL&&(l||or.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(Ni)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Pt(this.anonId)||(this.anonId=Wt()),this.postEvent(l,{skuToken:this.skuToken},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},s))}},vc=jh.postMapLoadEvent.bind(jh),gu=new class extends Bh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,i,l,c){if(!or.API_URL||!or.SESSION_PATH)return;const f=ys(or.API_URL+or.SESSION_PATH);f.params.push(`sku=${i||""}`),f.params.push(`access_token=${c||or.ACCESS_TOKEN||""}`);const g={url:ga(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=it(g,y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(s,i,l,c){this.skuToken=i,this.errorCb=c,or.SESSION_PATH&&or.API_URL&&(l||or.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},l):this.errorCb(new Error(Ni)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},s)}},$h=gu.getSessionAPI.bind(gu),_a=new Set;let Ys,xc=500,_u=50,To={};function bc(s){const i=B(s);let l,c;i&&i.forEach(g=>{const y=g.split("=");"language"===y[0]?l=y[1]:"worldview"===y[0]&&(c=y[1])});let f="mapbox-tiles";return l&&(f+=`-${l}`),c&&(f+=`-${c}`),f}function te(s){W.caches&&!To[s]&&(To[s]=W.caches.open(s))}function B(s){const i=s.indexOf("?");return i>0?s.slice(i+1).split("&"):[]}function $(s){const i=s.indexOf("?");if(i<0)return s;const l=B(s).filter(c=>{const f=c.split("=");return"language"===f[0]||"worldview"===f[0]});return l.length?`${s.slice(0,i)}?${l.join("&")}`:s.slice(0,i)}let ee=1/0;const se={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(se);class ge extends Error{constructor(i,l,c){401===l&&yc(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ee=Wn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===W.location.protocol?W.parent:W).location.href,Ce=function(s,i){if(!(/^file:/.test(l=s.url)||/^file:/.test(Ee())&&!/^\w+:/.test(l))){if(W.fetch&&W.Request&&W.AbortController&&W.Request.prototype.hasOwnProperty("signal"))return function(c,f){const g=new W.AbortController,y=new W.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ee(),signal:g.signal});let b=!1,M=!1;const E=(I=y.url).indexOf("sku=")>0&&yc(I);var I;"json"===c.type&&y.headers.set("Accept","application/json");const P=(z,V,j)=>{if(M)return;if(z&&"SecurityError"!==z.message&&On(z),V&&j)return k(V);const J=Date.now();W.fetch(y).then(re=>{if(re.ok){const de=E?re.clone():null;return k(re,de,J)}return f(new ge(re.statusText,re.status,c.url))}).catch(re=>{20!==re.code&&f(new Error(re.message))})},k=(z,V,j)=>{("arrayBuffer"===c.type?z.arrayBuffer():"json"===c.type?z.json():z.text()).then(J=>{M||(V&&j&&function(re,de,he){const pe=bc(re.url);if(te(pe),!To[pe])return;const _e={status:de.status,statusText:de.statusText,headers:new W.Headers};de.headers.forEach((ze,Je)=>_e.headers.set(Je,ze));const ve=Xi(de.headers.get("Cache-Control")||"");if(ve["no-store"])return;ve["max-age"]&&_e.headers.set("Expires",new Date(he+1e3*ve["max-age"]).toUTCString());const Fe=_e.headers.get("Expires");Fe&&(new Date(Fe).getTime()-he<42e4||function(ze,Je){if(void 0===Ys)try{new Response(new ReadableStream),Ys=!0}catch{Ys=!1}Ys?Je(ze.body):ze.blob().then(Je)}(de,ze=>{const Je=new W.Response(ze,_e);te(pe),To[pe]&&To[pe].then(ct=>ct.put($(re.url),Je)).catch(ct=>On(ct.message))}))}(y,V,j),b=!0,f(null,J,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(J=>{M||f(new Error(J.message))})};return E?function(z,V){const j=bc(z.url);if(te(j),!To[j])return V(null);const J=$(z.url);To[j].then(re=>{re.match(J).then(de=>{const he=function(pe){if(!pe)return!1;const _e=new Date(pe.headers.get("Expires")||0),ve=Xi(pe.headers.get("Cache-Control")||"");return _e>Date.now()&&!ve["no-cache"]}(de);re.delete(J),he&&re.put(J,de.clone()),V(null,de,he)}).catch(V)}).catch(V)}(y,P):P(null,null),{cancel:()=>{M=!0,b||g.abort()}}}(s,i);if(Wn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var l;return function(c,f){const g=new W.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const y in c.headers)g.setRequestHeader(y,c.headers[y]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===c.type)try{y=JSON.parse(g.response)}catch(b){return f(b)}f(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new ge(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(s,i)},ye=function(s,i){return Ce(He(s,{type:"arrayBuffer"}),i)},Se=function(s,i){return Ce(He(s,{method:"POST"}),i)},it=function(s,i){return Ce(He(s,{method:"GET"}),i)};function gt(s){const i=W.document.createElement("a");return i.href=s,i.protocol===W.document.location.protocol&&i.host===W.document.location.host}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Zt,un;Zt=[],un=0;const rn=function(s,i){if(ma.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),un>=or.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Zt.push(g),g}un++;let l=!1;const c=()=>{if(!l)for(l=!0,un--;Zt.length&&un<or.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Zt.shift(),{requestParameters:y,callback:b,cancelled:M}=g;M||(g.cancel=rn(y,b).cancel)}},f=ye(s,(g,y,b,M)=>{c(),g?i(g):y&&(W.createImageBitmap?function(E,I){const P=new W.Blob([new Uint8Array(E)],{type:"image/png"});W.createImageBitmap(P).then(k=>{I(null,k)}).catch(k=>{I(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,I)=>i(E,I,b,M)):function(E,I){const P=new W.Image,k=W.URL;P.onload=()=>{I(null,P),k.revokeObjectURL(P.src),P.onload=null,W.requestAnimationFrame(()=>{P.src=ot})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new W.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?k.createObjectURL(z):ot}(y,(E,I)=>i(E,I,b,M)))});return{cancel:()=>{f.cancel(),c()}}};function fn(s,i,l){l[s]&&-1!==l[s].indexOf(i)||(l[s]=l[s]||[],l[s].push(i))}function Rn(s,i,l){if(l&&l[s]){const c=l[s].indexOf(i);-1!==c&&l[s].splice(c,1)}}class cr{constructor(i,l={}){He(this,l),this.type=i}}class vr extends cr{constructor(i,l={}){super("error",He({error:i},l))}}class mr{on(i,l){return this._listeners=this._listeners||{},fn(i,l,this._listeners),this}off(i,l){return Rn(i,l,this._listeners),Rn(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},fn(i,l,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,l){"string"==typeof i&&(i=new cr(i,l||{}));const c=i.type;if(this.listens(c)){i.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of f)b.call(this,i);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of g)Rn(c,b,this._oneTimeListeners),b.call(this,i);const y=this._eventedParent;y&&(He(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof vr&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var we=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Uo(s,...i){for(const l of i)for(const c in l)s[c]=l[c];return s}function ei(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function vs(s){if(Array.isArray(s))return s.map(vs);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=vs(s[l]);return i}return ei(s)}class ug extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}var Qo=ug;class yu{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[c,f]of l)this.bindings[c]=f}concat(i){return new yu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Sp=yu;const vu={kind:"null"},mt={kind:"number"},tr={kind:"string"},bn={kind:"boolean"},ks={kind:"color"},ya={kind:"object"},Ht={kind:"value"},Rs={kind:"collator"},Mr={kind:"formatted"},Cl={kind:"resolvedImage"};function xs(s,i){return{kind:"array",itemType:s,N:i}}function En(s){if("array"===s.kind){const i=En(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const Pn=[vu,mt,tr,bn,ks,Mr,ya,xs(Ht),Cl];function Ya(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Ya(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const l of Pn)if(!Ya(l,i))return null}return`Expected ${En(s)} but found ${En(i)} instead.`}function rf(s,i){return i.some(l=>l.kind===s.kind)}function Fn(s,i){return i.some(l=>"null"===l?null===s:"array"===l?Array.isArray(s):"object"===l?s&&!Array.isArray(s)&&"object"==typeof s:l===typeof s)}function va(s){var i={exports:{}};return s(i,i.exports),i.exports}var Vn=va(function(s,i){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(b){return(b=Math.round(b))<0?0:b>255?255:b}function f(b){return c("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function g(b){return(M="%"===b[b.length-1]?parseFloat(b)/100:parseFloat(b))<0?0:M>1?1:M;var M}function y(b,M,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?b+(M-b)*E*6:2*E<1?M:3*E<2?b+(M-b)*(2/3-E)*6:b}try{i.parseCSSColor=function(b){var M,E=b.replace(/ /g,"").toLowerCase();if(E in l)return l[E].slice();if("#"===E[0])return 4===E.length?(M=parseInt(E.substr(1),16))>=0&&M<=4095?[(3840&M)>>4|(3840&M)>>8,240&M|(240&M)>>4,15&M|(15&M)<<4,1]:null:7===E.length&&(M=parseInt(E.substr(1),16))>=0&&M<=16777215?[(16711680&M)>>16,(65280&M)>>8,255&M,1]:null;var I=E.indexOf("("),P=E.indexOf(")");if(-1!==I&&P+1===E.length){var k=E.substr(0,I),z=E.substr(I+1,P-(I+1)).split(","),V=1;switch(k){case"rgba":if(4!==z.length)return null;V=g(z.pop());case"rgb":return 3!==z.length?null:[f(z[0]),f(z[1]),f(z[2]),V];case"hsla":if(4!==z.length)return null;V=g(z.pop());case"hsl":if(3!==z.length)return null;var j=(parseFloat(z[0])%360+360)%360/360,J=g(z[1]),re=g(z[2]),de=re<=.5?re*(J+1):re+J-re*J,he=2*re-de;return[c(255*y(he,de,j+1/3)),c(255*y(he,de,j)),c(255*y(he,de,j-1/3)),V];default:return null}}return null}}catch{}});class Tn{constructor(i,l,c,f=1){this.r=i,this.g=l,this.b=c,this.a=f}static parse(i){if(!i)return;if(i instanceof Tn)return i;if("string"!=typeof i)return;const l=Vn.parseCSSColor(i);return l?new Tn(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,c,f]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(c)},${f})`}toArray(){const{r:i,g:l,b:c,a:f}=this;return 0===f?[0,0,0,0]:[255*i/f,255*l/f,255*c/f,f]}toArray01(){const{r:i,g:l,b:c,a:f}=this;return 0===f?[0,0,0,0]:[i/f,l/f,c/f,f]}toArray01PremultipliedAlpha(){const{r:i,g:l,b:c,a:f}=this;return[i,l,c,f]}}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1),Tn.blue=new Tn(0,0,1,1);var fi=Tn;class Ls{constructor(i,l,c){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class of{constructor(i,l,c,f,g){this.text=i.normalize?i.normalize():i,this.image=l,this.scale=c,this.fontStack=f,this.textColor=g}}class Bi{constructor(i){this.sections=i}static fromString(i){return new Bi([new of(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof Bi?i:Bi.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const c={};l.fontStack&&(c["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(c["font-scale"]=l.scale),l.textColor&&(c["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(c)}return i}}class ai{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new ai({name:i,available:!1}):null}serialize(){return["image",this.name]}}function sf(s,i,l,c){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[s,i,l,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[s,i,l,c]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function xu(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof fi||s instanceof Ls||s instanceof Bi||s instanceof ai)return!0;if(Array.isArray(s)){for(const i of s)if(!xu(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!xu(s[i]))return!1;return!0}return!1}function pi(s){if(null===s)return vu;if("string"==typeof s)return tr;if("boolean"==typeof s)return bn;if("number"==typeof s)return mt;if(s instanceof fi)return ks;if(s instanceof Ls)return Rs;if(s instanceof Bi)return Mr;if(s instanceof ai)return Cl;if(Array.isArray(s)){const i=s.length;let l;for(const c of s){const f=pi(c);if(l){if(l===f)continue;l=Ht;break}l=f}return xs(l||Ht,i)}return ya}function Do(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof fi||s instanceof Bi||s instanceof ai?s.toString():JSON.stringify(s)}class Ip{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!xu(i[1]))return l.error("invalid value");const c=i[1];let f=pi(c);const g=l.expectedType;return"array"!==f.kind||0!==f.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(f=g),new Ip(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof fi?["rgba"].concat(this.value.toArray()):this.value instanceof Bi?this.value.serialize():this.value}}var Gh=Ip,uo=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const af={string:tr,number:mt,boolean:bn,object:ya};class bu{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let c,f=1;const g=i[0];if("array"===g){let b,M;if(i.length>2){const E=i[1];if("string"!=typeof E||!(E in af)||"object"===E)return l.error('The item type argument of "array" must be one of string, number, boolean',1);b=af[E],f++}else b=Ht;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=i[2],f++}c=xs(b,M)}else c=af[g];const y=[];for(;f<i.length;f++){const b=l.parse(i[f],f,Ht);if(!b)return null;y.push(b)}return new bu(c,y)}evaluate(i){for(let l=0;l<this.args.length;l++){const c=this.args[l].evaluate(i);if(!Ya(this.type,pi(c)))return c;if(l===this.args.length-1)throw new uo(`Expected value to be of type ${En(this.type)}, but found ${En(pi(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){l.push(c.kind);const f=i.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(c=>c.serialize()))}}var Ka=bu;class Ja{constructor(i){this.type=Mr,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return l.error("First argument must be an image or text section.");const f=[];let g=!1;for(let y=1;y<=i.length-1;++y){const b=i[y];if(g&&"object"==typeof b&&!Array.isArray(b)){g=!1;let M=null;if(b["font-scale"]&&(M=l.parse(b["font-scale"],1,mt),!M))return null;let E=null;if(b["text-font"]&&(E=l.parse(b["text-font"],1,xs(tr)),!E))return null;let I=null;if(b["text-color"]&&(I=l.parse(b["text-color"],1,ks),!I))return null;const P=f[f.length-1];P.scale=M,P.font=E,P.textColor=I}else{const M=l.parse(i[y],1,Ht);if(!M)return null;const E=M.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:M,scale:null,font:null,textColor:null})}}return new Ja(f)}evaluate(i){return new Bi(this.sections.map(l=>{const c=l.content.evaluate(i);return pi(c)===Cl?new of("",c,null,null,null):new of(Do(c),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const c={};l.scale&&(c["font-scale"]=l.scale.serialize()),l.font&&(c["text-font"]=l.font.serialize()),l.textColor&&(c["text-color"]=l.textColor.serialize()),i.push(c)}return i}}class lf{constructor(i){this.type=Cl,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const c=l.parse(i[1],1,tr);return c?new lf(c):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),c=ai.fromString(l);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(l)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const es={"to-boolean":bn,"to-color":ks,"to-number":mt,"to-string":tr};class Er{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return l.error("Expected one argument.");const f=es[c],g=[];for(let y=1;y<i.length;y++){const b=l.parse(i[y],y,Ht);if(!b)return null;g.push(b)}return new Er(f,g)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,c;for(const f of this.args){if(l=f.evaluate(i),c=null,l instanceof fi)return l;if("string"==typeof l){const g=i.parseColor(l);if(g)return g}else if(Array.isArray(l)&&(c=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:sf(l[0],l[1],l[2],l[3]),!c))return new fi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new uo(c||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const c of this.args){if(l=c.evaluate(i),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new uo(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Bi.fromString(Do(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?ai.fromString(Do(this.args[0].evaluate(i))):Do(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new lf(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}var wu=Er;const Oy=["Unknown","Point","LineString","Polygon"];var hg=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Oy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-s[0])+this.featureDistanceData.bearing[1]*(c*i-s[1])}return 0}parseColor(s){let i=this._parseColorCache[s];return i||(i=this._parseColorCache[s]=fi.parse(s)),i}};class gn{constructor(i,l,c,f){this.name=i,this.type=l,this._evaluate=c,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const c=i[0],f=gn.definitions[c];if(!f)return l.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=y.filter(([E])=>!Array.isArray(E)||E.length===i.length-1);let M=null;for(const[E,I]of b){M=new Tr(l.registry,l.path,null,l.scope);const P=[];let k=!1;for(let z=1;z<i.length;z++){const V=i[z],j=Array.isArray(E)?E[z-1]:E.type,J=M.parse(V,1+P.length,j);if(!J){k=!0;break}P.push(J)}if(!k)if(Array.isArray(E)&&E.length!==P.length)M.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let z=0;z<P.length;z++){const V=Array.isArray(E)?E[z]:E.type,j=P[z];M.concat(z+1).checkSubtype(V,j.type)}if(0===M.errors.length)return new gn(c,g,I,P)}}if(1===b.length)l.errors.push(...M.errors);else{const E=(b.length?b:y).map(([P])=>{return k=P,Array.isArray(k)?`(${k.map(En).join(", ")})`:`(${En(k.type)}...)`;var k}).join(" | "),I=[];for(let P=1;P<i.length;P++){const k=l.parse(i[P],1+I.length);if(!k)return null;I.push(En(k.type))}l.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(i,l){gn.definitions=l;for(const c in l)i[c]=gn}}var Qa=gn;class Vi{constructor(i,l,c){this.type=Rs,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,bn);if(!f)return null;const g=l.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,bn);if(!g)return null;let y=null;return c.locale&&(y=l.parse(c.locale,1,tr),!y)?null:new Vi(f,g,y)}evaluate(i){return new Ls(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ks=8192;function Hh(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function qh(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function dg(s,i){const l=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*Ks),Math.round(c*f*Ks)]}function Ap(s,i,l){const c=s[0]-i[0],f=s[1]-i[1],g=s[0]-l[0],y=s[1]-l[1];return c*y-g*f==0&&c*g<=0&&f*y<=0}function wc(s,i){let l=!1;for(let y=0,b=i.length;y<b;y++){const M=i[y];for(let E=0,I=M.length;E<I-1;E++){if(Ap(s,M[E],M[E+1]))return!1;(f=M[E])[1]>(c=s)[1]!=(g=M[E+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(l=!l)}}var c,f,g;return l}function Zh(s,i){for(let l=0;l<i.length;l++)if(wc(s,i[l]))return!0;return!1}function Cc(s,i,l,c){const f=c[0]-l[0],g=c[1]-l[1],y=(s[0]-l[0])*g-f*(s[1]-l[1]),b=(i[0]-l[0])*g-f*(i[1]-l[1]);return y>0&&b<0||y<0&&b>0}function fg(s,i,l){for(const E of l)for(let I=0;I<E.length-1;++I)if((b=[(y=E[I+1])[0]-(g=E[I])[0],y[1]-g[1]])[0]*(M=[(f=i)[0]-(c=s)[0],f[1]-c[1]])[1]-b[1]*M[0]!=0&&Cc(c,f,g,y)&&Cc(g,y,c,f))return!0;var c,f,g,y,b,M;return!1}function Dn(s,i){for(let l=0;l<s.length;++l)if(!wc(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(fg(s[l],s[l+1],i))return!1;return!0}function cf(s,i){for(let l=0;l<i.length;l++)if(Dn(s,i[l]))return!0;return!1}function uf(s,i,l){const c=[];for(let f=0;f<s.length;f++){const g=[];for(let y=0;y<s[f].length;y++){const b=dg(s[f][y],l);Hh(i,b),g.push(b)}c.push(g)}return c}function Ai(s,i,l){const c=[];for(let f=0;f<s.length;f++){const g=uf(s[f],i,l);c.push(g)}return c}function Wh(s,i,l,c){if(s[0]<l[0]||s[0]>l[2]){const f=.5*c;let g=s[0]-l[0]>f?-c:l[0]-s[0]>f?c:0;0===g&&(g=s[0]-l[2]>f?-c:l[2]-s[0]>f?c:0),s[0]+=g}Hh(i,s)}function Pp(s,i,l,c){const f=Math.pow(2,c.z)*Ks,g=[c.x*Ks,c.y*Ks],y=[];if(!s)return y;for(const b of s)for(const M of b){const E=[M.x+g[0],M.y+g[1]];Wh(E,i,l,f),y.push(E)}return y}function bs(s,i,l,c){const f=Math.pow(2,c.z)*Ks,g=[c.x*Ks,c.y*Ks],y=[];if(!s)return y;for(const M of s){const E=[];for(const I of M){const P=[I.x+g[0],I.y+g[1]];Hh(i,P),E.push(P)}y.push(E)}if(i[2]-i[0]<=f/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const M of y)for(const E of M)Wh(E,i,l,f)}var b;return y}class Ui{constructor(i,l){this.type=bn,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(xu(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let f=0;f<c.features.length;++f){const g=c.features[f].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Ui(c,c.features[f].geometry)}else if("Feature"===c.type){const f=c.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Ui(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Ui(c,c)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===c.type){const b=uf(c.coordinates,g,y),M=Pp(l.geometry(),f,g,y);if(!qh(f,g))return!1;for(const E of M)if(!wc(E,b))return!1}if("MultiPolygon"===c.type){const b=Ai(c.coordinates,g,y),M=Pp(l.geometry(),f,g,y);if(!qh(f,g))return!1;for(const E of M)if(!Zh(E,b))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(!y)return!1;if("Polygon"===c.type){const b=uf(c.coordinates,g,y),M=bs(l.geometry(),f,g,y);if(!qh(f,g))return!1;for(const E of M)if(!Dn(E,b))return!1}if("MultiPolygon"===c.type){const b=Ai(c.coordinates,g,y),M=bs(l.geometry(),f,g,y);if(!qh(f,g))return!1;for(const E of M)if(!cf(E,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var hf=Ui;function Cu(s){if(s instanceof Qa&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof hf)return!1;let i=!0;return s.eachChild(l=>{i&&!Cu(l)&&(i=!1)}),i}function So(s){if(s instanceof Qa&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(l=>{i&&!So(l)&&(i=!1)}),i}function Ir(s,i){if(s instanceof Qa&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(c=>{l&&!Ir(c,i)&&(l=!1)}),l}class gr{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const c=i[1];return l.scope.has(c)?new gr(c,l.scope.get(c)):l.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var pg=gr;class el{constructor(i,l=[],c,f=new Sp,g=[]){this.registry=i,this.path=l,this.key=l.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c}parse(i,l,c,f,g={}){return l?this.concat(l,c,f)._parse(i,g):this._parse(i,g)}_parse(i,l){function c(f,g,y){return"assert"===y?new Ka(g,[f]):"coerce"===y?new wu(g,[f]):f}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let y=g.parse(i,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,M=y.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==M.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==M.kind&&"string"!==M.kind){if(this.checkSubtype(b,M))return null}else y=c(y,b,l.typeAnnotation||"coerce");else y=c(y,b,l.typeAnnotation||"assert")}if(!(y instanceof Gh)&&"resolvedImage"!==y.type.kind&&Ml(y)){const b=new hg;try{y=new Gh(y.type,y.evaluate(b))}catch(M){return this.error(M.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,c){const f="number"==typeof i?this.path.concat(i):this.path,g=c?this.scope.concat(c):this.scope;return new el(this.registry,f,l||null,g,this.errors)}error(i,...l){const c=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Qo(c,i))}checkSubtype(i,l){const c=Ya(i,l);return c&&this.error(c),c}}var Tr=el;function Ml(s){if(s instanceof pg)return Ml(s.boundExpression);if(s instanceof Qa&&"error"===s.name||s instanceof Vi||s instanceof hf)return!1;const i=s instanceof wu||s instanceof Ka;let l=!0;return s.eachChild(c=>{l=i?l&&Ml(c):l&&c instanceof Gh}),!!l&&Cu(s)&&Ir(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Mc(s,i){const l=s.length-1;let c,f,g=0,y=l,b=0;for(;g<=y;)if(b=Math.floor((g+y)/2),c=s[b],f=s[b+1],c<=i){if(b===l||i<f)return b;g=b+1}else{if(!(c>i))throw new uo("Input is not a number.");y=b-1}return 0}class Ec{constructor(i,l,c){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of c)this.labels.push(f),this.outputs.push(g)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const c=l.parse(i[1],1,mt);if(!c)return null;const f=[];let g=null;l.expectedType&&"value"!==l.expectedType.kind&&(g=l.expectedType);for(let y=1;y<i.length;y+=2){const b=1===y?-1/0:i[y],M=i[y+1],E=y,I=y+1;if("number"!=typeof b)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(f.length&&f[f.length-1][0]>=b)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=l.parse(M,I,g);if(!P)return null;g=g||P.type,f.push([b,P])}return new Ec(g,c,f)}evaluate(i){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return c[0].evaluate(i);const g=l.length;return f>=l[g-1]?c[g-1].evaluate(i):c[Mc(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}var Mu=Ec;function Un(s,i,l){return s*(1-l)+i*l}var xa=Object.freeze({__proto__:null,number:Un,color:function(s,i,l){return new fi(Un(s.r,i.r,l),Un(s.g,i.g,l),Un(s.b,i.b,l),Un(s.a,i.a,l))},array:function(s,i,l){return s.map((c,f)=>Un(c,i[f],l))}});const Op=4/29,Tc=6/29,Xh=3*Tc*Tc,mg=Math.PI/180,ws=180/Math.PI;function Yh(s){return s>.008856451679035631?Math.pow(s,1/3):s/Xh+Op}function Kh(s){return s>Tc?s*s*s:Xh*(s-Op)}function wn(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function oo(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Fr(s){const i=oo(s.r),l=oo(s.g),c=oo(s.b),f=Yh((.4124564*i+.3575761*l+.1804375*c)/.95047),g=Yh((.2126729*i+.7151522*l+.072175*c)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-Yh((.0193339*i+.119192*l+.9503041*c)/1.08883)),alpha:s.a}}function ho(s){let i=(s.l+16)/116,l=isNaN(s.a)?i:i+s.a/500,c=isNaN(s.b)?i:i-s.b/200;return i=1*Kh(i),l=.95047*Kh(l),c=1.08883*Kh(c),new fi(wn(3.2404542*l-1.5371385*i-.4985314*c),wn(-.969266*l+1.8760108*i+.041556*c),wn(.0556434*l-.2040259*i+1.0572252*c),s.alpha)}function fo(s,i,l){const c=i-s;return s+l*(c>180||c<-180?c-360*Math.round(c/360):c)}const so={forward:Fr,reverse:ho,interpolate:function(s,i,l){return{l:Un(s.l,i.l,l),a:Un(s.a,i.a,l),b:Un(s.b,i.b,l),alpha:Un(s.alpha,i.alpha,l)}}},ao={forward:function(s){const{l:i,a:l,b:c}=Fr(s),f=Math.atan2(c,l)*ws;return{h:f<0?f+360:f,c:Math.sqrt(l*l+c*c),l:i,alpha:s.a}},reverse:function(s){const i=s.h*mg,l=s.c;return ho({l:s.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:s.alpha})},interpolate:function(s,i,l){return{h:fo(s.h,i.h,l),c:Un(s.c,i.c,l),l:Un(s.l,i.l,l),alpha:Un(s.alpha,i.alpha,l)}}};var Gt=Object.freeze({__proto__:null,lab:so,hcl:ao});class jn{constructor(i,l,c,f,g){this.type=i,this.operator=l,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[y,b]of g)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(i,l,c,f){let g=0;if("exponential"===i.name)g=Yr(l,i.base,c,f);else if("linear"===i.name)g=Yr(l,1,c,f);else if("cubic-bezier"===i.name){const y=i.controlPoints;g=new Te(y[0],y[1],y[2],y[3]).solve(Yr(l,1,c,f))}return g}static parse(i,l){let[c,f,g,...y]=i;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const E=f[1];if("number"!=typeof E)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:E}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const E=f.slice(1);if(4!==E.length||E.some(I=>"number"!=typeof I||I<0||I>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:E}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(g=l.parse(g,2,mt),!g)return null;const b=[];let M=null;"interpolate-hcl"===c||"interpolate-lab"===c?M=ks:l.expectedType&&"value"!==l.expectedType.kind&&(M=l.expectedType);for(let E=0;E<y.length;E+=2){const I=y[E],P=y[E+1],k=E+3,z=E+4;if("number"!=typeof I)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(b.length&&b[b.length-1][0]>=I)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const V=l.parse(P,z,M);if(!V)return null;M=M||V.type,b.push([I,V])}return"number"===M.kind||"color"===M.kind||"array"===M.kind&&"number"===M.itemType.kind&&"number"==typeof M.N?new jn(M,c,f,g,b):l.error(`Type ${En(M)} is not interpolatable.`)}evaluate(i){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return c[0].evaluate(i);const g=l.length;if(f>=l[g-1])return c[g-1].evaluate(i);const y=Mc(l,f),b=jn.interpolationFactor(this.interpolation,f,l[y],l[y+1]),M=c[y].evaluate(i),E=c[y+1].evaluate(i);return"interpolate"===this.operator?xa[this.type.kind.toLowerCase()](M,E,b):"interpolate-hcl"===this.operator?ao.reverse(ao.interpolate(ao.forward(M),ao.forward(E),b)):so.reverse(so.interpolate(so.forward(M),so.forward(E),b))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)l.push(this.labels[c],this.outputs[c].serialize());return l}}function Yr(s,i,l,c){const f=c-l,g=s-l;return 0===f?0:1===i?g/f:(Math.pow(i,g)-1)/(Math.pow(i,f)-1)}var Ci=jn;class ba{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let c=null;const f=l.expectedType;f&&"value"!==f.kind&&(c=f);const g=[];for(const b of i.slice(1)){const M=l.parse(b,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!M)return null;c=c||M.type,g.push(M)}const y=f&&g.some(b=>Ya(f,b.type));return new ba(y?Ht:c,g)}evaluate(i){let l,c=null,f=0;for(const g of this.args){if(f++,c=g.evaluate(i),c&&c instanceof ai&&!c.available&&(l||(l=c),c=null,f===this.args.length))return l;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}var ji=ba;class wa{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let g=1;g<i.length-1;g+=2){const y=i[g];if("string"!=typeof y)return l.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=l.parse(i[g+1],g+1);if(!b)return null;c.push([y,b])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,c);return f?new wa(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,c]of this.bindings)i.push(l,c.serialize());return i.push(this.result.serialize()),i}}var ti=wa;class Tl{constructor(i,l,c){this.type=i,this.index=l,this.input=c}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,mt),f=l.parse(i[2],2,xs(l.expectedType||Ht));return c&&f?new Tl(f.type.itemType,c,f):null}evaluate(i){const l=this.index.evaluate(i),c=this.input.evaluate(i);if(l<0)throw new uo(`Array index out of bounds: ${l} < 0.`);if(l>=c.length)throw new uo(`Array index out of bounds: ${l} > ${c.length-1}.`);if(l!==Math.floor(l))throw new uo(`Array index must be an integer, but found ${l} instead.`);return c[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Dc=Tl;class qn{constructor(i,l){this.type=bn,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,Ht),f=l.parse(i[2],2,Ht);return c&&f?rf(c.type,[bn,tr,mt,vu,Ht])?new qn(c,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(c.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!Fn(l,["boolean","string","number","null"]))throw new uo(`Expected first argument to be of type boolean, string, number or null, but found ${En(pi(l))} instead.`);if(!Fn(c,["string","array"]))throw new uo(`Expected second argument to be of type array or string, but found ${En(pi(c))} instead.`);return c.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Jh=qn;class Js{constructor(i,l,c){this.type=mt,this.needle=i,this.haystack=l,this.fromIndex=c}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,Ht),f=l.parse(i[2],2,Ht);if(!c||!f)return null;if(!rf(c.type,[bn,tr,mt,vu,Ht]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${En(c.type)} instead`);if(4===i.length){const g=l.parse(i[3],3,mt);return g?new Js(c,f,g):null}return new Js(c,f)}evaluate(i){const l=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!Fn(l,["boolean","string","number","null"]))throw new uo(`Expected first argument to be of type boolean, string, number or null, but found ${En(pi(l))} instead.`);if(!Fn(c,["string","array"]))throw new uo(`Expected second argument to be of type array or string, but found ${En(pi(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return c.indexOf(l,f)}return c.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Qh=Js;class Qs{constructor(i,l,c,f,g,y){this.inputType=i,this.type=l,this.input=c,this.cases=f,this.outputs=g,this.otherwise=y}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let c,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const g={},y=[];for(let E=2;E<i.length-1;E+=2){let I=i[E];const P=i[E+1];Array.isArray(I)||(I=[I]);const k=l.concat(E);if(0===I.length)return k.error("Expected at least one branch label.");for(const V of I){if("number"!=typeof V&&"string"!=typeof V)return k.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,pi(V)))return null}else c=pi(V);if(void 0!==g[String(V)])return k.error("Branch labels must be unique.");g[String(V)]=y.length}const z=l.parse(P,E,f);if(!z)return null;f=f||z.type,y.push(z)}const b=l.parse(i[1],1,Ht);if(!b)return null;const M=l.parse(i[i.length-1],i.length-1,f);return M?"value"!==b.type.kind&&l.concat(1).checkSubtype(c,b.type)?null:new Qs(c,f,b,g,y,M):null}evaluate(i){const l=this.input.evaluate(i);return(pi(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),c=[],f={};for(const y of l){const b=f[this.cases[y]];void 0===b?(f[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[b][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,b]of c)i.push(1===b.length?g(b[0]):b.map(g)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}var po=Qs;class Dl{constructor(i,l,c){this.type=i,this.branches=l,this.otherwise=c}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let c;l.expectedType&&"value"!==l.expectedType.kind&&(c=l.expectedType);const f=[];for(let y=1;y<i.length-1;y+=2){const b=l.parse(i[y],y,bn);if(!b)return null;const M=l.parse(i[y+1],y+1,c);if(!M)return null;f.push([b,M]),c=c||M.type}const g=l.parse(i[i.length-1],i.length-1,c);return g?new Dl(c,f,g):null}evaluate(i){for(const[l,c]of this.branches)if(l.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,c]of this.branches)i(l),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}var Sl=Dl;class Io{constructor(i,l,c,f){this.type=i,this.input=l,this.beginIndex=c,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,Ht),f=l.parse(i[2],2,mt);if(!c||!f)return null;if(!rf(c.type,[xs(Ht),tr,Ht]))return l.error(`Expected first argument to be of type array or string, but found ${En(c.type)} instead`);if(4===i.length){const g=l.parse(i[3],3,mt);return g?new Io(c.type,c,f,g):null}return new Io(c.type,c,f)}evaluate(i){const l=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!Fn(l,["string","array"]))throw new uo(`Expected first argument to be of type array or string, but found ${En(pi(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(c,f)}return l.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Il=Io;function df(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Hr(s,i,l,c){return 0===c.compare(i,l)}function Sc(s,i,l){const c="=="!==s&&"!="!==s;return class QP{constructor(g,y,b){this.type=bn,this.lhs=g,this.rhs=y,this.collator=b,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const b=g[0];let M=y.parse(g[1],1,Ht);if(!M)return null;if(!df(b,M.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${En(M.type)}'.`);let E=y.parse(g[2],2,Ht);if(!E)return null;if(!df(b,E.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${En(E.type)}'.`);if(M.type.kind!==E.type.kind&&"value"!==M.type.kind&&"value"!==E.type.kind)return y.error(`Cannot compare types '${En(M.type)}' and '${En(E.type)}'.`);c&&("value"===M.type.kind&&"value"!==E.type.kind?M=new Ka(E.type,[M]):"value"!==M.type.kind&&"value"===E.type.kind&&(E=new Ka(M.type,[E])));let I=null;if(4===g.length){if("string"!==M.type.kind&&"string"!==E.type.kind&&"value"!==M.type.kind&&"value"!==E.type.kind)return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(g[3],3,Rs),!I)return null}return new QP(M,E,I)}evaluate(g){const y=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const M=pi(y),E=pi(b);if(M.kind!==E.kind||"string"!==M.kind&&"number"!==M.kind)throw new uo(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const M=pi(y),E=pi(b);if("string"!==M.kind||"string"!==E.kind)return i(g,y,b)}return this.collator?l(g,y,b,this.collator.evaluate(g)):i(g,y,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[s];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const gg=Sc("==",function(s,i,l){return i===l},Hr),Al=Sc("!=",function(s,i,l){return i!==l},function(s,i,l,c){return!Hr(0,i,l,c)}),ed=Sc("<",function(s,i,l){return i<l},function(s,i,l,c){return c.compare(i,l)<0}),Ic=Sc(">",function(s,i,l){return i>l},function(s,i,l,c){return c.compare(i,l)>0}),td=Sc("<=",function(s,i,l){return i<=l},function(s,i,l,c){return c.compare(i,l)<=0}),Pl=Sc(">=",function(s,i,l){return i>=l},function(s,i,l,c){return c.compare(i,l)>=0});class Ki{constructor(i,l,c,f,g){this.type=tr,this.number=i,this.locale=l,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const c=l.parse(i[1],1,mt);if(!c)return null;const f=i[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=l.parse(f.locale,1,tr),!g))return null;let y=null;if(f.currency&&(y=l.parse(f.currency,1,tr),!y))return null;let b=null;if(f["min-fraction-digits"]&&(b=l.parse(f["min-fraction-digits"],1,mt),!b))return null;let M=null;return f["max-fraction-digits"]&&(M=l.parse(f["max-fraction-digits"],1,mt),!M)?null:new Ki(c,g,y,b,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class nd{constructor(i){this.type=mt,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=l.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?l.error(`Expected argument of type string or array, but found ${En(c.type)} instead.`):new nd(c):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new uo(`Expected value to be of type string or array, but found ${En(pi(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const mo={"==":gg,"!=":Al,">":Ic,"<":ed,">=":Pl,"<=":td,array:Ka,at:Dc,boolean:Ka,case:Sl,coalesce:ji,collator:Vi,format:Ja,image:lf,in:Jh,"index-of":Qh,interpolate:Ci,"interpolate-hcl":Ci,"interpolate-lab":Ci,length:nd,let:ti,literal:Gh,match:po,number:Ka,"number-format":Ki,object:Ka,slice:Il,step:Mu,string:Ka,"to-boolean":wu,"to-color":wu,"to-number":wu,"to-string":wu,var:pg,within:hf};function ts(s,[i,l,c,f]){i=i.evaluate(s),l=l.evaluate(s),c=c.evaluate(s);const g=f?f.evaluate(s):1,y=sf(i,l,c,g);if(y)throw new uo(y);return new fi(i/255*g,l/255*g,c/255*g,g)}function Ac(s,i){return s in i}function Pc(s,i){const l=i[s];return void 0===l?null:l}function ea(s){return{type:s}}Qa.register(mo,{error:[{kind:"error"},[tr],(s,[i])=>{throw new uo(i.evaluate(s))}],typeof:[tr,[Ht],(s,[i])=>En(pi(i.evaluate(s)))],"to-rgba":[xs(mt,4),[ks],(s,[i])=>i.evaluate(s).toArray()],rgb:[ks,[mt,mt,mt],ts],rgba:[ks,[mt,mt,mt,mt],ts],has:{type:bn,overloads:[[[tr],(s,[i])=>Ac(i.evaluate(s),s.properties())],[[tr,ya],(s,[i,l])=>Ac(i.evaluate(s),l.evaluate(s))]]},get:{type:Ht,overloads:[[[tr],(s,[i])=>Pc(i.evaluate(s),s.properties())],[[tr,ya],(s,[i,l])=>Pc(i.evaluate(s),l.evaluate(s))]]},"feature-state":[Ht,[tr],(s,[i])=>Pc(i.evaluate(s),s.featureState||{})],properties:[ya,[],s=>s.properties()],"geometry-type":[tr,[],s=>s.geometryType()],id:[Ht,[],s=>s.id()],zoom:[mt,[],s=>s.globals.zoom],pitch:[mt,[],s=>s.globals.pitch||0],"distance-from-center":[mt,[],s=>s.distanceFromCenter()],"heatmap-density":[mt,[],s=>s.globals.heatmapDensity||0],"line-progress":[mt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[mt,[],s=>s.globals.skyRadialProgress||0],accumulated:[Ht,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[mt,ea(mt),(s,i)=>{let l=0;for(const c of i)l+=c.evaluate(s);return l}],"*":[mt,ea(mt),(s,i)=>{let l=1;for(const c of i)l*=c.evaluate(s);return l}],"-":{type:mt,overloads:[[[mt,mt],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[mt],(s,[i])=>-i.evaluate(s)]]},"/":[mt,[mt,mt],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[mt,[mt,mt],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[mt,[mt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))],log2:[mt,[mt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[mt,[mt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[mt,[mt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[mt,[mt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[mt,[mt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[mt,[mt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[mt,[mt],(s,[i])=>Math.atan(i.evaluate(s))],min:[mt,ea(mt),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[mt,ea(mt),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[mt,[mt],(s,[i])=>Math.abs(i.evaluate(s))],round:[mt,[mt],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[mt,[mt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[mt,[mt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[bn,[tr,Ht],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[bn,[Ht],(s,[i])=>s.id()===i.value],"filter-type-==":[bn,[tr],(s,[i])=>s.geometryType()===i.value],"filter-<":[bn,[tr,Ht],(s,[i,l])=>{const c=s.properties()[i.value],f=l.value;return typeof c==typeof f&&c<f}],"filter-id-<":[bn,[Ht],(s,[i])=>{const l=s.id(),c=i.value;return typeof l==typeof c&&l<c}],"filter->":[bn,[tr,Ht],(s,[i,l])=>{const c=s.properties()[i.value],f=l.value;return typeof c==typeof f&&c>f}],"filter-id->":[bn,[Ht],(s,[i])=>{const l=s.id(),c=i.value;return typeof l==typeof c&&l>c}],"filter-<=":[bn,[tr,Ht],(s,[i,l])=>{const c=s.properties()[i.value],f=l.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[bn,[Ht],(s,[i])=>{const l=s.id(),c=i.value;return typeof l==typeof c&&l<=c}],"filter->=":[bn,[tr,Ht],(s,[i,l])=>{const c=s.properties()[i.value],f=l.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[bn,[Ht],(s,[i])=>{const l=s.id(),c=i.value;return typeof l==typeof c&&l>=c}],"filter-has":[bn,[Ht],(s,[i])=>i.value in s.properties()],"filter-has-id":[bn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[bn,[xs(tr)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[bn,[xs(Ht)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[bn,[tr,xs(Ht)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[bn,[tr,xs(Ht)],(s,[i,l])=>function(c,f,g,y){for(;g<=y;){const b=g+y>>1;if(f[b]===c)return!0;f[b]>c?y=b-1:g=b+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:bn,overloads:[[[bn,bn],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[ea(bn),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:bn,overloads:[[[bn,bn],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[ea(bn),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[bn,[bn],(s,[i])=>!i.evaluate(s)],"is-supported-script":[bn,[tr],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[tr,[tr],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[tr,[tr],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[tr,ea(Ht),(s,i)=>i.map(l=>Do(l.evaluate(s))).join("")],"resolved-locale":[tr,[Rs],(s,[i])=>i.evaluate(s).resolvedLocale()]});var Ao=mo;function kp(s){return{result:"success",value:s}}function Eu(s){return{result:"error",value:s}}function Oc(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function ff(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function pf(s){return!!s.expression&&s.expression.interpolated}function ur(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function mf(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function ky(s){return s}function _g(s,i){const l="color"===i.type,c=s.stops&&"object"==typeof s.stops[0][0],f=c||!(c||void 0!==s.property),g=s.type||(pf(i)?"exponential":"interval");if(l&&((s=Uo({},s)).stops&&(s.stops=s.stops.map(E=>[E[0],fi.parse(E[1])])),s.default=fi.parse(s.default?s.default:i.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Gt[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let y,b,M;if("exponential"===g)y=vg;else if("interval"===g)y=Tu;else if("categorical"===g){y=yg,b=Object.create(null);for(const E of s.stops)b[E[0]]=E[1];M=typeof s.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=Ry}if(c){const E={},I=[];for(let z=0;z<s.stops.length;z++){const V=s.stops[z],j=V[0].zoom;void 0===E[j]&&(E[j]={zoom:j,type:s.type,property:s.property,default:s.default,stops:[]},I.push(j)),E[j].stops.push([V[0].value,V[1]])}const P=[];for(const z of I)P.push([E[z].zoom,_g(E[z],i)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ci.interpolationFactor.bind(void 0,k),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},V)=>vg({stops:P,base:s.base},i,z).evaluate(z,V)}}if(f){const E="exponential"===g?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ci.interpolationFactor.bind(void 0,E),zoomStops:s.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(s,i,I,b,M)}}return{kind:"source",evaluate(E,I){const P=I&&I.properties?I.properties[s.property]:void 0;return void 0===P?Fs(s.default,i.default):y(s,i,P,b,M)}}}function Fs(s,i,l){return void 0!==s?s:void 0!==i?i:void 0!==l?l:void 0}function yg(s,i,l,c,f){return Fs(typeof l===f?c[l]:void 0,s.default,i.default)}function Tu(s,i,l){if("number"!==ur(l))return Fs(s.default,i.default);const c=s.stops.length;if(1===c||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[c-1][0])return s.stops[c-1][1];const f=Mc(s.stops.map(g=>g[0]),l);return s.stops[f][1]}function vg(s,i,l){const c=void 0!==s.base?s.base:1;if("number"!==ur(l))return Fs(s.default,i.default);const f=s.stops.length;if(1===f||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const g=Mc(s.stops.map(I=>I[0]),l),y=function(I,P,k,z){const V=z-k,j=I-k;return 0===V?0:1===P?j/V:(Math.pow(P,j)-1)/(Math.pow(P,V)-1)}(l,c,s.stops[g][0],s.stops[g+1][0]),b=s.stops[g][1],M=s.stops[g+1][1];let E=xa[i.type]||ky;if(s.colorSpace&&"rgb"!==s.colorSpace){const I=Gt[s.colorSpace];E=(P,k)=>I.reverse(I.interpolate(I.forward(P),I.forward(k),y))}return"function"==typeof b.evaluate?{evaluate(...I){const P=b.evaluate.apply(void 0,I),k=M.evaluate.apply(void 0,I);if(void 0!==P&&void 0!==k)return E(P,k,y)}}:E(b,M,y)}function Ry(s,i,l){return"color"===i.type?l=fi.parse(l):"formatted"===i.type?l=Bi.fromString(l.toString()):"resolvedImage"===i.type?l=ai.fromString(l.toString()):ur(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0),Fs(l,s.default,i.default)}class gf{constructor(i,l){var c;this.expression=i,this._warningHistory={},this._evaluator=new hg,this._defaultValue=l?"color"===(c=l).type&&(mf(c.default)||Array.isArray(c.default))?new fi(0,0,0,0):"color"===c.type?fi.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,c,f,g,y,b,M){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(i,l,c,f,g,y,b,M){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new uo(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function _f(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Ao}function kc(s,i){const l=new Tr(Ao,[],i?function(f){const g={color:ks,string:tr,number:mt,enum:tr,boolean:bn,formatted:Mr,resolvedImage:Cl};return"array"===f.type?xs(g[f.value]||Ht,f.length):g[f.type]}(i):void 0),c=l.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?kp(new gf(c,i)):Eu(l.errors)}class yf{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!So(l.expression)}evaluateWithoutErrorHandling(i,l,c,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,c,f,g,y)}evaluate(i,l,c,f,g,y){return this._styleExpression.evaluate(i,l,c,f,g,y)}}class Rc{constructor(i,l,c,f){this.kind=i,this.zoomStops=c,this._styleExpression=l,this.isStateDependent="camera"!==i&&!So(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,c,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,c,f,g,y)}evaluate(i,l,c,f,g,y){return this._styleExpression.evaluate(i,l,c,f,g,y)}interpolationFactor(i,l,c){return this.interpolationType?Ci.interpolationFactor(this.interpolationType,i,l,c):0}}function Lc(s,i){if("error"===(s=kc(s,i)).result)return s;const l=s.value.expression,c=Cu(l);if(!c&&!Oc(i))return Eu([new Qo("","data expressions not supported")]);const f=Ir(l,["zoom","pitch","distance-from-center"]);if(!f&&!ff(i))return Eu([new Qo("","zoom expressions not supported")]);const g=Du(l);return g||f?g instanceof Qo?Eu([g]):g instanceof Ci&&!pf(i)?Eu([new Qo("",'"interpolate" expressions cannot be used with this property')]):kp(g?new Rc(c?"camera":"composite",s.value,g.labels,g instanceof Ci?g.interpolation:void 0):new yf(c?"constant":"source",s.value)):Eu([new Qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rd{constructor(i,l){this._parameters=i,this._specification=l,Uo(this,_g(this._parameters,this._specification))}static deserialize(i){return new rd(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Du(s){let i=null;if(s instanceof ti)i=Du(s.result);else if(s instanceof ji){for(const l of s.args)if(i=Du(l),i)break}else(s instanceof Mu||s instanceof Ci)&&s.input instanceof Qa&&"zoom"===s.input.name&&(i=s);return i instanceof Qo||s.eachChild(l=>{const c=Du(l);c instanceof Qo?i=c:!i&&c?i=new Qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new Qo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class Nt{constructor(i,l,c,f){this.message=(i?`${i}: `:"")+c,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Ji(s){const i=s.key,l=s.value,c=s.valueSpec||{},f=s.objectElementValidators||{},g=s.style,y=s.styleSpec;let b=[];const M=ur(l);if("object"!==M)return[new Nt(i,l,`object expected, ${M} found`)];for(const E in l){const I=E.split(".")[0],P=c[I]||c["*"];let k;f[I]?k=f[I]:c[I]?k=Pi:f["*"]?k=f["*"]:c["*"]&&(k=Pi),k?b=b.concat(k({key:(i&&`${i}.`)+E,value:l[E],valueSpec:P,style:g,styleSpec:y,object:l,objectKey:E},l)):b.push(new Nt(i,l[E],`unknown property "${E}"`))}for(const E in c)f[E]||c[E].required&&void 0===c[E].default&&void 0===l[E]&&b.push(new Nt(i,l,`missing required property "${E}"`));return b}function Su(s){const i=s.value,l=s.valueSpec,c=s.style,f=s.styleSpec,g=s.key,y=s.arrayElementValidator||Pi;if("array"!==ur(i))return[new Nt(g,i,`array expected, ${ur(i)} found`)];if(l.length&&i.length!==l.length)return[new Nt(g,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Nt(g,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let b={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(b.function=l.function),"object"===ur(l.value)&&(b=l.value);let M=[];for(let E=0;E<i.length;E++)M=M.concat(y({array:i,arrayIndex:E,value:i[E],valueSpec:b,style:c,styleSpec:f,key:`${g}[${E}]`}));return M}function mi(s){const i=s.key,l=s.value,c=s.valueSpec;let f=ur(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new Nt(i,l,`number expected, ${f} found`)];if("minimum"in c){let g=c.minimum;if("array"===ur(c.minimum)&&(g=c.minimum[s.arrayIndex]),l<g)return[new Nt(i,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===ur(c.maximum)&&(g=c.maximum[s.arrayIndex]),l>g)return[new Nt(i,l,`${l} is greater than the maximum value ${g}`)]}return[]}function id(s){const i=s.valueSpec,l=ei(s.value.type);let c,f,g,y={};const b="categorical"!==l&&void 0===s.value.property,M=!b,E="array"===ur(s.value.stops)&&"array"===ur(s.value.stops[0])&&"object"===ur(s.value.stops[0][0]),I=Ji({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(z){if("identity"===l)return[new Nt(z.key,z.value,'identity function may not have a "stops" property')];let V=[];const j=z.value;return V=V.concat(Su({key:z.key,value:j,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:P})),"array"===ur(j)&&0===j.length&&V.push(new Nt(z.key,j,"array must have at least one stop")),V},default:function(z){return Pi({key:z.key,value:z.value,valueSpec:i,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===l&&b&&I.push(new Nt(s.key,s.value,'missing required property "property"')),"identity"===l||s.value.stops||I.push(new Nt(s.key,s.value,'missing required property "stops"')),"exponential"===l&&s.valueSpec.expression&&!pf(s.valueSpec)&&I.push(new Nt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!Oc(s.valueSpec)?I.push(new Nt(s.key,s.value,"property functions not supported")):b&&!ff(s.valueSpec)&&I.push(new Nt(s.key,s.value,"zoom functions not supported"))),"categorical"!==l&&!E||void 0!==s.value.property||I.push(new Nt(s.key,s.value,'"property" property is required')),I;function P(z){let V=[];const j=z.value,J=z.key;if("array"!==ur(j))return[new Nt(J,j,`array expected, ${ur(j)} found`)];if(2!==j.length)return[new Nt(J,j,`array length 2 expected, length ${j.length} found`)];if(E){if("object"!==ur(j[0]))return[new Nt(J,j,`object expected, ${ur(j[0])} found`)];if(void 0===j[0].zoom)return[new Nt(J,j,"object stop key must have zoom")];if(void 0===j[0].value)return[new Nt(J,j,"object stop key must have value")];const re=ei(j[0].zoom);if("number"!=typeof re)return[new Nt(J,j[0].zoom,"stop zoom values must be numbers")];if(g&&g>re)return[new Nt(J,j[0].zoom,"stop zoom values must appear in ascending order")];re!==g&&(g=re,f=void 0,y={}),V=V.concat(Ji({key:`${J}[0]`,value:j[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:mi,value:k}}))}else V=V.concat(k({key:`${J}[0]`,value:j[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},j));return _f(vs(j[1]))?V.concat([new Nt(`${J}[1]`,j[1],"expressions are not allowed in function stops.")]):V.concat(Pi({key:`${J}[1]`,value:j[1],valueSpec:i,style:z.style,styleSpec:z.styleSpec}))}function k(z,V){const j=ur(z.value),J=ei(z.value),re=null!==z.value?z.value:V;if(c){if(j!==c)return[new Nt(z.key,re,`${j} stop domain type must match previous stop domain type ${c}`)]}else c=j;if("number"!==j&&"string"!==j&&"boolean"!==j&&"number"!=typeof J&&"string"!=typeof J&&"boolean"!=typeof J)return[new Nt(z.key,re,"stop domain value must be a number, string, or boolean")];if("number"!==j&&"categorical"!==l){let de=`number expected, ${j} found`;return Oc(i)&&void 0===l&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(z.key,re,de)]}return"categorical"!==l||"number"!==j||"number"==typeof J&&isFinite(J)&&Math.floor(J)===J?"categorical"!==l&&"number"===j&&"number"==typeof J&&"number"==typeof f&&void 0!==f&&J<f?[new Nt(z.key,re,"stop domain values must appear in ascending order")]:(f=J,"categorical"===l&&J in y?[new Nt(z.key,re,"stop domain values must be unique")]:(y[J]=!0,[])):[new Nt(z.key,re,`integer expected, found ${String(J)}`)]}}function Ol(s){const i=("property"===s.expressionContext?Lc:kc)(vs(s.value),s.valueSpec);if("error"===i.result)return i.value.map(c=>new Nt(`${s.key}${c.key}`,s.value,c.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!l.outputDefined())return[new Nt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!So(l))return[new Nt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return od(l,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Ir(l,["zoom","feature-state"]))return[new Nt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Cu(l))return[new Nt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function od(s,i){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const f of i.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const c=[];return s instanceof Qa&&l.has(s.name)?[new Nt(i.key,i.value,`["${s.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(s.eachChild(f=>{c.push(...od(f,i))}),c)}function Fc(s){const i=s.key,l=s.value,c=s.valueSpec,f=[];return Array.isArray(c.values)?-1===c.values.indexOf(ei(l))&&f.push(new Nt(i,l,`expected one of [${c.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(c.values).indexOf(ei(l))&&f.push(new Nt(i,l,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function sd(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!sd(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function kl(s,i="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};sd(s)||(s=Ll(s));const l=s;let c=!0;try{c=function(E){if(!lo(E))return E;let I=vs(E);return Rp(I),I=ad(I),I}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=we[`filter_${i}`],g=kc(c,f);let y=null;if("error"===g.result)throw new Error(g.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,I,P)=>g.value.evaluate(E,I,{},P);let b=null,M=null;if(c!==l){const E=kc(l,f);if("error"===E.result)throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,P,k,z,V)=>E.value.evaluate(I,P,{},k,void 0,void 0,z,V),M=!Cu(E.value.expression)}return{filter:y,dynamicFilter:b||void 0,needGeometry:Rl(c),needFeature:!!M}}function ad(s){if(!Array.isArray(s))return s;const i=function(l){if(vf.has(l[0]))for(let c=1;c<l.length;c++)if(lo(l[c]))return!0;return l}(s);return!0===i?i:i.map(l=>ad(l))}function Rp(s){let i=!1;const l=[];if("case"===s[0]){for(let c=1;c<s.length-1;c+=2)i=i||lo(s[c]),l.push(s[c+1]);l.push(s[s.length-1])}else if("match"===s[0]){i=i||lo(s[1]);for(let c=2;c<s.length-1;c+=2)l.push(s[c+1]);l.push(s[s.length-1])}else if("step"===s[0]){i=i||lo(s[1]);for(let c=1;c<s.length-1;c+=2)l.push(s[c+1])}i&&(s.length=0,s.push("any",...l));for(let c=1;c<s.length;c++)Rp(s[c])}function lo(s){if(!Array.isArray(s))return!1;if("pitch"===(i=s[0])||"distance-from-center"===i)return!0;var i;for(let l=1;l<s.length;l++)if(lo(s[l]))return!0;return!1}const vf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function xg(s,i){return s<i?-1:s>i?1:0}function Rl(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(Rl(s[i]))return!0;return!1}function Ll(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?Po(s[1],s[2],"=="):"!="===i?zc(Po(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Po(s[1],s[2],i):"any"===i?(l=s.slice(1),["any"].concat(l.map(Ll))):"all"===i?["all"].concat(s.slice(1).map(Ll)):"none"===i?["all"].concat(s.slice(1).map(Ll).map(zc)):"in"===i?Fl(s[1],s.slice(2)):"!in"===i?zc(Fl(s[1],s.slice(2))):"has"===i?Lp(s[1]):"!has"===i?zc(Lp(s[1])):"within"!==i||s;var l}function Po(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function Fl(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(xg)]]:["filter-in-small",s,["literal",i]]}}function Lp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function zc(s){return["!",s]}function Fp(s){return sd(vs(s.value))?Ol(Uo({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):gi(s)}function gi(s){const i=s.value,l=s.key;if("array"!==ur(i))return[new Nt(l,i,`array expected, ${ur(i)} found`)];const c=s.styleSpec;let f,g=[];if(i.length<1)return[new Nt(l,i,"filter array must have at least 1 element")];switch(g=g.concat(Fc({key:`${l}[0]`,value:i[0],valueSpec:c.filter_operator,style:s.style,styleSpec:s.styleSpec})),ei(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===ei(i[1])&&g.push(new Nt(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&g.push(new Nt(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=ur(i[1]),"string"!==f&&g.push(new Nt(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let y=2;y<i.length;y++)f=ur(i[y]),"$type"===ei(i[1])?g=g.concat(Fc({key:`${l}[${y}]`,value:i[y],valueSpec:c.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&g.push(new Nt(`${l}[${y}]`,i[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)g=g.concat(gi({key:`${l}[${y}]`,value:i[y],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=ur(i[1]),2!==i.length?g.push(new Nt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==f&&g.push(new Nt(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=ur(i[1]),2!==i.length?g.push(new Nt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==f&&g.push(new Nt(`${l}[1]`,i[1],`object expected, ${f} found`))}return g}function Iu(s,i){const l=s.key,c=s.style,f=s.styleSpec,g=s.value,y=s.objectKey,b=f[`${i}_${s.layerType}`];if(!b)return[];const M=y.match(/^(.*)-transition$/);if("paint"===i&&M&&b[M[1]]&&b[M[1]].transition)return Pi({key:l,value:g,valueSpec:f.transition,style:c,styleSpec:f});const E=s.valueSpec||b[y];if(!E)return[new Nt(l,g,`unknown property "${y}"`)];let I;if("string"===ur(g)&&Oc(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(g)))return[new Nt(l,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const P=[];return"symbol"===s.layerType&&("text-field"===y&&c&&!c.glyphs&&P.push(new Nt(l,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&mf(vs(g))&&"identity"===ei(g.type)&&P.push(new Nt(l,g,'"text-font" does not support identity functions'))),P.concat(Pi({key:s.key,value:g,valueSpec:E,style:c,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:y}))}function zp(s){return Iu(s,"paint")}function _i(s){return Iu(s,"layout")}function Np(s){let i=[];const l=s.value,c=s.key,f=s.style,g=s.styleSpec;l.type||l.ref||i.push(new Nt(c,l,'either "type" or "ref" is required'));let y=ei(l.type);const b=ei(l.ref);if(l.id){const M=ei(l.id);for(let E=0;E<s.arrayIndex;E++){const I=f.layers[E];ei(I.id)===M&&i.push(new Nt(c,l.id,`duplicate layer id "${l.id}", previously used at line ${I.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(E=>{E in l&&i.push(new Nt(c,l[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{ei(E.id)===b&&(M=E)}),M?M.ref?i.push(new Nt(c,l.ref,"ref cannot reference another ref layer")):y=ei(M.type):"string"==typeof b&&i.push(new Nt(c,l.ref,`ref layer "${b}" not found`))}else if("background"!==y&&"sky"!==y)if(l.source){const M=f.sources&&f.sources[l.source],E=M&&ei(M.type);M?"vector"===E&&"raster"===y?i.push(new Nt(c,l.source,`layer "${l.id}" requires a raster source`)):"raster"===E&&"raster"!==y?i.push(new Nt(c,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==E||l["source-layer"]?"raster-dem"===E&&"hillshade"!==y?i.push(new Nt(c,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===E&&M.lineMetrics||i.push(new Nt(c,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Nt(c,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Nt(c,l.source,`source "${l.source}" not found`))}else i.push(new Nt(c,l,'missing required property "source"'));return i=i.concat(Ji({key:c,value:l,valueSpec:g.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pi({key:`${c}.type`,value:l.type,valueSpec:g.layer.type,style:s.style,styleSpec:s.styleSpec,object:l,objectKey:"type"}),filter:M=>Fp(Uo({layerType:y},M)),layout:M=>Ji({layer:l,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":E=>_i(Uo({layerType:y},E))}}),paint:M=>Ji({layer:l,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":E=>zp(Uo({layerType:y},E))}})}})),i}function Au(s){const i=s.value,l=s.key,c=ur(i);return"string"!==c?[new Nt(l,i,`string expected, ${c} found`)]:[]}const zl={promoteId:function({key:s,value:i}){if("string"===ur(i))return Au({key:s,value:i});{const l=[];for(const c in i)l.push(...Au({key:`${s}.${c}`,value:i[c]}));return l}}};function ns(s){const i=s.value,l=s.key,c=s.styleSpec,f=s.style;if(!i.type)return[new Nt(l,i,'"type" is required')];const g=ei(i.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=Ji({key:l,value:i,valueSpec:c[`source_${g.replace("-","_")}`],style:s.style,styleSpec:c,objectElementValidators:zl}),y;case"geojson":if(y=Ji({key:l,value:i,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:zl}),i.cluster)for(const b in i.clusterProperties){const[M,E]=i.clusterProperties[b],I="string"==typeof M?[M,["accumulated"],["get",b]]:M;y.push(...Ol({key:`${l}.${b}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Ol({key:`${l}.${b}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return Ji({key:l,value:i,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Ji({key:l,value:i,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new Nt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fc({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:c})}}function xf(s){const i=s.value,l=s.styleSpec,c=l.light,f=s.style;let g=[];const y=ur(i);if(void 0===i)return g;if("object"!==y)return g=g.concat([new Nt("light",i,`object expected, ${y} found`)]),g;for(const b in i){const M=b.match(/^(.*)-transition$/);g=g.concat(M&&c[M[1]]&&c[M[1]].transition?Pi({key:b,value:i[b],valueSpec:l.transition,style:f,styleSpec:l}):c[b]?Pi({key:b,value:i[b],valueSpec:c[b],style:f,styleSpec:l}):[new Nt(b,i[b],`unknown property "${b}"`)])}return g}function Pu(s){const i=s.value,l=s.key,c=s.style,f=s.styleSpec,g=f.terrain;let y=[];const b=ur(i);if(void 0===i)return y;if("object"!==b)return y=y.concat([new Nt("terrain",i,`object expected, ${b} found`)]),y;for(const M in i){const E=M.match(/^(.*)-transition$/);y=y.concat(E&&g[E[1]]&&g[E[1]].transition?Pi({key:M,value:i[M],valueSpec:f.transition,style:c,styleSpec:f}):g[M]?Pi({key:M,value:i[M],valueSpec:g[M],style:c,styleSpec:f}):[new Nt(M,i[M],`unknown property "${M}"`)])}if(i.source){const M=c.sources&&c.sources[i.source],E=M&&ei(M.type);M?"raster-dem"!==E&&y.push(new Nt(l,i.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new Nt(l,i.source,`source "${i.source}" not found`))}else y.push(new Nt(l,i,'terrain is missing required property "source"'));return y}function Nl(s){const i=s.value,l=s.style,c=s.styleSpec,f=c.fog;let g=[];const y=ur(i);if(void 0===i)return g;if("object"!==y)return g=g.concat([new Nt("fog",i,`object expected, ${y} found`)]),g;for(const b in i){const M=b.match(/^(.*)-transition$/);g=g.concat(M&&f[M[1]]&&f[M[1]].transition?Pi({key:b,value:i[b],valueSpec:c.transition,style:l,styleSpec:c}):f[b]?Pi({key:b,value:i[b],valueSpec:f[b],style:l,styleSpec:c}):[new Nt(b,i[b],`unknown property "${b}"`)])}return g}const go={"*":()=>[],array:Su,boolean:function(s){const i=s.value,l=s.key,c=ur(i);return"boolean"!==c?[new Nt(l,i,`boolean expected, ${c} found`)]:[]},number:mi,color:function(s){const i=s.key,l=s.value,c=ur(l);return"string"!==c?[new Nt(i,l,`color expected, ${c} found`)]:null===Vn.parseCSSColor(l)?[new Nt(i,l,`color expected, "${l}" found`)]:[]},enum:Fc,filter:Fp,function:id,layer:Np,object:Ji,source:ns,light:xf,terrain:Pu,fog:Nl,string:Au,formatted:function(s){return 0===Au(s).length?[]:Ol(s)},resolvedImage:function(s){return 0===Au(s).length?[]:Ol(s)},projection:function(s){const i=s.value,l=s.styleSpec,c=l.projection,f=s.style;let g=[];const y=ur(i);if("object"===y)for(const b in i)g=g.concat(Pi({key:b,value:i[b],valueSpec:c[b],style:f,styleSpec:l}));else"string"!==y&&(g=g.concat([new Nt("projection",i,`object or string expected, ${y} found`)]));return g}};function Pi(s){const i=s.value,l=s.valueSpec,c=s.styleSpec;return l.expression&&mf(ei(i))?id(s):l.expression&&_f(vs(i))?Ol(s):l.type&&go[l.type]?go[l.type](s):Ji(Uo({},s,{valueSpec:l.type?c[l.type]:l}))}function ld(s){const i=s.value,l=s.key,c=Au(s);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new Nt(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new Nt(l,i,'"glyphs" url must include a "{range}" token'))),c}function Bp(s,i=we){return rs(Pi({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:ld,"*":()=>[]}}))}const Ca=s=>rs(zp(s)),Vp=s=>rs(_i(s));function rs(s){return s.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function zn(s,i){let l=!1;if(i&&i.length)for(const c of i)s.fire(new vr(new Error(c.message))),l=!0;return l}var Bl=Ma;function Ma(s,i,l){var c=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var f=new Int32Array(this.arrayBuffer);s=f[0],this.d=(i=f[1])+2*(l=f[2]);for(var g=0;g<this.d*this.d;g++){var y=f[3+g],b=f[3+g+1];c.push(y===b?null:f.subarray(y,b))}var M=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],M),this.bboxes=f.subarray(M),this.insert=this._insertReadonly}else{this.d=i+2*l;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=s,this.padding=l,this.scale=i/s,this.uid=0;var I=l/i*s;this.min=-I,this.max=s+I}Ma.prototype.insert=function(s,i,l,c,f){this._forEachCell(i,l,c,f,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(f)},Ma.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ma.prototype._insertCell=function(s,i,l,c,f,g){this.cells[f].push(g)},Ma.prototype.query=function(s,i,l,c,f){var g=this.min,y=this.max;if(s<=g&&i<=g&&y<=l&&y<=c&&!f)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(s,i,l,c,this._queryCell,b,{},f),b},Ma.prototype._queryCell=function(s,i,l,c,f,g,y,b){var M=this.cells[f];if(null!==M)for(var E=this.keys,I=this.bboxes,P=0;P<M.length;P++){var k=M[P];if(void 0===y[k]){var z=4*k;(b?b(I[z+0],I[z+1],I[z+2],I[z+3]):s<=I[z+2]&&i<=I[z+3]&&l>=I[z+0]&&c>=I[z+1])?(y[k]=!0,g.push(E[k])):y[k]=!1}}},Ma.prototype._forEachCell=function(s,i,l,c,f,g,y,b){for(var M=this._convertToCellCoord(s),E=this._convertToCellCoord(i),I=this._convertToCellCoord(l),P=this._convertToCellCoord(c),k=M;k<=I;k++)for(var z=E;z<=P;z++){var V=this.d*z+k;if((!b||b(this._convertFromCellCoord(k),this._convertFromCellCoord(z),this._convertFromCellCoord(k+1),this._convertFromCellCoord(z+1)))&&f.call(this,s,i,l,c,V,g,y,b))return}},Ma.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Ma.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Ma.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,i=3+this.cells.length+1+1,l=0,c=0;c<this.cells.length;c++)l+=this.cells[c].length;var f=new Int32Array(i+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=i,y=0;y<s.length;y++){var b=s[y];f[3+y]=g,f.set(b,g),g+=b.length}return f[3+s.length]=g,f.set(this.keys,g),f[3+s.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};const cd={};function Bt(s,i,l={}){Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),cd[i]={klass:s,omit:l.omit||[]}}Bt(Object,"Object"),Bl.serialize=function(s,i){const l=s.toArrayBuffer();return i&&i.push(l),{buffer:l}},Bl.deserialize=function(s){return new Bl(s.buffer)},Object.defineProperty(Bl,"name",{value:"Grid"}),Bt(Bl,"Grid"),Bt(fi,"Color"),Bt(Error,"Error"),Bt(ge,"AJAXError"),Bt(ai,"ResolvedImage"),Bt(rd,"StylePropertyFunction"),Bt(gf,"StyleExpression",{omit:["_evaluator"]}),Bt(Rc,"ZoomDependentExpression"),Bt(yf,"ZoomConstantExpression"),Bt(Qa,"CompoundExpression",{omit:["_evaluate"]});for(const s in Ao)cd[Ao[s]._classRegistryKey]||Bt(Ao[s],`Expression${s}`);function Up(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function bf(s){return W.ImageBitmap&&s instanceof W.ImageBitmap}function Ou(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Up(s)||bf(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof W.ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const c of s)l.push(Ou(c,i));return l}if("object"==typeof s){const l=s.constructor,c=l._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const f=l.serialize?l.serialize(s,i):{};if(!l.serialize){for(const g in s)s.hasOwnProperty(g)&&(cd[c].omit.indexOf(g)>=0||(f[g]=Ou(s[g],i)));s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof s)}function ku(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Up(s)||bf(s)||ArrayBuffer.isView(s)||s instanceof W.ImageData)return s;if(Array.isArray(s))return s.map(ku);if("object"==typeof s){const i=s.$name||"Object",{klass:l}=cd[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const c=Object.create(l.prototype);for(const f of Object.keys(s))"$name"!==f&&(c[f]=ku(s[f]));return c}throw new Error("can't deserialize object of type "+typeof s)}class pt{constructor(){this.first=!0}update(i,l){const c=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=c,!0))}}const dr=s=>s>=1536&&s<=1791,ni=s=>s>=1872&&s<=1919,Vr=s=>s>=2208&&s<=2303,Oi=s=>s>=11904&&s<=12031,wf=s=>s>=12032&&s<=12255,Ea=s=>s>=12272&&s<=12287,is=s=>s>=12288&&s<=12351,Nc=s=>s>=12352&&s<=12447,Bc=s=>s>=12448&&s<=12543,jp=s=>s>=12544&&s<=12591,Cf=s=>s>=12704&&s<=12735,$p=s=>s>=12736&&s<=12783,Vc=s=>s>=12784&&s<=12799,Qi=s=>s>=12800&&s<=13055,Cs=s=>s>=13056&&s<=13311,Mf=s=>s>=13312&&s<=19903,tl=s=>s>=19968&&s<=40959,ta=s=>s>=40960&&s<=42127,ud=s=>s>=42128&&s<=42191,Ef=s=>s>=44032&&s<=55215,Gp=s=>s>=63744&&s<=64255,Tf=s=>s>=64336&&s<=65023,hd=s=>s>=65040&&s<=65055,Ta=s=>s>=65072&&s<=65103,Df=s=>s>=65104&&s<=65135,Ru=s=>s>=65136&&s<=65279,dd=s=>s>=65280&&s<=65519;function Vl(s){for(const i of s)if(h(i.charCodeAt(0)))return!0;return!1}function p(s){for(const i of s)if(!o(i.charCodeAt(0)))return!1;return!0}function o(s){return!(dr(s)||ni(s)||Vr(s)||Tf(s)||Ru(s))}function h(s){return!(746!==s&&747!==s&&(s<4352||!(Cf(s)||jp(s)||Ta(s)&&!(s>=65097&&s<=65103)||Gp(s)||Cs(s)||Oi(s)||$p(s)||!(!is(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Mf(s)||tl(s)||Qi(s)||(i=s,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(s)||(i=>i>=55216&&i<=55295)(s)||(i=>i>=4352&&i<=4607)(s)||Ef(s)||Nc(s)||Ea(s)||(i=>i>=12688&&i<=12703)(s)||wf(s)||Vc(s)||Bc(s)&&12540!==s||!(!dd(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Df(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(i=>i>=5120&&i<=5759)(s)||(i=>i>=6320&&i<=6399)(s)||hd(s)||(i=>i>=19904&&i<=19967)(s)||ta(s)||ud(s))));var i}function _(s){return!(h(s)||(i=s,(l=i)>=128&&l<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(l=>l>=8192&&l<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&9251!==i||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||is(i)||Bc(i)||(l=>l>=57344&&l<=63743)(i)||Ta(i)||Df(i)||dd(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,l}function x(s){return s>=1424&&s<=2303||Tf(s)||Ru(s)}function w(s,i){return!(!i&&x(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(l=s,l>=6016&&l<=6143));var l}function T(s){for(const i of s)if(x(i.charCodeAt(0)))return!0;return!1}const S="deferred",A="loading",R="loaded";let L=null,N="unavailable",H=null;const Z=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(N="error"),L&&L(s)};function K(){q.fire(new cr("pluginStateChange",{pluginStatus:N,pluginURL:H}))}const q=new mr,ie=function(){return N},Y=function(){if(N!==S||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");N=A,K(),H&&ye({url:H},s=>{s?Z(s):(N=R,K())})},Q={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>N===R||null!=Q.applyArabicShaping,isLoading:()=>N===A,setState(s){N=s.pluginStatus,H=s.pluginURL},isParsed:()=>null!=Q.applyArabicShaping&&null!=Q.processBidirectionalText&&null!=Q.processStyledBidirectionalText,getPluginURL:()=>H};class X{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new pt,this.transition={},this.pitch=0)}isSupportedScript(i){return function(l,c){for(const f of l)if(!w(f.charCodeAt(0),c))return!1;return!0}(i,Q.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),c=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*l}}}class ue{constructor(i,l){this.property=i,this.value=l,this.expression=function(c,f){if(mf(c))return new rd(c,f);if(_f(c)){const g=Lc(c,f);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===f.type&&(g=fi.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,c){return this.property.possiblyEvaluate(this,i,l,c)}}class ne{constructor(i){this.property=i,this.value=new ue(i,void 0)}transitioned(i,l){return new fe(this.property,this.value,l,He({},i.transition,this.transition),i.now)}untransitioned(){return new fe(this.property,this.value,null,{},0)}}class oe{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Jt(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ne(this._values[i].property)),this._values[i].value=new ue(this._values[i].property,null===l?void 0:Jt(l))}getTransition(i){return Jt(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new ne(this._values[i].property)),this._values[i].transition=Jt(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(i[l]=c);const f=this.getTransition(l);void 0!==f&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const c=new ke(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(i,l._values[f]);return c}untransitioned(){const i=new ke(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class fe{constructor(i,l,c,f,g){const y=f.delay||0,b=f.duration||0;g=g||0,this.property=i,this.value=l,this.begin=g+y,this.end=this.begin+b,i.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(i,l,c){const f=i.now||0,g=this.value.possiblyEvaluate(i,l,c),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(i,l,c);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,l,c),g,_t(b))}}return g}}class ke{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,c){const f=new ft(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(i,l,c);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ve{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Jt(this._values[i].value)}setValue(i,l){this._values[i]=new ue(this._values[i].property,null===l?void 0:Jt(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(i[l]=c)}return i}possiblyEvaluate(i,l,c){const f=new ft(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(i,l,c);return f}}class Re{constructor(i,l,c){this.property=i,this.value=l,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,c,f){return this.property.evaluate(this.value,this.parameters,i,l,c,f)}}class ft{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class ae{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,c){const f=xa[this.specification.type];return f?f(i,l,c):i}}class Ie{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,c,f){return new Re(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},c,f)}:i.expression,l)}interpolate(i,l,c){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new Re(this,{kind:"constant",value:void 0},i.parameters);const f=xa[this.specification.type];return f?new Re(this,{kind:"constant",value:f(i.value.value,l.value.value,c)},i.parameters):i}evaluate(i,l,c,f,g,y){return"constant"===i.kind?i.value:i.evaluate(l,c,f,g,y)}}class Ke extends Ie{possiblyEvaluate(i,l,c,f){if(void 0===i.value)return new Re(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const g=i.expression.evaluate(l,null,{},c,f),y="resolvedImage"===i.property.specification.type&&"string"!=typeof g?g.name:g,b=this._calculate(y,y,y,l);return new Re(this,{kind:"constant",value:b},l)}if("camera"===i.expression.kind){const g=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Re(this,{kind:"constant",value:g},l)}return new Re(this,i.expression,l)}evaluate(i,l,c,f,g,y){if("source"===i.kind){const b=i.evaluate(l,c,f,g,y);return this._calculate(b,b,b,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},c,f),i.evaluate({zoom:Math.floor(l.zoom)},c,f),i.evaluate({zoom:Math.floor(l.zoom)+1},c,f),l):i.value}_calculate(i,l,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l,other:c}:{from:c,to:l,other:i}}interpolate(i){return i}}class Dt{constructor(i){this.specification=i}possiblyEvaluate(i,l,c,f){if(void 0!==i.value){if("constant"===i.expression.kind){const g=i.expression.evaluate(l,null,{},c,f);return this._calculate(g,g,g,l)}return this._calculate(i.expression.evaluate(new X(Math.floor(l.zoom-1),l)),i.expression.evaluate(new X(Math.floor(l.zoom),l)),i.expression.evaluate(new X(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:c,to:l}}interpolate(i){return i}}class Ye{constructor(i){this.specification=i}possiblyEvaluate(i,l,c,f){return!!i.expression.evaluate(l,null,{},c,f)}interpolate(){return!1}}class Vt{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new X(0,{});for(const c in i){const f=i[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new ue(f,void 0),y=this.defaultTransitionablePropertyValues[c]=new ne(f);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(l)}}}function xt(s,i){return 256*(s=je(Math.floor(s),0,255))+je(Math.floor(i),0,255)}Bt(Ie,"DataDrivenProperty"),Bt(ae,"DataConstantProperty"),Bt(Ke,"CrossFadedDataDrivenProperty"),Bt(Dt,"CrossFadedProperty"),Bt(Ye,"ColorRampProperty");const Et={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wt{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lt(s,i=1){let l=0,c=0;return{members:s.map(f=>{const g=Et[f.type].BYTES_PER_ELEMENT,y=l=sn(l,Math.max(i,g)),b=f.components||1;return c=Math.max(c,g),l+=g*b,{name:f.name,type:f.type,components:b,offset:y}}),size:sn(l,Math.max(c,i)),alignment:i}}function sn(s,i){return Math.ceil(s/i)*i}class Sn extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=c,i}}Sn.prototype.bytesPerElement=4,Bt(Sn,"StructArrayLayout2i4");class qt extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const g=3*i;return this.int16[g+0]=l,this.int16[g+1]=c,this.int16[g+2]=f,i}}qt.prototype.bytesPerElement=6,Bt(qt,"StructArrayLayout3i6");class vn extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,c,f)}emplace(i,l,c,f,g){const y=4*i;return this.int16[y+0]=l,this.int16[y+1]=c,this.int16[y+2]=f,this.int16[y+3]=g,i}}vn.prototype.bytesPerElement=8,Bt(vn,"StructArrayLayout4i8");class hr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,c,f,g,y,b)}emplace(i,l,c,f,g,y,b,M){const E=6*i,I=12*i,P=3*i;return this.int16[E+0]=l,this.int16[E+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=g,this.uint8[I+6]=y,this.uint8[I+7]=b,this.float32[P+2]=M,i}}hr.prototype.bytesPerElement=12,Bt(hr,"StructArrayLayout2i4ub1f12");class Ur extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,c,f)}emplace(i,l,c,f,g){const y=4*i;return this.float32[y+0]=l,this.float32[y+1]=c,this.float32[y+2]=f,this.float32[y+3]=g,i}}Ur.prototype.bytesPerElement=16,Bt(Ur,"StructArrayLayout4f16");class qr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M,E,I){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,c,f,g,y,b,M,E,I)}emplace(i,l,c,f,g,y,b,M,E,I,P){const k=10*i;return this.uint16[k+0]=l,this.uint16[k+1]=c,this.uint16[k+2]=f,this.uint16[k+3]=g,this.uint16[k+4]=y,this.uint16[k+5]=b,this.uint16[k+6]=M,this.uint16[k+7]=E,this.uint16[k+8]=I,this.uint16[k+9]=P,i}}qr.prototype.bytesPerElement=20,Bt(qr,"StructArrayLayout10ui20");class Ar extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M){const E=this.length;return this.resize(E+1),this.emplace(E,i,l,c,f,g,y,b,M)}emplace(i,l,c,f,g,y,b,M,E){const I=8*i;return this.uint16[I+0]=l,this.uint16[I+1]=c,this.uint16[I+2]=f,this.uint16[I+3]=g,this.uint16[I+4]=y,this.uint16[I+5]=b,this.uint16[I+6]=M,this.uint16[I+7]=E,i}}Ar.prototype.bytesPerElement=16,Bt(Ar,"StructArrayLayout8ui16");class jo extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,c,f,g,y)}emplace(i,l,c,f,g,y,b){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=c,this.int16[M+2]=f,this.int16[M+3]=g,this.int16[M+4]=y,this.int16[M+5]=b,i}}jo.prototype.bytesPerElement=12,Bt(jo,"StructArrayLayout6i12");class $i extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M,E,I,P,k){const z=this.length;return this.resize(z+1),this.emplace(z,i,l,c,f,g,y,b,M,E,I,P,k)}emplace(i,l,c,f,g,y,b,M,E,I,P,k,z){const V=12*i;return this.int16[V+0]=l,this.int16[V+1]=c,this.int16[V+2]=f,this.int16[V+3]=g,this.uint16[V+4]=y,this.uint16[V+5]=b,this.uint16[V+6]=M,this.uint16[V+7]=E,this.int16[V+8]=I,this.int16[V+9]=P,this.int16[V+10]=k,this.int16[V+11]=z,i}}$i.prototype.bytesPerElement=24,Bt($i,"StructArrayLayout4i4ui4i24");class Da extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,i,l,c,f,g,y)}emplace(i,l,c,f,g,y,b){const M=10*i,E=5*i;return this.int16[M+0]=l,this.int16[M+1]=c,this.int16[M+2]=f,this.float32[E+2]=g,this.float32[E+3]=y,this.float32[E+4]=b,i}}Da.prototype.bytesPerElement=20,Bt(Da,"StructArrayLayout3i3f20");class Pr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Pr.prototype.bytesPerElement=4,Bt(Pr,"StructArrayLayout1ul4");class Zr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M,E,I,P,k,z){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,c,f,g,y,b,M,E,I,P,k,z)}emplace(i,l,c,f,g,y,b,M,E,I,P,k,z,V){const j=20*i,J=10*i;return this.int16[j+0]=l,this.int16[j+1]=c,this.int16[j+2]=f,this.int16[j+3]=g,this.int16[j+4]=y,this.float32[J+3]=b,this.float32[J+4]=M,this.float32[J+5]=E,this.float32[J+6]=I,this.int16[j+14]=P,this.uint32[J+8]=k,this.uint16[j+18]=z,this.uint16[j+19]=V,i}}Zr.prototype.bytesPerElement=40,Bt(Zr,"StructArrayLayout5i4f1i1ul2ui40");class sr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,c,f,g,y,b)}emplace(i,l,c,f,g,y,b,M){const E=8*i;return this.int16[E+0]=l,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+4]=g,this.int16[E+5]=y,this.int16[E+6]=b,this.int16[E+7]=M,i}}sr.prototype.bytesPerElement=16,Bt(sr,"StructArrayLayout3i2i2i16");class li extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,c,f,g)}emplace(i,l,c,f,g,y){const b=4*i,M=8*i;return this.float32[b+0]=l,this.float32[b+1]=c,this.float32[b+2]=f,this.int16[M+6]=g,this.int16[M+7]=y,i}}li.prototype.bytesPerElement=16,Bt(li,"StructArrayLayout2f1f2i16");class Gi extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,c,f)}emplace(i,l,c,f,g){const y=12*i,b=3*i;return this.uint8[y+0]=l,this.uint8[y+1]=c,this.float32[b+1]=f,this.float32[b+2]=g,i}}Gi.prototype.bytesPerElement=12,Bt(Gi,"StructArrayLayout2ub2f12");class zr extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const g=3*i;return this.float32[g+0]=l,this.float32[g+1]=c,this.float32[g+2]=f,i}}zr.prototype.bytesPerElement=12,Bt(zr,"StructArrayLayout3f12");class ri extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const g=3*i;return this.uint16[g+0]=l,this.uint16[g+1]=c,this.uint16[g+2]=f,i}}ri.prototype.bytesPerElement=6,Bt(ri,"StructArrayLayout3ui6");class nl extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e){const ve=this.length;return this.resize(ve+1),this.emplace(ve,i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e)}emplace(i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e,ve){const Fe=30*i,ze=15*i,Je=60*i;return this.int16[Fe+0]=l,this.int16[Fe+1]=c,this.int16[Fe+2]=f,this.float32[ze+2]=g,this.float32[ze+3]=y,this.uint16[Fe+8]=b,this.uint16[Fe+9]=M,this.uint32[ze+5]=E,this.uint32[ze+6]=I,this.uint32[ze+7]=P,this.uint16[Fe+16]=k,this.uint16[Fe+17]=z,this.uint16[Fe+18]=V,this.float32[ze+10]=j,this.float32[ze+11]=J,this.uint8[Je+48]=re,this.uint8[Je+49]=de,this.uint8[Je+50]=he,this.uint32[ze+13]=pe,this.int16[Fe+28]=_e,this.uint8[Je+58]=ve,i}}nl.prototype.bytesPerElement=60,Bt(nl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class zs extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e,ve,Fe,ze,Je,ct,Oe,qe,ut,ht){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e,ve,Fe,ze,Je,ct,Oe,qe,ut,ht)}emplace(i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J,re,de,he,pe,_e,ve,Fe,ze,Je,ct,Oe,qe,ut,ht,Ot){const at=38*i,yt=19*i;return this.int16[at+0]=l,this.int16[at+1]=c,this.int16[at+2]=f,this.float32[yt+2]=g,this.float32[yt+3]=y,this.int16[at+8]=b,this.int16[at+9]=M,this.int16[at+10]=E,this.int16[at+11]=I,this.int16[at+12]=P,this.int16[at+13]=k,this.uint16[at+14]=z,this.uint16[at+15]=V,this.uint16[at+16]=j,this.uint16[at+17]=J,this.uint16[at+18]=re,this.uint16[at+19]=de,this.uint16[at+20]=he,this.uint16[at+21]=pe,this.uint16[at+22]=_e,this.uint16[at+23]=ve,this.uint16[at+24]=Fe,this.uint16[at+25]=ze,this.uint16[at+26]=Je,this.uint16[at+27]=ct,this.uint16[at+28]=Oe,this.uint32[yt+15]=qe,this.float32[yt+16]=ut,this.float32[yt+17]=ht,this.float32[yt+18]=Ot,i}}zs.prototype.bytesPerElement=76,Bt(zs,"StructArrayLayout3i2f6i15ui1ul3f76");class Ul extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Ul.prototype.bytesPerElement=4,Bt(Ul,"StructArrayLayout1f4");class jl extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g,y,b){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,c,f,g,y,b)}emplace(i,l,c,f,g,y,b,M){const E=7*i;return this.float32[E+0]=l,this.float32[E+1]=c,this.float32[E+2]=f,this.float32[E+3]=g,this.float32[E+4]=y,this.float32[E+5]=b,this.float32[E+6]=M,i}}jl.prototype.bytesPerElement=28,Bt(jl,"StructArrayLayout7f28");class Ns extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,c,f,g)}emplace(i,l,c,f,g,y){const b=5*i;return this.float32[b+0]=l,this.float32[b+1]=c,this.float32[b+2]=f,this.float32[b+3]=g,this.float32[b+4]=y,i}}Ns.prototype.bytesPerElement=20,Bt(Ns,"StructArrayLayout5f20");class ki extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,c,f)}emplace(i,l,c,f,g){const y=6*i;return this.uint32[3*i+0]=l,this.uint16[y+2]=c,this.uint16[y+3]=f,this.uint16[y+4]=g,i}}ki.prototype.bytesPerElement=12,Bt(ki,"StructArrayLayout1ul3ui12");class os extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=c,i}}os.prototype.bytesPerElement=4,Bt(os,"StructArrayLayout2ui4");class Bs extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Bs.prototype.bytesPerElement=2,Bt(Bs,"StructArrayLayout1ui2");class rl extends bt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=c,i}}rl.prototype.bytesPerElement=8,Bt(rl,"StructArrayLayout2f8");class Lu extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Lu.prototype.size=12;class Ly extends jo{get(i){return new Lu(this,i)}}Bt(Ly,"FillExtrusionExtArray");class Oo extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Oo.prototype.size=40;class Sf extends Zr{get(i){return new Oo(this,i)}}Bt(Sf,"CollisionBoxArray");class Fy extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Fy.prototype.size=60;class bg extends nl{get(i){return new Fy(this,i)}}Bt(bg,"PlacedSymbolArray");class fd extends wt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}fd.prototype.size=76;class Fu extends zs{get(i){return new fd(this,i)}}Bt(Fu,"SymbolInstanceArray");class zu extends Ul{getoffsetX(i){return this.float32[1*i+0]}}Bt(zu,"GlyphOffsetArray");class Nu extends qt{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Bt(Nu,"SymbolLineVertexArray");class wg extends wt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wg.prototype.size=12;class Hp extends ki{get(i){return new wg(this,i)}}Bt(Hp,"FeatureIndexArray");class Bu extends wt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Bu.prototype.size=4;class e1 extends os{get(i){return new Bu(this,i)}}Bt(e1,"FillExtrusionCentroidArray");class zy extends wt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}zy.prototype.size=12;class Nn extends jo{get(i){return new zy(this,i)}}Bt(Nn,"CircleGlobeExtArray");const t1=Lt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),IM=Lt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var n1=va(function(s){s.exports=function(i,l){var c,f,g,y,b,M,E,I;for(f=i.length-(c=3&i.length),g=l,b=3432918353,M=461845907,I=0;I<f;)E=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,g=27492+(65535&(y=5*(65535&(g=(g^=E=(65535&(E=(E=(65535&E)*b+(((E>>>16)*b&65535)<<16)&4294967295)<<15|E>>>17))*M+(((E>>>16)*M&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,c){case 3:E^=(255&i.charCodeAt(I+2))<<16;case 2:E^=(255&i.charCodeAt(I+1))<<8;case 1:g^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(I)))*b+(((E>>>16)*b&65535)<<16)&4294967295)<<15|E>>>17))*M+(((E>>>16)*M&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),AM=va(function(s){s.exports=function(i,l){for(var c,f=i.length,g=l^f,y=0;f>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:g^=(255&i.charCodeAt(y+2))<<16;case 2:g^=(255&i.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),qp=n1,PM=AM;qp.murmur3=n1,qp.murmur2=PM;class Cg{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,c,f){this.ids.push(pd(i)),this.positions.push(l,c,f)}getPositions(i){const l=pd(i);let c=0,f=this.ids.length-1;for(;c<f;){const y=c+f>>1;this.ids[y]>=l?f=y:c=y+1}const g=[];for(;this.ids[c]===l;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(i,l){const c=new Float64Array(i.ids),f=new Uint32Array(i.positions);return Ny(c,f,0,c.length-1),l&&l.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(i){const l=new Cg;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function pd(s){const i=+s;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:qp(String(s))}function Ny(s,i,l,c){for(;l<c;){const f=s[l+c>>1];let g=l-1,y=c+1;for(;;){do{g++}while(s[g]<f);do{y--}while(s[y]>f);if(g>=y)break;Mg(s,g,y),Mg(i,3*g,3*y),Mg(i,3*g+1,3*y+1),Mg(i,3*g+2,3*y+2)}y-l<c-y?(Ny(s,i,l,y),l=y+1):(Ny(s,i,y+1,c),c=y)}}function Mg(s,i,l){const c=s[i];s[i]=s[l],s[l]=c}Bt(Cg,"FeaturePositionMap");class ii{constructor(i,l){this.gl=i.gl,this.location=l}}class md extends ii{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class gd extends ii{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class r1 extends ii{constructor(i,l){super(i,l),this.current=fi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const i1=new Float32Array(16),Vs=new Float32Array(9),$l=new Float32Array(4);function Zp(s){return[xt(255*s.r,255*s.g),xt(255*s.b,255*s.a)]}class Uc{constructor(i,l,c){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=c}setUniform(i,l,c){i.set(c.constantOr(this.value))}getBinding(i,l,c){return"color"===this.type?new r1(i,l):new md(i,l)}}class il{constructor(i,l){this.uniformNames=l.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio||1,this.pixelRatioTo=i.pixelRatio||1,this.patternFrom=l.tl.concat(l.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,l,c,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&i.set(g)}getBinding(i,l,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new gd(i,l):new md(i,l)}}class ol{constructor(i,l,c,f){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=l.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,c,f,g,y){const b=this.paintVertexArray.length,M=this.expression.evaluate(new X(0),l,{},g,f,y);this.paintVertexArray.resize(i),this._setPaintValue(b,i,M)}updatePaintArray(i,l,c,f,g){const y=this.expression.evaluate({zoom:0},c,f,void 0,g);this._setPaintValue(i,l,y)}_setPaintValue(i,l,c){if("color"===this.type){const f=Zp(c);for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sa{constructor(i,l,c,f,g,y){this.expression=i,this.uniformNames=l.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=l.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,l,c,f,g,y){const b=this.expression.evaluate(new X(this.zoom),l,{},g,f,y),M=this.expression.evaluate(new X(this.zoom+1),l,{},g,f,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(E,i,b,M)}updatePaintArray(i,l,c,f,g){const y=this.expression.evaluate({zoom:this.zoom},c,f,void 0,g),b=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,g);this._setPaintValue(i,l,y,b)}_setPaintValue(i,l,c,f){if("color"===this.type){const g=Zp(c),y=Zp(f);for(let b=i;b<l;b++)this.paintVertexArray.emplace(b,g[0],g[1],y[0],y[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const c=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=je(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);i.set(f)}getBinding(i,l,c){return new md(i,l)}}class jc{constructor(i,l,c,f,g,y,b){this.expression=i,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.paintVertexAttributes=("array"===c?IM:t1).members;for(let M=0;M<l.length;++M);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(i,l,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],c)}updatePaintArray(i,l,c,f,g,y){this._setPaintValues(i,l,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(i,l,c,f){if(!f||!c)return;const{min:g,mid:y,max:b}=c,M=f[g],E=f[y],I=f[b];if(M&&E&&I)for(let P=i;P<l;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,M),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,I)}_setPaintValue(i,l,c,f){i.emplace(l,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vu{constructor(i,l,c=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const g in i.paint._values){if(!c(g))continue;const y=i.paint.get(g);if(!(y instanceof Re&&Oc(y.property.specification)))continue;const b=Us(g,i.type),M=y.value,E=y.property.specification.type,I=y.property.useIntegerZoom,P=y.property.specification["property-type"],k="cross-faded"===P||"cross-faded-data-driven"===P,z="line-dasharray"===String(g)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==M.kind||z)if("source"===M.kind||z||k){const V=o1(g,E,"source");this.binders[g]=k?new jc(M,b,E,I,l,V,i.id):new ol(M,b,E,V),f.push(`/a_${g}`)}else{const V=o1(g,E,"composite");this.binders[g]=new Sa(M,b,E,I,l,V),f.push(`/z_${g}`)}else this.binders[g]=k?new il(M.value,b):new Uc(M.value,b,E),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof ol||l instanceof Sa?l.maxValue:0}populatePaintArrays(i,l,c,f,g,y){for(const b in this.binders){const M=this.binders[b];(M instanceof ol||M instanceof Sa||M instanceof jc)&&M.populatePaintArray(i,l,c,f,g,y)}}setConstantPatternPositions(i,l){for(const c in this.binders){const f=this.binders[c];f instanceof il&&f.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,c,f,g,y){let b=!1;for(const M in i){const E=l.getPositions(M);for(const I of E){const P=c.feature(I.index);for(const k in this.binders){const z=this.binders[k];if((z instanceof ol||z instanceof Sa||z instanceof jc)&&!0===z.expression.isStateDependent){const V=f.paint.get(k);z.expression=V.value,z.updatePaintArray(I.start,I.end,P,i[M],g,y),b=!0}}}}return b}defines(){const i=[];for(const l in this.binders){const c=this.binders[l];(c instanceof Uc||c instanceof il)&&i.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof ol||c instanceof Sa||c instanceof jc)for(let f=0;f<c.paintVertexAttributes.length;f++)i.push(c.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof Uc||c instanceof il||c instanceof Sa)for(const f of c.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const c=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof Uc||g instanceof il||g instanceof Sa)for(const y of g.uniformNames)if(l[y]){const b=g.getBinding(i,l[y],y);c.push({name:y,property:f,binding:b})}}return c}setUniforms(i,l,c,f){for(const{name:g,property:y,binding:b}of l)this.binders[y].setUniform(b,f,c.get(y),g)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const c=this.binders[l];if(i&&c instanceof jc){const f=2===i.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof ol||c instanceof Sa)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(i){for(const l in this.binders){const c=this.binders[l];(c instanceof ol||c instanceof Sa||c instanceof jc)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof ol||l instanceof Sa||l instanceof jc)&&l.destroy()}}}class _d{constructor(i,l,c=(()=>!0)){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new Vu(f,l,c);this.needsUpload=!1,this._featureMap=new Cg,this._bufferOffset=0}populatePaintArrays(i,l,c,f,g,y,b){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,l,f,g,y,b);void 0!==l.id&&this._featureMap.add(l.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,c,f,g){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(i,this._featureMap,l,y,f,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const By={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Us(s,i){return By[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}const Eg={"line-pattern":{source:qr,composite:qr},"fill-pattern":{source:qr,composite:qr},"fill-extrusion-pattern":{source:qr,composite:qr},"line-dasharray":{source:Ar,composite:Ar}},yd={color:{source:rl,composite:Ur},number:{source:Ul,composite:rl}};function o1(s,i,l){const c=Eg[s];return c&&c[l]||yd[i][l]}Bt(Uc,"ConstantBinder"),Bt(il,"CrossFadedConstantBinder"),Bt(ol,"SourceExpressionBinder"),Bt(jc,"CrossFadedCompositeBinder"),Bt(Sa,"CompositeExpressionBinder"),Bt(Vu,"ProgramConfiguration",{omit:["_buffers"]}),Bt(_d,"ProgramConfigurationSet");const If="-transition";class Ia extends mr{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Ve(l.layout)),l.paint)){this._transitionablePaint=new oe(l.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ft(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,c={}){null!=l&&this._validate(Vp,`layers.${this.id}.layout.${i}`,i,l,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return Rt(i,If)?this._transitionablePaint.getTransition(i.slice(0,-If.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,c={}){if(null!=l&&this._validate(Ca,`layers.${this.id}.paint.${i}`,i,l,c))return!1;if(Rt(i,If))return this._transitionablePaint.setTransition(i.slice(0,-If.length),l||void 0),!1;{const f=this._transitionablePaint._values[i],g="cross-faded-data-driven"===f.property.specification["property-type"],y=f.value.isDataDriven(),b=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(i,b,M)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,l,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),yn(i,(l,c)=>!(void 0===l||"layout"===c&&!Object.keys(l).length||"paint"===c&&!Object.keys(l).length))}_validate(i,l,c,f,g={}){return(!g||!1!==g.validate)&&zn(this,i.call(Bp,{key:l,layerType:this.type,objectKey:c,value:f,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Re&&Oc(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=kl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const s1=Lt([{name:"a_pos",components:2,type:"Int16"}],4),a1=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Mi{constructor(i=[]){this.segments=i}prepareSegment(i,l,c,f){let g=this.segments[this.segments.length-1];return i>Mi.MAX_VERTEX_ARRAY_LENGTH&&On(`Max vertices per segment is ${Mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>Mi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:l.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==f&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,c,f){return new Mi([{vertexOffset:i,primitiveOffset:l,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}Mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt(Mi,"SegmentVector");var hn=8192;class $c{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof _r?new _r(i.lng,i.lat):_r.convert(i),this}setSouthWest(i){return this._sw=i instanceof _r?new _r(i.lng,i.lat):_r.convert(i),this}extend(i){const l=this._sw,c=this._ne;let f,g;if(i instanceof _r)f=i,g=i;else{if(!(i instanceof $c))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend($c.convert(i)):this.extend(_r.convert(i)):this;if(f=i._sw,g=i._ne,!f||!g)return this}return l||c?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new _r(f.lng,f.lat),this._ne=new _r(g.lng,g.lat)),this}getCenter(){return new _r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _r(this.getWest(),this.getNorth())}getSouthEast(){return new _r(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:c}=_r.convert(i);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(i){return!i||i instanceof $c?i:new $c(i)}}const Af=6371008.8;class _r{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _r(xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,c=this.lat*l,f=i.lat*l,g=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return Af*Math.acos(Math.min(g,1))}toBounds(i=0){const l=360*i/40075017,c=l/Math.cos(Math.PI/180*this.lat);return new $c(new _r(this.lng-c,this.lat-l),new _r(this.lng+c,this.lat+l))}static convert(i){if(i instanceof _r)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new _r(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new _r(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l1=2*Math.PI*Af;function Uu(s){return l1*Math.cos(s*Math.PI/180)}function Gl(s){return(180+s)/360}function sl(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function na(s,i){return s/Uu(i)}function $o(s){return 360*s-180}function Ri(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Tg(s,i){return s*Uu(Ri(i))}const Ms=85.051129;class Hl{constructor(i,l,c=0){this.x=+i,this.y=+l,this.z=+c}static fromLngLat(i,l=0){const c=_r.convert(i);return new Hl(Gl(c.lng),sl(c.lat),na(l,c.lat))}toLngLat(){return new _r($o(this.x),Ri(this.y))}toAltitude(){return Tg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/l1*(i=Ri(this.y),1/Math.cos(i*Math.PI/180));var i}}function Dg(s,i,l,c,f,g,y,b,M){const E=(i+c)/2,I=(l+f)/2,P=new ce(E,I);b(P),function(k,z,V,j,J,re){const de=V-J,he=j-re;return Math.abs((j-z)*de-(V-k)*he)/Math.hypot(de,he)}(P.x,P.y,g.x,g.y,y.x,y.y)>=M?(Dg(s,i,l,E,I,g,P,b,M),Dg(s,E,I,c,f,P,y,b,M)):s.push(y)}function Yt(s,i,l){let c=s[0],f=c.x,g=c.y;i(c);const y=[c];for(let b=1;b<s.length;b++){const M=s[b],{x:E,y:I}=M;i(M),Dg(y,f,g,E,I,c,M,i,l),f=E,g=I,c=M}return y}function Wp(s,i,l,c,f){if(f(i,l)){const g=i.add(l).mult(.5);c(g),Wp(s,i,g,c,f),Wp(s,g,l,c,f)}else s.push(l)}function c1(s,i,l){let c=s[0];i(c);const f=[c];for(let g=1;g<s.length;g++){const y=s[g];i(y),Wp(f,c,y,i,l),c=y}return f}const Pf=Math.pow(2,14)-1,vd=-Pf-1;function u1(s,i){const l=Math.round(s.x*i),c=Math.round(s.y*i);return s.x=je(l,vd,Pf),s.y=je(c,vd,Pf),(l<s.x||l>s.x+1||c<s.y||c>s.y+1)&&On("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function ql(s,i,l){const c=s.loadGeometry(),f=s.extent,g=hn/f;if(i&&l&&l.projection.isReprojectedInTileSpace){const y=1<<i.z,{scale:b,x:M,y:E,projection:I}=l,P=k=>{const z=$o((i.x+k.x/f)/y),V=Ri((i.y+k.y/f)/y),j=I.project(z,V);k.x=(j.x*b-M)*f,k.y=(j.y*b-E)*f};for(let k=0;k<c.length;k++)if(1!==s.type)c[k]=Yt(c[k],P,1);else{const z=[];for(const V of c[k])V.x<0||V.x>=f||V.y<0||V.y>=f||(P(V),z.push(V));c[k]=z}}for(const y of c)for(const b of y)u1(b,g);return c}function ju(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ql(s):[]}}function $u(s,i,l,c,f){s.emplaceBack(2*i+(c+1)/2,2*l+(f+1)/2)}function ra(s,i,l){s.emplaceBack(i.x,i.y,i.z,16384*l[0],16384*l[1],16384*l[2])}class Xp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Sn,this.indexArray=new ri,this.segments=new Mi,this.programConfigurations=new _d(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,c,f){const g=this.layers[0],y=[];let b=null;"circle"===g.type&&(b=g.layout.get("circle-sort-key"));for(const{feature:E,id:I,index:P,sourceLayerIndex:k}of i){const z=this.layers[0]._featureFilter.needGeometry,V=ju(E,z);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),V,c))continue;const j=b?b.evaluate(V,{},c):void 0,J={id:I,properties:E.properties,type:E.type,sourceLayerIndex:k,index:P,geometry:z?V.geometry:ql(E,c,f),patterns:{},sortKey:j};y.push(J)}b&&y.sort((E,I)=>E.sortKey-I.sortKey);let M=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Nn,M=f.projection);for(const E of y){const{geometry:I,index:P,sourceLayerIndex:k}=E,z=i[P].feature;this.addFeature(E,I,P,l.availableImages,c,M),l.featureIndex.insert(z,I,P,k,this.index)}}update(i,l,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,s1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,a1.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,l,c,f,g,y){for(const b of l)for(const M of b){const E=M.x,I=M.y;if(E<0||E>=hn||I<0||I>=hn)continue;if(y){const z=y.projectTilePoint(E,I,g),V=y.upVector(g,E,I),j=this.globeExtVertexArray;ra(j,z,V),ra(j,z,V),ra(j,z,V),ra(j,z,V)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),k=P.vertexLength;$u(this.layoutVertexArray,E,I,-1,-1),$u(this.layoutVertexArray,E,I,1,-1),$u(this.layoutVertexArray,E,I,1,1),$u(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},f,g)}}function xd(s,i){for(let l=0;l<s.length;l++)if(Aa(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Aa(s,i[l]))return!0;return!!bd(s,i)}function h1(s,i,l){return!!Aa(s,i)||!!Ig(i,s,l)}function Sg(s,i){if(1===s.length)return Gu(i,s[0]);for(let l=0;l<i.length;l++){const c=i[l];for(let f=0;f<c.length;f++)if(Aa(s,c[f]))return!0}for(let l=0;l<s.length;l++)if(Gu(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(bd(s,i[l]))return!0;return!1}function Of(s,i,l){if(s.length>1){if(bd(s,i))return!0;for(let c=0;c<i.length;c++)if(Ig(i[c],s,l))return!0}for(let c=0;c<s.length;c++)if(Ig(s[c],i,l))return!0;return!1}function bd(s,i){if(0===s.length||0===i.length)return!1;for(let l=0;l<s.length-1;l++){const c=s[l],f=s[l+1];for(let g=0;g<i.length-1;g++)if(Vy(c,f,i[g],i[g+1]))return!0}return!1}function Vy(s,i,l,c){return lr(s,l,c)!==lr(i,l,c)&&lr(s,i,l)!==lr(s,i,c)}function Ig(s,i,l){const c=l*l;if(1===i.length)return s.distSqr(i[0])<c;for(let f=1;f<i.length;f++)if(Uy(s,i[f-1],i[f])<c)return!0;return!1}function Uy(s,i,l){const c=i.distSqr(l);if(0===c)return s.distSqr(i);const f=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/c;return s.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function Gu(s,i){let l,c,f,g=!1;for(let y=0;y<s.length;y++){l=s[y];for(let b=0,M=l.length-1;b<l.length;M=b++)c=l[b],f=l[M],c.y>i.y!=f.y>i.y&&i.x<(f.x-c.x)*(i.y-c.y)/(f.y-c.y)+c.x&&(g=!g)}return g}function Aa(s,i){let l=!1;for(let c=0,f=s.length-1;c<s.length;f=c++){const g=s[c],y=s[f];g.y>i.y!=y.y>i.y&&i.x<(y.x-g.x)*(i.y-g.y)/(y.y-g.y)+g.x&&(l=!l)}return l}function jy(s,i,l,c,f){for(const y of s)if(i<=y.x&&l<=y.y&&c>=y.x&&f>=y.y)return!0;const g=[new ce(i,l),new ce(i,f),new ce(c,f),new ce(c,l)];if(s.length>2)for(const y of g)if(Aa(s,y))return!0;for(let y=0;y<s.length-1;y++)if(OM(s[y],s[y+1],g))return!0;return!1}function OM(s,i,l){const c=l[0],f=l[2];if(s.x<c.x&&i.x<c.x||s.x>f.x&&i.x>f.x||s.y<c.y&&i.y<c.y||s.y>f.y&&i.y>f.y)return!1;const g=lr(s,i,l[0]);return g!==lr(s,i,l[1])||g!==lr(s,i,l[2])||g!==lr(s,i,l[3])}function Hu(s,i,l){const c=i.paint.get(s).value;return"constant"===c.kind?c.value:l.programConfigurations.get(i.id).getMaxValue(s)}function Yp(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function d1(s,i,l,c,f){if(!i[0]&&!i[1])return s;const g=ce.convert(i)._mult(f);"viewport"===l&&g._rotate(-c);const y=[];for(let b=0;b<s.length;b++)y.push(s[b].sub(g));return y}function $y(s,i,l,c){const f=ce.convert(s)._mult(c);return"viewport"===i&&f._rotate(-l),f}Bt(Xp,"CircleBucket",{omit:["layers"]});const f1=new Vt({"circle-sort-key":new Ie(we.layout_circle["circle-sort-key"])});var p1={paint:new Vt({"circle-radius":new Ie(we.paint_circle["circle-radius"]),"circle-color":new Ie(we.paint_circle["circle-color"]),"circle-blur":new Ie(we.paint_circle["circle-blur"]),"circle-opacity":new Ie(we.paint_circle["circle-opacity"]),"circle-translate":new ae(we.paint_circle["circle-translate"]),"circle-translate-anchor":new ae(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ae(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ae(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ie(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ie(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ie(we.paint_circle["circle-stroke-opacity"])}),layout:f1},qu=1e-6,ss=typeof Float32Array<"u"?Float32Array:Array;function Gy(){var s=new ss(9);return ss!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function as(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Zu(s,i,l){var c=i[0],f=i[1],g=i[2],y=i[3],b=i[4],M=i[5],E=i[6],I=i[7],P=i[8],k=i[9],z=i[10],V=i[11],j=i[12],J=i[13],re=i[14],de=i[15],he=l[0],pe=l[1],_e=l[2],ve=l[3];return s[0]=he*c+pe*b+_e*P+ve*j,s[1]=he*f+pe*M+_e*k+ve*J,s[2]=he*g+pe*E+_e*z+ve*re,s[3]=he*y+pe*I+_e*V+ve*de,s[4]=(he=l[4])*c+(pe=l[5])*b+(_e=l[6])*P+(ve=l[7])*j,s[5]=he*f+pe*M+_e*k+ve*J,s[6]=he*g+pe*E+_e*z+ve*re,s[7]=he*y+pe*I+_e*V+ve*de,s[8]=(he=l[8])*c+(pe=l[9])*b+(_e=l[10])*P+(ve=l[11])*j,s[9]=he*f+pe*M+_e*k+ve*J,s[10]=he*g+pe*E+_e*z+ve*re,s[11]=he*y+pe*I+_e*V+ve*de,s[12]=(he=l[12])*c+(pe=l[13])*b+(_e=l[14])*P+(ve=l[15])*j,s[13]=he*f+pe*M+_e*k+ve*J,s[14]=he*g+pe*E+_e*z+ve*re,s[15]=he*y+pe*I+_e*V+ve*de,s}function Gc(s,i,l){var c,f,g,y,b,M,E,I,P,k,z,V,j=l[0],J=l[1],re=l[2];return i===s?(s[12]=i[0]*j+i[4]*J+i[8]*re+i[12],s[13]=i[1]*j+i[5]*J+i[9]*re+i[13],s[14]=i[2]*j+i[6]*J+i[10]*re+i[14],s[15]=i[3]*j+i[7]*J+i[11]*re+i[15]):(f=i[1],g=i[2],y=i[3],b=i[4],M=i[5],E=i[6],I=i[7],P=i[8],k=i[9],z=i[10],V=i[11],s[0]=c=i[0],s[1]=f,s[2]=g,s[3]=y,s[4]=b,s[5]=M,s[6]=E,s[7]=I,s[8]=P,s[9]=k,s[10]=z,s[11]=V,s[12]=c*j+b*J+P*re+i[12],s[13]=f*j+M*J+k*re+i[13],s[14]=g*j+E*J+z*re+i[14],s[15]=y*j+I*J+V*re+i[15]),s}function Zl(s,i,l){var c=l[0],f=l[1],g=l[2];return s[0]=i[0]*c,s[1]=i[1]*c,s[2]=i[2]*c,s[3]=i[3]*c,s[4]=i[4]*f,s[5]=i[5]*f,s[6]=i[6]*f,s[7]=i[7]*f,s[8]=i[8]*g,s[9]=i[9]*g,s[10]=i[10]*g,s[11]=i[11]*g,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Wu(s,i,l){var c=Math.sin(l),f=Math.cos(l),g=i[4],y=i[5],b=i[6],M=i[7],E=i[8],I=i[9],P=i[10],k=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=g*f+E*c,s[5]=y*f+I*c,s[6]=b*f+P*c,s[7]=M*f+k*c,s[8]=E*f-g*c,s[9]=I*f-y*c,s[10]=P*f-b*c,s[11]=k*f-M*c,s}function wd(s,i,l){var c=Math.sin(l),f=Math.cos(l),g=i[0],y=i[1],b=i[2],M=i[3],E=i[8],I=i[9],P=i[10],k=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=g*f-E*c,s[1]=y*f-I*c,s[2]=b*f-P*c,s[3]=M*f-k*c,s[8]=g*c+E*f,s[9]=y*c+I*f,s[10]=b*c+P*f,s[11]=M*c+k*f,s}function Xu(s,i,l){var c,f,g,y=l[0],b=l[1],M=l[2],E=Math.hypot(y,b,M);return E<qu?null:(y*=E=1/E,b*=E,M*=E,c=Math.sin(i),f=Math.cos(i),s[0]=y*y*(g=1-f)+f,s[1]=b*y*g+M*c,s[2]=M*y*g-b*c,s[3]=0,s[4]=y*b*g-M*c,s[5]=b*b*g+f,s[6]=M*b*g+y*c,s[7]=0,s[8]=y*M*g+b*c,s[9]=b*M*g-y*c,s[10]=M*M*g+f,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var m1=Zu;function Ag(){var s=new ss(3);return ss!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function g1(s){var i=new ss(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i}function Hc(s){return Math.hypot(s[0],s[1],s[2])}function qc(s,i,l){var c=new ss(3);return c[0]=s,c[1]=i,c[2]=l,c}function Wl(s,i,l){return s[0]=i[0]+l[0],s[1]=i[1]+l[1],s[2]=i[2]+l[2],s}function Kp(s,i,l){return s[0]=i[0]-l[0],s[1]=i[1]-l[1],s[2]=i[2]-l[2],s}function Pg(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s}function al(s,i,l){return s[0]=Math.min(i[0],l[0]),s[1]=Math.min(i[1],l[1]),s[2]=Math.min(i[2],l[2]),s}function Jp(s,i,l){return s[0]=Math.max(i[0],l[0]),s[1]=Math.max(i[1],l[1]),s[2]=Math.max(i[2],l[2]),s}function ll(s,i,l){return s[0]=i[0]*l,s[1]=i[1]*l,s[2]=i[2]*l,s}function Qp(s,i,l,c){return s[0]=i[0]+l[0]*c,s[1]=i[1]+l[1]*c,s[2]=i[2]+l[2]*c,s}function Go(s,i){var l=i[0],c=i[1],f=i[2],g=l*l+c*c+f*f;return g>0&&(g=1/Math.sqrt(g)),s[0]=i[0]*g,s[1]=i[1]*g,s[2]=i[2]*g,s}function ia(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function ls(s,i,l){var c=i[0],f=i[1],g=i[2],y=l[0],b=l[1],M=l[2];return s[0]=f*M-g*b,s[1]=g*y-c*M,s[2]=c*b-f*y,s}function oi(s,i,l){var c=i[0],f=i[1],g=i[2],y=l[3]*c+l[7]*f+l[11]*g+l[15];return s[0]=(l[0]*c+l[4]*f+l[8]*g+l[12])/(y=y||1),s[1]=(l[1]*c+l[5]*f+l[9]*g+l[13])/y,s[2]=(l[2]*c+l[6]*f+l[10]*g+l[14])/y,s}function Og(s,i,l){var c=l[0],f=l[1],g=l[2],y=i[0],b=i[1],M=i[2],E=f*M-g*b,I=g*y-c*M,P=c*b-f*y,k=f*P-g*I,z=g*E-c*P,V=c*I-f*E,j=2*l[3];return I*=j,P*=j,z*=2,V*=2,s[0]=y+(E*=j)+(k*=2),s[1]=b+I+z,s[2]=M+P+V,s}var kf,oa=Kp,_1=Pg,y1=Hc;function Hy(s,i,l){return s[0]=i[0]*l,s[1]=i[1]*l,s[2]=i[2]*l,s[3]=i[3]*l,s}function Zc(s,i,l){var c=i[0],f=i[1],g=i[2],y=i[3];return s[0]=l[0]*c+l[4]*f+l[8]*g+l[12]*y,s[1]=l[1]*c+l[5]*f+l[9]*g+l[13]*y,s[2]=l[2]*c+l[6]*f+l[10]*g+l[14]*y,s[3]=l[3]*c+l[7]*f+l[11]*g+l[15]*y,s}function qy(){var s=new ss(4);return ss!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Zy(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Wy(s,i,l){l*=.5;var c=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),M=Math.cos(l);return s[0]=c*M+y*b,s[1]=f*M+g*b,s[2]=g*M-f*b,s[3]=y*M-c*b,s}function Xy(s,i,l){l*=.5;var c=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),M=Math.cos(l);return s[0]=c*M-g*b,s[1]=f*M+y*b,s[2]=g*M+c*b,s[3]=y*M-f*b,s}Ag(),kf=new ss(4),ss!=Float32Array&&(kf[0]=0,kf[1]=0,kf[2]=0,kf[3]=0),Ag(),qc(1,0,0),qc(0,1,0),qy(),qy(),Gy();class Yy{constructor(i,l){this.pos=i,this.dir=l}intersectsPlane(i,l,c){const f=ia(l,this.dir);if(Math.abs(f)<1e-6)return!1;const g=((i[0]-this.pos[0])*l[0]+(i[1]-this.pos[1])*l[1]+(i[2]-this.pos[2])*l[2])/f;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,l,c){if(j=(z=this.pos)[0],J=z[1],re=z[2],de=(V=i)[0],he=V[1],pe=V[2],Math.abs(j-de)<=qu*Math.max(1,Math.abs(j),Math.abs(de))&&Math.abs(J-he)<=qu*Math.max(1,Math.abs(J),Math.abs(he))&&Math.abs(re-pe)<=qu*Math.max(1,Math.abs(re),Math.abs(pe))||0===l)return c[0]=c[1]=c[2]=0,!1;var z,V,j,J,re,de,he,pe;const[f,g,y]=this.dir,b=this.pos[0]-i[0],M=this.pos[1]-i[1],E=this.pos[2]-i[2],I=f*f+g*g+y*y,P=2*(b*f+M*g+E*y),k=P*P-4*I*(b*b+M*M+E*E-l*l);if(k<0){const z=Math.max(-P/2,0),V=b+f*z,j=M+g*z,J=E+y*z,re=Math.hypot(V,j,J);return c[0]=V*l/re,c[1]=j*l/re,c[2]=J*l/re,!1}{const z=(-P-Math.sqrt(k))/(2*I);if(z<0){const V=Math.hypot(b,M,E);return c[0]=b*l/V,c[1]=M*l/V,c[2]=E*l/V,!1}return c[0]=b+f*z,c[1]=M+g*z,c[2]=E+y*z,!0}}}class kg{constructor(i,l,c,f,g){this.TL=i,this.TR=l,this.BR=c,this.BL=f,this.horizon=g}static fromInvProjectionMatrix(i,l,c){const f=[-1,1,1],g=[1,1,1],y=[1,-1,1],b=[-1,-1,1],M=oi(f,f,i),E=oi(g,g,i),I=oi(y,y,i),P=oi(b,b,i);return new kg(M,E,I,P,l/c)}}class Yu{constructor(i,l){this.points=i,this.planes=l}static fromInvProjectionMatrix(i,l,c,f){const g=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const E=Zc([],M,i),I=1/E[3]/l*g;return(P=E)[0]=(k=E)[0]*(z=[I,I,f?1/E[3]:I,I])[0],P[1]=k[1]*z[1],P[2]=k[2]*z[2],P[3]=k[3]*z[3],P;var P,k,z}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const E=Go([],ls([],oa([],y[M[0]],y[M[1]]),oa([],y[M[2]],y[M[1]]))),I=-ia(E,y[M[1]]);return E.concat(I)});return new Yu(y,b)}}class Es{constructor(i,l){this.min=i,this.max=l,this.center=ll([],Wl([],this.min,this.max),.5)}quadrant(i){const l=[i%2==0,i<2],c=g1(this.min),f=g1(this.max);for(let g=0;g<l.length;g++)c[g]=l[g]?this.min[g]:this.center[g],f[g]=l[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new Es(c,f)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,l=this.max;return[[i[0],i[1],i[2]],[l[0],i[1],i[2]],[l[0],l[1],i[2]],[i[0],l[1],i[2]],[i[0],i[1],l[2]],[l[0],i[1],l[2]],[l[0],l[1],l[2]],[i[0],l[1],l[2]]]}intersects(i){const l=this.getCorners();let c=!0;for(let f=0;f<i.planes.length;f++){const g=i.planes[f];let y=0;for(let b=0;b<l.length;b++)y+=ia(g,l[b])+g[3]>=0;if(0===y)return 0;y!==l.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<i.points.length;b++){const M=i.points[b][f]-this.min[f];g=Math.min(g,M),y=Math.max(y,M)}if(y<0||g>this.max[f]-this.min[f])return 0}return 1}}function Pa(s,i,l,c,f,g,y,b,M){if(g&&s.queryGeometry.isAboveHorizon)return!1;g&&(M*=s.pixelToTileUnitsFactor);const E=s.tileID.canonical,I=l.projection.upVectorScale(E,l.center.lat,l.worldSize).metersToTile;for(const P of i)for(const k of P){const z=k.add(b),V=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(z.x,z.y,!0):0,j=l.projection.projectTilePoint(z.x,z.y,E);if(V>0){const he=l.projection.upVector(E,z.x,z.y);j.x+=he[0]*I*V,j.y+=he[1]*I*V,j.z+=he[2]*I*V}const J=g?z:Rf(j.x,j.y,j.z,c),re=g?s.tilespaceRays.map(he=>Jy(he,V)):s.queryGeometry.screenGeometry,de=Zc([],[j.x,j.y,j.z,1],c);if(!y&&g?M*=de[3]/l.cameraToCenterDistance:y&&!g&&(M*=l.cameraToCenterDistance/de[3]),g){const he=Ri((k.y/hn+E.y)/(1<<E.z));M/=l.projection.pixelsPerMeter(he,1)/na(1,he)}if(h1(re,J,M))return!0}return!1}function Rf(s,i,l,c){const f=Zc([],[s,i,l,1],c);return new ce(f[0]/f[3],f[1]/f[3])}const Rg=qc(0,0,0),Ky=qc(0,0,1);function Jy(s,i){const l=Ag();return Rg[2]=i,s.intersectsPlane(Rg,Ky,l),new ce(l[0],l[1])}class v1 extends Xp{}function x1(s,{width:i,height:l},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*l*c);return s.width=i,s.height=l,s.data=f,s}function b1(s,i,l){const{width:c,height:f}=i;c===s.width&&f===s.height||(Lf(s,i,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,f)},l),s.width=c,s.height=f,s.data=i.data)}function Lf(s,i,l,c,f,g){if(0===f.width||0===f.height)return i;if(f.width>s.width||f.height>s.height||l.x>s.width-f.width||l.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||c.x>i.width-f.width||c.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=s.data,b=i.data;for(let M=0;M<f.height;M++){const E=((l.y+M)*s.width+l.x)*g,I=((c.y+M)*i.width+c.x)*g;for(let P=0;P<f.width*g;P++)b[I+P]=y[E+P]}return i}Bt(v1,"HeatmapBucket",{omit:["layers"]});class Oa{constructor(i,l){x1(this,i,1,l)}resize(i){b1(this,new Oa(i),1)}clone(){return new Oa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,c,f,g){Lf(i,l,c,f,g,1)}}class Ho{constructor(i,l){x1(this,i,4,l)}resize(i){b1(this,new Ho(i),4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,c,f,g){Lf(i,l,c,f,g,4)}}Bt(Oa,"AlphaImage"),Bt(Ho,"RGBAImage");var kM={paint:new Vt({"heatmap-radius":new Ie(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ie(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ae(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ye(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ae(we.paint_heatmap["heatmap-opacity"])})};function Qy(s){const i={},l=s.resolution||256,c=s.clips?s.clips.length:1,f=s.image||new Ho({width:l,height:c}),g=(y,b,M)=>{i[s.evaluationKey]=M;const E=s.expression.evaluate(i);f.data[y+b+0]=Math.floor(255*E.r/E.a),f.data[y+b+1]=Math.floor(255*E.g/E.a),f.data[y+b+2]=Math.floor(255*E.b/E.a),f.data[y+b+3]=Math.floor(255*E.a)};if(s.clips)for(let y=0,b=0;y<c;++y,b+=4*l)for(let M=0,E=0;M<l;M++,E+=4){const I=M/(l-1),{start:P,end:k}=s.clips[y];g(b,E,P*(1-I)+k*I)}else for(let y=0,b=0;y<l;y++,b+=4)g(0,b,y/(l-1));return f}var e0={paint:new Vt({"hillshade-illumination-direction":new ae(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ae(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ae(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ae(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ae(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ae(we.paint_hillshade["hillshade-accent-color"])})};const w1=Lt([{name:"a_pos",components:2,type:"Int16"}],4),{members:C1}=w1;var em=Ff,M1=Ff;function Ff(s,i,l){l=l||2;var c,f,g,y,b,M,E,I=i&&i.length,P=I?i[0]*l:s.length,k=zf(s,0,P,l,!0),z=[];if(!k||k.next===k.prev)return z;if(I&&(k=function(j,J,re,de){var he,pe,_e,ve=[];for(he=0,pe=J.length;he<pe;he++)(_e=zf(j,J[he]*de,he<pe-1?J[he+1]*de:j.length,de,!1))===_e.next&&(_e.steiner=!0),ve.push(S1(_e));for(ve.sort(Yl),he=0;he<ve.length;he++)re=Xl(re=Lg(ve[he],re),re.next);return re}(s,i,k,l)),s.length>80*l){c=g=s[0],f=y=s[1];for(var V=l;V<P;V+=l)(b=s[V])<c&&(c=b),(M=s[V+1])<f&&(f=M),b>g&&(g=b),M>y&&(y=M);E=0!==(E=Math.max(g-c,y-f))?1/E:0}return Ku(k,z,l,c,f,E),z}function zf(s,i,l,c,f){var g,y;if(f===nm(s,i,l,c)>0)for(g=i;g<l;g+=c)y=t0(g,s[g],s[g+1],y);else for(g=l-c;g>=i;g-=c)y=t0(g,s[g],s[g+1],y);return y&&zg(y,y.next)&&(Nf(y),y=y.next),y}function Xl(s,i){if(!s)return s;i||(i=s);var l,c=s;do{if(l=!1,c.steiner||!zg(c,c.next)&&0!==Li(c.prev,c,c.next))c=c.next;else{if(Nf(c),(c=i=c.prev)===c.next)break;l=!0}}while(l||c!==i);return i}function Ku(s,i,l,c,f,g,y){if(s){!y&&g&&function(I,P,k,z){var V=I;do{null===V.z&&(V.z=Fg(V.x,V.y,P,k,z)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==I);V.prevZ.nextZ=null,V.prevZ=null,function(j){var J,re,de,he,pe,_e,ve,Fe,ze=1;do{for(re=j,j=null,pe=null,_e=0;re;){for(_e++,de=re,ve=0,J=0;J<ze&&(ve++,de=de.nextZ);J++);for(Fe=ze;ve>0||Fe>0&&de;)0!==ve&&(0===Fe||!de||re.z<=de.z)?(he=re,re=re.nextZ,ve--):(he=de,de=de.nextZ,Fe--),pe?pe.nextZ=he:j=he,he.prevZ=pe,pe=he;re=de}pe.nextZ=null,ze*=2}while(_e>1)}(V)}(s,c,f,g);for(var b,M,E=s;s.prev!==s.next;)if(b=s.prev,M=s.next,g?ci(s,c,f,g):E1(s))i.push(b.i/l),i.push(s.i/l),i.push(M.i/l),Nf(s),s=M.next,E=M.next;else if((s=M)===E){y?1===y?Ku(s=Cd(Xl(s),i,l),i,l,c,f,g,2):2===y&&T1(s,i,l,c,f,g):Ku(Xl(s),i,l,c,f,g,1);break}}}function E1(s){var i=s.prev,l=s,c=s.next;if(Li(i,l,c)>=0)return!1;for(var f=s.next.next;f!==s.prev;){if(Md(i.x,i.y,l.x,l.y,c.x,c.y,f.x,f.y)&&Li(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ci(s,i,l,c){var f=s.prev,g=s,y=s.next;if(Li(f,g,y)>=0)return!1;for(var b=f.x>g.x?f.x>y.x?f.x:y.x:g.x>y.x?g.x:y.x,M=f.y>g.y?f.y>y.y?f.y:y.y:g.y>y.y?g.y:y.y,E=Fg(f.x<g.x?f.x<y.x?f.x:y.x:g.x<y.x?g.x:y.x,f.y<g.y?f.y<y.y?f.y:y.y:g.y<y.y?g.y:y.y,i,l,c),I=Fg(b,M,i,l,c),P=s.prevZ,k=s.nextZ;P&&P.z>=E&&k&&k.z<=I;){if(P!==s.prev&&P!==s.next&&Md(f.x,f.y,g.x,g.y,y.x,y.y,P.x,P.y)&&Li(P.prev,P,P.next)>=0||(P=P.prevZ,k!==s.prev&&k!==s.next&&Md(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&Li(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;P&&P.z>=E;){if(P!==s.prev&&P!==s.next&&Md(f.x,f.y,g.x,g.y,y.x,y.y,P.x,P.y)&&Li(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;k&&k.z<=I;){if(k!==s.prev&&k!==s.next&&Md(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&Li(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function Cd(s,i,l){var c=s;do{var f=c.prev,g=c.next.next;!zg(f,g)&&Ed(f,c,c.next,g)&&Ju(f,g)&&Ju(g,f)&&(i.push(f.i/l),i.push(c.i/l),i.push(g.i/l),Nf(c),Nf(c.next),c=s=g),c=c.next}while(c!==s);return Xl(c)}function T1(s,i,l,c,f,g){var y=s;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&I1(y,b)){var M=Qu(y,b);return y=Xl(y,y.next),M=Xl(M,M.next),Ku(y,i,l,c,f,g),void Ku(M,i,l,c,f,g)}b=b.next}y=y.next}while(y!==s)}function Yl(s,i){return s.x-i.x}function Lg(s,i){var l=function(g,y){var b,M=y,E=g.x,I=g.y,P=-1/0;do{if(I<=M.y&&I>=M.next.y&&M.next.y!==M.y){var k=M.x+(I-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(k<=E&&k>P){if(P=k,k===E){if(I===M.y)return M;if(I===M.next.y)return M.next}b=M.x<M.next.x?M:M.next}}M=M.next}while(M!==y);if(!b)return null;if(E===P)return b;var z,V=b,j=b.x,J=b.y,re=1/0;M=b;do{E>=M.x&&M.x>=j&&E!==M.x&&Md(I<J?E:P,I,j,J,I<J?P:E,I,M.x,M.y)&&(z=Math.abs(I-M.y)/(E-M.x),Ju(M,g)&&(z<re||z===re&&(M.x>b.x||M.x===b.x&&D1(b,M)))&&(b=M,re=z)),M=M.next}while(M!==V);return b}(s,i);if(!l)return i;var c=Qu(l,s),f=Xl(l,l.next);return Xl(c,c.next),i===l?f:i}function D1(s,i){return Li(s.prev,s,i.prev)<0&&Li(i.next,s,s.next)<0}function Fg(s,i,l,c,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-l)*f)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-c)*f)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function S1(s){var i=s,l=s;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==s);return l}function Md(s,i,l,c,f,g,y,b){return(f-y)*(i-b)-(s-y)*(g-b)>=0&&(s-y)*(c-b)-(l-y)*(i-b)>=0&&(l-y)*(g-b)-(f-y)*(c-b)>=0}function I1(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,c){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==c.i&&f.next.i!==c.i&&Ed(f,f.next,l,c))return!0;f=f.next}while(f!==l);return!1}(s,i)&&(Ju(s,i)&&Ju(i,s)&&function(l,c){var f=l,g=!1,y=(l.x+c.x)/2,b=(l.y+c.y)/2;do{f.y>b!=f.next.y>b&&f.next.y!==f.y&&y<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next}while(f!==l);return g}(s,i)&&(Li(s.prev,s,i.prev)||Li(s,i.prev,i))||zg(s,i)&&Li(s.prev,s,s.next)>0&&Li(i.prev,i,i.next)>0)}function Li(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function zg(s,i){return s.x===i.x&&s.y===i.y}function Ed(s,i,l,c){var f=tm(Li(s,i,l)),g=tm(Li(s,i,c)),y=tm(Li(l,c,s)),b=tm(Li(l,c,i));return f!==g&&y!==b||!(0!==f||!Td(s,l,i))||!(0!==g||!Td(s,c,i))||!(0!==y||!Td(l,s,c))||!(0!==b||!Td(l,i,c))}function Td(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function tm(s){return s>0?1:s<0?-1:0}function Ju(s,i){return Li(s.prev,s,s.next)<0?Li(s,i,s.next)>=0&&Li(s,s.prev,i)>=0:Li(s,i,s.prev)<0||Li(s,s.next,i)<0}function Qu(s,i){var l=new Ng(s.i,s.x,s.y),c=new Ng(i.i,i.x,i.y),f=s.next,g=i.prev;return s.next=i,i.prev=s,l.next=f,f.prev=l,c.next=l,l.prev=c,g.next=c,c.prev=g,c}function t0(s,i,l,c){var f=new Ng(s,i,l);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Nf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ng(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nm(s,i,l,c){for(var f=0,g=i,y=l-c;g<l;g+=c)f+=(s[y]-s[g])*(s[g+1]+s[y+1]),y=g;return f}function A1(s,i,l,c,f){n0(s,i,l||0,c||s.length-1,f||P1)}function n0(s,i,l,c,f){for(;c>l;){if(c-l>600){var g=c-l+1,y=i-l+1,b=Math.log(g),M=.5*Math.exp(2*b/3),E=.5*Math.sqrt(b*M*(g-M)/g)*(y-g/2<0?-1:1);n0(s,i,Math.max(l,Math.floor(i-y*M/g+E)),Math.min(c,Math.floor(i+(g-y)*M/g+E)),f)}var I=s[i],P=l,k=c;for(Bf(s,l,i),f(s[c],I)>0&&Bf(s,l,c);P<k;){for(Bf(s,P,k),P++,k--;f(s[P],I)<0;)P++;for(;f(s[k],I)>0;)k--}0===f(s[l],I)?Bf(s,l,k):Bf(s,++k,c),k<=i&&(l=k+1),i<=k&&(c=k-1)}}function Bf(s,i,l){var c=s[i];s[i]=s[l],s[l]=c}function P1(s,i){return s<i?-1:s>i?1:0}function Vf(s,i){const l=s.length;if(l<=1)return[s];const c=[];let f,g;for(let y=0;y<l;y++){const b=di(s[y]);0!==b&&(s[y].area=Math.abs(b),void 0===g&&(g=b<0),g===b<0?(f&&c.push(f),f=[s[y]]):f.push(s[y]))}if(f&&c.push(f),i>1)for(let y=0;y<c.length;y++)c[y].length<=i||(A1(c[y],i,1,c[y].length-1,O1),c[y]=c[y].slice(0,i));return c}function O1(s,i){return i.area-s.area}function Bg(s,i,l){const c=l.patternDependencies;let f=!1;for(const g of i){const y=g.paint.get(`${s}-pattern`);y.isConstant()||(f=!0);const b=y.constantOr(null);b&&(f=!0,c[b.to]=!0,c[b.from]=!0)}return f}function Vg(s,i,l,c,f){const g=f.patternDependencies;for(const y of i){const b=y.paint.get(`${s}-pattern`).value;if("constant"!==b.kind){let M=b.evaluate({zoom:c-1},l,{},f.availableImages),E=b.evaluate({zoom:c},l,{},f.availableImages),I=b.evaluate({zoom:c+1},l,{},f.availableImages);M=M&&M.name?M.name:M,E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,g[M]=!0,g[E]=!0,g[I]=!0,l.patterns[y.id]={min:M,mid:E,max:I}}}return l}Ff.deviation=function(s,i,l,c){var f=i&&i.length,g=Math.abs(nm(s,0,f?i[0]*l:s.length,l));if(f)for(var y=0,b=i.length;y<b;y++)g-=Math.abs(nm(s,i[y]*l,y<b-1?i[y+1]*l:s.length,l));var M=0;for(y=0;y<c.length;y+=3){var E=c[y]*l,I=c[y+1]*l,P=c[y+2]*l;M+=Math.abs((s[E]-s[P])*(s[I+1]-s[E+1])-(s[E]-s[I])*(s[P+1]-s[E+1]))}return 0===g&&0===M?0:Math.abs((M-g)/g)},Ff.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},c=0,f=0;f<s.length;f++){for(var g=0;g<s[f].length;g++)for(var y=0;y<i;y++)l.vertices.push(s[f][g][y]);f>0&&l.holes.push(c+=s[f-1].length)}return l},em.default=M1;class Uf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Sn,this.indexArray=new ri,this.indexArray2=new os,this.programConfigurations=new _d(i.layers,i.zoom),this.segments=new Mi,this.segments2=new Mi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=i.projection}populate(i,l,c,f){this.hasPattern=Bg("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:M,index:E,sourceLayerIndex:I}of i){const P=this.layers[0]._featureFilter.needGeometry,k=ju(b,P);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),k,c))continue;const z=g?g.evaluate(k,{},c,l.availableImages):void 0,V={id:M,properties:b.properties,type:b.type,sourceLayerIndex:I,index:E,geometry:P?k.geometry:ql(b,c,f),patterns:{},sortKey:z};y.push(V)}g&&y.sort((b,M)=>b.sortKey-M.sortKey);for(const b of y){const{geometry:M,index:E,sourceLayerIndex:I}=b;if(this.hasPattern){const P=Vg("fill",this.layers,b,this.zoom,l);this.patternFeatures.push(P)}else this.addFeature(b,M,E,c,{},l.availableImages);l.featureIndex.insert(i[E].feature,M,E,I,this.index)}}update(i,l,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c,f)}addFeatures(i,l,c,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,C1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,c,f,g,y=[]){for(const b of Vf(l,500)){let M=0;for(const V of b)M+=V.length;const E=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),I=E.vertexLength,P=[],k=[];for(const V of b){if(0===V.length)continue;V!==b[0]&&k.push(P.length/2);const j=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),J=j.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(J+V.length-1,J),P.push(V[0].x),P.push(V[0].y);for(let re=1;re<V.length;re++)this.layoutVertexArray.emplaceBack(V[re].x,V[re].y),this.indexArray2.emplaceBack(J+re-1,J+re),P.push(V[re].x),P.push(V[re].y);j.vertexLength+=V.length,j.primitiveLength+=V.length}const z=em(P,k);for(let V=0;V<z.length;V+=3)this.indexArray.emplaceBack(I+z[V],I+z[V+1],I+z[V+2]);E.vertexLength+=M,E.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,y,f)}}Bt(Uf,"FillBucket",{omit:["layers","patternFeatures"]});const k1=new Vt({"fill-sort-key":new Ie(we.layout_fill["fill-sort-key"])});var R1={paint:new Vt({"fill-antialias":new ae(we.paint_fill["fill-antialias"]),"fill-opacity":new Ie(we.paint_fill["fill-opacity"]),"fill-color":new Ie(we.paint_fill["fill-color"]),"fill-outline-color":new Ie(we.paint_fill["fill-outline-color"]),"fill-translate":new ae(we.paint_fill["fill-translate"]),"fill-translate-anchor":new ae(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ke(we.paint_fill["fill-pattern"])}),layout:k1};const cs=Lt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ug=Lt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),r0=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jg}=cs;var ko=cl;function cl(s,i,l,c,f){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=c,this._values=f,s.readFields($g,this,i)}function $g(s,i,l){1==s?i.id=l.readVarint():2==s?function(c,f){for(var g=c.readVarint()+c.pos;c.pos<g;){var y=f._keys[c.readVarint()],b=f._values[c.readVarint()];f.properties[y]=b}}(l,i):3==s?i.type=l.readVarint():4==s&&(i._geometry=l.pos)}function L1(s){for(var i,l,c=0,f=0,g=s.length,y=g-1;f<g;y=f++)c+=((l=s[y]).x-(i=s[f]).x)*(i.y+l.y);return c}cl.types=["Unknown","Point","LineString","Polygon"],cl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,c=1,f=0,g=0,y=0,b=[];s.pos<l;){if(f<=0){var M=s.readVarint();c=7&M,f=M>>3}if(f--,1===c||2===c)g+=s.readSVarint(),y+=s.readSVarint(),1===c&&(i&&b.push(i),i=[]),i.push(new ce(g,y));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&b.push(i),b},cl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,c=0,f=0,g=0,y=1/0,b=-1/0,M=1/0,E=-1/0;s.pos<i;){if(c<=0){var I=s.readVarint();l=7&I,c=I>>3}if(c--,1===l||2===l)(f+=s.readSVarint())<y&&(y=f),f>b&&(b=f),(g+=s.readSVarint())<M&&(M=g),g>E&&(E=g);else if(7!==l)throw new Error("unknown command "+l)}return[y,M,b,E]},cl.prototype.toGeoJSON=function(s,i,l){var c,f,g=this.extent*Math.pow(2,l),y=this.extent*s,b=this.extent*i,M=this.loadGeometry(),E=cl.types[this.type];function I(z){for(var V=0;V<z.length;V++){var j=z[V];z[V]=[360*(j.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+b)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(c=0;c<M.length;c++)P[c]=M[c][0];I(M=P);break;case 2:for(c=0;c<M.length;c++)I(M[c]);break;case 3:for(M=function(z){var V=z.length;if(V<=1)return[z];for(var j,J,re=[],de=0;de<V;de++){var he=L1(z[de]);0!==he&&(void 0===J&&(J=he<0),J===he<0?(j&&re.push(j),j=[z[de]]):j.push(z[de]))}return j&&re.push(j),re}(M),c=0;c<M.length;c++)for(f=0;f<M[c].length;f++)I(M[c][f])}1===M.length?M=M[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:M},properties:this.properties};return"id"in this&&(k.id=this.id),k};var o0=Gg;function Gg(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(F1,this,i),this.length=this._features.length}function F1(s,i,l){15===s?i.version=l.readVarint():1===s?i.name=l.readString():5===s?i.extent=l.readVarint():2===s?i._features.push(l.pos):3===s?i._keys.push(l.readString()):4===s&&i._values.push(function(c){for(var f=null,g=c.readVarint()+c.pos;c.pos<g;){var y=c.readVarint()>>3;f=1===y?c.readString():2===y?c.readFloat():3===y?c.readDouble():4===y?c.readVarint64():5===y?c.readVarint():6===y?c.readSVarint():7===y?c.readBoolean():null}return f}(l))}function s0(s,i,l){if(3===s){var c=new o0(l,l.readVarint()+l.pos);c.length&&(i[c.name]=c)}}Gg.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new ko(this._pbf,i,this.extent,this._keys,this._values)};var eh={VectorTile:function(s,i){this.layers=s.readFields(s0,{},i)},VectorTileFeature:ko,VectorTileLayer:o0};function jf(s,i,l,c){const f=[],g=0===c?(y,b,M,E,I,P)=>{y.push(new ce(P,M+(P-b)/(E-b)*(I-M)))}:(y,b,M,E,I,P)=>{y.push(new ce(b+(P-M)/(I-M)*(E-b),P))};for(const y of s){const b=[];for(const M of y){if(M.length<=2)continue;const E=[];for(let k=0;k<M.length-1;k++){const z=M[k].x,V=M[k].y,j=M[k+1].x,J=M[k+1].y,re=0===c?z:V,de=0===c?j:J;re<i?de>i&&g(E,z,V,j,J,i):re>l?de<l&&g(E,z,V,j,J,l):E.push(M[k]),de<i&&re>=i&&g(E,z,V,j,J,i),de>l&&re<=l&&g(E,z,V,j,J,l)}let I=M[M.length-1];const P=0===c?I.x:I.y;P>=i&&P<=l&&E.push(I),E.length&&(I=E[E.length-1],E[0].x===I.x&&E[0].y===I.y||E.push(E[0]),b.push(E))}b.length&&f.push(b)}return f}const z1=eh.VectorTileFeature.types,N1=Math.pow(2,13);function $f(s,i,l,c,f,g,y,b){s.emplaceBack((i<<1)+y,(l<<1)+g,(Math.floor(c*N1)<<1)+f,Math.round(b))}function Gf(s,i,l){s.emplaceBack(i.x,i.y,i.z,16384*l[0],16384*l[1],16384*l[2])}class a0{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(i.x,i.y),this.max=new ce(i.x,i.y))}append(i,l){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,f=this.max;i.x<c.x?c.x=i.x:i.x>f.x&&(f.x=i.x),i.y<c.y?c.y=i.y:i.y>f.y&&(f.y=i.y),((0===i.x||i.x===hn)&&i.x===l.x)!=((0===i.y||i.y===hn)&&i.y===l.y)&&this.processBorderOverlap(i,l),l.x<0!=i.x<0&&this.addBorderIntersection(0,Un(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>hn!=i.x>hn&&this.addBorderIntersection(1,Un(l.y,i.y,(hn-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,Un(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>hn!=i.y>hn&&this.addBorderIntersection(3,Un(l.x,i.x,(hn-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];l<c[0]&&(c[0]=l),l>c[1]&&(c[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,l.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,l.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((l,c)=>l+c.edges,0);return 0!==i?this.acc.div(i)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0)}}class Hf{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new vn,this.centroidVertexArray=new e1,this.indexArray=new ri,this.programConfigurations=new _d(i.layers,i.zoom),this.segments=new Mi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=i.enableTerrain}populate(i,l,c,f){this.features=[],this.hasPattern=Bg("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/hn/(1<<g.z)}(c);for(const{feature:g,id:y,index:b,sourceLayerIndex:M}of i){const E=this.layers[0]._featureFilter.needGeometry,I=ju(g,E);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),I,c))continue;const P={id:y,sourceLayerIndex:M,index:b,geometry:E?I.geometry:ql(g,c,f),properties:g.properties,type:g.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(Vg("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,b,c,{},l.availableImages,f),l.featureIndex.insert(g,P.geometry,b,M,this.index,k)}this.sortBorders()}addFeatures(i,l,c,f,g){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,l,c,f,g)}this.sortBorders()}update(i,l,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jg),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,r0.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Ug.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,c,f,g,y,b){const M=[new ce(0,0),new ce(hn,hn)],E=b.projection,I="globe"===E.name,P=this.enableTerrain&&!I?new a0:null;I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ly);const k=Vf(l,500);for(let j=k.length-1;j>=0;j--){const J=k[j];(0===J.length||(z=J[0]).every(re=>re.x<=0)||z.every(re=>re.x>=hn)||z.every(re=>re.y<=0)||z.every(re=>re.y>=hn))&&k.splice(j,1)}var z;let V;if(I)V=l0(k,M,f);else{V=[];for(const j of k)V.push({polygon:j,bounds:M})}for(const j of V){const J=j.polygon;let re=0,de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Fe=0;Fe<J.length;Fe++){const ze=J[Fe];if(0===ze.length)continue;re+=ze.length;let Je=0;P&&P.startRing(ze[0]);for(let ct=0;ct<ze.length;ct++){const Oe=ze[ct];if(ct>=1){const qe=ze[ct-1];if(!Dd(Oe,qe,j.bounds)){P&&P.append(Oe,qe),de.vertexLength+4>Mi.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ut=Oe.sub(qe)._perp(),ht=ut.x/(Math.abs(ut.x)+Math.abs(ut.y)),Ot=ut.y>0?1:0,at=qe.dist(Oe);Je+at>32768&&(Je=0),$f(this.layoutVertexArray,Oe.x,Oe.y,ht,Ot,0,0,Je),$f(this.layoutVertexArray,Oe.x,Oe.y,ht,Ot,0,1,Je),Je+=at,$f(this.layoutVertexArray,qe.x,qe.y,ht,Ot,0,0,Je),$f(this.layoutVertexArray,qe.x,qe.y,ht,Ot,0,1,Je);const yt=de.vertexLength;if(this.indexArray.emplaceBack(yt,yt+2,yt+1),this.indexArray.emplaceBack(yt+1,yt+2,yt+3),de.vertexLength+=4,de.primitiveLength+=2,I){const In=this.layoutVertexExtArray,$n=E.projectTilePoint(Oe.x,Oe.y,f),Qt=E.projectTilePoint(qe.x,qe.y,f),Ut=E.upVector(f,Oe.x,Oe.y),Zn=E.upVector(f,qe.x,qe.y);Gf(In,$n,Ut),Gf(In,$n,Ut),Gf(In,Qt,Zn),Gf(In,Qt,Zn)}}}}}if(de.vertexLength+re>Mi.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(re,this.layoutVertexArray,this.indexArray)),"Polygon"!==z1[i.type])continue;const he=[],pe=[],_e=de.vertexLength;for(let Fe=0;Fe<J.length;Fe++){const ze=J[Fe];if(0!==ze.length){ze!==J[0]&&pe.push(he.length/2);for(let Je=0;Je<ze.length;Je++){const ct=ze[Je];$f(this.layoutVertexArray,ct.x,ct.y,0,0,1,1,0),he.push(ct.x),he.push(ct.y),P&&P.currentPolyCount.top++,I&&Gf(this.layoutVertexExtArray,E.projectTilePoint(ct.x,ct.y,f),E.upVector(f,ct.x,ct.y))}}}const ve=em(he,pe);for(let Fe=0;Fe<ve.length;Fe+=3)this.indexArray.emplaceBack(_e+ve[Fe],_e+ve[Fe+2],_e+ve[Fe+1]);de.primitiveLength+=ve.length/3,de.vertexLength+=re}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const j=P.borders,J=this.featuresOnBorder.push(P)-1;for(let re=0;re<4;re++)j[re][0]!==Number.MAX_VALUE&&this.borders[re].push(J)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,y,f)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((l,c)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,l,c=!0){let f,g;if(i)if(0!==i.y){const b=l.span()._mult(this.tileToMeter);f=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(b.x/10)),g=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else f=Math.ceil(7*(i.x+450)),g=0;else f=0,g=+c;let y=c?this.centroidVertexArray.length:l.vertexArrayOffset;for(const b of l.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let M=0;M<2*b.edges;M++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,f,g);for(let M=0;M<b.top;M++)this.centroidVertexArray.emplace(y++,f,g)}}}function Dd(s,i,l){return s.x===i.x&&(s.x<l[0].x||s.x>l[1].x)||s.y===i.y&&(s.y<l[0].y||s.y>l[1].y)}function ul(){const s=Math.PI/32,i=Math.tan(s),l=Af;return l*Math.sqrt(1+2*i*i)-l}function l0(s,i,l){const c=1<<l.z,f=$o(l.x/c),g=$o((l.x+1)/c),y=Ri(l.y/c),b=Ri((l.y+1)/c);return function(M,E,I,P,k=0,z){const V=[];if(!M.length||!I||!P)return V;const j=(ve,Fe)=>{for(const ze of ve)V.push({polygon:ze,bounds:Fe})},J=Math.ceil(Math.log2(I)),re=Math.ceil(Math.log2(P)),de=J-re,he=[];for(let ve=0;ve<Math.abs(de);ve++)he.push(de>0?0:1);for(let ve=0;ve<Math.min(J,re);ve++)he.push(0),he.push(1);let pe=M;if(pe=jf(pe,E[0].y-k,E[1].y+k,1),pe=jf(pe,E[0].x-k,E[1].x+k,0),!pe.length)return V;const _e=[];for(he.length?_e.push({polygons:pe,bounds:E,depth:0}):j(pe,E);_e.length;){const ve=_e.pop(),Fe=ve.depth,ze=he[Fe],Je=ve.bounds[0],ct=ve.bounds[1],Oe=0===ze?Je.x:Je.y,qe=0===ze?ct.x:ct.y,ut=z?z(ze,Oe,qe):.5*(Oe+qe),ht=jf(ve.polygons,Oe-k,ut+k,ze),Ot=jf(ve.polygons,ut-k,qe+k,ze);if(ht.length){const at=[Je,new ce(0===ze?ut:ct.x,1===ze?ut:ct.y)];he.length>Fe+1?_e.push({polygons:ht,bounds:at,depth:Fe+1}):j(ht,at)}if(Ot.length){const at=[new ce(0===ze?ut:Je.x,1===ze?ut:Je.y),ct];he.length>Fe+1?_e.push({polygons:Ot,bounds:at,depth:Fe+1}):j(Ot,at)}}return V}(s,i,Math.ceil((g-f)/11.25),Math.ceil((y-b)/11.25),1,(M,E,I)=>{if(0===M)return.5*(E+I);{const P=Ri((l.y+E/hn)/c);return(sl(.5*(Ri((l.y+I/hn)/c)+P))*c-l.y)*hn}})}Bt(Hf,"FillExtrusionBucket",{omit:["layers","features"]}),Bt(a0,"PartMetadata");var RM={paint:new Vt({"fill-extrusion-opacity":new ae(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ie(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ae(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ae(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ke(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ie(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ie(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ae(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function B1(s,i,l){var c=2*Math.PI*6378137/256/Math.pow(2,l);return[s*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class qf{constructor(i,l,c){this.z=i,this.x=l,this.y=c,this.key=th(0,i,i,l,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l){const c=(y=this.y,b=this.z,M=B1(256*(g=this.x),256*(y=Math.pow(2,b)-y-1),b),E=B1(256*(g+1),256*(y+1),b),M[0]+","+M[1]+","+E[0]+","+E[1]),f=function(g,y,b){let M,E="";for(let I=g;I>0;I--)M=1<<I-1,E+=(y&M?1:0)+(b&M?2:0);return E}(this.z,this.x,this.y);var g,y,b,M,E;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class V1{constructor(i,l){this.wrap=i,this.canonical=l,this.key=th(i,l.z,l.z,l.x,l.y)}}class Kr{constructor(i,l,c,f,g){this.overscaledZ=i,this.wrap=l,this.canonical=new qf(c,+f,+g),this.key=0===l&&i===c?this.canonical.key:th(l,i,c,f,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new Kr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Kr(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return th(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return th(this.wrap*+l,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Kr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Kr(l,this.wrap,l,c,f),new Kr(l,this.wrap,l,c+1,f),new Kr(l,this.wrap,l,c,f+1),new Kr(l,this.wrap,l,c+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Kr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Kr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new V1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function th(s,i,l,c,f){const g=1<<Math.min(l,22);let y=g*(f%g)+c%g;return s&&l<22&&(y+=g*g*((s<0?-2*s-1:2*s)%(1<<2*(22-l)))),16*(32*y+l)+(i-l)}function nh(s,i){return s.x*i.x+s.y*i.y}function c0(s,i){if(1===s.length){let l=0;const c=i[l++];let f;for(;!f||c.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const g=i[l],y=s[0],b=f.sub(c),M=g.sub(c),E=y.sub(c),I=nh(b,b),P=nh(b,M),k=nh(M,M),z=nh(E,b),V=nh(E,M),j=I*k-P*P,J=(k*z-P*V)/j,re=(I*V-P*z)/j,de=c.z*(1-J-re)+f.z*J+g.z*re;if(isFinite(de))return de}return 1/0}{let l=1/0;for(const c of i)l=Math.min(l,c.z);return l}}function Zf(s){const i=new ce(s[0],s[1]);return i.z=s[2],i}function Sd(s,i,l,c,f,g,y,b){const M=y*f.getElevationAt(s,i,!0,!0),E=0!==g[0],I=E?0===g[1]?y*(g[0]/7-450):y*function(P,k,z){const V=Math.floor(k[0]/8),j=Math.floor(k[1]/8),J=10*(k[0]-8*V),re=10*(k[1]-8*j),de=P.getElevationAt(V,j,!0,!0),he=P.getMeterToDEM(z),pe=Math.floor(.5*(J*he-1)),_e=Math.floor(.5*(re*he-1)),ve=P.tileCoordToPixel(V,j),Fe=2*pe+1,ze=2*_e+1,Je=(In=Fe,$n=ze,[(Ot=P).getElevationAtPixel(at=ve.x-pe,yt=ve.y-_e,!0),Ot.getElevationAtPixel(at+$n,yt,!0),Ot.getElevationAtPixel(at,yt+$n,!0),Ot.getElevationAtPixel(at+In,yt+$n,!0)]),ct=Math.abs(Je[0]-Je[1]),Oe=Math.abs(Je[2]-Je[3]),qe=Math.abs(Je[0]-Je[2])+Math.abs(Je[1]-Je[3]),ut=Math.min(.25,.5*he*(ct+Oe)/Fe),ht=Math.min(.25,.5*he*qe/ze);var Ot,at,yt,In,$n;return de+Math.max(ut*J,ht*re)}(f,g,b):M;return{base:M+(0===l)?-1:l,top:E?Math.max(I+c,M+l+2):M+c}}Bt(qf,"CanonicalTileID"),Bt(Kr,"OverscaledTileID",{omit:["projMatrix"]});const u0=Lt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:h0}=u0,Hg=Lt([{name:"a_packed",components:4,type:"Float32"}]),{members:qg}=Hg,d0=eh.VectorTileFeature.types,LM=Math.cos(Math.PI/180*37.5);class Kl{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new hr,this.layoutVertexArray2=new Ur,this.indexArray=new ri,this.programConfigurations=new _d(i.layers,i.zoom),this.segments=new Mi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,c,f){this.hasPattern=Bg("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:I,id:P,index:k,sourceLayerIndex:z}of i){const V=this.layers[0]._featureFilter.needGeometry,j=ju(I,V);if(!this.layers[0]._featureFilter.filter(new X(this.zoom),j,c))continue;const J=g?g.evaluate(j,{},c):void 0,re={id:P,properties:I.properties,type:I.type,sourceLayerIndex:z,index:k,geometry:V?j.geometry:ql(I,c,f),patterns:{},sortKey:J};y.push(re)}g&&y.sort((I,P)=>I.sortKey-P.sortKey);const{lineAtlas:b,featureIndex:M}=l,E=this.addConstantDashes(b);for(const I of y){const{geometry:P,index:k,sourceLayerIndex:z}=I;if(E&&this.addFeatureDashes(I,b),this.hasPattern){const V=Vg("line",this.layers,I,this.zoom,l);this.patternFeatures.push(V)}else this.addFeature(I,P,k,c,b.positions,l.availableImages);M.insert(i[k].feature,P,k,z,this.index)}}addConstantDashes(i){let l=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==g.kind)l=!0;else{const y=g.value,b=f.value;if(!b)continue;i.addDash(b.from,y),i.addDash(b.to,y),b.other&&i.addDash(b.other,y)}}return l}addFeatureDashes(i,l){const c=this.zoom;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let b,M,E,I,P,k;if("constant"===g.kind){const J=g.value;if(!J)continue;b=J.other||J.to,M=J.to,E=J.from}else b=g.evaluate({zoom:c-1},i),M=g.evaluate({zoom:c},i),E=g.evaluate({zoom:c+1},i);"constant"===y.kind?I=P=k=y.value:(I=y.evaluate({zoom:c-1},i),P=y.evaluate({zoom:c},i),k=y.evaluate({zoom:c+1},i)),l.addDash(b,I),l.addDash(M,P),l.addDash(E,k);const z=l.getKey(b,I),V=l.getKey(M,P),j=l.getKey(E,k);i.patterns[f.id]={min:z,mid:V,max:j}}}update(i,l,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c,f)}addFeatures(i,l,c,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,l,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,qg)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,h0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,c,f,g,y){const b=this.layers[0].layout,M=b.get("line-join").evaluate(i,{}),E=b.get("line-cap").evaluate(i,{}),I=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const k of l)this.addLine(k,i,M,E,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,y,f)}addLine(i,l,c,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<i.length-1;re++)this.totalDistance+=i[re].dist(i[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===d0[l.type];let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let E=0;for(;E<M-1&&i[E].equals(i[E+1]);)E++;if(M<(b?3:2))return;"bevel"===c&&(g=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let k,z,V,j,J;this.e1=this.e2=-1,b&&(k=i[M-2],J=i[E].sub(k)._unit()._perp());for(let re=E;re<M;re++){if(V=re===M-1?b?i[E+1]:void 0:i[re+1],V&&i[re].equals(V))continue;J&&(j=J),k&&(z=k),k=i[re],J=V?V.sub(k)._unit()._perp():j,j=j||J;let de=j.add(J);0===de.x&&0===de.y||de._unit();const he=j.x*J.x+j.y*J.y,pe=de.x*J.x+de.y*J.y,_e=0!==pe?1/pe:1/0,ve=2*Math.sqrt(2-2*pe),Fe=pe<LM&&z&&V,ze=j.x*J.y-j.y*J.x>0;if(Fe&&re>E){const Oe=k.dist(z);if(Oe>2*I){const qe=k.sub(k.sub(z)._mult(I/Oe)._round());this.updateDistance(z,qe),this.addCurrentVertex(qe,j,0,0,P),z=qe}}const Je=z&&V;let ct=Je?c:b?"butt":f;if(Je&&"round"===ct&&(_e<y?ct="miter":_e<=2&&(ct="fakeround")),"miter"===ct&&_e>g&&(ct="bevel"),"bevel"===ct&&(_e>2&&(ct="flipbevel"),_e<g&&(ct="miter")),z&&this.updateDistance(z,k),"miter"===ct)de._mult(_e),this.addCurrentVertex(k,de,0,0,P);else if("flipbevel"===ct){if(_e>100)de=J.mult(-1);else{const Oe=_e*j.add(J).mag()/j.sub(J).mag();de._perp()._mult(Oe*(ze?-1:1))}this.addCurrentVertex(k,de,0,0,P),this.addCurrentVertex(k,de.mult(-1),0,0,P)}else if("bevel"===ct||"fakeround"===ct){const Oe=-Math.sqrt(_e*_e-1),qe=ze?Oe:0,ut=ze?0:Oe;if(z&&this.addCurrentVertex(k,j,qe,ut,P),"fakeround"===ct){const ht=Math.round(180*ve/Math.PI/20);for(let Ot=1;Ot<ht;Ot++){let at=Ot/ht;if(.5!==at){const In=at-.5;at+=at*In*(at-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*In*In+(.848013+he*(.215638*he-1.06021)))}const yt=J.sub(j)._mult(at)._add(j)._unit()._mult(ze?-1:1);this.addHalfVertex(k,yt.x,yt.y,!1,ze,0,P)}}V&&this.addCurrentVertex(k,J,-qe,-ut,P)}else if("butt"===ct)this.addCurrentVertex(k,de,0,0,P);else if("square"===ct){const Oe=z?1:-1;z||this.addCurrentVertex(k,de,Oe,Oe,P),this.addCurrentVertex(k,de,0,0,P),z&&this.addCurrentVertex(k,de,Oe,Oe,P)}else"round"===ct&&(z&&(this.addCurrentVertex(k,j,0,0,P),this.addCurrentVertex(k,j,1,1,P,!0)),V&&(this.addCurrentVertex(k,J,-1,-1,P,!0),this.addCurrentVertex(k,J,0,0,P)));if(Fe&&re<M-1){const Oe=k.dist(V);if(Oe>2*I){const qe=k.add(V.sub(k)._mult(I/Oe)._round());this.updateDistance(k,qe),this.addCurrentVertex(qe,J,0,0,P),k=qe}}}}addCurrentVertex(i,l,c,f,g,y=!1){const b=l.y*f-l.x,M=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*c,l.y-l.x*c,y,!1,c,g),this.addHalfVertex(i,b,M,y,!0,-f,g)}addHalfVertex({x:i,y:l},c,f,g,y,b,M){this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(l<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),M.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}Bt(Kl,"LineBucket",{omit:["layers","patternFeatures"]});const Zg=new Vt({"line-cap":new Ie(we.layout_line["line-cap"]),"line-join":new Ie(we.layout_line["line-join"]),"line-miter-limit":new ae(we.layout_line["line-miter-limit"]),"line-round-limit":new ae(we.layout_line["line-round-limit"]),"line-sort-key":new Ie(we.layout_line["line-sort-key"])});var Wg={paint:new Vt({"line-opacity":new Ie(we.paint_line["line-opacity"]),"line-color":new Ie(we.paint_line["line-color"]),"line-translate":new ae(we.paint_line["line-translate"]),"line-translate-anchor":new ae(we.paint_line["line-translate-anchor"]),"line-width":new Ie(we.paint_line["line-width"]),"line-gap-width":new Ie(we.paint_line["line-gap-width"]),"line-offset":new Ie(we.paint_line["line-offset"]),"line-blur":new Ie(we.paint_line["line-blur"]),"line-dasharray":new Ke(we.paint_line["line-dasharray"]),"line-pattern":new Ke(we.paint_line["line-pattern"]),"line-gradient":new Ye(we.paint_line["line-gradient"]),"line-trim-offset":new ae(we.paint_line["line-trim-offset"])}),layout:Zg};const f0=new class extends Ie{possiblyEvaluate(s,i){return i=new X(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,l,c){return i=He({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,l,c)}}(Wg.paint.properties["line-width"].specification);function rm(s,i){return i>0?i+2*s:s}f0.useIntegerZoom=!0;const U1=Lt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),j1=Lt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$1=Lt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const G1=Lt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),H1=Lt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const p0=Lt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),m0=Lt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lt([{name:"triangle",components:3,type:"Uint16"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lt([{type:"Float32",name:"offsetX"}]),Lt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ka=128;function Wf(s,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new X(s+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:f}=l;let g=0;for(;g<c.length&&c[g]<=s;)g++;g=Math.max(0,g-1);let y=g;for(;y<c.length&&c[y]<s+1;)y++;y=Math.min(c.length-1,y);const b=c[g],M=c[y];return"composite"===l.kind?{kind:"composite",minZoom:b,maxZoom:M,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:M,minSize:l.evaluate(new X(b)),maxSize:l.evaluate(new X(M)),interpolationType:f}}}function im(s,{uSize:i,uSizeT:l},{lowerSize:c,upperSize:f}){return"source"===s.kind?c/ka:"composite"===s.kind?Un(c/ka,f/ka,l):i}function Id(s,i){let l=0,c=0;if("constant"===s.kind)c=s.layoutSize;else if("source"!==s.kind){const{interpolationType:f,minZoom:g,maxZoom:y}=s,b=f?je(Ci.interpolationFactor(f,i,g,y),0,1):0;"camera"===s.kind?c=Un(s.minSize,s.maxSize,b):l=b}return{uSizeT:l,uSize:c}}var g0=Object.freeze({__proto__:null,getSizeData:Wf,evaluateSizeForFeature:im,evaluateSizeForZoom:Id,SIZE_PACK_FACTOR:ka});function _0(s,i,l){return s.sections.forEach(c=>{c.text=function(f,g,y){const b=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===b?f=f.toLocaleUpperCase():"lowercase"===b&&(f=f.toLocaleLowerCase()),Q.applyArabicShaping&&(f=Q.applyArabicShaping(f)),f}(c.text,i,l)}),s}const Ra={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function y0(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function v0(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var x0=function(s,i,l,c,f){var g,y,b=8*f-c-1,M=(1<<b)-1,E=M>>1,I=-7,P=l?f-1:0,k=l?-1:1,z=s[i+P];for(P+=k,g=z&(1<<-I)-1,z>>=-I,I+=b;I>0;g=256*g+s[i+P],P+=k,I-=8);for(y=g&(1<<-I)-1,g>>=-I,I+=c;I>0;y=256*y+s[i+P],P+=k,I-=8);if(0===g)g=1-E;else{if(g===M)return y?NaN:1/0*(z?-1:1);y+=Math.pow(2,c),g-=E}return(z?-1:1)*y*Math.pow(2,g-c)},Xg=function(s,i,l,c,f,g){var y,b,M,E=8*g-f-1,I=(1<<E)-1,P=I>>1,k=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,z=c?0:g-1,V=c?1:-1,j=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(b=isNaN(i)?1:0,y=I):(y=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-y))<1&&(y--,M*=2),(i+=y+P>=1?k/M:k*Math.pow(2,1-P))*M>=2&&(y++,M/=2),y+P>=I?(b=0,y=I):y+P>=1?(b=(i*M-1)*Math.pow(2,f),y+=P):(b=i*Math.pow(2,P-1)*Math.pow(2,f),y=0));f>=8;s[l+z]=255&b,z+=V,b/=256,f-=8);for(y=y<<f|b,E+=f;E>0;s[l+z]=255&y,z+=V,y/=256,E-=8);s[l+z-V]|=128*j},Wc=Nr;function Nr(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Nr.Varint=0,Nr.Fixed64=1,Nr.Bytes=2,Nr.Fixed32=5;var om=4294967296,Yg=1/om,Kg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function La(s){return s.type===Nr.Bytes?s.readVarint()+s.pos:s.pos+1}function Xf(s,i,l){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(c);for(var f=l.pos-1;f>=s;f--)l.buf[f+c]=l.buf[f]}function sm(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function b0(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function Jg(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function w0(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function Qg(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function Yf(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function q1(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function C0(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function Z1(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function am(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function ih(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function lm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}function M0(s,i,l){i.glyphs=[],1===s&&l.readMessage(FM,i)}function FM(s,i,l){if(3===s){const{id:c,bitmap:f,width:g,height:y,left:b,top:M,advance:E}=l.readMessage(E0,{});i.glyphs.push({id:c,bitmap:new Oa({width:g+6,height:y+6},f),metrics:{width:g,height:y,left:b,top:M,advance:E}})}else 4===s?i.ascender=l.readSVarint():5===s&&(i.descender=l.readSVarint())}function E0(s,i,l){1===s?i.id=l.readVarint():2===s?i.bitmap=l.readBytes():3===s?i.width=l.readVarint():4===s?i.height=l.readVarint():5===s?i.left=l.readSVarint():6===s?i.top=l.readSVarint():7===s&&(i.advance=l.readVarint())}function e_(s){let i=0,l=0;for(const y of s)i+=y.w*y.h,l=Math.max(l,y.w);s.sort((y,b)=>b.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,g=0;for(const y of s)for(let b=c.length-1;b>=0;b--){const M=c[b];if(!(y.w>M.w||y.h>M.h)){if(y.x=M.x,y.y=M.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===M.w&&y.h===M.h){const E=c.pop();b<c.length&&(c[b]=E)}else y.h===M.h?(M.x+=y.w,M.w-=y.w):y.w===M.w?(M.y+=y.h,M.h-=y.h):(c.push({x:M.x+y.w,y:M.y,w:M.w-y.w,h:y.h}),M.y+=y.h,M.h-=y.h);break}}return{w:f,h:g,fill:i/(f*g)||0}}Nr.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var c=this.readVarint(),f=c>>3,g=this.pos;this.type=7&c,s(f,i,this),this.pos===g&&this.skip(c)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=am(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=lm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=am(this.buf,this.pos)+am(this.buf,this.pos+4)*om;return this.pos+=8,s},readSFixed64:function(){var s=am(this.buf,this.pos)+lm(this.buf,this.pos+4)*om;return this.pos+=8,s},readFloat:function(){var s=x0(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=x0(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,c=this.buf;return i=127&(l=c[this.pos++]),l<128?i:(i|=(127&(l=c[this.pos++]))<<7,l<128?i:(i|=(127&(l=c[this.pos++]))<<14,l<128?i:(i|=(127&(l=c[this.pos++]))<<21,l<128?i:function(f,g,y){var b,M,E=y.buf;if(b=(112&(M=E[y.pos++]))>>4,M<128||(b|=(127&(M=E[y.pos++]))<<3,M<128)||(b|=(127&(M=E[y.pos++]))<<10,M<128)||(b|=(127&(M=E[y.pos++]))<<17,M<128)||(b|=(127&(M=E[y.pos++]))<<24,M<128)||(b|=(1&(M=E[y.pos++]))<<31,M<128))return function rh(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(f,b,g);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=c[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Kg?Kg.decode(this.buf.subarray(i,s)):function(l,c,f){for(var g="",y=c;y<f;){var b,M,E,I=l[y],P=null,k=I>239?4:I>223?3:I>191?2:1;if(y+k>f)break;1===k?I<128&&(P=I):2===k?128==(192&(b=l[y+1]))&&(P=(31&I)<<6|63&b)<=127&&(P=null):3===k?(M=l[y+2],128==(192&(b=l[y+1]))&&128==(192&M)&&((P=(15&I)<<12|(63&b)<<6|63&M)<=2047||P>=55296&&P<=57343)&&(P=null)):4===k&&(M=l[y+2],E=l[y+3],128==(192&(b=l[y+1]))&&128==(192&M)&&128==(192&E)&&((P=(15&I)<<18|(63&b)<<12|(63&M)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,k=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),y+=k}return g}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Nr.Bytes)return s.push(this.readVarint(i));var l=La(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Nr.Bytes)return s.push(this.readSVarint());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Nr.Bytes)return s.push(this.readBoolean());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Nr.Bytes)return s.push(this.readFloat());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Nr.Bytes)return s.push(this.readDouble());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Nr.Bytes)return s.push(this.readFixed32());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Nr.Bytes)return s.push(this.readSFixed32());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Nr.Bytes)return s.push(this.readFixed64());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Nr.Bytes)return s.push(this.readSFixed64());var i=La(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Nr.Varint)for(;this.buf[this.pos++]>127;);else if(i===Nr.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Nr.Fixed32)this.pos+=4;else{if(i!==Nr.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ih(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ih(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ih(this.buf,-1&s,this.pos),ih(this.buf,Math.floor(s*Yg),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ih(this.buf,-1&s,this.pos),ih(this.buf,Math.floor(s*Yg),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var c,f,g,b;if(i>=0?(c=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,f=f+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),g=c,(b=l).buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7),function(g,y){var b=(7&g)<<4;y.buf[y.pos++]|=b|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(c,f,g){for(var y,b,M=0;M<f.length;M++){if((y=f.charCodeAt(M))>55295&&y<57344){if(!b){y>56319||M+1===f.length?(c[g++]=239,c[g++]=191,c[g++]=189):b=y;continue}if(y<56320){c[g++]=239,c[g++]=191,c[g++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(c[g++]=239,c[g++]=191,c[g++]=189,b=null);y<128?c[g++]=y:(y<2048?c[g++]=y>>6|192:(y<65536?c[g++]=y>>12|224:(c[g++]=y>>18|240,c[g++]=y>>12&63|128),c[g++]=y>>6&63|128),c[g++]=63&y|128)}return g}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&Xf(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),Xg(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Xg(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var c=this.pos-l;c>=128&&Xf(l,c,this),this.pos=l-1,this.writeVarint(c),this.pos+=c},writeMessage:function(s,i,l){this.writeTag(s,Nr.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,sm,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,b0,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,Qg,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,Jg,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,w0,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,Yf,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,q1,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,C0,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,Z1,i)},writeBytesField:function(s,i){this.writeTag(s,Nr.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Nr.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Nr.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Nr.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Nr.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Nr.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Nr.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Nr.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Nr.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Nr.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,Boolean(i))}};class cm{constructor(i,{pixelRatio:l,version:c,stretchX:f,stretchY:g,content:y}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=g,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class T0{constructor(i,l){const c={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(i,c,g),this.addImages(l,f,g);const{w:y,h:b}=e_(g),M=new Ho({width:y||1,height:b||1});for(const E in i){const I=i[E],P=c[E].paddedRect;Ho.copy(I.data,M,{x:0,y:0},{x:P.x+1,y:P.y+1},I.data)}for(const E in l){const I=l[E],P=f[E].paddedRect,k=P.x+1,z=P.y+1,V=I.data.width,j=I.data.height;Ho.copy(I.data,M,{x:0,y:0},{x:k,y:z},I.data),Ho.copy(I.data,M,{x:0,y:j-1},{x:k,y:z-1},{width:V,height:1}),Ho.copy(I.data,M,{x:0,y:0},{x:k,y:z+j},{width:V,height:1}),Ho.copy(I.data,M,{x:V-1,y:0},{x:k-1,y:z},{width:1,height:j}),Ho.copy(I.data,M,{x:0,y:0},{x:k+V,y:z},{width:1,height:j})}this.image=M,this.iconPositions=c,this.patternPositions=f}addImages(i,l,c){for(const f in i){const g=i[f],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};c.push(y),l[f]=new cm(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),l),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),l)}patchUpdatedImage(i,l,c){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,g]=i.tl;c.update(l.data,void 0,{x:f,y:g})}}Bt(cm,"ImagePosition"),Bt(T0,"ImageAtlas");const js={horizontal:1,vertical:2,horizontalOnly:3};class us{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const c=new us;return c.scale=i||1,c.fontStack=l,c}static forImage(i){const l=new us;return l.imageName=i,l}}class Ad{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const c=new Ad;for(let f=0;f<i.sections.length;f++){const g=i.sections[f];g.image?c.addImageSection(g):c.addTextSection(g,l)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(l,c){let f="";for(let g=0;g<l.length;g++){const y=l.charCodeAt(g+1)||null,b=l.charCodeAt(g-1)||null;f+=!c&&(y&&_(y)&&!Ra[l[g+1]]||b&&_(b)&&!Ra[l[g-1]])||!Ra[l[g]]?l[g]:Ra[l[g]]}return f}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&hm[this.text.charCodeAt(c)];c++)i++;let l=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&hm[this.text.charCodeAt(c)];c--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const c=new Ad;return c.text=this.text.substring(i,l),c.sectionIndex=this.sectionIndex.slice(i,l),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(us.forText(i.scale,i.fontStack||l));const c=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(c)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void On("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(us.forImage(l)),this.sectionIndex.push(this.sections.length-1)):On("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function um(s,i,l,c,f,g,y,b,M,E,I,P,k,z,V,j){const J=Ad.fromFeature(s,f);let re;P===js.vertical&&J.verticalizePunctuation(k);const{processBidirectionalText:de,processStyledBidirectionalText:he}=Q;if(de&&1===J.sections.length){re=[];const ve=de(J.toString(),t_(J,E,g,i,c,z,V));for(const Fe of ve){const ze=new Ad;ze.text=Fe,ze.sections=J.sections;for(let Je=0;Je<Fe.length;Je++)ze.sectionIndex.push(0);re.push(ze)}}else if(he){re=[];const ve=he(J.text,J.sectionIndex,t_(J,E,g,i,c,z,V));for(const Fe of ve){const ze=new Ad;ze.text=Fe[0],ze.sectionIndex=Fe[1],ze.sections=J.sections,re.push(ze)}}else re=function(ve,Fe){const ze=[],Je=ve.text;let ct=0;for(const Oe of Fe)ze.push(ve.substring(ct,Oe)),ct=Oe;return ct<Je.length&&ze.push(ve.substring(ct,Je.length)),ze}(J,t_(J,E,g,i,c,z,V));const pe=[],_e={positionedLines:pe,text:J.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ve,Fe,ze,Je,ct,Oe,qe,ut,ht,Ot,at,yt){let In=0,$n=0,Qt=0;const Ut="right"===ut?1:"left"===ut?0:.5;let Zn=!1;for(const Xn of ct){const Qn=Xn.getSections();for(const Or of Qn){if(Or.imageName)continue;const Rr=Fe[Or.fontStack];if(Rr&&(Zn=void 0!==Rr.ascender&&void 0!==Rr.descender,!Zn))break}if(!Zn)break}let Bn=0;for(const Xn of ct){Xn.trim();const Qn=Xn.getMaxScale(),Or=24*(Qn-1),Rr={positionedGlyphs:[],lineOffset:0};ve.positionedLines[Bn]=Rr;const xr=Rr.positionedGlyphs;let Br=0;if(!Xn.length()){$n+=Oe,++Bn;continue}let Jr=0,yo=0;for(let Kn=0;Kn<Xn.length();Kn++){const Ei=Xn.getSection(Kn),Ro=Xn.getSectionIndex(Kn),fr=Xn.getCharCode(Kn);let Qr=Ei.scale,Lo=null,Wr=null,vi=null,si=24,Ii=0;const vo=!(ht===js.horizontal||!at&&!h(fr)||at&&(hm[fr]||(Xt=fr,dr(Xt)||ni(Xt)||Vr(Xt)||Tf(Xt)||Ru(Xt))));if(Ei.imageName){const Wo=Je[Ei.imageName];if(!Wo)continue;vi=Ei.imageName,ve.iconsInText=ve.iconsInText||!0,Wr=Wo.paddedRect;const xo=Wo.displaySize;Qr=24*Qr/yt,Lo={width:xo[0],height:xo[1],left:1,top:-3,advance:vo?xo[1]:xo[0],localGlyph:!1},Ii=Zn?-Lo.height*Qr:24*Qn-17-xo[1]*Qr,si=Lo.advance;const Na=(vo?xo[0]:xo[1])*Qr-24*Qn;Na>0&&Na>Br&&(Br=Na)}else{const Wo=ze[Ei.fontStack];if(!Wo)continue;Wo[fr]&&(Wr=Wo[fr]);const xo=Fe[Ei.fontStack];if(!xo)continue;const Na=xo.glyphs[fr];if(!Na)continue;if(Lo=Na.metrics,si=8203!==fr?24:0,Zn){const _h=void 0!==xo.ascender?Math.abs(xo.ascender):0,jd=void 0!==xo.descender?Math.abs(xo.descender):0,$d=(_h+jd)*Qr;Jr<$d&&(Jr=$d,yo=(_h-jd)/2*Qr),Ii=-_h*Qr}else Ii=24*(Qn-Qr)-17}vo?(ve.verticalizable=!0,xr.push({glyph:fr,imageName:vi,x:In,y:$n+Ii,vertical:vo,scale:Qr,localGlyph:Lo.localGlyph,fontStack:Ei.fontStack,sectionIndex:Ro,metrics:Lo,rect:Wr}),In+=si*Qr+Ot):(xr.push({glyph:fr,imageName:vi,x:In,y:$n+Ii,vertical:vo,scale:Qr,localGlyph:Lo.localGlyph,fontStack:Ei.fontStack,sectionIndex:Ro,metrics:Lo,rect:Wr}),In+=Lo.advance*Qr+Ot)}0!==xr.length&&(Qt=Math.max(In-Ot,Qt),Zn?Qe(xr,Ut,Br,yo,Oe*Qn/2):Qe(xr,Ut,Br,0,Oe/2)),In=0;const Ts=Oe*Qn+Br;Rr.lineOffset=Math.max(Br,Or),$n+=Ts,++Bn}var Xt;const Fi=$n,{horizontalAlign:ui,verticalAlign:yi}=Hn(qe);(function(Xn,Qn,Or,Rr,xr,Br){const Jr=(Qn-Or)*xr,yo=-Br*Rr;for(const Ts of Xn)for(const Kn of Ts.positionedGlyphs)Kn.x+=Jr,Kn.y+=yo})(ve.positionedLines,Ut,ui,yi,Qt,Fi),ve.top+=-yi*Fi,ve.bottom=ve.top+Fi,ve.left+=-ui*Qt,ve.right=ve.left+Qt,ve.hasBaseline=Zn}(_e,i,l,c,re,y,b,M,P,E,k,j),!function(ve){for(const Fe of ve)if(0!==Fe.positionedGlyphs.length)return!1;return!0}(pe)&&_e}const hm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},W1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function D0(s,i,l,c,f,g){if(i.imageName){const y=c[i.imageName];return y?y.displaySize[0]*i.scale*24/g+f:0}{const y=l[i.fontStack],b=y&&y.glyphs[s];return b?b.metrics.advance*i.scale+f:0}}function S0(s,i,l,c){const f=Math.pow(s-i,2);return c?s<i?f/2:2*f:f+Math.abs(l)*l}function I0(s,i,l){let c=0;return 10===s&&(c-=1e4),l&&(c+=150),40!==s&&65288!==s||(c+=50),41!==i&&65289!==i||(c+=50),c}function A0(s,i,l,c,f,g){let y=null,b=S0(i,l,f,g);for(const M of c){const E=S0(i-M.x,l,f,g)+M.badness;E<=b&&(y=M,b=E)}return{index:s,x:i,priorBreak:y,badness:b}}function P0(s){return s?P0(s.priorBreak).concat(s.index):[]}function t_(s,i,l,c,f,g,y){if("point"!==g)return[];if(!s)return[];const b=[],M=function(k,z,V,j,J,re){let de=0;for(let he=0;he<k.length();he++){const pe=k.getSection(he);de+=D0(k.getCharCode(he),pe,j,J,z,re)}return de/Math.max(1,Math.ceil(de/V))}(s,i,l,c,f,y),E=s.text.indexOf("\u200b")>=0;let I=0;for(let k=0;k<s.length();k++){const z=s.getSection(k),V=s.getCharCode(k);if(hm[V]||(I+=D0(V,z,c,f,i,y)),k<s.length()-1){const j=!((P=V)<11904||!(Cf(P)||jp(P)||Ta(P)||Gp(P)||Cs(P)||Oi(P)||$p(P)||is(P)||Mf(P)||tl(P)||Qi(P)||dd(P)||Nc(P)||Ea(P)||wf(P)||Vc(P)||Bc(P)||hd(P)||ud(P)||ta(P)));(W1[V]||j||z.imageName)&&b.push(A0(k+1,I,M,b,I0(V,s.getCharCode(k+1),j&&E),!1))}}var P;return P0(A0(s.length(),I,M,b,0,!0))}function Hn(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Qe(s,i,l,c,f){if(!(i||l||c||f))return;const g=s.length-1,y=s[g],b=(y.x+y.metrics.advance*y.scale)*i;for(let M=0;M<=g;M++)s[M].x-=b,s[M].y+=l+c+f}function O0(s,i,l){const{horizontalAlign:c,verticalAlign:f}=Hn(l),g=i[0]-s.displaySize[0]*c,y=i[1]-s.displaySize[1]*f;return{image:s,top:y,bottom:y+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function n_(s,i,l,c,f,g){const y=s.image;let b;if(y.content){const J=y.content,re=y.pixelRatio||1;b=[J[0]/re,J[1]/re,y.displaySize[0]-J[2]/re,y.displaySize[1]-J[3]/re]}const M=i.left*g,E=i.right*g;let I,P,k,z;"width"===l||"both"===l?(z=f[0]+M-c[3],P=f[0]+E+c[1]):(z=f[0]+(M+E-y.displaySize[0])/2,P=z+y.displaySize[0]);const V=i.top*g,j=i.bottom*g;return"height"===l||"both"===l?(I=f[1]+V-c[0],k=f[1]+j+c[2]):(I=f[1]+(V+j-y.displaySize[1])/2,k=I+y.displaySize[1]),{image:y,top:I,right:P,bottom:k,left:z,collisionPadding:b}}class Jl extends ce{constructor(i,l,c,f,g){super(i,l),this.angle=f,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new Jl(this.x,this.y,this.z,this.angle,this.segment)}}function k0(s,i,l,c,f){if(void 0===i.segment)return!0;let g=i,y=i.segment+1,b=0;for(;b>-l/2;){if(y--,y<0)return!1;b-=s[y].dist(g),g=s[y]}b+=s[y].dist(s[y+1]),y++;const M=[];let E=0;for(;b<l/2;){const I=s[y],P=s[y+1];if(!P)return!1;let k=s[y-1].angleTo(I)-I.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:b,angleDelta:k}),E+=k;b-M[0].distance>c;)E-=M.shift().angleDelta;if(E>f)return!1;y++,b+=I.dist(P)}return!0}function r_(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function R0(s,i,l){return s?.6*i*l:0}function i_(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function X1(s,i,l,c,f,g){const y=R0(l,f,g),b=i_(l,c)*g;let M=0;const E=r_(s)/2;for(let I=0;I<s.length-1;I++){const P=s[I],k=s[I+1],z=P.dist(k);if(M+z>E){const V=(E-M)/z,j=Un(P.x,k.x,V),J=Un(P.y,k.y,V),re=new Jl(j,J,0,k.angleTo(P),I);return!y||k0(s,re,b,y,i)?re:void 0}M+=z}}function Y1(s,i,l,c,f,g,y,b,M){const E=R0(c,g,y),I=i_(c,f),P=I*y,k=0===s[0].x||s[0].x===M||0===s[0].y||s[0].y===M;return i-P<i/4&&(i=P+i/4),K1(s,k?i/2*b%i:(I/2+2*g)*y*b%i,i,E,l,P,k,!1,M)}function K1(s,i,l,c,f,g,y,b,M){const E=g/2,I=r_(s);let P=0,k=i-l,z=[];for(let V=0;V<s.length-1;V++){const j=s[V],J=s[V+1],re=j.dist(J),de=J.angleTo(j);for(;k+l<P+re;){k+=l;const he=(k-P)/re,pe=Un(j.x,J.x,he),_e=Un(j.y,J.y,he);if(pe>=0&&pe<M&&_e>=0&&_e<M&&k-E>=0&&k+E<=I){const ve=new Jl(pe,_e,0,de,V);ve._round(),c&&!k0(s,ve,g,c,f)||z.push(ve)}}P+=re}return b||z.length||y||(z=K1(s,P/2,l,c,f,g,y,!0,M)),z}function o_(s,i,l,c,f){const g=[];for(let y=0;y<s.length;y++){const b=s[y];let M;for(let E=0;E<b.length-1;E++){let I=b[E],P=b[E+1];I.x<i&&P.x<i||(I.x<i?I=new ce(i,I.y+(i-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<i&&(P=new ce(i,I.y+(i-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<l&&P.y<l||(I.y<l?I=new ce(I.x+(l-I.y)/(P.y-I.y)*(P.x-I.x),l)._round():P.y<l&&(P=new ce(I.x+(l-I.y)/(P.y-I.y)*(P.x-I.x),l)._round()),I.x>=c&&P.x>=c||(I.x>=c?I=new ce(c,I.y+(c-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=c&&(P=new ce(c,I.y+(c-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=f&&P.y>=f||(I.y>=f?I=new ce(I.x+(f-I.y)/(P.y-I.y)*(P.x-I.x),f)._round():P.y>=f&&(P=new ce(I.x+(f-I.y)/(P.y-I.y)*(P.x-I.x),f)._round()),M&&I.equals(M[M.length-1])||(M=[I],g.push(M)),M.push(P)))))}}return g}Bt(Jl,"Anchor");const Pd=1e20;function L0(s,i,l,c,f,g,y,b,M){for(let E=i;E<i+c;E++)s_(s,l*g+E,g,f,y,b,M);for(let E=l;E<l+f;E++)s_(s,E*g+i,1,c,y,b,M)}function s_(s,i,l,c,f,g,y){g[0]=0,y[0]=-Pd,y[1]=Pd,f[0]=s[i];for(let b=1,M=0,E=0;b<c;b++){f[b]=s[i+b*l];const I=b*b;do{const P=g[M];E=(f[b]-f[P]+I-P*P)/(b-P)/2}while(E<=y[M]&&--M>-1);M++,g[M]=b,y[M]=E,y[M+1]=Pd}for(let b=0,M=0;b<c;b++){for(;y[M+1]<b;)M++;const E=g[M],I=b-E;s[i+b*l]=f[E]+I*I}}const dm={none:0,ideographs:1,all:2};class Xc{constructor(i,l,c){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const c=[];for(const f in i)for(const g of i[f])c.push({stack:f,id:g});Xe(c,({stack:f,id:g},y)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=b.glyphs[g];if(void 0!==M)return void y(null,{stack:f,id:g,glyph:M});if(M=this._tinySDF(b,f,g),M)return b.glyphs[g]=M,void y(null,{stack:f,id:g,glyph:M});const E=Math.floor(g/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(b.ranges[E])return void y(null,{stack:f,id:g,glyph:M});let I=b.requests[E];I||(I=b.requests[E]=[],Xc.loadGlyphRange(f,E,this.url,this.requestManager,(P,k)=>{if(k){b.ascender=k.ascender,b.descender=k.descender;for(const z in k.glyphs)this._doesCharSupportLocalGlyph(+z)||(b.glyphs[+z]=k.glyphs[+z]);b.ranges[E]=!0}for(const z of I)z(P,k);delete b.requests[E]})),I.push((P,k)=>{P?y(P):k&&y(null,{stack:f,id:g,glyph:k.glyphs[g]||null})})},(f,g)=>{if(f)l(f);else if(g){const y={};for(const{stack:b,id:M,glyph:E}of g)void 0===y[b]&&(y[b]={}),void 0===y[b].glyphs&&(y[b].glyphs={}),y[b].glyphs[M]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;l(null,y)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==dm.none&&(this.localGlyphMode===dm.all?!!this.localFontFamily:!!this.localFontFamily&&(tl(i)||Ef(i)||Nc(i)||Bc(i)||is(i)))}_tinySDF(i,l,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let g=i.tinySDF;if(!g){let j="400";/bold/i.test(l)?j="900":/medium/i.test(l)?j="500":/light/i.test(l)&&(j="200"),g=i.tinySDF=new Xc.TinySDF({fontFamily:f,fontWeight:j,fontSize:48,buffer:6,radius:16}),g.fontWeight=j}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const y=String.fromCharCode(c),{data:b,width:M,height:E,glyphWidth:I,glyphHeight:P,glyphLeft:k,glyphTop:z,glyphAdvance:V}=g.draw(y);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Oa({width:M,height:E},b),metrics:{width:I/2,height:P/2,left:k/2,top:z/2-27,advance:V/2,localGlyph:!0}}}}function J1(s,i,l,c){const f=[],g=s.image,y=g.pixelRatio,b=g.paddedRect.w-2,M=g.paddedRect.h-2,E=s.right-s.left,I=s.bottom-s.top,P=g.stretchX||[[0,b]],k=g.stretchY||[[0,M]],z=(Oe,qe)=>Oe+qe[1]-qe[0],V=P.reduce(z,0),j=k.reduce(z,0),J=b-V,re=M-j;let de=0,he=V,pe=0,_e=j,ve=0,Fe=J,ze=0,Je=re;if(g.content&&c){const Oe=g.content;de=fm(P,0,Oe[0]),pe=fm(k,0,Oe[1]),he=fm(P,Oe[0],Oe[2]),_e=fm(k,Oe[1],Oe[3]),ve=Oe[0]-de,ze=Oe[1]-pe,Fe=Oe[2]-Oe[0]-he,Je=Oe[3]-Oe[1]-_e}const ct=(Oe,qe,ut,ht)=>{const Ot=Kf(Oe.stretch-de,he,E,s.left),at=Jf(Oe.fixed-ve,Fe,Oe.stretch,V),yt=Kf(qe.stretch-pe,_e,I,s.top),In=Jf(qe.fixed-ze,Je,qe.stretch,j),$n=Kf(ut.stretch-de,he,E,s.left),Qt=Jf(ut.fixed-ve,Fe,ut.stretch,V),Ut=Kf(ht.stretch-pe,_e,I,s.top),Zn=Jf(ht.fixed-ze,Je,ht.stretch,j),Bn=new ce(Ot,yt),Xt=new ce($n,yt),Fi=new ce($n,Ut),ui=new ce(Ot,Ut),yi=new ce(at/y,In/y),Xn=new ce(Qt/y,Zn/y),Qn=i*Math.PI/180;if(Qn){const xr=Math.sin(Qn),Br=Math.cos(Qn),Jr=[Br,-xr,xr,Br];Bn._matMult(Jr),Xt._matMult(Jr),ui._matMult(Jr),Fi._matMult(Jr)}const Or=Oe.stretch+Oe.fixed,Rr=qe.stretch+qe.fixed;return{tl:Bn,tr:Xt,bl:ui,br:Fi,tex:{x:g.paddedRect.x+1+Or,y:g.paddedRect.y+1+Rr,w:ut.stretch+ut.fixed-Or,h:ht.stretch+ht.fixed-Rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:Xn,minFontScaleX:Fe/y/E,minFontScaleY:Je/y/I,isSDF:l}};if(c&&(g.stretchX||g.stretchY)){const Oe=pm(P,J,V),qe=pm(k,re,j);for(let ut=0;ut<Oe.length-1;ut++){const ht=Oe[ut],Ot=Oe[ut+1];for(let at=0;at<qe.length-1;at++)f.push(ct(ht,qe[at],Ot,qe[at+1]))}}else f.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return f}function fm(s,i,l){let c=0;for(const f of s)c+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return c}function pm(s,i,l){const c=[{fixed:-1,stretch:0}];for(const[f,g]of s){const y=c[c.length-1];c.push({fixed:f-y.stretch,stretch:y.stretch}),c.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return c.push({fixed:i+1,stretch:l}),c}function Kf(s,i,l,c){return s/i*l+c}function Jf(s,i,l,c){return s-i*l/c}function oh(s,i,l,c){const f=i+s.positionedLines[c].lineOffset;return 0===c?l+f/2:l+(f+(i+s.positionedLines[c-1].lineOffset))/2}Xc.loadGlyphRange=function(s,i,l,c,f){const g=256*i,y=g+255,b=c.transformRequest(c.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",`${g}-${y}`),se.Glyphs);ye(b,(M,E)=>{if(M)f(M);else if(E){const I={},P=new Wc(E).readFields(M0,{});for(const k of P.glyphs)I[k.id]=k;f(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},Xc.TinySDF=class{constructor({fontSize:s=24,buffer:i=3,radius:l=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=l;const b=this.size=s+4*i,M=this._createCanvas(b),E=this.ctx=M.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${g} ${s}px ${f}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(s){const i=document.createElement("canvas");return i.width=i.height=s,i}draw(s){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(s),y=Math.ceil(l),b=Math.min(this.size-this.buffer,Math.ceil(g-f)),M=Math.min(this.size-this.buffer,y+Math.ceil(c)),E=b+2*this.buffer,I=M+2*this.buffer,P=Math.max(E*I,0),k=new Uint8ClampedArray(P),z={data:k,width:E,height:I,glyphWidth:b,glyphHeight:M,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(0===b||0===M)return z;const{ctx:V,buffer:j,gridInner:J,gridOuter:re}=this;V.clearRect(j,j,b,M),V.fillText(s,j,j+y);const de=V.getImageData(j,j,b,M);re.fill(Pd,0,P),J.fill(0,0,P);for(let he=0;he<M;he++)for(let pe=0;pe<b;pe++){const _e=de.data[4*(he*b+pe)+3]/255;if(0===_e)continue;const ve=(he+j)*E+pe+j;if(1===_e)re[ve]=0,J[ve]=Pd;else{const Fe=.5-_e;re[ve]=Fe>0?Fe*Fe:0,J[ve]=Fe<0?Fe*Fe:0}}L0(re,0,0,E,I,E,this.f,this.v,this.z),L0(J,j,j,b,M,E,this.f,this.v,this.z);for(let he=0;he<P;he++){const pe=Math.sqrt(re[he])-Math.sqrt(J[he]);k[he]=Math.round(255-255*(pe/this.radius+this.cutoff))}return z}};class Q1{constructor(i=[],l=a_){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:c}=this,f=l[i];for(;i>0;){const g=i-1>>1,y=l[g];if(c(f,y)>=0)break;l[i]=y,i=g}l[i]=f}_down(i){const{data:l,compare:c}=this,f=this.length>>1,g=l[i];for(;i<f;){let y=1+(i<<1),b=l[y];const M=y+1;if(M<this.length&&c(l[M],b)<0&&(y=M,b=l[M]),c(b,g)>=0)break;l[i]=b,i=y}l[i]=g}}function a_(s,i){return s<i?-1:s>i?1:0}function F0(s,i=1,l=!1){let c=1/0,f=1/0,g=-1/0,y=-1/0;const b=s[0];for(let z=0;z<b.length;z++){const V=b[z];(!z||V.x<c)&&(c=V.x),(!z||V.y<f)&&(f=V.y),(!z||V.x>g)&&(g=V.x),(!z||V.y>y)&&(y=V.y)}const M=Math.min(g-c,y-f);let E=M/2;const I=new Q1([],l_);if(0===M)return new ce(c,f);for(let z=c;z<g;z+=M)for(let V=f;V<y;V+=M)I.push(new Ql(z+E,V+E,E,s));let P=function(z){let V=0,j=0,J=0;const re=z[0];for(let de=0,he=re.length,pe=he-1;de<he;pe=de++){const _e=re[de],ve=re[pe],Fe=_e.x*ve.y-ve.x*_e.y;j+=(_e.x+ve.x)*Fe,J+=(_e.y+ve.y)*Fe,V+=3*Fe}return new Ql(j/V,J/V,0,z)}(s),k=I.length;for(;I.length;){const z=I.pop();(z.d>P.d||!P.d)&&(P=z,l&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,k)),z.max-P.d<=i||(E=z.h/2,I.push(new Ql(z.p.x-E,z.p.y-E,E,s)),I.push(new Ql(z.p.x+E,z.p.y-E,E,s)),I.push(new Ql(z.p.x-E,z.p.y+E,E,s)),I.push(new Ql(z.p.x+E,z.p.y+E,E,s)),k+=4)}return l&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function l_(s,i){return i.max-s.max}function Ql(s,i,l,c){this.p=new ce(s,i),this.h=l,this.d=function(f,g){let y=!1,b=1/0;for(let M=0;M<g.length;M++){const E=g[M];for(let I=0,P=E.length,k=P-1;I<P;k=I++){const z=E[I],V=E[k];z.y>f.y!=V.y>f.y&&f.x<(V.x-z.x)*(f.y-z.y)/(V.y-z.y)+z.x&&(y=!y),b=Math.min(b,Uy(f,z,V))}}return(y?1:-1)*Math.sqrt(b)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const c_=Number.POSITIVE_INFINITY,u_=Math.sqrt(2);function mm(s,i){return i[1]!==c_?function(l,c,f){let g=0,y=0;switch(c=Math.abs(c),f=Math.abs(f),l){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(l){case"top-right":case"bottom-right":case"right":g=-c;break;case"top-left":case"bottom-left":case"left":g=c}return[g,y]}(s,i[0],i[1]):function(l,c){let f=0,g=0;c<0&&(c=0);const y=c/u_;switch(l){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-c;break;case"top":g=c-7}switch(l){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=c;break;case"right":f=-c}return[f,g]}(s,i[0])}function sh(s,i,l,c,f,g,y,b,M,E){s.createArrays(),s.tilePixelRatio=hn/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const I=s.layers[0].layout,P=s.layers[0]._unevaluatedLayout._values,k={};if("composite"===s.textSizeData.kind){const{minZoom:j,maxZoom:J}=s.textSizeData;k.compositeTextSizes=[P["text-size"].possiblyEvaluate(new X(j),b),P["text-size"].possiblyEvaluate(new X(J),b)]}if("composite"===s.iconSizeData.kind){const{minZoom:j,maxZoom:J}=s.iconSizeData;k.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new X(j),b),P["icon-size"].possiblyEvaluate(new X(J),b)]}k.layoutTextSize=P["text-size"].possiblyEvaluate(new X(M+1),b),k.layoutIconSize=P["icon-size"].possiblyEvaluate(new X(M+1),b),k.textMaxSize=P["text-size"].possiblyEvaluate(new X(18),b);const z="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),V=I.get("text-size");for(const j of s.features){const J=I.get("text-font").evaluate(j,{},b).join(","),re=V.evaluate(j,{},b),de=k.layoutTextSize.evaluate(j,{},b),he=(k.layoutIconSize.evaluate(j,{},b),{horizontal:{},vertical:void 0}),pe=j.text;let _e,ve=[0,0];if(pe){const Je=pe.toString(),ct=24*I.get("text-letter-spacing").evaluate(j,{},b),Oe=24*I.get("text-line-height").evaluate(j,{},b),qe=p(Je)?ct:0,ut=I.get("text-anchor").evaluate(j,{},b),ht=I.get("text-variable-anchor");if(!ht){const Qt=I.get("text-radial-offset").evaluate(j,{},b);ve=Qt?mm(ut,[24*Qt,c_]):I.get("text-offset").evaluate(j,{},b).map(Ut=>24*Ut)}let Ot=z?"center":I.get("text-justify").evaluate(j,{},b);const at=I.get("symbol-placement"),yt="point"===at,In="point"===at?24*I.get("text-max-width").evaluate(j,{},b):0,$n=Qt=>{s.allowVerticalPlacement&&Vl(Je)&&(he.vertical=um(pe,i,l,f,J,In,Oe,ut,Qt,qe,ve,js.vertical,!0,at,de,re))};if(!z&&ht){const Qt="auto"===Ot?ht.map(Zn=>gm(Zn)):[Ot];let Ut=!1;for(let Zn=0;Zn<Qt.length;Zn++){const Bn=Qt[Zn];if(!he.horizontal[Bn])if(Ut)he.horizontal[Bn]=he.horizontal[0];else{const Xt=um(pe,i,l,f,J,In,Oe,"center",Bn,qe,ve,js.horizontal,!1,at,de,re);Xt&&(he.horizontal[Bn]=Xt,Ut=1===Xt.positionedLines.length)}}$n("left")}else{if("auto"===Ot&&(Ot=gm(ut)),yt||I.get("text-writing-mode").indexOf("horizontal")>=0||!Vl(Je)){const Qt=um(pe,i,l,f,J,In,Oe,ut,Ot,qe,ve,js.horizontal,!1,at,de,re);Qt&&(he.horizontal[Ot]=Qt)}$n("point"===at?"left":Ot)}}let Fe=!1;if(j.icon&&j.icon.name){const Je=c[j.icon.name];Je&&(_e=O0(f[j.icon.name],I.get("icon-offset").evaluate(j,{},b),I.get("icon-anchor").evaluate(j,{},b)),Fe=Je.sdf,void 0===s.sdfIcons?s.sdfIcons=Je.sdf:s.sdfIcons!==Je.sdf&&On("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==s.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const ze=d_(he.horizontal)||he.vertical;s.iconsInText||(s.iconsInText=!!ze&&ze.iconsInText),(ze||_e)&&h_(s,j,he,_e,c,k,de,0,ve,Fe,y,b,E)}g&&s.generateCollisionDebugBuffers(M,s.collisionBoxArray)}function gm(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function h_(s,i,l,c,f,g,y,b,M,E,I,P,k){let z=g.textMaxSize.evaluate(i,{},P);void 0===z&&(z=y);const V=s.layers[0].layout,j=V.get("icon-offset").evaluate(i,{},P),J=d_(l.horizontal)||l.vertical,re="globe"===k.name,de=y/24,he=s.tilePixelRatio*z/24,pe=(qe=s.overscaling,s.zoom>18&&qe>2&&(qe>>=1),Math.max(hn/(512*qe),1)*V.get("symbol-spacing")),_e=V.get("text-padding")*s.tilePixelRatio,ve=V.get("icon-padding")*s.tilePixelRatio,Fe=tt(V.get("text-max-angle")),ze="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),Je="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),ct=V.get("symbol-placement"),Oe=pe/2;var qe;const ut=V.get("icon-text-fit");let ht;c&&"none"!==ut&&(s.allowVerticalPlacement&&l.vertical&&(ht=n_(c,l.vertical,ut,V.get("icon-text-fit-padding"),j,de)),J&&(c=n_(c,J,ut,V.get("icon-text-fit-padding"),j,de)));const Ot=(at,yt,In)=>{if(yt.x<0||yt.x>=hn||yt.y<0||yt.y>=hn)return;let $n=null;if(re){const{x:Qt,y:Ut,z:Zn}=k.projectTilePoint(yt.x,yt.y,In);$n={anchor:new Jl(Qt,Ut,Zn,0,void 0),up:k.upVector(In,yt.x,yt.y)}}!function(Qt,Ut,Zn,Bn,Xt,Fi,ui,yi,Xn,Qn,Or,Rr,xr,Br,Jr,yo,Ts,Kn,Ei,Ro,fr,Qr,Lo,Wr,vi){const si=Qt.addToLineVertexArray(Ut,Bn);let Ii,vo,Wo,xo,Na,_h,jd,$d=0,T_=0,rv=0,iv=0,D_=-1,S_=-1;const Ba={};let vb=qp("");const eu=Zn?Zn.anchor:Ut;let I_=0,A_=0;if(void 0===Xn._unevaluatedLayout.getValue("text-radial-offset")?[I_,A_]=Xn.layout.get("text-offset").evaluate(fr,{},vi).map(Ds=>24*Ds):(I_=24*Xn.layout.get("text-radial-offset").evaluate(fr,{},vi),A_=c_),Qt.allowVerticalPlacement&&Xt.vertical){const Ds=Xt.vertical;if(Jr)_h=f_(Ds),yi&&(jd=f_(yi));else{const hs=Xn.layout.get("text-rotate").evaluate(fr,{},vi)+90;Wo=ec(Qn,eu,Ut,Or,Rr,xr,Ds,Br,hs,yo),yi&&(xo=ec(Qn,eu,Ut,Or,Rr,xr,yi,Kn,hs))}}if(Fi){const Ds=Xn.layout.get("icon-rotate").evaluate(fr,{},vi),hs="none"!==Xn.layout.get("icon-text-fit"),Gd=J1(Fi,Ds,Lo,hs),sv=yi?J1(yi,Ds,Lo,hs):void 0;vo=ec(Qn,eu,Ut,Or,Rr,xr,Fi,Kn,Ds),$d=4*Gd.length;const ca=Qt.iconSizeData;let Hd=null;"source"===ca.kind?(Hd=[ka*Xn.layout.get("icon-size").evaluate(fr,{},vi)],Hd[0]>Yc&&On(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===ca.kind&&(Hd=[ka*Qr.compositeIconSizes[0].evaluate(fr,{},vi),ka*Qr.compositeIconSizes[1].evaluate(fr,{},vi)],(Hd[0]>Yc||Hd[1]>Yc)&&On(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,Gd,Hd,Ro,Ei,fr,!1,Zn,Ut,si.lineStartIndex,si.lineLength,-1,Wr,vi),D_=Qt.icon.placedSymbolArray.length-1,sv&&(T_=4*sv.length,Qt.addSymbols(Qt.icon,sv,Hd,Ro,Ei,fr,js.vertical,Zn,Ut,si.lineStartIndex,si.lineLength,-1,Wr,vi),S_=Qt.icon.placedSymbolArray.length-1)}for(const Ds in Xt.horizontal){const hs=Xt.horizontal[Ds];Ii||(vb=qp(hs.text),Jr?Na=f_(hs):Ii=ec(Qn,eu,Ut,Or,Rr,xr,hs,Br,Xn.layout.get("text-rotate").evaluate(fr,{},vi),yo));const Gd=1===hs.positionedLines.length;if(rv+=z0(Qt,Zn,Ut,hs,ui,Xn,Jr,fr,yo,si,Xt.vertical?js.horizontal:js.horizontalOnly,Gd?Object.keys(Xt.horizontal):[Ds],Ba,D_,Qr,Wr,vi),Gd)break}Xt.vertical&&(iv+=z0(Qt,Zn,Ut,Xt.vertical,ui,Xn,Jr,fr,yo,si,js.vertical,["vertical"],Ba,S_,Qr,Wr,vi));let yh=-1;const ov=(Ds,hs)=>Ds?Math.max(Ds,hs):hs;yh=ov(Na,yh),yh=ov(_h,yh),yh=ov(jd,yh);const xb=yh>-1?1:0;Qt.glyphOffsetArray.length>=Qc.MAX_GLYPHS&&On("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==fr.sortKey&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,fr.sortKey),Qt.symbolInstances.emplaceBack(eu.x,eu.y,eu.z,Ut.x,Ut.y,Ba.right>=0?Ba.right:-1,Ba.center>=0?Ba.center:-1,Ba.left>=0?Ba.left:-1,Ba.vertical>=0?Ba.vertical:-1,D_,S_,vb,void 0!==Ii?Ii:Qt.collisionBoxArray.length,void 0!==Ii?Ii+1:Qt.collisionBoxArray.length,void 0!==Wo?Wo:Qt.collisionBoxArray.length,void 0!==Wo?Wo+1:Qt.collisionBoxArray.length,void 0!==vo?vo:Qt.collisionBoxArray.length,void 0!==vo?vo+1:Qt.collisionBoxArray.length,xo||Qt.collisionBoxArray.length,xo?xo+1:Qt.collisionBoxArray.length,Or,rv,iv,$d,T_,xb,0,I_,A_,yh)}(s,yt,$n,at,l,c,f,ht,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,_e,ze,M,0,ve,Je,j,i,g,E,I,P)};if("line"===ct)for(const at of o_(i.geometry,0,0,hn,hn)){const yt=Y1(at,pe,Fe,l.vertical||J,c,24,he,s.overscaling,hn);for(const In of yt){const $n=J;$n&&eb(s,$n.text,Oe,In)||Ot(at,In,P)}}else if("line-center"===ct){for(const at of i.geometry)if(at.length>1){const yt=X1(at,Fe,l.vertical||J,c,24,he);yt&&Ot(at,yt,P)}}else if("Polygon"===i.type)for(const at of Vf(i.geometry,0)){const yt=F0(at,16);Ot(at[0],new Jl(yt.x,yt.y,0,0,void 0),P)}else if("LineString"===i.type)for(const at of i.geometry)Ot(at,new Jl(at[0].x,at[0].y,0,0,void 0),P);else if("Point"===i.type)for(const at of i.geometry)for(const yt of at)Ot([yt],new Jl(yt.x,yt.y,0,0,void 0),P)}const Yc=32640;function z0(s,i,l,c,f,g,y,b,M,E,I,P,k,z,V,j,J){const re=function(pe,_e,ve,Fe,ze,Je,ct,Oe){const qe=[];if(0===_e.positionedLines.length)return qe;const ut=Fe.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,ht=function($n){const Qt=$n[0],Ut=$n[1],Zn=Qt*Ut;return Zn>0?[Qt,-Ut]:Zn<0?[-Qt,Ut]:0===Qt?[Ut,Qt]:[Ut,-Qt]}(ve);let Ot=Math.abs(_e.top-_e.bottom);for(const $n of _e.positionedLines)Ot-=$n.lineOffset;const at=_e.positionedLines.length,yt=Ot/at;let In=_e.top-ve[1];for(let $n=0;$n<at;++$n){const Qt=_e.positionedLines[$n];In=oh(_e,yt,In,$n);for(const Ut of Qt.positionedGlyphs){if(!Ut.rect)continue;const Zn=Ut.rect||{};let Bn=4,Xt=!0,Fi=1,ui=0;if(Ut.imageName){const Wr=ct[Ut.imageName];if(!Wr)continue;if(Wr.sdf){On("SDF images are not supported in formatted text and will be ignored.");continue}Xt=!1,Fi=Wr.pixelRatio,Bn=1/Fi}const yi=(ze||Oe)&&Ut.vertical,Xn=Ut.metrics.advance*Ut.scale/2,Qn=Ut.metrics,Or=Ut.rect;if(null===Or)continue;Oe&&_e.verticalizable&&(ui=Ut.imageName?Xn-Ut.metrics.width*Ut.scale/2:0);const Rr=ze?[Ut.x+Xn,Ut.y]:[0,0];let xr=[0,0],Br=[0,0],Jr=!1;ze||(yi?(Br=[Ut.x+Xn+ht[0],Ut.y+ht[1]-ui],Jr=!0):xr=[Ut.x+Xn+ve[0],Ut.y+ve[1]-ui]);const yo=Or.w*Ut.scale/(Fi*(Ut.localGlyph?2:1)),Ts=Or.h*Ut.scale/(Fi*(Ut.localGlyph?2:1));let Kn,Ei,Ro,fr;if(yi){const Wr=Ut.y-In,vi=new ce(-Xn,Xn-Wr),si=-Math.PI/2,Ii=new ce(...Br);Kn=new ce(-Xn+xr[0],xr[1]),Kn._rotateAround(si,vi)._add(Ii),Kn.x+=-Wr+Xn,Kn.y-=(Qn.left-Bn)*Ut.scale;const vo=Ut.imageName?Qn.advance*Ut.scale:24*Ut.scale,Wo=String.fromCharCode(Ut.glyph);y0(Wo)?Kn.x+=(1-Bn)*Ut.scale:v0(Wo)?Kn.x+=vo-Qn.height*Ut.scale+(-Bn-1)*Ut.scale:Kn.x+=Ut.imageName||Qn.width+2*Bn===Or.w&&Qn.height+2*Bn===Or.h?(vo-Ts)/2:(vo-(Qn.height+2*Bn)*Ut.scale)/2,Ei=new ce(Kn.x,Kn.y-yo),Ro=new ce(Kn.x+Ts,Kn.y),fr=new ce(Kn.x+Ts,Kn.y-yo)}else{const Wr=(Qn.left-Bn)*Ut.scale-Xn+xr[0],vi=(-Qn.top-Bn)*Ut.scale+xr[1],si=Wr+yo,Ii=vi+Ts;Kn=new ce(Wr,vi),Ei=new ce(si,vi),Ro=new ce(Wr,Ii),fr=new ce(si,Ii)}if(ut){let Wr;Wr=ze?new ce(0,0):Jr?new ce(ht[0],ht[1]):new ce(ve[0],ve[1]),Kn._rotateAround(ut,Wr),Ei._rotateAround(ut,Wr),Ro._rotateAround(ut,Wr),fr._rotateAround(ut,Wr)}const Qr=new ce(0,0),Lo=new ce(0,0);qe.push({tl:Kn,tr:Ei,bl:Ro,br:fr,tex:Zn,writingMode:_e.writingMode,glyphOffset:Rr,sectionIndex:Ut.sectionIndex,isSDF:Xt,pixelOffsetTL:Qr,pixelOffsetBR:Lo,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,c,M,g,y,b,f,s.allowVerticalPlacement),de=s.textSizeData;let he=null;"source"===de.kind?(he=[ka*g.layout.get("text-size").evaluate(b,{},J)],he[0]>Yc&&On(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===de.kind&&(he=[ka*V.compositeTextSizes[0].evaluate(b,{},J),ka*V.compositeTextSizes[1].evaluate(b,{},J)],(he[0]>Yc||he[1]>Yc)&&On(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,re,he,M,y,b,I,i,l,E.lineStartIndex,E.lineLength,z,j,J);for(const pe of P)k[pe]=s.text.placedSymbolArray.length-1;return 4*re.length}function d_(s){for(const i in s)return s[i];return null}function ec(s,i,l,c,f,g,y,b,M,E){let I=y.top,P=y.bottom,k=y.left,z=y.right;const V=y.collisionPadding;if(V&&(k-=V[0],I-=V[1],z+=V[2],P+=V[3]),M){const j=new ce(k,I),J=new ce(z,I),re=new ce(k,P),de=new ce(z,P),he=tt(M);let pe=new ce(0,0);E&&(pe=new ce(E[0],E[1])),j._rotateAround(he,pe),J._rotateAround(he,pe),re._rotateAround(he,pe),de._rotateAround(he,pe),k=Math.min(j.x,J.x,re.x,de.x),z=Math.max(j.x,J.x,re.x,de.x),I=Math.min(j.y,J.y,re.y,de.y),P=Math.max(j.y,J.y,re.y,de.y)}return s.emplaceBack(i.x,i.y,i.z,l.x,l.y,k,I,z,P,b,c,f,g),s.length-1}function f_(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const i=s.bottom-s.top;return i>0?Math.max(10,i):null}function eb(s,i,l,c){const f=s.compareText;if(i in f){const g=f[i];for(let y=g.length-1;y>=0;y--)if(c.dist(g[y])<l)return!0}else f[i]=[];return f[i].push(c),!1}const tb=Lt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:N0}=tb,_m=Lt([{name:"a_pos_3",components:3,type:"Int16"}]);var Od=Lt([{name:"a_pos",type:"Int16",components:2}]);const Kc=hn/Math.PI/2,_o=2*na(1,0)*Kc*Math.PI,kd=[64,32,16],qo=-Kc,Zo=Kc,nb=[new Es([qo,qo,qo],[Zo,Zo,Zo]),new Es([qo,qo,qo],[0,0,Zo]),new Es([0,qo,qo],[Zo,0,Zo]),new Es([qo,0,qo],[0,Zo,Zo]),new Es([0,0,qo],[Zo,Zo,Zo])];function rb(s,i,l,c=!0){const f=ll([],s._camera.position,s.worldSize),g=[i,l,1,1];Zc(g,g,s.pixelMatrixInverse),Hy(g,g,1/g[3]);const y=Go([],oa([],g,f)),b=s.globeMatrix,M=[b[12],b[13],b[14]],E=oa([],M,f),I=Hc(E),P=Go([],E),k=s.worldSize/(2*Math.PI),z=ia(P,y),V=Math.asin(k/I);if(V<Math.acos(z)){if(!c)return null;const ct=[],Oe=[];ll(ct,y,I/z),Go(Oe,oa(Oe,ct,E)),Go(y,Wl(y,E,ll(y,Oe,Math.tan(V)*I)))}const j=[];new Yy(f,y).closestPointOnSphere(M,k,j);const J=Go([],Gr(b,0)),re=Go([],Gr(b,1)),de=Go([],Gr(b,2)),he=ia(J,j),pe=ia(re,j),_e=ia(de,j),ve=Mt(Math.asin(-pe/k));let Fe=Mt(Math.atan2(he,_e));Fe=s.center.lng+function(ct,Oe){const qe=(Oe-ct+180)%360-180;return qe<-180?qe+360:qe}(s.center.lng,Fe);const ze=Gl(Fe),Je=je(sl(ve),0,1);return new Hl(ze,Je)}class zM{constructor(i,l,c){this.a=oa([],i,c),this.b=oa([],l,c),this.center=c;const f=Go([],this.a),g=Go([],this.b);this.angle=Math.acos(ia(f,g))}}function B0(s,i){if(0===s.angle)return null;let l;return l=0===s.a[i]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[i]/s.a[i]/Math.sin(s.angle)-1/Math.tan(s.angle)),l<0||l>1?null:function(c,f,g,y){const b=Math.sin(g);return c*(Math.sin((1-y)*g)/b)+f*(Math.sin(y*g)/b)}(s.a[i],s.b[i],s.angle,je(l,0,1))+s.center[i]}function hl(s){if(s.z<=1)return nb[s.z+2*s.y+s.x];const[i,l]=U0(s),c=[Hi(i[0],i[1]),Hi(i[0],l[1]),Hi(l[0],i[1]),Hi(l[0],l[1])],f=[Zo,Zo,Zo],g=[qo,qo,qo];for(const y of c)f[0]=Math.min(f[0],y[0]),f[1]=Math.min(f[1],y[1]),f[2]=Math.min(f[2],y[2]),g[0]=Math.max(g[0],y[0]),g[1]=Math.max(g[1],y[1]),g[2]=Math.max(g[2],y[2]);return new Es(f,g)}function U0(s){const i=1<<s.z,l=s.x/i,c=(s.x+1)/i,f=(s.y+1)/i;return[[Ri(s.y/i),$o(l)],[Ri(f),$o(c)]]}function j0(s,i,l,c=Kc){return l=tt(l),[s*Math.sin(l)*c,-i*c,s*Math.cos(l)*c]}function Hi(s,i,l){return j0(Math.cos(tt(s)),Math.sin(tt(s)),i,l)}function $0(s,i,l){const c=Math.pow(2,l.z),f=(s/hn+l.x)/c;return Hi(Ri((i/hn+l.y)/c),$o(f))}function Qf(s){return 16383/Math.max(...oa([],s.max,s.min))}function Jc(s){const i=as(new Float64Array(16)),l=Qf(s);var c,f;return Zl(i,i,[l,l,l]),Gc(i,i,((c=[])[0]=-(f=s.min)[0],c[1]=-f[1],c[2]=-f[2],c)),i}function G0(s){const i=as(new Float64Array(16)),l=1/Qf(s);return Gc(i,i,s.min),Zl(i,i,[l,l,l]),i}function p_(s,i,l,c,f){const g=function(M){const E=hn/(2*Math.PI);return M/(2*Math.PI)/E}(l),y=[s,i,-l/(2*Math.PI)],b=as(new Float64Array(16));return Gc(b,b,y),Zl(b,b,[g,g,g]),Wu(b,b,tt(-f)),wd(b,b,tt(-c)),b}function m_(s){return Le(5,6,s)}function H0(s,i){const l=Hi(i.lat,i.lng);return g=(c=Kp([],function(z){const V=Hi(z._center.lat,z._center.lng);let j=ls([],qc(0,1,0),V);const J=Xu([],-z.angle,V);j=oi(j,j,J),Xu(J,-z._pitch,j);const re=Go([],V);return ll(re,re,z.cameraToCenterDistance/z.pixelsPerMeter*_o),oi(re,re,J),Wl([],V,re)}(s),l))[0],y=c[1],b=c[2],M=(f=l)[0],E=f[1],I=f[2],k=(P=Math.sqrt(g*g+y*y+b*b)*Math.sqrt(M*M+E*E+I*I))&&ia(c,f)/P,Math.acos(Math.min(Math.max(k,-1),1));var c,f,g,y,b,M,E,I,P,k}const q0=tt(85),ib=Math.cos(q0),ob=Math.sin(q0);function g_(s,i){const l=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*i:0,f=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),g=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-s._pitch-l,.01)),y=Math.sin(s._pitch)*g+f;return Math.min(1.01*y,f*(1/s._horizonShift))}function ah(s,i){if(!i.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:i};const l=Math.pow(2,-s.z),c=s.x*l,f=(s.x+1)*l,g=s.y*l,y=(s.y+1)*l,b=$o(c),M=$o(f),E=Ri(g),I=Ri(y),P=i.project(b,E),k=i.project(M,E),z=i.project(M,I),V=i.project(b,I);let j=Math.min(P.x,k.x,z.x,V.x),J=Math.min(P.y,k.y,z.y,V.y),re=Math.max(P.x,k.x,z.x,V.x),de=Math.max(P.y,k.y,z.y,V.y);const he=l/16;function pe(ve,Fe,ze,Je,ct,Oe){const qe=(ze+ct)/2,ut=(Je+Oe)/2,ht=i.project($o(qe),Ri(ut)),Ot=Math.max(0,j-ht.x,J-ht.y,ht.x-re,ht.y-de);j=Math.min(j,ht.x),re=Math.max(re,ht.x),J=Math.min(J,ht.y),de=Math.max(de,ht.y),Ot>he&&(pe(ve,ht,ze,Je,qe,ut),pe(ht,Fe,qe,ut,ct,Oe))}pe(P,k,c,g,f,g),pe(k,z,f,g,f,y),pe(z,V,f,y,c,y),pe(V,P,c,y,c,g),j-=he,J-=he,re+=he,de+=he;const _e=1/Math.max(re-j,de-J);return{scale:_e,x:j*_e,y:J*_e,x2:re*_e,y2:de*_e,projection:i}}const Z0=as(new Float32Array(16));class tc{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,l){return{x:0,y:0,z:0}}unproject(i,l){return new _r(0,0)}projectTilePoint(i,l,c){return{x:i,y:l,z:0}}locationPoint(i,l,c=!0){return i._coordinatePoint(i.locationCoordinate(l),c)}pixelsPerMeter(i,l){return na(1,i)*l}pixelSpaceConversion(i,l,c){return 1}farthestPixelDistance(i){return g_(i,i.pixelsPerMeter)}pointCoordinate(i,l,c,f){const g=i.horizonLineFromTop(!1),y=new ce(l,Math.max(g,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(y,f))}pointCoordinate3D(i,l,c){const f=new ce(l,c);if(i.elevation)return i.elevation.pointCoordinate(f);{const g=this.pointCoordinate(i,f.x,f.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,l){if(i.elevation)return!this.pointCoordinate3D(i,l.x,l.y);const c=i.horizonLineFromTop();return l.y<c}createInversionMatrix(i,l){return Z0}createTileMatrix(i,l,c){let f,g,y;const b=c.canonical,M=as(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=ah(b,this);f=1,g=E.x+c.wrap*E.scale,y=E.y,Zl(M,M,[f/E.scale,f/E.scale,i.pixelsPerMeter/l])}else f=l/i.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*c.wrap)*f,y=b.y*f;return Gc(M,M,[g,y,0]),Zl(M,M,[f/hn,f/hn,1]),M}upVector(i,l,c){return[0,0,1]}upVectorScale(i,l,c){return{metersToTile:1}}}class __ extends tc{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[l,c]=this.parallels=i.parallels||[29.5,45.5],f=Math.sin(tt(l));this.n=(f+Math.sin(tt(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(i,l){const{n:c,c:f,r0:g}=this,y=tt(i-this.center[0]),b=tt(l),M=Math.sqrt(f-2*c*Math.sin(b))/c;return{x:M*Math.sin(y*c),y:M*Math.cos(y*c)-g,z:0}}unproject(i,l){const{n:c,c:f,r0:g}=this,y=g+l;let b=Math.atan2(i,Math.abs(y))*Math.sign(y);y*c<0&&(b-=Math.PI*Math.sign(i)*Math.sign(y));const M=tt(this.center[0])*c;b=xe(b,-Math.PI-M,Math.PI-M);const E=Mt(b/c)+this.center[0],I=Math.asin(je((f-(i*i+y*y)*c*c)/(2*c),-1,1)),P=je(Mt(I),-85.051129,Ms);return new _r(E,P)}}const ym=1.340264,lh=-.081106,ep=893e-6,vm=.003796,rt=Math.sqrt(3)/2;class y_ extends tc{project(i,l){l=l/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(rt*Math.sin(l)),f=c*c,g=f*f*f;return{x:.5*(i*Math.cos(c)/(rt*(ym+3*lh*f+g*(7*ep+9*vm*f)))/Math.PI+.5),y:1-.5*(c*(ym+lh*f+g*(ep+vm*f))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let c=l=(2*(1-l)-1)*Math.PI,f=c*c,g=f*f*f;for(let I,P,k,z=0;z<12&&(P=c*(ym+lh*f+g*(ep+vm*f))-l,k=ym+3*lh*f+g*(7*ep+9*vm*f),I=P/k,c=je(c-I,-Math.PI/3,Math.PI/3),f=c*c,g=f*f*f,!(Math.abs(I)<1e-12));++z);const y=rt*i*(ym+3*lh*f+g*(7*ep+9*vm*f))/Math.cos(c),b=Math.asin(Math.sin(c)/rt),M=je(180*y/Math.PI,-180,180),E=je(180*b/Math.PI,-85.051129,Ms);return new _r(M,E)}}class sb extends tc{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){return{x:.5+i/360,y:.5-l/360,z:0}}unproject(i,l){const c=360*(i-.5),f=je(360*(.5-l),-85.051129,Ms);return new _r(c,f)}}const Rd=Math.PI/2;function Ld(s){return Math.tan((Rd+s)/2)}class NM extends tc{constructor(i){super(i),this.center=i.center||[0,30];const[l,c]=this.parallels=i.parallels||[30,30],f=tt(l),g=tt(c),y=Math.cos(f);this.n=f===g?Math.sin(f):Math.log(y/Math.cos(g))/Math.log(Ld(g)/Ld(f)),this.f=y*Math.pow(Ld(f),this.n)/this.n}project(i,l){l=tt(l),i=tt(i-this.center[0]);const c=1e-6,{n:f,f:g}=this;g>0?l<-Rd+c&&(l=-Rd+c):l>Rd-c&&(l=Rd-c);const y=g/Math.pow(Ld(l),f),b=y*Math.sin(f*i),M=g-y*Math.cos(f*i);return{x:.5*(b/Math.PI+.5),y:1-.5*(M/Math.PI+.5),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI,l=(2*(1-l)-.5)*Math.PI;const{n:c,f}=this,g=f-l,y=Math.sign(g),b=Math.sign(c)*Math.sqrt(i*i+g*g);let M=Math.atan2(i,Math.abs(g))*y;g*c<0&&(M-=Math.PI*Math.sign(i)*y);const E=je(Mt(M/c)+this.center[0],-180,180),I=je(Mt(2*Math.atan(Math.pow(f/b,1/c))-Rd),-85.051129,Ms);return new _r(E,I)}}class ab extends tc{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,l){return{x:Gl(i),y:sl(l),z:0}}unproject(i,l){const c=$o(i),f=Ri(l);return new _r(c,f)}}const xm=tt(Ms);class BM extends tc{project(i,l){const c=(l=tt(l))*l,f=c*c;return{x:.5*((i=tt(i))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(i,l){i=(2*i-.5)*Math.PI;let c=l=(2*(1-l)-1)*Math.PI,f=25,g=0,y=c*c;do{y=c*c;const E=y*y;g=(c*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-l)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),c=je(c-g,-xm,xm)}while(Math.abs(g)>1e-6&&--f>0);y=c*c;const b=je(Mt(i/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),M=Mt(c);return new _r(b,M)}}const lb=tt(Ms);class VM extends tc{project(i,l){l=tt(l),i=tt(i);const c=Math.cos(l),f=2/Math.PI,g=Math.acos(c*Math.cos(i/2)),y=Math.sin(g)/g,b=.5*(i*f+2*c*Math.sin(i/2)/y)||0,M=.5*(l+Math.sin(l)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(i,l){let c=i=(2*i-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,g=25;const y=1e-6;let b=0,M=0;do{const E=Math.cos(f),I=Math.sin(f),P=2*I*E,k=I*I,z=E*E,V=Math.cos(c/2),j=Math.sin(c/2),J=2*V*j,re=j*j,de=1-z*V*V,he=de?1/de:0,pe=de?Math.acos(E*V)*Math.sqrt(1/de):0,_e=.5*(2*pe*E*j+2*c/Math.PI)-i,ve=.5*(pe*I+f)-l,Fe=.5*he*(z*re+pe*E*V*k)+1/Math.PI,ze=he*(J*P/4-pe*I*j),Je=.125*he*(P*j-pe*I*z*J),ct=.5*he*(k*V+pe*re*E)+.5,Oe=ze*Je-ct*Fe;b=(ve*ze-_e*ct)/Oe,M=(_e*Je-ve*Fe)/Oe,c=je(c-b,-Math.PI,Math.PI),f=je(f-M,-lb,lb)}while((Math.abs(b)>y||Math.abs(M)>y)&&--g>0);return new _r(Mt(c),Mt(f))}}class cb extends tc{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,l){const{scale:c,cosPhi:f}=this;return{x:tt(i)*f*c+.5,y:-Math.sin(tt(l))/f*c+.5,z:0}}unproject(i,l){const{scale:c,cosPhi:f}=this,g=-(l-.5)/c,y=je(Mt((i-.5)/c)/f,-180,180),b=Math.asin(je(g*f,-1,1)),M=je(Mt(b),-85.051129,Ms);return new _r(y,M)}}class UM extends ab{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(i,l,c){const f=Math.pow(2,c.z),g=(i/hn+c.x)/f,y=Hi(Ri((l/hn+c.y)/f),$o(g));return oi(y,y,Jc(hl(c))),{x:y[0],y:y[1],z:y[2]}}locationPoint(i,l){const c=Hi(l.lat,l.lng),f=Go([],c),g=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(l),i._centerAltitude):i._centerAltitude;Qp(c,c,f,na(1,0)*hn*g);const y=as(new Float64Array(16));return Zu(y,i.pixelMatrix,i.globeMatrix),oi(c,c,y),new ce(c[0],c[1])}pixelsPerMeter(i,l){return na(1,0)*l}pixelSpaceConversion(i,l,c){const f=Un(na(1,45)*l,na(1,i)*l,c);return this.pixelsPerMeter(i,l)/f}createTileMatrix(i,l,c){const f=G0(hl(c.canonical));return Zu(new Float64Array(16),i.globeMatrix,f)}createInversionMatrix(i,l){const{center:c}=i,f=as(new Float64Array(16));return Zu(f,f,Jc(hl(l))),wd(f,f,tt(c.lng)),Wu(f,f,tt(c.lat)),Zl(f,f,[i._projectionScaler,i._projectionScaler,1]),Float32Array.from(f)}pointCoordinate(i,l,c,f){return rb(i,l,c,!0)||new Hl(0,0)}pointCoordinate3D(i,l,c){const f=this.pointCoordinate(i,l,c,0);return[f.x,f.y,f.z]}isPointAboveHorizon(i,l){return!rb(i,l.x,l.y,!1)}farthestPixelDistance(i){const l=function(f,g){const y=f.cameraToCenterDistance,b=f._centerAltitude*g,M=f._camera,E=f._camera.forward(),I=Wl([],ll([],E,-y),[0,0,b]),P=f.worldSize/(2*Math.PI),k=[0,0,-P],z=f.width/f.height,V=Math.tan(f.fovAboveCenter),j=ll([],M.up(),V),J=ll([],M.right(),V*z),re=Go([],Wl([],Wl([],E,j),J)),de=[];let he;if(new Yy(I,re).closestPointOnSphere(k,P,de)){const pe=Wl([],de,k),_e=oa([],pe,I);he=Math.cos(f.fovAboveCenter)*Hc(_e)}else{const pe=oa([],I,k),_e=oa([],k,I);Go(_e,_e);const ve=Hc(pe)-P;he=Math.sqrt(ve*(ve+2*P));const Fe=Math.acos(he/(P+ve))-Math.acos(ia(E,_e));he*=Math.cos(Fe)}return 1.01*he}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=m_(i.zoom);if(c>0){const f=g_(i,na(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),y=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Un(l,f+g*(1-Math.cos(y)),Math.pow(c,10))}return l}upVector(i,l,c){const f=1<<i.z,g=(l/hn+i.x)/f;return Hi(Ri((c/hn+i.y)/f),$o(g),1)}upVectorScale(i){return{metersToTile:_o*Qf(hl(i))}}}function v_(s){const i=s.parallels,l=!!i&&Math.abs(i[0]+i[1])<.01;switch(s.name){case"mercator":return new ab(s);case"equirectangular":return new sb(s);case"naturalEarth":return new BM(s);case"equalEarth":return new y_(s);case"winkelTripel":return new VM(s);case"albers":return l?new cb(s):new __(s);case"lambertConformalConic":return l?new cb(s):new NM(s);case"globe":return new UM(s)}throw new Error(`Invalid projection name: ${s.name}`)}const x_=eh.VectorTileFeature.types,W0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bm(s,i,l,c,f,g,y,b,M,E,I,P,k){const z=b?Math.min(Yc,Math.round(b[0])):0,V=b?Math.min(Yc,Math.round(b[1])):0;s.emplaceBack(i,l,Math.round(32*c),Math.round(32*f),g,y,(z<<1)+(M?1:0),V,16*E,16*I,256*P,256*k)}function tp(s,i,l,c,f,g,y){s.emplaceBack(i,l,c,f,g,y)}function np(s,i,l,c,f){s.emplaceBack(i,l,c,f),s.emplaceBack(i,l,c,f),s.emplaceBack(i,l,c,f),s.emplaceBack(i,l,c,f)}function wm(s){for(const i of s.sections)if(T(i.text))return!0;return!1}class $s{constructor(i){this.layoutVertexArray=new $i,this.indexArray=new ri,this.programConfigurations=i,this.segments=new Mi,this.dynamicLayoutVertexArray=new Ur,this.opacityVertexArray=new Pr,this.placedSymbolArray=new bg,this.globeExtVertexArray=new Da}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,U1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,$1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,W0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,j1.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Bt($s,"SymbolBuffers");class Cm{constructor(i,l,c){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new c,this.segments=new Mi,this.collisionVertexArray=new Gi,this.collisionVertexArrayExt=new zr}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,G1.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,H1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Bt(Cm,"CollisionBuffers");class Qc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=as([]),this.placementViewportMatrix=as([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wf(this.zoom,l["text-size"]),this.iconSizeData=Wf(this.zoom,l["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>js[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new $s(new _d(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new $s(new _d(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new zu,this.lineVertexArray=new Nu,this.symbolInstances=new Fu}calculateGlyphDependencies(i,l,c,f,g){for(let y=0;y<i.length;y++)if(l[i.charCodeAt(y)]=!0,f&&g){const b=Ra[i.charAt(y)];b&&(l[b.charCodeAt(0)]=!0)}}populate(i,l,c,f){const g=this.layers[0],y=g.layout,b="globe"===this.projection.name,M=y.get("text-font"),E=y.get("text-field"),I=y.get("icon-image"),P=("constant"!==E.value.kind||E.value.value instanceof Bi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==M.value.kind||M.value.value.length>0),k="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const V=l.iconDependencies,j=l.glyphDependencies,J=l.availableImages,re=new X(this.zoom);for(const{feature:de,id:he,index:pe,sourceLayerIndex:_e}of i){const ve=g._featureFilter.needGeometry,Fe=ju(de,ve);if(!g._featureFilter.filter(re,Fe,c))continue;if(ve||(Fe.geometry=ql(de,c,f)),b&&1!==de.type&&c.z<=5){const Oe=Fe.geometry,qe=1<<c.z,ut=c.x,ht=c.y,Ot=.98078528056;for(let at=0;at<Oe.length;at++)Oe[at]=c1(Oe[at],yt=>yt,(yt,In)=>ia(Hi(Ri((yt.y/hn+ht)/qe),$o((yt.x/hn+ut)/qe),1),Hi(Ri((In.y/hn+ht)/qe),$o((In.x/hn+ut)/qe),1))<Ot)}let ze,Je;if(P){const Oe=g.getValueAndResolveTokens("text-field",Fe,c,J),qe=Bi.factory(Oe);wm(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ie()||this.hasRTLText&&Q.isParsed())&&(ze=_0(qe,g,Fe))}if(k){const Oe=g.getValueAndResolveTokens("icon-image",Fe,c,J);Je=Oe instanceof ai?Oe:ai.fromString(Oe)}if(!ze&&!Je)continue;const ct=this.sortFeaturesByKey?z.evaluate(Fe,{},c):void 0;if(this.features.push({id:he,text:ze,icon:Je,index:pe,sourceLayerIndex:_e,geometry:Fe.geometry,properties:de.properties,type:x_[de.type],sortKey:ct}),Je&&(V[Je.name]=!0),ze){const Oe=M.evaluate(Fe,{},c).join(","),qe="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(js.vertical)>=0;for(const ut of ze.sections)if(ut.image)V[ut.image.name]=!0;else{const ht=Vl(ze.toString()),Ot=ut.fontStack||Oe,at=j[Ot]=j[Ot]||{};this.calculateGlyphDependencies(ut.text,at,qe,this.allowVerticalPlacement,ht)}}}"line"===y.get("symbol-placement")&&(this.features=function(de){const he={},pe={},_e=[];let ve=0;function Fe(Oe){_e.push(de[Oe]),ve++}function ze(Oe,qe,ut){const ht=pe[Oe];return delete pe[Oe],pe[qe]=ht,_e[ht].geometry[0].pop(),_e[ht].geometry[0]=_e[ht].geometry[0].concat(ut[0]),ht}function Je(Oe,qe,ut){const ht=he[qe];return delete he[qe],he[Oe]=ht,_e[ht].geometry[0].shift(),_e[ht].geometry[0]=ut[0].concat(_e[ht].geometry[0]),ht}function ct(Oe,qe,ut){const ht=ut?qe[0][qe[0].length-1]:qe[0][0];return`${Oe}:${ht.x}:${ht.y}`}for(let Oe=0;Oe<de.length;Oe++){const qe=de[Oe],ut=qe.geometry,ht=qe.text?qe.text.toString():null;if(!ht){Fe(Oe);continue}const Ot=ct(ht,ut),at=ct(ht,ut,!0);if(Ot in pe&&at in he&&pe[Ot]!==he[at]){const yt=Je(Ot,at,ut),In=ze(Ot,at,_e[yt].geometry);delete he[Ot],delete pe[at],pe[ct(ht,_e[In].geometry,!0)]=In,_e[yt].geometry=null}else Ot in pe?ze(Ot,at,ut):at in he?Je(Ot,at,ut):(Fe(Oe),he[Ot]=ve-1,pe[at]=ve-1)}return _e.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,he)=>de.sortKey-he.sortKey)}update(i,l,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,c,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=v_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const c=this.lineVertexArray.length,f=i.segment;if(void 0!==f){let g=i.dist(l[f+1]),y=i.dist(l[f]);const b={};for(let M=f+1;M<l.length;M++)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:g},M<l.length-1&&(g+=l[M+1].dist(l[M]));for(let M=f||0;M>=0;M--)b[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:y},M>0&&(y+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const E=b[M];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,l,c,f,g,y,b,M,E,I,P,k,z,V){const j=i.indexArray,J=i.layoutVertexArray,re=i.globeExtVertexArray,de=i.segments.prepareSegment(4*l.length,J,j,this.canOverlap?y.sortKey:void 0),he=this.glyphOffsetArray.length,pe=de.vertexLength,_e=this.allowVerticalPlacement&&b===js.vertical?Math.PI/2:0,ve=y.text&&y.text.sections;for(let ze=0;ze<l.length;ze++){const{tl:Je,tr:ct,bl:Oe,br:qe,tex:ut,pixelOffsetTL:ht,pixelOffsetBR:Ot,minFontScaleX:at,minFontScaleY:yt,glyphOffset:In,isSDF:$n,sectionIndex:Qt}=l[ze],Ut=de.vertexLength,Zn=In[1];if(bm(J,E.x,E.y,Je.x,Zn+Je.y,ut.x,ut.y,c,$n,ht.x,ht.y,at,yt),bm(J,E.x,E.y,ct.x,Zn+ct.y,ut.x+ut.w,ut.y,c,$n,Ot.x,ht.y,at,yt),bm(J,E.x,E.y,Oe.x,Zn+Oe.y,ut.x,ut.y+ut.h,c,$n,ht.x,Ot.y,at,yt),bm(J,E.x,E.y,qe.x,Zn+qe.y,ut.x+ut.w,ut.y+ut.h,c,$n,Ot.x,Ot.y,at,yt),M){const Bn=M.anchor,Xt=M.up;tp(re,Bn.x,Bn.y,Bn.z,Xt[0],Xt[1],Xt[2]),tp(re,Bn.x,Bn.y,Bn.z,Xt[0],Xt[1],Xt[2]),tp(re,Bn.x,Bn.y,Bn.z,Xt[0],Xt[1],Xt[2]),tp(re,Bn.x,Bn.y,Bn.z,Xt[0],Xt[1],Xt[2]),np(i.dynamicLayoutVertexArray,Bn.x,Bn.y,Bn.z,_e)}else np(i.dynamicLayoutVertexArray,E.x,E.y,E.z,_e);j.emplaceBack(Ut,Ut+1,Ut+2),j.emplaceBack(Ut+1,Ut+2,Ut+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(In[0]),ze!==l.length-1&&Qt===l[ze+1].sectionIndex||i.programConfigurations.populatePaintArrays(J.length,y,y.index,{},z,V,ve&&ve[Qt])}const Fe=M?M.anchor:E;i.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,E.x,E.y,he,this.glyphOffsetArray.length-he,pe,I,P,E.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],b,0,!1,0,k,0)}_commitLayoutVertex(i,l,c,f,g,y,b){i.emplaceBack(l,c,f,g,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,l,c,f,g,y,b){const M=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=M.vertexLength,I=b.tileAnchorX,P=b.tileAnchorY;for(let z=0;z<4;z++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(l,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(l,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(l,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(l,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,I,P,new ce(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,I,P,new ce(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,I,P,new ce(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,I,P,new ce(i.x1,i.y2)),M.vertexLength+=4;const k=c.indexArray;k.emplaceBack(E,E+1),k.emplaceBack(E+1,E+2),k.emplaceBack(E+2,E+3),k.emplaceBack(E+3,E),M.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,c,f,g,y){for(let b=f;b<g;b++){const M=c.get(b),E=this.getSymbolInstanceTextSize(i,y,l,b);this._addCollisionDebugVertices(M,E,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,l,c,f,g,y){for(let b=f;b<g;b++){const M=c.get(b),E=this.getSymbolInstanceIconSize(i,l,b);this._addCollisionDebugVertices(M,E,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cm(sr,p0.members,os),this.iconCollisionBox=new Cm(sr,p0.members,os);const c=Id(this.iconSizeData,i),f=Id(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(i,l,c,f){const g=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),y=im(this.textSizeData,i,g)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,l,c){const f=this.icon.placedSymbolArray.get(c),g=im(this.iconSizeData,i,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,l,c){i.emplaceBack(l,-c,-c),i.emplaceBack(l,c,-c),i.emplaceBack(l,c,c),i.emplaceBack(l,-c,c)}_updateTextDebugCollisionBoxes(i,l,c,f,g,y){for(let b=f;b<g;b++){const M=c.get(b),E=this.getSymbolInstanceTextSize(i,y,l,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,M.padding)}}_updateIconDebugCollisionBoxes(i,l,c,f,g){for(let y=f;y<g;y++){const b=c.get(y),M=this.getSymbolInstanceIconSize(i,l,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,b.padding)}}updateCollisionDebugBuffers(i,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Id(this.iconSizeData,i),f=Id(this.textSizeData,i);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,c,f,g,y,b,M,E){const I={};for(let P=l;P<c;P++){const k=i.get(P);I.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.textFeatureIndex=k.featureIndex;break}for(let P=f;P<g;P++){const k=i.get(P);I.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalTextFeatureIndex=k.featureIndex;break}for(let P=y;P<b;P++){const k=i.get(P);I.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.iconFeatureIndex=k.featureIndex;break}for(let P=M;P<E;P++){const k=i.get(P);I.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalIconFeatureIndex=k.featureIndex;break}return I}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const c=i.placedSymbolArray.get(l),f=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<f;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),c=Math.cos(i),f=[],g=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const M=this.symbolInstances.get(b);f.push(0|Math.round(l*M.tileAnchorX+c*M.tileAnchorY)),g.push(M.featureIndex)}return y.sort((b,M)=>f[b]-f[M]||g[M]-g[b]),y}addToSortKeyRanges(i,l){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===l?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const c=this.symbolInstances.get(l);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,g,y)=>{f>=0&&y.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Bt(Qc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Qc.MAX_GLYPHS=65535,Qc.addDynamicAttributes=np;const b_=new Vt({"symbol-placement":new ae(we.layout_symbol["symbol-placement"]),"symbol-spacing":new ae(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ae(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ie(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ae(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ae(we.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ae(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new ae(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ae(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ie(we.layout_symbol["icon-size"]),"icon-text-fit":new ae(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ae(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ie(we.layout_symbol["icon-image"]),"icon-rotate":new Ie(we.layout_symbol["icon-rotate"]),"icon-padding":new ae(we.layout_symbol["icon-padding"]),"icon-keep-upright":new ae(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Ie(we.layout_symbol["icon-offset"]),"icon-anchor":new Ie(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ae(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ae(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ae(we.layout_symbol["text-rotation-alignment"]),"text-field":new Ie(we.layout_symbol["text-field"]),"text-font":new Ie(we.layout_symbol["text-font"]),"text-size":new Ie(we.layout_symbol["text-size"]),"text-max-width":new Ie(we.layout_symbol["text-max-width"]),"text-line-height":new Ie(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Ie(we.layout_symbol["text-letter-spacing"]),"text-justify":new Ie(we.layout_symbol["text-justify"]),"text-radial-offset":new Ie(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ae(we.layout_symbol["text-variable-anchor"]),"text-anchor":new Ie(we.layout_symbol["text-anchor"]),"text-max-angle":new ae(we.layout_symbol["text-max-angle"]),"text-writing-mode":new ae(we.layout_symbol["text-writing-mode"]),"text-rotate":new Ie(we.layout_symbol["text-rotate"]),"text-padding":new ae(we.layout_symbol["text-padding"]),"text-keep-upright":new ae(we.layout_symbol["text-keep-upright"]),"text-transform":new Ie(we.layout_symbol["text-transform"]),"text-offset":new Ie(we.layout_symbol["text-offset"]),"text-allow-overlap":new ae(we.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ae(we.layout_symbol["text-ignore-placement"]),"text-optional":new ae(we.layout_symbol["text-optional"])});var Fa={paint:new Vt({"icon-opacity":new Ie(we.paint_symbol["icon-opacity"]),"icon-color":new Ie(we.paint_symbol["icon-color"]),"icon-halo-color":new Ie(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ie(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ie(we.paint_symbol["icon-halo-blur"]),"icon-translate":new ae(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new ae(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ie(we.paint_symbol["text-opacity"]),"text-color":new Ie(we.paint_symbol["text-color"],{runtimeType:ks,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ie(we.paint_symbol["text-halo-color"]),"text-halo-width":new Ie(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Ie(we.paint_symbol["text-halo-blur"]),"text-translate":new ae(we.paint_symbol["text-translate"]),"text-translate-anchor":new ae(we.paint_symbol["text-translate-anchor"])}),layout:b_};class Mm{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:vu,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt(Mm,"FormatSectionOverride",{omit:["defaultValue"]});class rp extends Ia{constructor(i){super(i,Fa)}recalculate(i,l){super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const g of c)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,l,c,f){const g=this.layout.get(i).evaluate(l,{},c,f),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||_f(y.value)||!g?g:(b=l.properties,g.replace(/{([^{}]+)}/g,(E,I)=>I in b?String(b[I]):""));var b}createBucket(i){return new Qc(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Fa.paint.overridableProperties){if(!rp.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),c=new Mm(l),f=new gf(c,l.property.specification);let g=null;g="constant"===l.value.kind||"source"===l.value.kind?new yf("source",f):new Rc("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new Re(l.property,g,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,c){return!(!this.layout||l.isDataDriven()||c.isDataDriven())&&rp.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const c=i.get("text-field"),f=Fa.paint.properties[l];let g=!1;const y=b=>{for(const M of b)if(f.overrides&&f.overrides.hasOverride(M))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof Bi)y(c.value.value.sections);else if("source"===c.value.kind){const b=E=>{g||(E instanceof Gh&&pi(E.value)===Mr?y(E.value.sections):E instanceof Ja?y(E.sections):E.eachChild(b))},M=c.value;M._styleExpression&&b(M._styleExpression.expression)}return g}getProgramConfiguration(i){return new Vu(this,i)}}var w_={paint:new Vt({"background-color":new ae(we.paint_background["background-color"]),"background-pattern":new Dt(we.paint_background["background-pattern"]),"background-opacity":new ae(we.paint_background["background-opacity"])})},jM={paint:new Vt({"raster-opacity":new ae(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new ae(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ae(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ae(we.paint_raster["raster-brightness-max"]),"raster-saturation":new ae(we.paint_raster["raster-saturation"]),"raster-contrast":new ae(we.paint_raster["raster-contrast"]),"raster-resampling":new ae(we.paint_raster["raster-resampling"]),"raster-fade-duration":new ae(we.paint_raster["raster-fade-duration"])})};class X0 extends Ia{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var $M={paint:new Vt({"sky-type":new ae(we.paint_sky["sky-type"]),"sky-atmosphere-sun":new ae(we.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ae(we.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ae(we.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ae(we.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ye(we.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ae(we.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ae(we.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ae(we.paint_sky["sky-opacity"])})};function Fd(s,i,l){const c=[0,0,1],f=Zy([]);return Xy(f,f,l?-tt(s)+Math.PI:tt(s)),Wy(f,f,-tt(i)),Og(c,c,f),Go(c,c)}const Em={circle:class extends Ia{constructor(s){super(s,p1)}createBucket(s){return new Xp(s)}queryRadius(s){const i=s;return Hu("circle-radius",this,i)+Hu("circle-stroke-width",this,i)+Yp(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,l,c,f,g,y,b){const M=$y(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return Pa(s,c,g,y,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),M,E)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Vu(this,s)}},heatmap:class extends Ia{createBucket(s){return new v1(s)}constructor(s){super(s,kM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Qy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Hu("heatmap-radius",this,s)}queryIntersectsFeature(s,i,l,c,f,g,y,b){const M=this.paint.get("heatmap-radius").evaluate(i,l);return Pa(s,c,g,y,b,!0,!0,new ce(0,0),M)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Vu(this,s)}},hillshade:class extends Ia{constructor(s){super(s,e0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ia{constructor(s){super(s,R1)}getProgramIds(){const s=this.paint.get("fill-pattern"),i=s&&s.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(s){return new Vu(this,s)}recalculate(s,i){super.recalculate(s,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Uf(s)}queryRadius(){return Yp(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,l,c,f,g){return!s.queryGeometry.isAboveHorizon&&Sg(d1(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ia{constructor(s){super(s,RM)}createBucket(s){return new Hf(s)}queryRadius(){return Yp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Vu(this,s)}queryIntersectsFeature(s,i,l,c,f,g,y,b,M){const E=$y(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(i,l),P=this.paint.get("fill-extrusion-base").evaluate(i,l),k=[0,0],z=b&&g.elevation,V=g.elevation?g.elevation.exaggeration():1,j=s.tile.getBucket(this);if(z&&j instanceof Hf){const de=j.centroidVertexArray,he=M+1;if(he<de.length){const pe=de.get(he);k[0]=pe.a_centroid_pos0,k[1]=pe.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;"globe"===g.projection.name&&(c=l0([c],[new ce(0,0),new ce(hn,hn)],s.tileID.canonical).map(de=>de.polygon).flat());const J=(he=c,pe=P,_e=I,ve=E,Fe=y,ze=z?b:null,Je=k,ct=V,Oe=g.center.lat,"globe"===(de=g).projection.name?function(ut,ht,Ot,at,yt,In,$n,Qt,Ut,Zn,Bn){const Xt=[],Fi=[],ui=ut.projection.upVectorScale(Bn,ut.center.lat,ut.worldSize).metersToTile,yi=[0,0,0,1],Xn=[0,0,0,1],Qn=(Rr,xr,Br,Jr)=>{Rr[0]=xr,Rr[1]=Br,Rr[2]=Jr,Rr[3]=1},Or=ul();Ot>0&&(Ot+=Or),at+=Or;for(const Rr of ht){const xr=[],Br=[];for(const Jr of Rr){const yo=Jr.x+yt.x,Ts=Jr.y+yt.y,Kn=ut.projection.projectTilePoint(yo,Ts,Bn),Ei=ut.projection.upVector(Bn,Jr.x,Jr.y);let Ro=Ot,fr=at;if($n){const Qr=Sd(yo,Ts,Ot,at,$n,Qt,Ut,Zn);Ro+=Qr.base,fr+=Qr.top}0!==Ot?Qn(yi,Kn.x+Ei[0]*ui*Ro,Kn.y+Ei[1]*ui*Ro,Kn.z+Ei[2]*ui*Ro):Qn(yi,Kn.x,Kn.y,Kn.z),Qn(Xn,Kn.x+Ei[0]*ui*fr,Kn.y+Ei[1]*ui*fr,Kn.z+Ei[2]*ui*fr),oi(yi,yi,In),oi(Xn,Xn,In),xr.push(Zf(yi)),Br.push(Zf(Xn))}Xt.push(xr),Fi.push(Br)}return[Xt,Fi]}(de,he,pe,_e,ve,Fe,ze,Je,ct,Oe,s.tileID.canonical):ze?function(ut,ht,Ot,at,yt,In,$n,Qt,Ut){const Zn=[],Bn=[],Xt=[0,0,0,1];for(const Fi of ut){const ui=[],yi=[];for(const Xn of Fi){const Qn=Xn.x+at.x,Or=Xn.y+at.y,Rr=Sd(Qn,Or,ht,Ot,In,$n,Qt,Ut);Xt[0]=Qn,Xt[1]=Or,Xt[2]=Rr.base,Xt[3]=1,Zc(Xt,Xt,yt),Xt[3]=Math.max(Xt[3],1e-5);const xr=Zf([Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]]);Xt[0]=Qn,Xt[1]=Or,Xt[2]=Rr.top,Xt[3]=1,Zc(Xt,Xt,yt),Xt[3]=Math.max(Xt[3],1e-5);const Br=Zf([Xt[0]/Xt[3],Xt[1]/Xt[3],Xt[2]/Xt[3]]);ui.push(xr),yi.push(Br)}Zn.push(ui),Bn.push(yi)}return[Zn,Bn]}(he,pe,_e,ve,Fe,ze,Je,ct,Oe):function(ut,ht,Ot,at,yt){const In=[],$n=[],Qt=yt[8]*ht,Ut=yt[9]*ht,Zn=yt[10]*ht,Bn=yt[11]*ht,Xt=yt[8]*Ot,Fi=yt[9]*Ot,ui=yt[10]*Ot,yi=yt[11]*Ot;for(const Xn of ut){const Qn=[],Or=[];for(const Rr of Xn){const xr=Rr.x+at.x,Br=Rr.y+at.y,Jr=yt[0]*xr+yt[4]*Br+yt[12],yo=yt[1]*xr+yt[5]*Br+yt[13],Ts=yt[2]*xr+yt[6]*Br+yt[14],Kn=yt[3]*xr+yt[7]*Br+yt[15],Ei=Jr+Qt,Ro=yo+Ut,fr=Ts+Zn,Qr=Math.max(Kn+Bn,1e-5),Lo=Jr+Xt,Wr=yo+Fi,vi=Ts+ui,si=Math.max(Kn+yi,1e-5),Ii=new ce(Ei/Qr,Ro/Qr);Ii.z=fr/Qr,Qn.push(Ii);const vo=new ce(Lo/si,Wr/si);vo.z=vi/si,Or.push(vo)}In.push(Qn),$n.push(Or)}return[In,$n]}(he,pe,_e,ve,Fe)),re=s.queryGeometry;var de,he,pe,_e,ve,Fe,ze,Je,ct,Oe;return function(de,he,pe){let _e=1/0;Sg(pe,he)&&(_e=c0(pe,he[0]));for(let ve=0;ve<he.length;ve++){const Fe=he[ve],ze=de[ve];for(let Je=0;Je<Fe.length-1;Je++){const ct=Fe[Je],Oe=[ct,Fe[Je+1],ze[Je+1],ze[Je],ct];xd(pe,Oe)&&(_e=Math.min(_e,c0(pe,Oe)))}}return _e!==1/0&&_e}(J[0],J[1],re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Ia{constructor(s){super(s,Wg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Mu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=f0.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Kl(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Vu(this,s)}queryRadius(s){const i=s,l=rm(Hu("line-width",this,i),Hu("line-gap-width",this,i)),c=Hu("line-offset",this,i);return l/2+Math.abs(c)+Yp(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,l,c,f,g){if(s.queryGeometry.isAboveHorizon)return!1;const y=d1(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,s.pixelToTileUnitsFactor),b=s.pixelToTileUnitsFactor/2*rm(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),M=this.paint.get("line-offset").evaluate(i,l);return M&&(c=function(E,I){const P=[],k=new ce(0,0);for(let z=0;z<E.length;z++){const V=E[z],j=[];for(let J=0;J<V.length;J++){const re=V[J-1],de=V[J],he=V[J+1],pe=0===J?k:de.sub(re)._unit()._perp(),_e=J===V.length-1?k:he.sub(de)._unit()._perp(),ve=pe._add(_e)._unit();ve._mult(1/(ve.x*_e.x+ve.y*_e.y)),j.push(ve._mult(I)._add(de))}P.push(j)}return P}(c,M*s.pixelToTileUnitsFactor)),function(E,I,P){for(let k=0;k<I.length;k++){const z=I[k];if(E.length>=3)for(let V=0;V<z.length;V++)if(Aa(E,z[V]))return!0;if(Of(E,z,P))return!0}return!1}(y,c,b)}isTileClipped(){return!0}},symbol:rp,background:class extends Ia{constructor(s){super(s,w_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ia{constructor(s){super(s,jM)}getProgramIds(){return["raster"]}},sky:class extends Ia{constructor(s){super(s,$M),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Qy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(s,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),f=!c,g=s.style.light,y=g.properties.get("position");return f&&"viewport"===g.properties.get("anchor")&&On("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Fd(y.azimuthal,90-y.polar,i):Fd(c[0],90-c[1],i)}const l=this.paint.get("sky-gradient-center");return Fd(l[0],90-l[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class ch{constructor(i,l,c,f){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(l,f)}update(i,l,c){const{width:f,height:g}=i,{context:y}=this,{gl:b}=y,{HTMLImageElement:M,HTMLCanvasElement:E,HTMLVideoElement:I,ImageData:P,ImageBitmap:k}=W;if(b.bindTexture(b.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!l||!1!==l.premultiply)),c||this.size&&this.size[0]===f&&this.size[1]===g){const{x:z,y:V}=c||{x:0,y:0};i instanceof M||i instanceof E||i instanceof I||i instanceof P||k&&i instanceof k?b.texSubImage2D(b.TEXTURE_2D,0,z,V,b.RGBA,b.UNSIGNED_BYTE,i):b.texSubImage2D(b.TEXTURE_2D,0,z,V,f,g,b.RGBA,b.UNSIGNED_BYTE,i.data)}else this.size=[f,g],i instanceof M||i instanceof E||i instanceof I||i instanceof P||k&&i instanceof k?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,i):b.texImage2D(b.TEXTURE_2D,0,this.format,f,g,0,this.format,b.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(i,l){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?i===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:i),this.filter=i),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class ip{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new Oa({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const c=this.getKey(i,l);return this.positions[c]}trim(){const i=this.width,l=this.height=It(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,c){const f=[];let g=i.length%2==1?-i[i.length-1]*c:0,y=i[0]*c,b=!0;f.push({left:g,right:y,isDash:b,zeroLength:0===i[0]});let M=i[0];for(let E=1;E<i.length;E++){b=!b;const I=i[E];g=M*c,M+=I,y=M*c,f.push({left:g,right:y,isDash:b,zeroLength:0===I})}return f}addRoundDash(i,l,c){const f=l/2;for(let g=-c;g<=c;g++){const y=this.width*(this.nextRow+c+g);let b=0,M=i[b];for(let E=0;E<this.width;E++){E/M.right>1&&(M=i[++b]);const I=Math.abs(E-M.left),P=Math.abs(E-M.right),k=Math.min(I,P);let z;const V=g/c*(f+1);if(M.isDash){const j=f-Math.abs(V);z=Math.sqrt(k*k+j*j)}else z=f-Math.sqrt(k*k+V*V);this.image.data[y+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(i,l){for(let M=i.length-1;M>=0;--M){const E=i[M],I=i[M+1];E.zeroLength?i.splice(M,1):I&&I.isDash===E.isDash&&(I.left=E.left,i.splice(M,1))}const c=i[0],f=i[i.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const g=this.width*this.nextRow;let y=0,b=i[y];for(let M=0;M<this.width;M++){M/b.right>1&&(b=i[++y]);const E=Math.abs(M-b.left),I=Math.abs(M-b.right),P=Math.min(E,I);this.image.data[g+M]=Math.max(0,Math.min(255,(b.isDash?P:-P)+l+128))}}addDash(i,l){const c=this.getKey(i,l);if(this.positions[c])return this.positions[c];const f="round"===l,g=f?7:0,y=2*g+1;if(this.nextRow+y>this.height)return On("LineAtlas out of space"),null;0===i.length&&i.push(1);let b=0;for(let I=0;I<i.length;I++)i[I]<0&&(On("Negative value is found in line dasharray, replacing values with 0"),i[I]=0),b+=i[I];if(0!==b){const I=this.width/b,P=this.getDashRanges(i,this.width,I);f?this.addRoundDash(P,I,g):this.addRegularDash(P,"square"===l?.5*I:0)}const M=this.nextRow+g;this.nextRow+=y;const E={tl:[M,g],br:[b,0]};return this.positions[c]=E,E}}Bt(ip,"LineAtlas");class C_{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class GM{constructor(){this.tasks={},this.taskQueue=[],nn(["process"],this),this.invoker=new C_(this.process),this.nextId=0}add(i,l){const c=this.nextId++,f=function({type:g,isSymbolTile:y,zoom:b}){return b=b||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-b:"maybePrepare"===g&&y?400-b:500:200-b:100-b}(l);if(0===f){Wn();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:l,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Wn();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const g=this.tasks[this.taskQueue[f]];g.priority<l&&(l=g.priority,i=f)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class Y0{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const c=i[l];this._stringToNumber[c]=l,this._numberToString[l]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const ub=["tile","layer","source","sourceLayer","state"];class K0{constructor(i,l,c,f,g){this.type="Feature",this._vectorTileFeature=i,this._z=l,this._x=c,this._y=f,this.properties=i.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const l of ub)void 0!==this[l]&&(i[l]=this[l]);return i}}const uh=new Uint16Array(8184);for(let s=0;s<2046;s++){let i=s+2,l=0,c=0,f=0,g=0,y=0,b=0;for(1&i?f=g=y=32:l=c=b=32;(i>>=1)>1;){const E=l+f>>1,I=c+g>>1;1&i?(f=l,g=c,l=y,c=b):(l=f,c=g,f=y,g=b),y=E,b=I}const M=4*s;uh[M+0]=l,uh[M+1]=c,uh[M+2]=f,uh[M+3]=g}const dl=new Uint16Array(2178),hh=new Uint8Array(1089),op=new Uint16Array(1089);function M_(s){return 0===s?-.03125:32===s?.03125:0}var J0=Lt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Tm={type:2,extent:hn,loadGeometry:()=>[[new ce(0,0),new ce(8193,0),new ce(8193,8193),new ce(0,8193),new ce(0,0)]]};class Q0{constructor(i,l,c,f,g){this.tileID=i,this.uid=tn(),this.uses=0,this.tileSize=l,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(i){const l=i+this.timeAdded;l<Os.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ah(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,g){const y={};if(!g)return y;for(const b of f){const M=b.layerIds.map(E=>g.getLayer(E)).filter(Boolean);if(0!==M.length){b.layers=M,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(E=>M.filter(I=>I.id===E)[0]));for(const E of M)y[E.id]=b}}return y}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Qc){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Qc&&g.hasRTLText){this.hasRTLText=!0,Q.isLoading()||Q.isLoaded()||"deferred"!==ie()||Y();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(g))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Sf}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ch(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ch(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ch(i,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,c,f,g,y,b,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:b,transform:y,params:g,tileTransform:this.tileTransform},i,l,c):{}}querySourceFeatures(i,l){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=l?l.sourceLayer:"",y=f._geojsonTileLayer||f[g];if(!y)return;const b=kl(l&&l.filter),{z:M,x:E,y:I}=this.tileID.canonical,P={z:M,x:E,y:I};for(let k=0;k<y.length;k++){const z=y.feature(k);if(b.needGeometry){const J=ju(z,!0);if(!b.filter(new X(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!b.filter(new X(this.tileID.overscaledZ),z))continue;const V=c.getId(z,g),j=new K0(z,M,E,I,V);j.tile=P,i.push(j)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const c=Xi(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const g=this.expirationTime-l;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!l)return;const c=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const y=this.buckets[g],b=y.layers[0].sourceLayer||"_geojsonTileLayer",M=c[b],E=i[b];if(!M||!E||0===Object.keys(E).length)continue;if(y.update(E,M,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Kl||y instanceof Uf){const P=l.style._getSourceCache(y.layers[0].source);l._terrain&&l._terrain.enabled&&P&&y.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(P.id,this.tileID)}const I=l&&l.style&&l.style.getLayer(g);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Os.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Os.now()+i}setTexture(i,l){const c=l.context,f=c.gl;this.texture=l.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new ch(c,i,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(i,l){const c={};for(const f of l)c[f]=!0;this.dependencies[i]=c}hasDependency(i,l){for(const c of i){const f=this.dependencies[c];if(f)for(const g of l)if(f[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const c=ql(Tm,this.tileID.canonical,this.tileTransform)[0],f=new Sn,g=new Bs;for(let y=0;y<c.length;y++){const{x:b,y:M}=c[y];f.emplaceBack(b,M),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(f,Od.members),this._tileDebugSegments=Mi.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const c=ql(Tm,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const y=function(b,M){const E=ah(b,M),I=Math.pow(2,b.z);for(let J=0;J<33;J++)for(let re=0;re<33;re++){const de=$o((b.x+(re+M_(re))/32)/I),he=Ri((b.y+(J+M_(J))/32)/I),pe=M.project(de,he),_e=33*J+re;dl[2*_e+0]=Math.round((pe.x*E.scale-E.x)*hn),dl[2*_e+1]=Math.round((pe.y*E.scale-E.y)*hn)}hh.fill(0),op.fill(0);for(let J=2045;J>=0;J--){const re=4*J,de=uh[re+0],he=uh[re+1],pe=uh[re+2],_e=uh[re+3],ve=de+pe>>1,Fe=he+_e>>1,ze=ve+Fe-he,Je=Fe+de-ve,ct=33*he+de,Oe=33*_e+pe,qe=33*Fe+ve,ut=Math.hypot((dl[2*ct+0]+dl[2*Oe+0])/2-dl[2*qe+0],(dl[2*ct+1]+dl[2*Oe+1])/2-dl[2*qe+1])>=16;if(hh[qe]=hh[qe]||(ut?1:0),J<1022){const ht=33*(he+Je>>1)+(de+ze>>1),Ot=33*(_e+Je>>1)+(pe+ze>>1);hh[qe]=hh[qe]||hh[ht]||hh[Ot]}}const P=new vn,k=new ri;let z=0;function V(J,re){const de=33*re+J;return 0===op[de]&&(P.emplaceBack(dl[2*de+0],dl[2*de+1],J*hn/32,re*hn/32),op[de]=++z),op[de]-1}function j(J,re,de,he,pe,_e){const ve=J+de>>1,Fe=re+he>>1;if(Math.abs(J-pe)+Math.abs(re-_e)>1&&hh[33*Fe+ve])j(pe,_e,J,re,ve,Fe),j(de,he,pe,_e,ve,Fe);else{const ze=V(J,re),Je=V(de,he),ct=V(pe,_e);k.emplaceBack(ze,Je,ct)}}return j(0,0,32,32,32,0),j(32,32,0,0,0,32),{vertices:P,indices:k}}(this.tileID.canonical,l);f=y.vertices,g=y.indices}else{f=new vn,g=new ri;for(const{x:b,y:M}of c)f.emplaceBack(b,M,0,0);const y=em(f.int16,void 0,4);for(let b=0;b<y.length;b+=3)g.emplaceBack(y[b],y[b+1],y[b+2])}this._tileBoundsBuffer=i.createVertexBuffer(f,J0.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(g),this._tileBoundsSegments=Mi.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(i,l){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!l||"globe"!==l.name)return;const c=this.tileID.canonical,f=Jc(hl(c));this._makeGlobeTileDebugBorderBuffer(i,c,f),this._makeGlobeTileDebugTextBuffer(i,c,f)}_makeGlobeTileDebugBorderBuffer(i,l,c){const f=new Sn,g=new Bs,y=new qt,b=(E,I,P,k,z)=>{const V=(P-E)/(z-1),j=(k-I)/(z-1),J=f.length;for(let re=0;re<z;re++){const de=E+re*V,he=I+re*j;f.emplaceBack(de,he);const pe=$0(de,he,l),_e=oi(pe,pe,c);y.emplaceBack(_e[0],_e[1],_e[2]),g.emplaceBack(J+re)}},M=hn;b(0,0,M,0,16),b(M,0,M,M,16),b(M,M,0,M,16),b(0,M,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(g),this._tileDebugBuffer=i.createVertexBuffer(f,Od.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(y,_m.members),this._tileDebugSegments=Mi.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugTextBuffer(i,l,c){const f=new Sn,g=new ri,y=new qt,b=25;g.reserve(32),f.reserve(b),y.reserve(b);const M=(E,I)=>b*E+I;for(let E=0;E<b;E++){const I=2048*E;for(let P=0;P<b;P++){const k=2048*P;f.emplaceBack(k,I);const z=$0(k,I,l),V=oi(z,z,c);y.emplaceBack(V[0],V[1],V[2])}}for(let E=0;E<4;E++)for(let I=0;I<4;I++){const P=M(E,I),k=M(E,I+1),z=M(E+1,I),V=M(E+1,I+1);g.emplaceBack(P,k,z),g.emplaceBack(z,k,V)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(g),this._tileDebugTextBuffer=i.createVertexBuffer(f,Od.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(y,_m.members),this._tileDebugTextSegments=Mi.simpleSegment(0,0,b,32)}}class HM{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,c){const f=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},He(this.stateChanges[i][f],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const g in this.state[i])g!==f&&(this.deletedStates[i][g]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][f]){this.deletedStates[i][f]={};for(const g in this.state[i][f])c[g]||(this.deletedStates[i][f][g]=null)}else for(const g in c)this.deletedStates[i]&&this.deletedStates[i][f]&&null===this.deletedStates[i][f][g]&&delete this.deletedStates[i][f][g]}removeFeatureState(i,l,c){if(null===this.deletedStates[i])return;const f=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==l)null!==this.deletedStates[i][f]&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][c]=null);else if(void 0!==l)if(this.stateChanges[i]&&this.stateChanges[i][f])for(c in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][c]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,l){const c=String(l),f=He({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const g=this.deletedStates[i][l];if(null===g)return{};for(const y in g)delete f[y]}return f}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),He(this.state[f][y],this.stateChanges[f][y]),g[y]=this.state[f][y];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(null===this.deletedStates[f])for(const y in this.state[f])g[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else for(const b of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][b];g[y]=this.state[f][y]}c[f]=c[f]||{},He(c[f],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const f in i)i[f].setFeatureState(c,l)}}class hb{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const c=this.toIdx(i,l);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function db(s,i,l,c){let f=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(l[y]<s[y]||l[y]>i[y])return null}else{const b=1/c[y];let M=(s[y]-l[y])*b,E=(i[y]-l[y])*b;if(M>E){const I=M;M=E,E=I}if(M>f&&(f=M),E<g&&(g=E),f>g)return null}return f}function fb(s,i,l,c,f,g,y,b,M,E,I){const P=c-s,k=f-i,z=g-l,V=y-s,j=b-i,J=M-l,re=I[1]*J-I[2]*j,de=I[2]*V-I[0]*J,he=I[0]*j-I[1]*V,pe=P*re+k*de+z*he;if(Math.abs(pe)<1e-15)return null;const _e=1/pe,ve=E[0]-s,Fe=E[1]-i,ze=E[2]-l,Je=(ve*re+Fe*de+ze*he)*_e;if(Je<0||Je>1)return null;const ct=Fe*z-ze*k,Oe=ze*P-ve*z,qe=ve*k-Fe*P,ut=(I[0]*ct+I[1]*Oe+I[2]*qe)*_e;return ut<0||Je+ut>1?null:(V*ct+j*Oe+J*qe)*_e}function pb(s,i,l){return(s-i)/(l-i)}function mb(s,i,l,c,f,g,y,b,M){const E=1<<l,I=g-c,P=y-f,k=(s+1)/E*I+c,z=(i+0)/E*P+f,V=(i+1)/E*P+f;b[0]=(s+0)/E*I+c,b[1]=z,M[0]=k,M[1]=V}class gb{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(g){const y=Math.ceil(Math.log2(g.dim/8)),b=[];let M=Math.ceil(Math.pow(2,y));const E=1/M,I=(z,V,j,J,re)=>{const de=J?1:0,he=(z+1)*j-de,pe=V*j,_e=(V+1)*j-de;re[0]=z*j,re[1]=pe,re[2]=he,re[3]=_e};let P=new hb(M);const k=[];for(let z=0;z<M*M;z++){I(z%M,Math.floor(z/M),E,!1,k);const V=dh(k[0],k[1],g),j=dh(k[2],k[1],g),J=dh(k[2],k[3],g),re=dh(k[0],k[3],g);P.minimums.push(Math.min(V,j,J,re)),P.maximums.push(Math.max(V,j,J,re)),P.leaves.push(1)}for(b.push(P),M/=2;M>=1;M/=2){const z=b[b.length-1];P=new hb(M);for(let V=0;V<M*M;V++){I(V%M,Math.floor(V/M),2,!0,k);const j=z.getElevation(k[0],k[1]),J=z.getElevation(k[2],k[1]),re=z.getElevation(k[2],k[3]),de=z.getElevation(k[0],k[3]),he=z.isLeaf(k[0],k[1]),pe=z.isLeaf(k[2],k[1]),_e=z.isLeaf(k[2],k[3]),ve=z.isLeaf(k[0],k[3]),Fe=Math.min(j.min,J.min,re.min,de.min),ze=Math.max(j.max,J.max,re.max,de.max),Je=he&&pe&&_e&&ve;P.maximums.push(ze),P.minimums.push(Fe),P.leaves.push(ze-Fe<=5&&Je?1:0)}b.push(P)}return b}(this.dem),c=l.length-1,f=l[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,c,0)}raycastRoot(i,l,c,f,g,y,b=1){return db([i,l,-100],[c,f,this.maximums[0]*b],g,y)}raycast(i,l,c,f,g,y,b=1){if(!this.nodeCount)return null;const M=this.raycastRoot(i,l,c,f,g,y,b);if(null==M)return null;const E=[],I=[],P=[],k=[],z=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:V,t:j,nodex:J,nodey:re,depth:de}=z.pop();if(this.leaves[V]){mb(J,re,de,i,l,c,f,P,k);const pe=1<<de,_e=(J+0)/pe,ve=(J+1)/pe,Fe=(re+0)/pe,ze=(re+1)/pe,Je=dh(_e,Fe,this.dem)*b,ct=dh(ve,Fe,this.dem)*b,Oe=dh(ve,ze,this.dem)*b,qe=dh(_e,ze,this.dem)*b,ut=fb(P[0],P[1],Je,k[0],P[1],ct,k[0],k[1],Oe,g,y),ht=fb(k[0],k[1],Oe,P[0],k[1],qe,P[0],P[1],Je,g,y),Ot=Math.min(null!==ut?ut:Number.MAX_VALUE,null!==ht?ht:Number.MAX_VALUE);if(Ot!==Number.MAX_VALUE)return Ot;{const at=Qp([],g,y,j);if(_b(Je,ct,qe,Oe,pb(at[0],P[0],k[0]),pb(at[1],P[1],k[1]))>=at[2])return j}continue}let he=0;for(let pe=0;pe<this._siblingOffset.length;pe++){mb((J<<1)+this._siblingOffset[pe][0],(re<<1)+this._siblingOffset[pe][1],de+1,i,l,c,f,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[V]+pe]*b;const _e=db(P,k,g,y);if(null!=_e){const ve=_e;E[pe]=ve;let Fe=!1;for(let ze=0;ze<he&&!Fe;ze++)ve>=E[I[ze]]&&(I.splice(ze,0,pe),Fe=!0);Fe||(I[he]=pe),he++}}for(let pe=0;pe<he;pe++){const _e=I[pe];z.push({idx:this.childOffsets[V]+_e,t:E[_e],nodex:(J<<1)+this._siblingOffset[_e][0],nodey:(re<<1)+this._siblingOffset[_e][1],depth:de+1})}}return null}_addNode(i,l,c){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,c,f,g){if(1===i[f].isLeaf(l,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=f-1,b=i[y];let M=0,E=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*l+this._siblingOffset[I][0],k=2*c+this._siblingOffset[I][1],z=b.getElevation(P,k),V=b.isLeaf(P,k),j=this._addNode(z.min,z.max,V);V&&(M|=1<<I),E||(E=j)}for(let I=0;I<this._siblingOffset.length;I++)M&1<<I||this._construct(i,2*l+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],y,E+I)}}function _b(s,i,l,c,f,g){return Un(Un(s,l,g),Un(i,c,g),f)}function dh(s,i,l){const c=l.dim,f=je(s*c-.5,0,c-1),g=je(i*c-.5,0,c-1),y=Math.floor(f),b=Math.floor(g),M=Math.min(y+1,c-1),E=Math.min(b+1,c-1);return _b(l.get(y,b),l.get(M,b),l.get(y,E),l.get(M,E),f-y,g-b)}const nc={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class zd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,c,f=!1,g=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return On(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2,b=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let M=0;M<y;M++)b[this._idx(-1,M)]=b[this._idx(0,M)],b[this._idx(y,M)]=b[this._idx(y-1,M)],b[this._idx(M,-1)]=b[this._idx(M,0)],b[this._idx(M,y)]=b[this._idx(M,y-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(y,-1)]=b[this._idx(y-1,0)],b[this._idx(-1,y)]=b[this._idx(0,y-1)],b[this._idx(y,y)]=b[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new gb(this)}get(i,l,c=!1){c&&(i=je(i,-1,this.dim),l=je(l,-1,this.dim));const f=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(i){return nc[i]}get unpackVector(){return nc[this.encoding]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,c){return(256*i*256+256*l+c)/10-1e4}_unpackTerrarium(i,l,c){return 256*i+l+c/256-32768}static pack(i,l){const c=[0,0,0,0],f=zd.getUnpackVector(l);let g=Math.floor((i+f[3])/f[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Ho({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,l,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,g=l*this.dim+this.dim,y=c*this.dim,b=c*this.dim+this.dim;switch(l){case-1:f=g-1;break;case 1:g=f+1}switch(c){case-1:y=b-1;break;case 1:b=y+1}const M=-l*this.dim,E=-c*this.dim;for(let I=y;I<b;I++)for(let P=f;P<g;P++){const k=4*this._idx(P,I),z=4*this._idx(P+M,I+E);this.pixels[k+0]=i.pixels[z+0],this.pixels[k+1]=i.pixels[z+1],this.pixels[k+2]=i.pixels[z+2],this.pixels[k+3]=i.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Bt(zd,"DEMData"),Bt(gb,"DemMinMaxQuadTree",{omit:["dem"]});class yb{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,c){const f=i.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const g={value:l,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(i,g)},c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const c=i.wrapped().key,f=void 0===l?0:this.data[c].indexOf(l),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const c in this.data)for(const f of this.data[c])i(f.value)||l.push(f);for(const c of l)this.remove(c.value.tileID,c)}}class fh{constructor(i,l,c){this.func=i,this.mask=l,this.range=c}}fh.ReadOnly=!1,fh.ReadWrite=!0,fh.disabled=new fh(519,fh.ReadOnly,[0,1]);class Dm{constructor(i,l,c,f,g,y){this.test=i,this.ref=l,this.mask=c,this.fail=f,this.depthFail=g,this.pass=y}}Dm.disabled=new Dm({func:519,mask:0},0,0,7680,7680,7680);class aa{constructor(i,l,c){this.blendFunction=i,this.blendColor=l,this.mask=c}}aa.Replace=[1,0],aa.disabled=new aa(aa.Replace,fi.transparent,[!1,!1,!1,!1]),aa.unblended=new aa(aa.Replace,fi.transparent,[!0,!0,!0,!0]),aa.alphaBlended=new aa([1,771],fi.transparent,[!0,!0,!0,!0]);class la{constructor(i,l,c){this.enable=i,this.mode=l,this.frontFace=c}}la.disabled=new la(!1,1029,2305),la.backCCW=new la(!0,1029,2305),la.backCW=new la(!0,1029,2304),la.frontCW=new la(!0,1028,2304),la.frontCCW=new la(!0,1028,2305);class ph extends mr{constructor(i,l,c){super(),this.id=i,this._onlySymbols=c,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new yb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new HM,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const l in this._tiles){const c=this._tiles[l];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(i),c.prepare(this.map.style.imageManager)}else for(const l in this._tiles){const c=this._tiles[l];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return st(this._tiles).map(i=>i.tileID).sort(Sm).map(i=>i.key)}getRenderableIds(i){const l=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&l.push(this._tiles[c]);return i?l.sort((c,f)=>{const g=c.tileID,y=f.tileID,b=new ce(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),M=new ce(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||M.y-b.y||M.x-b.x}).map(c=>c.tileID.key):l.map(c=>c.tileID).sort(Sm).map(c=>c.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=l),this._loadTile(c,this._tileLoaded.bind(this,c,i,l)))}_tileLoaded(i,l,c,f){if(f)if(i.state="errored",404!==f.status)this._source.fire(new vr(f,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Os.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new cr("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const g=l[f];if(i.neighboringTiles&&i.neighboringTiles[g]){const y=this.getTileByID(g);c(i,y),c(y,i)}}function c(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-f.tileID.canonical.x;const b=g.tileID.canonical.y-f.tileID.canonical.y,M=Math.pow(2,f.tileID.canonical.z),E=g.tileID.key;0===y&&0===b||Math.abs(b)>1||(Math.abs(y)>1&&(1===Math.abs(y+M)?y+=M:1===Math.abs(y-M)&&(y-=M)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,y,b),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,c,f){for(const g in this._tiles){let y=this._tiles[g];if(f[g]||!y.hasData()||y.tileID.overscaledZ<=l||y.tileID.overscaledZ>c)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>l+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(b=E)}let M=b;for(;M.overscaledZ>l;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){f[b.key]=b;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=l?c:null}for(let c=i.overscaledZ-1;c>=l;c--){const f=i.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const c=Math.ceil(i.width/l)+1,f=Math.ceil(i.height/l)+1,g=Math.floor(c*f*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(b)}handleWrapJump(i){const l=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,l){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+l),c[g.tileID.key]=g}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(i,l,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(i,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Kr(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(f=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(b=>this._source.hasTile(b)))):f=[];const g=this._updateRetainedTiles(f);if(ev(this._source.type)&&0!==f.length){const b={},M={},E=Object.keys(g);for(const P of E){const k=g[P],z=this._tiles[P];if(!z||z.fadeEndTime&&z.fadeEndTime<=Os.now())continue;const V=this.findLoadedParent(k,Math.max(k.overscaledZ-ph.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),b[V.tileID.key]=V.tileID),M[P]=k}const I=f[f.length-1].overscaledZ;for(const P in this._tiles){const k=this._tiles[P];if(g[P]||!k.hasData())continue;let z=k.tileID;for(;z.overscaledZ>I;){z=z.scaledTo(z.overscaledZ-1);const V=this._tiles[z.key];if(V&&V.hasData()&&M[z.key]){g[P]=k.tileID;break}}}for(const P in b)g[P]||(this._coveredTiles[P]=!0,g[P]=b[P])}for(const b in g)this._tiles[b].clearFadeHold();const y=function(b,M){const E=[];for(const I in b)I in M||E.push(I);return E}(this._tiles,g);for(const b of y){const M=this._tiles[b];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(0===i.length)return l;const c={},f=i.reduce((E,I)=>Math.min(E,I.overscaledZ),1/0),g=i[0].overscaledZ,y=Math.max(g-ph.maxOverzooming,this._source.minzoom),b=Math.max(g+ph.maxUnderzooming,this._source.minzoom),M={};for(const E of i){const I=this._addTile(E);l[E.key]=E,I.hasData()||f<this._source.maxzoom&&(M[E.key]=E)}this._retainLoadedChildren(M,f,b,l);for(const E of i){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const k=E.children(this._source.maxzoom)[0],z=this.getTile(k);if(z&&z.hasData()){l[k.key]=k;continue}}else{const k=E.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let P=I.wasRequested();for(let k=E.overscaledZ-1;k>=y;--k){const z=E.scaledTo(k);if(c[z.key]||(c[z.key]=!0,I=this.getTile(z),!I&&P&&(I=this._addTile(z)),I&&(l[z.key]=z,P=I.wasRequested(),I.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let c,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}l.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(const g of l)this._loadedParentTiles[g]=c}}_addTile(i){let l=this._tiles[i.key];if(l)return this._source.prepareTile&&this._source.prepareTile(l),l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const c=Boolean(l);if(!c){const f=this.map?this.map.painter:null;l=new Q0(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._source.prepareTile&&this._source.prepareTile(l)||this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l?(l.uses++,this._tiles[i.key]=l,c||this._source.fire(new cr("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=l.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,c){const f=[],g=this.transform;if(!g)return f;const y="globe"===g.projection.name,b=Gl(g.center.lng);for(const M in this._tiles){const E=this._tiles[M];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let I;if(y){const P=E.tileID.canonical;if(0===P.z){const k=[Math.abs(je(b,...Nd(P,-1))-b),Math.abs(je(b,...Nd(P,1))-b)];I=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(je(b,...Nd(P,-1))-b),Math.abs(je(b,...Nd(P,0))-b),Math.abs(je(b,...Nd(P,1))-b)];I=[k.indexOf(Math.min(...k))-1]}}else I=[0];for(const P of I){const k=i.containsTile(E,g,l,P);k&&f.push(k)}}return f}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of l)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(ev(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Os.now())return!0}return!1}setFeatureState(i,l,c){this._state.updateState(i=i||"_geojsonTileLayer",l,c)}removeFeatureState(i,l,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,c)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,c){const f=this._tiles[i];f&&f.setDependencies(l,c)}reloadTilesForDependencies(i,l){for(const c in this._tiles)this._tiles[c].hasDependency(i,l)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,l))}_preloadTiles(i,l){const c=new Map,f=Array.isArray(i)?i:[i],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const b of f){const M=b.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of M)c.set(E.key,E);this.usedForTerrain&&b.updateElevation(!1)}Xe(Array.from(c.values()),(b,M)=>{const E=new Q0(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,I=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),M(I,E)})},l)}}function Sm(s,i){const l=Math.abs(2*s.wrap)-+(s.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return s.overscaledZ-i.overscaledZ||c-l||i.canonical.y-s.canonical.y||i.canonical.x-s.canonical.x}function ev(s){return"raster"===s||"image"===s||"video"===s}function Nd(s,i){const l=1<<s.z;return[s.x/l+i,(s.x+1)/l+i]}ph.maxOverzooming=10,ph.maxUnderzooming=3;class Im{constructor(i,l,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=c}static create(i,l,c){const f=c||i.findDEMTileFor(l);if(!f||!f.dem)return;const g=f.dem,y=f.tileID,b=1<<l.canonical.z-y.canonical.z;return new Im(f,f.tileSize/hn/b,[(l.canonical.x/b-y.canonical.x)*g.dim,(l.canonical.y/b-y.canonical.y)*g.dim])}tileCoordToPixel(i,l){const c=l*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),g=Math.floor(c);return new ce(f,g)}getElevationAt(i,l,c,f){const g=i*this._scale+this._offset[0],y=l*this._scale+this._offset[1],b=Math.floor(g),M=Math.floor(y),E=this._dem;return f=!!f,c?Un(Un(E.get(b,M,f),E.get(b,M+1,f),y-M),Un(E.get(b+1,M,f),E.get(b+1,M+1,f),y-M),g-b):E.get(b,M,f)}getElevationAtPixel(i,l,c){return this._dem.get(i,l,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*na(1,i)*this._dem.stride}}class tv{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Bl(hn,16,0),this.featureIndexArray=new Hp,this.promoteId=l}insert(i,l,c,f,g,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,g,y);const M=this.grid;for(let E=0;E<l.length;E++){const I=l[E],P=[1/0,1/0,-1/0,-1/0];for(let k=0;k<I.length;k++){const z=I[k];P[0]=Math.min(P[0],z.x),P[1]=Math.min(P[1],z.y),P[2]=Math.max(P[2],z.x),P[3]=Math.max(P[3],z.y)}P[0]<hn&&P[1]<hn&&P[2]>=0&&P[3]>=0&&M.insert(b,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new eh.VectorTile(new Wc(this.rawTileData)).layers,this.sourceLayerCoder=new Y0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,l,c,f){this.loadVTLayers();const g=i.params||{},y=kl(g.filter),b=i.tileResult,M=i.transform,E=b.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(V,j,J,re)=>jy(b.bufferedTilespaceGeometry,V,j,J,re));I.sort(Vd);let P=null;M.elevation&&I.length>0&&(P=Im.create(M.elevation,this.tileID));const k={};let z;for(let V=0;V<I.length;V++){const j=I[V];if(j===z)continue;z=j;const J=this.featureIndexArray.get(j);let re=null;this.loadMatchingFeature(k,J,y,g.layers,g.availableImages,l,c,f,(de,he,pe,_e=0)=>(re||(re=ql(de,this.tileID.canonical,i.tileTransform)),he.queryIntersectsFeature(b,de,pe,re,this.z,i.transform,i.pixelPosMatrix,P,_e)))}return k}loadMatchingFeature(i,l,c,f,g,y,b,M,E){const{featureIndex:I,bucketIndex:P,sourceLayerIndex:k,layoutVertexArrayOffset:z}=l,V=this.bucketLayerIDs[P];if(f&&!function(de,he){for(let pe=0;pe<de.length;pe++)if(he.indexOf(de[pe])>=0)return!0;return!1}(f,V))return;const j=this.sourceLayerCoder.decode(k),J=this.vtLayers[j].feature(I);if(c.needGeometry){const de=ju(J,!0);if(!c.filter(new X(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!c.filter(new X(this.tileID.overscaledZ),J))return;const re=this.getId(J,j);for(let de=0;de<V.length;de++){const he=V[de];if(f&&f.indexOf(he)<0)continue;const pe=y[he];if(!pe)continue;let _e={};void 0!==re&&M&&(_e=M.getState(pe.sourceLayer||"_geojsonTileLayer",re));const ve=He({},b[he]);ve.paint=Bd(ve.paint,pe.paint,J,_e,g),ve.layout=Bd(ve.layout,pe.layout,J,_e,g);const Fe=!E||E(J,pe,_e,z);if(!Fe)continue;const ze=new K0(J,this.z,this.x,this.y,re);ze.layer=ve;let Je=i[he];void 0===Je&&(Je=i[he]=[]),Je.push({featureIndex:I,feature:ze,intersectionZ:Fe})}}lookupSymbolFeatures(i,l,c,f,g,y,b,M){const E={};this.loadVTLayers();const I=kl(g);for(const P of i)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:f,featureIndex:P,layoutVertexArrayOffset:0},I,y,b,M,l);return E}loadFeature(i){const{featureIndex:l,sourceLayerIndex:c}=i;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),g=this.vtFeatures[f];if(g[l])return g[l];const y=this.vtLayers[f].feature(l);return g[l]=y,y}hasLayer(i){for(const l of this.bucketLayerIDs)for(const c of l)if(i===c)return!0;return!1}getId(i,l){let c=i.id;return this.promoteId&&(c=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof c&&(c=Number(c))),c}}function Bd(s,i,l,c,f){return mn(s,(g,y)=>{const b=i instanceof ft?i.get(y):null;return b&&b.evaluate?b.evaluate(l,c,f):b})}function Vd(s,i){return i-s}Bt(tv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Am{constructor(i){const l={},c=[];for(const b in i){const M=i[b],E=l[b]={};for(const I in M.glyphs){const P=M.glyphs[+I];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const k=P.metrics.localGlyph?2:1,z={x:0,y:0,w:P.bitmap.width+2*k,h:P.bitmap.height+2*k};c.push(z),E[I]=z}}const{w:f,h:g}=e_(c),y=new Oa({width:f||1,height:g||1});for(const b in i){const M=i[b];for(const E in M.glyphs){const I=M.glyphs[+E];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=l[b][E],k=I.metrics.localGlyph?2:1;Oa.copy(I.bitmap,y,{x:0,y:0},{x:P.x+k,y:P.y+k},I.bitmap)}}this.image=y,this.positions=l}}Bt(Am,"GlyphAtlas");class Ud{constructor(i){this.tileID=new Kr(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=ah(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,l,c,f,g){this.status="parsing",this.data=i,this.collisionBoxArray=new Sf;const y=new Y0(Object.keys(i.layers).sort()),b=new tv(this.tileID,this.promoteId);b.bucketLayerIDs=[];const M={},E=new ip(256,256),I={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},P=l.familiesBySource[this.source];for(const _e in P){const ve=i.layers[_e];if(!ve)continue;let Fe=!1,ze=!1;for(const Oe of P[_e])"symbol"===Oe[0].type?Fe=!0:ze=!0;if(!0===this.isSymbolTile&&!Fe||!1===this.isSymbolTile&&!ze)continue;1===ve.version&&On(`Vector tile source "${this.source}" layer "${_e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Je=y.encode(_e),ct=[];for(let Oe=0;Oe<ve.length;Oe++){const qe=ve.feature(Oe),ut=b.getId(qe,_e);ct.push({feature:qe,id:ut,index:Oe,sourceLayerIndex:Je})}for(const Oe of P[_e]){const qe=Oe[0];void 0!==this.isSymbolTile&&"symbol"===qe.type!==this.isSymbolTile||qe.minzoom&&this.zoom<Math.floor(qe.minzoom)||qe.maxzoom&&this.zoom>=qe.maxzoom||"none"!==qe.visibility&&(mh(Oe,this.zoom,c),(M[qe.id]=qe.createBucket({index:b.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Je,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(ct,I,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Oe.map(ut=>ut.id)))}}let k,z,V,j;E.trim();const J={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},re=mn(I.glyphDependencies,_e=>Object.keys(_e).map(Number));Object.keys(re).length?f.send("getGlyphs",{uid:this.uid,stacks:re},(_e,ve)=>{k||(k=_e,z=ve,pe.call(this))},void 0,!1,J):z={};const de=Object.keys(I.iconDependencies);de.length?f.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(_e,ve)=>{k||(k=_e,V=ve,pe.call(this))},void 0,!1,J):V={};const he=Object.keys(I.patternDependencies);function pe(){if(k)return g(k);if(z&&V&&j){const _e=new Am(z),ve=new T0(V,j);for(const Fe in M){const ze=M[Fe];ze instanceof Qc?(mh(ze.layers,this.zoom,c),sh(ze,z,_e.positions,V,ve.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):ze.hasPattern&&(ze instanceof Kl||ze instanceof Uf||ze instanceof Hf)&&(mh(ze.layers,this.zoom,c),ze.addFeatures(I,this.tileID.canonical,ve.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:st(M).filter(Fe=>!Fe.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_e.image,lineAtlas:E,imageAtlas:ve,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?_e.positions:null})}}he.length?f.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(_e,ve)=>{k||(k=_e,j=ve,pe.call(this))},void 0,!1,J):j={},pe.call(this)}}function mh(s,i,l){const c=new X(i);for(const f of s)f.recalculate(c,l)}class gh{constructor(i){this.entries={},this.scheduler=i}request(i,l,c,f){const g=this.entries[i]=this.entries[i]||{callbacks:[]};if(g.result){const[y,b]=g.result;return this.scheduler?this.scheduler.add(()=>{f(y,b)},l):f(y,b),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=c((y,b)=>{g.result=[y,b];for(const M of g.callbacks)this.scheduler?this.scheduler.add(()=>{M(y,b)},l):M(y,b);setTimeout(()=>delete this.entries[i],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==f),g.callbacks.length||(g.cancel(),delete this.entries[i]))}}}function nv(s,i,l){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},f=>{const g=ye(s.request,(y,b,M,E)=>{y?f(y):b&&f(null,{vectorTile:l?void 0:new eh.VectorTile(new Wc(b)),rawData:b,cacheControl:M,expires:E})});return()=>{g.cancel(),f()}},i)}d.ARRAY_TYPE=ss,d.AUTH_ERR_MSG=Ni,d.Aabb=Es,d.Actor=class{constructor(s,i,l){this.target=s,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},nn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wn()?s:W,this.scheduler=new GM}send(s,i,l,c,f=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[y]=l);const b=nr(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:s,hasCallback:!!l,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:Ou(i,b)},b),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(s){const i=s.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[l];delete this.cancelCallbacks[l],c&&c.cancel()}else if(i.mustQueue||Wn()){const c=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,i),c&&c.metadata||{type:"message"})}else this.processTask(l,i)}processTask(s,i){if("<response>"===i.type){const l=this.callbacks[s];delete this.callbacks[s],l&&(i.error?l(ku(i.error)):l(null,ku(i.data)))}else{const l=nr(this.globalScope)?void 0:[],c=i.hasCallback?(g,y)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:g?Ou(g):null,data:Ou(y,l)},l)}:g=>{},f=ku(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,c);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],f.source)[g[1]](f,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=qf,d.Color=fi,d.ColorMode=aa,d.CullFaceMode=la,d.DEMData=zd,d.DataConstantProperty=ae,d.DedupedRequest=gh,d.DepthMode=fh,d.EXTENT=hn,d.Elevation=class{isDataAvailableAtPoint(s){const i=this._source();if(!i||s.y<0||s.y>1)return!1;const l=i.getSource().maxzoom,c=1<<l,f=Math.floor(s.x),g=Math.floor((s.x-f)*c),y=Math.floor(s.y*c),b=this.findDEMTileFor(new Kr(l,f,l,g,y));return!(!b||!b.dem)}getAtPointOrZero(s,i=0){return this.getAtPoint(s,i)||0}getAtPoint(s,i,l=!0){null==i&&(i=null);const c=this._source();if(!c||s.y<0||s.y>1)return i;const f=c.getSource().maxzoom,g=1<<f,y=Math.floor(s.x),b=s.x-y,M=new Kr(f,y,f,Math.floor(b*g),Math.floor(s.y*g)),E=this.findDEMTileFor(M);if(!E||!E.dem)return i;const I=E.dem,P=1<<E.tileID.canonical.z,k=(b*P-E.tileID.canonical.x)*I.dim,z=(s.y*P-E.tileID.canonical.y)*I.dim,V=Math.floor(k),j=Math.floor(z);return(l?this.exaggeration():1)*Un(Un(I.get(V,j),I.get(V,j+1),z-j),Un(I.get(V+1,j),I.get(V+1,j+1),z-j),k-V)}getAtTileOffset(s,i,l){const c=1<<s.canonical.z;return this.getAtPointOrZero(new Hl(s.wrap+(s.canonical.x+i/hn)/c,(s.canonical.y+l/hn)/c))}getAtTileOffsetFunc(s,i,l,c){return f=>{const g=this.getAtTileOffset(s,f.x,f.y),y=c.upVector(s.canonical,f.x,f.y);return ll(y,y,g*c.upVectorScale(s.canonical,i,l).metersToTile),y}}getForTilePoints(s,i,l,c){const f=Im.create(this,s,c);return!!f&&(i.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],l)}),!0)}getMinMaxForTile(s){const i=this.findDEMTileFor(s);if(!i||!i.dem)return null;const l=i.dem.tree,c=i.tileID,f=1<<s.canonical.z-c.canonical.z;let g=s.canonical.x/f-c.canonical.x,y=s.canonical.y/f-c.canonical.y,b=0;for(let M=0;M<s.canonical.z-c.canonical.z&&!l.leaves[b];M++){g*=2,y*=2;const E=2*Math.floor(y)+Math.floor(g);b=l.childOffsets[b]+E,g%=1,y%=1}return{min:this.exaggeration()*l.minimums[b],max:this.exaggeration()*l.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=vr,d.EvaluationParameters=X,d.Event=cr,d.Evented=mr,d.FillExtrusionBucket=Hf,d.Frustum=Yu,d.FrustumCorners=kg,d.GLOBE_METERS_TO_ECEF=_o,d.GLOBE_RADIUS=Kc,d.GLOBE_SCALE_MATCH_LATITUDE=45,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GLOBE_ZOOM_THRESHOLD_MIN=5,d.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const i=new Sn,l=new ri,c=65;for(let f=0;f<c;f++)for(let g=0;g<c;g++)i.emplaceBack(g,f);this._gridSegments=[];for(let f=0,g=0;f<kd.length;f++){const y=kd[f];for(let M=0;M<y;M++)for(let E=0;E<64;E++){const I=M*c+E;l.emplaceBack(I+1,I,I+c),l.emplaceBack(I+c,I+c+1,I+1)}const b=64*y*2;this._gridSegments.push(Mi.simpleSegment(0,g,(y+1)*c,b)),g+=b}this._gridBuffer=s.createVertexBuffer(i,Od.members),this._gridIndexBuffer=s.createIndexBuffer(l,!0)}_createPoles(s){const i=new ri;for(let f=0;f<=64;f++)i.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=s.createIndexBuffer(i,!0);const l=new jl,c=new jl;this._poleSegments=[];for(let f=0,g=0;f<5;f++){const y=1<<f,b=512*y/Math.PI/2,M=360/y;l.emplaceBack(0,-b,0,0,0,.5,0),c.emplaceBack(0,-b,0,0,0,.5,1);for(let E=0;E<=64;E++){const I=E/64,P=Un(0,M,I),[k,z,V]=j0(ib,ob,P,b);l.emplaceBack(k,z,V,0,0,I,0),c.emplaceBack(k,z,V,0,0,I,1)}this._poleSegments.push(Mi.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(l,N0,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,N0,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,i){if(!this._wireframeSegments){const l=new os,c=64,f=c+1;this._wireframeSegments=[];for(let g=0,y=0;g<kd.length;g++){const b=kd[g];for(let E=0;E<b;E++)for(let I=0;I<c;I++){const P=E*f+I;l.emplaceBack(P,P+1),l.emplaceBack(P,P+f),l.emplaceBack(P,P+f+1)}const M=b*c*3;this._wireframeSegments.push(Mi.simpleSegment(0,y,(b+1)*f,M)),y+=M}this._wireframeIndexBuffer=s.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},d.GlyphManager=Xc,d.ImagePosition=cm,d.LineAtlas=ip,d.LngLat=_r,d.LngLatBounds=$c,d.LocalGlyphMode=dm,d.MAX_MERCATOR_LATITUDE=Ms,d.MercatorCoordinate=Hl,d.ONE_EM=24,d.OverscaledTileID=Kr,d.Properties=Vt,d.RGBAImage=Ho,d.Ray=Yy,d.RequestManager=class{constructor(s,i,l){this._transformRequestFn=s,this._customAccessToken=i,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const s=function(){let i="";for(let l=0;l<10;l++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",zh,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,i){return this._transformRequestFn&&this._transformRequestFn(s,i)||{url:s}}normalizeStyleURL(s,i){if(!Xs(s))return s;const l=ys(s);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeGlyphsURL(s,i){if(!Xs(s))return s;const l=ys(s);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeSourceURL(s,i,l,c){if(!Xs(s))return s;const f=ys(s);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),c&&f.params.push(`worldview=${c}`),this._makeAPIURL(f,this._customAccessToken||i)}normalizeSpriteURL(s,i,l,c){const f=ys(s);return Xs(s)?(f.path=`/styles/v1${f.path}/sprite${i}${l}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${i}${l}`,ga(f))}normalizeTileURL(s,i,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Xs(s))return s;const c=ys(s);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||l&&"raster"!==c.authority&&512===l?"@2x":""}${ma.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${or.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${or.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(g){for(const y of g){const b=y.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(c.params)||or.ACCESS_TOKEN;return or.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(s,i){const l=ys(s);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return s;let c="mapbox://";l.path.match(/^\/raster\/v1\//)?c+=`raster/${l.path.replace(`/${or.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${l.path.replace(`/${or.TILE_URL_VERSION}/`,"")}`;let f=l.params;return i&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(s,i){const l=!!i&&Xs(i),c=[];for(const f of s.tiles||[])yc(f)?c.push(this.canonicalizeTileURL(f,l)):c.push(f);return c}_makeAPIURL(s,i){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=ys(or.API_URL);if(s.protocol=c.protocol,s.authority=c.authority,"http"===s.protocol){const f=s.params.indexOf("secure");f>=0&&s.params.splice(f,1)}if("/"!==c.path&&(s.path=`${c.path}${s.path}`),!or.REQUIRE_ACCESS_TOKEN)return ga(s);if(i=i||or.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return s.params=s.params.filter(f=>-1===f.indexOf("access_token")),s.params.push(`access_token=${i||""}`),ga(s)}},d.ResourceType=se,d.SegmentVector=Mi,d.SourceCache=ph,d.StencilMode=Dm,d.StructArrayLayout1ui2=Bs,d.StructArrayLayout2f1f2i16=li,d.StructArrayLayout2i4=Sn,d.StructArrayLayout2ui4=os,d.StructArrayLayout3f12=zr,d.StructArrayLayout3ui6=ri,d.StructArrayLayout4i8=vn,d.StructArrayLayout5f20=Ns,d.Texture=ch,d.Tile=Q0,d.Transitionable=oe,d.Uniform1f=md,d.Uniform1i=class extends ii{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.Uniform2f=class extends ii{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.Uniform3f=class extends ii{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.Uniform4f=gd,d.UniformColor=r1,d.UniformMatrix2f=class extends ii{constructor(s,i){super(s,i),this.current=$l}set(s){for(let i=0;i<4;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},d.UniformMatrix3f=class extends ii{constructor(s,i){super(s,i),this.current=Vs}set(s){for(let i=0;i<9;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},d.UniformMatrix4f=class extends ii{constructor(s,i){super(s,i),this.current=i1}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.UnwrappedTileID=V1,d.ValidationError=Nt,d.VectorTileWorkerSource=class extends mr{constructor(s,i,l,c,f){super(),this.actor=s,this.layerIndex=i,this.availableImages=l,this.loadVectorData=f||nv,this.loading={},this.loaded={},this.deduped=new gh(s.scheduler),this.isSpriteLoaded=c,this.scheduler=s.scheduler}loadTile(s,i){const l=s.uid,c=s&&s.request,f=c&&c.collectResourceTiming,g=this.loading[l]=new Ud(s);g.abort=this.loadVectorData(s,(y,b)=>{const M=!this.loading[l];if(delete this.loading[l],M||y||!b)return g.status="done",M||(this.loaded[l]=g),i(y);const E=b.rawData,I={};b.expires&&(I.expires=b.expires),b.cacheControl&&(I.cacheControl=b.cacheControl),g.vectorTile=b.vectorTile||new eh.VectorTile(new Wc(E));const P=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,z)=>{if(k||!z)return i(k);const V={};if(f){const j=io(c);j.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(j)))}i(null,He({rawTileData:E.slice(0)},z,I,V))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[l]=g})}reloadTile(s,i){const l=this.loaded,c=s.uid,f=this;if(l&&l[c]){const g=l[c];g.showCollisionBoxes=s.showCollisionBoxes,g.enableTerrain=!!s.enableTerrain,g.projection=s.projection,g.tileTransform=ah(s.tileID.canonical,s.projection);const y=(b,M)=>{const E=g.reloadCallback;E&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,E)),i(b,M)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(s,i){const l=s.uid,c=this.loading[l];c&&(c.abort&&c.abort(),delete this.loading[l]),i()}removeTile(s,i){const l=this.loaded,c=s.uid;l&&l[c]&&delete l[c],i()}},d.WritingMode=js,d.ZoomHistory=pt,d.add=Wl,d.addDynamicAttributes=np,d.adjoint=function(s,i){var l=i[0],c=i[1],f=i[2],g=i[3],y=i[4],b=i[5],M=i[6],E=i[7],I=i[8];return s[0]=y*I-b*E,s[1]=f*E-c*I,s[2]=c*b-f*y,s[3]=b*M-g*I,s[4]=l*I-f*M,s[5]=f*g-l*b,s[6]=g*E-y*M,s[7]=c*M-l*E,s[8]=l*y-c*g,s},d.asyncAll=Xe,d.bezier=le,d.bindAll=nn,d.boundsAttributes=J0,d.bufferConvexPolygon=function(s,i){const l=[];for(let c=0;c<s.length;c++){const f=xe(c-1,-1,s.length-1),g=xe(c+1,-1,s.length-1),y=s[c],b=s[g],M=s[f].sub(y).unit(),E=b.sub(y).unit(),I=E.angleWithSep(M.x,M.y),P=M.add(E).unit().mult(-1*i/Math.sin(I/2));l.push(y.add(P))}return l},d.cacheEntryPossiblyAdded=function(s){ee++,ee>_u&&(s.getActor().send("enforceCacheSizeLimit",xc),ee=0)},d.calculateGlobeLabelMatrix=function(s,i){const{x:l,y:c}=s.point,f=p_(l,c,s.worldSize/s._projectionScaler,0,0);return Zu(f,f,G0(hl(i)))},d.calculateGlobeMatrix=function(s){const{x:i,y:l}=s.point,{lng:c,lat:f}=s._center;return p_(i,l,s.worldSize,c,f)},d.calculateGlobeMercatorMatrix=function(s){const i=s.worldSize,l=s.point,c=na(1,s.center.lat)*i,f=s.pixelsPerMeter,g=i/(c/s.pixelsPerMeter),y=as(new Float64Array(16));return Gc(y,y,[l.x,l.y,0]),Zl(y,y,[g,g,f]),Float32Array.from(y)},d.circumferenceAtLatitude=Uu,d.clamp=je,d.clearTileCache=function(s){const i=[];for(const l in To)i.push(W.caches.delete(l)),delete To[l];s&&Promise.all(i).catch(s).then(()=>s())},d.clipLine=o_,d.clone=function(s){var i=new ss(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},d.clone$1=Jt,d.collisionCircleLayout=m0,d.config=or,d.conjugate=function(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=i[3],s},d.create=function(){var s=new ss(16);return ss!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.create$1=Gy,d.createExpression=kc,d.createLayout=Lt,d.createStyleLayer=function(s){return"custom"===s.type?new X0(s):new Em[s.type](s)},d.cross=ls,d.degToRad=tt,d.distance=function(s,i){return Math.hypot(i[0]-s[0],i[1]-s[1],i[2]-s[2])},d.div=function(s,i,l){return s[0]=i[0]/l[0],s[1]=i[1]/l[1],s[2]=i[2]/l[2],s},d.dot=ia,d.ease=Be,d.easeCubicInOut=_t,d.emitValidationErrors=zn,d.endsWith=Rt,d.enforceCacheSizeLimit=function(s){for(const i in To)te(i),To[i].then(l=>{l.keys().then(c=>{for(let f=0;f<c.length-s;f++)l.delete(c[f])})})},d.evaluateSizeForFeature=im,d.evaluateSizeForZoom=Id,d.evaluateVariableOffset=mm,d.evented=q,d.exactEquals=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]},d.exactEquals$1=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]},d.exported=Os,d.exported$1=ma,d.extend=He,d.extend$1=Uo,d.fillExtrusionHeightLift=ul,d.filterObject=yn,d.fromMat4=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],s},d.fromQuat=function(s,i){var l=i[0],c=i[1],f=i[2],g=i[3],y=l+l,b=c+c,M=f+f,E=l*y,I=c*y,P=c*b,k=f*y,z=f*b,V=f*M,j=g*y,J=g*b,re=g*M;return s[0]=1-P-V,s[1]=I+re,s[2]=k-J,s[3]=0,s[4]=I-re,s[5]=1-E-V,s[6]=z+j,s[7]=0,s[8]=k+J,s[9]=z-j,s[10]=1-E-P,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.fromRotation=function(s,i){var l=Math.sin(i),c=Math.cos(i);return s[0]=c,s[1]=l,s[2]=0,s[3]=-l,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},d.fromScaling=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.furthestTileCorner=function(s){const i=Math.round((s+45+360)%360/90)%4;return vt[i]},d.getAABBPointSquareDist=function(s,i,l){let c=0;for(let f=0;f<2;++f){const g=l?l[f]:0;s[f]>g&&(c+=(s[f]-g)*(s[f]-g)),i[f]<g&&(c+=(g-i[f])*(g-i[f]))}return c},d.getAnchorAlignment=Hn,d.getAnchorJustification=gm,d.getBounds=function(s){let i=1/0,l=1/0,c=-1/0,f=-1/0;for(const g of s)i=Math.min(i,g.x),l=Math.min(l,g.y),c=Math.max(c,g.x),f=Math.max(f,g.y);return{min:new ce(i,l),max:new ce(c,f)}},d.getColumn=Gr,d.getGridMatrix=function(s,i,l){const[c,f]=i,g=.015625;return[0,(f[1]-c[1])*g,1<<s.z,(f[0]-c[0])/kd[l],0,s.y,c[0],c[1],g]},d.getImage=rn,d.getJSON=function(s,i){return Ce(He(s,{type:"json"}),i)},d.getLatitudinalLod=function(s){const i=80.051129;s=je(s,-80.051129,i)/i*90;const l=Math.pow(Math.abs(Math.sin(tt(s))),3);return Math.round(l*(kd.length-1))},d.getMapSessionAPI=$h,d.getPerformanceMeasurement=io,d.getProjection=v_,d.getRTLTextPluginStatus=ie,d.getReferrer=Ee,d.getTilePoint=function(s,{x:i,y:l},c=0){return new ce(((i-c)*s.scale-s.x)*hn,(l*s.scale-s.y)*hn)},d.getTileVec3=function(s,i,l=0){return qc(((i.x-l)*s.scale-s.x)*hn,(i.y*s.scale-s.y)*hn,Tg(i.z,i.y))},d.getVideo=function(s,i){const l=W.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let c=0;c<s.length;c++){const f=W.document.createElement("source");gt(s[c])||(l.crossOrigin="Anonymous"),f.src=s[c],l.appendChild(f)}return{cancel:()=>{}}},d.globeCenterToScreenPoint=function(s){const i=[0,0,0],l=as(new Float64Array(16));return Zu(l,s.pixelMatrix,s.globeMatrix),oi(i,i,l),new ce(i[0],i[1])},d.globeECEFOrigin=function(s,i){const l=[0,0,0];return oi(l,l,Jc(hl(i.canonical))),oi(l,l,s),l},d.globeNormalizeECEF=Jc,d.globePixelsToTileUnits=function(s,i){return hn/(512*Math.pow(2,s))*Qf(hl(i))},d.globePoleMatrixForTile=function(s,i,l){const c=as(new Float64Array(16)),f=1<<s,g=360*(i/f-.5),y=l.point,b=l.worldSize/(l.tileSize*f);return Gc(c,c,[y.x,y.y,-l.worldSize/Math.PI/2]),Zl(c,c,[b,b,b]),Wu(c,c,tt(-l._center.lat)),wd(c,c,tt(-l._center.lng+g)),Float32Array.from(c)},d.globeTileBounds=hl,d.globeTileLatLngCorners=U0,d.globeTiltAtLngLat=H0,d.globeToMercatorTransition=m_,d.globeUseCustomAntiAliasing=function(s,i,l){const c=m_(l.zoom),f=s.style.map._antialias,g=!!i.extStandardDerivatives,y=i.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===c&&!f&&!y&&g},d.identity=as,d.identity$1=Zy,d.invert=function(s,i){var l=i[0],c=i[1],f=i[2],g=i[3],y=i[4],b=i[5],M=i[6],E=i[7],I=i[8],P=i[9],k=i[10],z=i[11],V=i[12],j=i[13],J=i[14],re=i[15],de=l*b-c*y,he=l*M-f*y,pe=l*E-g*y,_e=c*M-f*b,ve=c*E-g*b,Fe=f*E-g*M,ze=I*j-P*V,Je=I*J-k*V,ct=I*re-z*V,Oe=P*J-k*j,qe=P*re-z*j,ut=k*re-z*J,ht=de*ut-he*qe+pe*Oe+_e*ct-ve*Je+Fe*ze;return ht?(s[0]=(b*ut-M*qe+E*Oe)*(ht=1/ht),s[1]=(f*qe-c*ut-g*Oe)*ht,s[2]=(j*Fe-J*ve+re*_e)*ht,s[3]=(k*ve-P*Fe-z*_e)*ht,s[4]=(M*ct-y*ut-E*Je)*ht,s[5]=(l*ut-f*ct+g*Je)*ht,s[6]=(J*pe-V*Fe-re*he)*ht,s[7]=(I*Fe-k*pe+z*he)*ht,s[8]=(y*qe-b*ct+E*ze)*ht,s[9]=(c*ct-l*qe-g*ze)*ht,s[10]=(V*ve-j*pe+re*de)*ht,s[11]=(P*pe-I*ve-z*de)*ht,s[12]=(b*Je-y*Oe-M*ze)*ht,s[13]=(l*Oe-c*Je+f*ze)*ht,s[14]=(j*he-V*_e-J*de)*ht,s[15]=(I*_e-P*he+k*de)*ht,s):null},d.isLngLatBehindGlobe=function(s,i){return H0(s,i)>Math.PI/2*1.01},d.isMapAuthenticated=function(s){return _a.has(s)},d.isMapboxURL=Xs,d.isSafariWithAntialiasingBug=function(s){const i=s.navigator?s.navigator.userAgent:null;return!!nr(s)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.latFromMercatorY=Ri,d.len=y1,d.length=Hc,d.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},d.loadVectorTile=nv,d.makeRequest=Ce,d.mapValue=function(s,i,l,c,f){return je((s-i)/(l-i)*(f-c)+c,c,f)},d.mercatorXfromLng=Gl,d.mercatorYfromLat=sl,d.mercatorZfromAltitude=na,d.mul=m1,d.mul$1=_1,d.multiply=Zu,d.multiply$1=function(s,i,l){var c=i[0],f=i[1],g=i[2],y=i[3],b=i[4],M=i[5],E=i[6],I=i[7],P=i[8],k=l[0],z=l[1],V=l[2],j=l[3],J=l[4],re=l[5],de=l[6],he=l[7],pe=l[8];return s[0]=k*c+z*y+V*E,s[1]=k*f+z*b+V*I,s[2]=k*g+z*M+V*P,s[3]=j*c+J*y+re*E,s[4]=j*f+J*b+re*I,s[5]=j*g+J*M+re*P,s[6]=de*c+he*y+pe*E,s[7]=de*f+he*b+pe*I,s[8]=de*g+he*M+pe*P,s},d.multiply$2=Pg,d.nextPowerOfTwo=It,d.normalize=Go,d.normalize$1=function(s,i){var l=i[0],c=i[1],f=i[2],g=i[3],y=l*l+c*c+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),s[0]=l*y,s[1]=c*y,s[2]=f*y,s[3]=g*y,s},d.number=Un,d.ortho=function(s,i,l,c,f,g,y){var b=1/(i-l),M=1/(c-f),E=1/(g-y);return s[0]=-2*b,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*E,s[11]=0,s[12]=(i+l)*b,s[13]=(f+c)*M,s[14]=(y+g)*E,s[15]=1,s},d.pbf=Wc,d.perspective=function(s,i,l,c,f){var g,y=1/Math.tan(i/2);return s[0]=y/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=y,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=f&&f!==1/0?(s[10]=(f+c)*(g=1/(c-f)),s[14]=2*f*c*g):(s[10]=-1,s[14]=-2*c),s},d.pick=function(s,i){const l={};for(let c=0;c<i.length;c++){const f=i[c];f in s&&(l[f]=s[f])}return l},d.plugin=Q,d.pointGeometry=ce,d.polygonContainsPoint=Aa,d.polygonIntersectsBox=jy,d.polygonIntersectsPolygon=xd,d.polygonizeBounds=function(s,i,l=0,c=!0){const f=new ce(l,l),g=s.sub(f),y=i.add(f),b=[g,new ce(y.x,g.y),y,new ce(g.x,y.y)];return c&&b.push(g.clone()),b},d.posAttributes=Od,d.postMapLoadEvent=vc,d.postTurnstileEvent=Uh,d.potpack=e_,d.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},d.radToDeg=Mt,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(s){return s({pluginStatus:N,pluginURL:H}),q.on("pluginStateChange",s),s},d.removeAuthState=function(s){_a.delete(s)},d.renderColorRamp=Qy,d.resample=Yt,d.rotateX=Wu,d.rotateX$1=Wy,d.rotateY=wd,d.rotateY$1=Xy,d.rotateZ=function(s,i,l){var c=Math.sin(l),f=Math.cos(l),g=i[0],y=i[1],b=i[2],M=i[3],E=i[4],I=i[5],P=i[6],k=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=g*f+E*c,s[1]=y*f+I*c,s[2]=b*f+P*c,s[3]=M*f+k*c,s[4]=E*f-g*c,s[5]=I*f-y*c,s[6]=P*f-b*c,s[7]=k*f-M*c,s},d.rotateZ$1=function(s,i,l){l*=.5;var c=i[0],f=i[1],g=i[2],y=i[3],b=Math.sin(l),M=Math.cos(l);return s[0]=c*M+f*b,s[1]=f*M-c*b,s[2]=g*M+y*b,s[3]=y*M-g*b,s},d.scale=Zl,d.scale$1=Hy,d.scale$2=ll,d.scaleAndAdd=Qp,d.setCacheLimits=function(s,i){xc=s,_u=i},d.setColumn=function(s,i,l){s[4*i+0]=l[0],s[4*i+1]=l[1],s[4*i+2]=l[2],s[4*i+3]=l[3]},d.setRTLTextPlugin=function(s,i,l=!1){if(N===S||N===A||N===R)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=Os.resolveURL(s),N=S,L=i,K(),l||Y()},d.smoothstep=Le,d.spec=we,d.storeAuthState=function(s,i){i?_a.add(s):_a.delete(s)},d.sub=oa,d.subtract=Kp,d.symbolSize=g0,d.tileAABB=function(s,i,l,c,f,g,y,b,M){if("globe"===M.name)return function V0(s,i,l){const c=i/s.worldSize,f=Number.MAX_VALUE,g=[-f,-f,-f],y=[f,f,f],b=as(new Float64Array(16));if(Zl(b,b,[c,c,c]),Zu(b,b,s.globeMatrix),l.z<=1){const Oe=hl(l).getCorners();for(let qe=0;qe<Oe.length;qe++)oi(Oe[qe],Oe[qe],b),al(y,y,Oe[qe]),Jp(g,g,Oe[qe]);return new Es(y,g)}const[M,E]=U0(l),I=new $c;I.setSouthWest([M[1],E[0]]),I.setNorthEast([E[1],M[0]]);const P=[Hi(I.getSouth(),I.getWest()),Hi(I.getSouth(),I.getEast()),Hi(I.getNorth(),I.getEast()),Hi(I.getNorth(),I.getWest())];for(let Oe=0;Oe<P.length;Oe++)oi(P[Oe],P[Oe],b),al(y,y,P[Oe]),Jp(g,g,P[Oe]);if(I.contains(s.center)){g[2]=0;const Oe=s.point,qe=[Oe.x*c,Oe.y*c,0];return al(y,y,qe),Jp(g,g,qe),new Es(y,g)}const k=[b[12],b[13],b[14]],z=s.center.lng,V=je(s.center.lat,-85.051129,Ms),j=[Gl(z),sl(V)],J=I.getCenter().lng,re=je(I.getCenter().lat,-85.051129,Ms),de=[Gl(J),sl(re)];let he=new Array(3),pe=0,_e=j[0]-de[0];const ve=j[1]-de[1];if(_e>.5?_e-=1:_e<-.5&&(_e+=1),Math.abs(_e)>Math.abs(ve))pe=_e>=0?1:3,he=k;else{pe=ve>=0?0:2;const Oe=[b[4],b[5],b[6]];let qe;qe=ve>=0?-Math.sin(tt(I.getSouth()))*Kc:-Math.sin(tt(I.getNorth()))*Kc,he=Qp(he,k,Oe,qe)}const Fe=P[pe],ze=P[(pe+1)%4],Je=new zM(Fe,ze,he),ct=[B0(Je,0)||Fe[0],B0(Je,1)||Fe[1],B0(Je,2)||Fe[2]];return y[2]=Math.min(Fe[2],ze[2]),al(y,y,ct),Jp(g,g,ct),new Es(y,g)}(s,i,new qf(l,c,f));const E=ah({z:l,x:c,y:f},M);return new Es([(g+E.x/E.scale)*i,i*(E.y/E.scale),y],[(g+E.x2/E.scale)*i,i*(E.y2/E.scale),b])},d.tileTransform=ah,d.transformMat3=function(s,i,l){var c=i[0],f=i[1],g=i[2];return s[0]=c*l[0]+f*l[3]+g*l[6],s[1]=c*l[1]+f*l[4]+g*l[7],s[2]=c*l[2]+f*l[5]+g*l[8],s},d.transformMat4=oi,d.transformMat4$1=Zc,d.transformQuat=Og,d.translate=Gc,d.transpose=function(s,i){if(s===i){var l=i[1],c=i[2],f=i[5];s[1]=i[3],s[2]=i[6],s[3]=l,s[5]=i[7],s[6]=c,s[7]=f}else s[0]=i[0],s[1]=i[3],s[2]=i[6],s[3]=i[1],s[4]=i[4],s[5]=i[7],s[6]=i[2],s[7]=i[5],s[8]=i[8];return s},d.triggerPluginCompletionEvent=Z,d.uniqueId=tn,d.updateGlobeVertexNormal=function(s,i,l,c,f){const g=5*i+2;s.float32[g+0]=l,s.float32[g+1]=c,s.float32[g+2]=f},d.validateCustomStyleLayer=function(s){const i=[],l=s.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},d.validateFilter=s=>rs(Fp(s)),d.validateFog=s=>rs(Nl(s)),d.validateLayer=s=>rs(Np(s)),d.validateLight=s=>rs(xf(s)),d.validateSource=s=>rs(ns(s)),d.validateStyle=Bp,d.validateTerrain=s=>rs(Pu(s)),d.values=st,d.vectorTile=eh,d.version="2.9.1",d.warnOnce=On,d.window=W,d.wrap=xe}),Ue(0,function(d){function W(te){if("number"==typeof te||"boolean"==typeof te||"string"==typeof te||null==te)return JSON.stringify(te);if(Array.isArray(te)){let $="[";for(const ee of te)$+=`${W(ee)},`;return`${$}]`}let B="{";for(const $ of Object.keys(te).sort())B+=`${$}:${W(te[$])},`;return`${B}}`}function Te(te){let B="";for(const $ of d.refProperties)B+=`/${W(te[$])}`;return B}class Me{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,$){for(const se of B)this._layerConfigs[se.id]=se,(this._layers[se.id]=d.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of $)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ee=function(se,ge){const Ee={};for(let ye=0;ye<se.length;ye++){const Se=ge&&ge[se[ye].id]||Te(se[ye]);ge&&(ge[se[ye].id]=Se);let it=Ee[Se];it||(it=Ee[Se]=[]),it.push(se[ye])}const Ce=[];for(const ye in Ee)Ce.push(Ee[ye]);return Ce}(d.values(this._layerConfigs),this.keyCache);for(const se of ee){const ge=se.map(gt=>this._layers[gt.id]),Ee=ge[0];if("none"===Ee.visibility)continue;const Ce=Ee.source||"";let ye=this.familiesBySource[Ce];ye||(ye=this.familiesBySource[Ce]={});const Se=Ee.sourceLayer||"_geojsonTileLayer";let it=ye[Se];it||(it=ye[Se]=[]),it.push(ge)}}}class ce{loadTile(B,$){const{uid:ee,encoding:se,rawImageData:ge,padding:Ee,buildQuadTree:Ce}=B,ye=d.window.ImageBitmap&&ge instanceof d.window.ImageBitmap?this.getImageData(ge,Ee):ge;$(null,new d.DEMData(ee,ye,se,Ee<1,Ce))}getImageData(B,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const ee=this.offscreenCanvasContext.getImageData(-$,-$,B.width+2*$,B.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ee}}var De=function te(B,$){var ee,se=B&&B.type;if("FeatureCollection"===se)for(ee=0;ee<B.features.length;ee++)te(B.features[ee],$);else if("GeometryCollection"===se)for(ee=0;ee<B.geometries.length;ee++)te(B.geometries[ee],$);else if("Feature"===se)te(B.geometry,$);else if("Polygon"===se)lt(B.coordinates,$);else if("MultiPolygon"===se)for(ee=0;ee<B.coordinates.length;ee++)lt(B.coordinates[ee],$);return B};function lt(te,B){if(0!==te.length){$t(te[0],B);for(var $=1;$<te.length;$++)$t(te[$],!B)}}function $t(te,B){for(var $=0,ee=0,se=0,ge=te.length,Ee=ge-1;se<ge;Ee=se++){var Ce=(te[se][0]-te[Ee][0])*(te[Ee][1]+te[se][1]),ye=$+Ce;ee+=Math.abs($)>=Math.abs(Ce)?$-ye+Ce:Ce-ye+$,$=ye}$+ee>=0!=!!B&&te.reverse()}const tt=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Mt{constructor(B){this._feature=B,this.extent=d.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(1===this._feature.type){const B=[];for(const $ of this._feature.geometry)B.push([new d.pointGeometry($[0],$[1])]);return B}{const B=[];for(const $ of this._feature.geometry){const ee=[];for(const se of $)ee.push(new d.pointGeometry(se[0],se[1]));B.push(ee)}return B}}toGeoJSON(B,$,ee){return tt.call(this,B,$,ee)}}class vt{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=B.length,this._features=B}feature(B){return new Mt(this._features[B])}}var _t=d.vectorTile.VectorTileFeature,le=Be;function Be(te,B){this.options=B||{},this.features=te,this.length=te.length}function je(te,B){this.id="number"==typeof te.id?te.id:void 0,this.type=te.type,this.rawGeometry=1===te.type?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=B||4096}Be.prototype.feature=function(te){return new je(this.features[te],this.options.extent)},je.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var B=0;B<te.length;B++){for(var $=te[B],ee=[],se=0;se<$.length;se++)ee.push(new d.pointGeometry($[se][0],$[se][1]));this.geometry.push(ee)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,B=1/0,$=-1/0,ee=1/0,se=-1/0,ge=0;ge<te.length;ge++)for(var Ee=te[ge],Ce=0;Ce<Ee.length;Ce++){var ye=Ee[Ce];B=Math.min(B,ye.x),$=Math.max($,ye.x),ee=Math.min(ee,ye.y),se=Math.max(se,ye.y)}return[B,ee,$,se]},je.prototype.toGeoJSON=_t.prototype.toGeoJSON;var Le=Xe,xe=le;function Xe(te){var B=new d.pbf;return function($,ee){for(var se in $.layers)ee.writeMessage(3,st,$.layers[se])}(te,B),B.finish()}function st(te,B){var $;B.writeVarintField(15,te.version||1),B.writeStringField(1,te.name||""),B.writeVarintField(5,te.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<te.length;$++)ee.feature=te.feature($),B.writeMessage(2,He,ee);var se=ee.keys;for($=0;$<se.length;$++)B.writeStringField(3,se[$]);var ge=ee.values;for($=0;$<ge.length;$++)B.writeMessage(4,Pt,ge[$])}function He(te,B){var $=te.feature;void 0!==$.id&&B.writeVarintField(1,$.id),B.writeMessage(2,zt,te),B.writeVarintField(3,$.type),B.writeMessage(4,It,$)}function zt(te,B){var $=te.feature,ee=te.keys,se=te.values,ge=te.keycache,Ee=te.valuecache;for(var Ce in $.properties){var ye=$.properties[Ce],Se=ge[Ce];if(null!==ye){void 0===Se&&(ee.push(Ce),ge[Ce]=Se=ee.length-1),B.writeVarint(Se);var it=typeof ye;"string"!==it&&"boolean"!==it&&"number"!==it&&(ye=JSON.stringify(ye));var gt=it+":"+ye,ot=Ee[gt];void 0===ot&&(se.push(ye),Ee[gt]=ot=se.length-1),B.writeVarint(ot)}}}function tn(te,B){return(B<<3)+(7&te)}function Wt(te){return te<<1^te>>31}function It(te,B){for(var $=te.loadGeometry(),ee=te.type,se=0,ge=0,Ee=$.length,Ce=0;Ce<Ee;Ce++){var ye=$[Ce],Se=1;1===ee&&(Se=ye.length),B.writeVarint(tn(1,Se));for(var it=3===ee?ye.length-1:ye.length,gt=0;gt<it;gt++){1===gt&&1!==ee&&B.writeVarint(tn(2,it-1));var ot=ye[gt].x-se,Zt=ye[gt].y-ge;B.writeVarint(Wt(ot)),B.writeVarint(Wt(Zt)),se+=ot,ge+=Zt}3===ee&&B.writeVarint(tn(7,1))}}function Pt(te,B){var $=typeof te;"string"===$?B.writeStringField(1,te):"boolean"===$?B.writeBooleanField(7,te):"number"===$&&(te%1!=0?B.writeDoubleField(3,te):te<0?B.writeSVarintField(6,te):B.writeVarintField(5,te))}function nn(te,B,$,ee,se,ge){if(se-ee<=$)return;const Ee=ee+se>>1;Rt(te,B,Ee,ee,se,ge%2),nn(te,B,$,ee,Ee-1,ge+1),nn(te,B,$,Ee+1,se,ge+1)}function Rt(te,B,$,ee,se,ge){for(;se>ee;){if(se-ee>600){const Se=se-ee+1,it=$-ee+1,gt=Math.log(Se),ot=.5*Math.exp(2*gt/3),Zt=.5*Math.sqrt(gt*ot*(Se-ot)/Se)*(it-Se/2<0?-1:1);Rt(te,B,$,Math.max(ee,Math.floor($-it*ot/Se+Zt)),Math.min(se,Math.floor($+(Se-it)*ot/Se+Zt)),ge)}const Ee=B[2*$+ge];let Ce=ee,ye=se;for(mn(te,B,ee,$),B[2*se+ge]>Ee&&mn(te,B,ee,se);Ce<ye;){for(mn(te,B,Ce,ye),Ce++,ye--;B[2*Ce+ge]<Ee;)Ce++;for(;B[2*ye+ge]>Ee;)ye--}B[2*ee+ge]===Ee?mn(te,B,ee,ye):(ye++,mn(te,B,ye,se)),ye<=$&&(ee=ye+1),$<=ye&&(se=ye-1)}}function mn(te,B,$,ee){yn(te,$,ee),yn(B,2*$,2*ee),yn(B,2*$+1,2*ee+1)}function yn(te,B,$){const ee=te[B];te[B]=te[$],te[$]=ee}function Jt(te,B,$,ee){const se=te-$,ge=B-ee;return se*se+ge*ge}Le.fromVectorTileJs=Xe,Le.fromGeojsonVt=function(te,B){B=B||{};var $={};for(var ee in te)$[ee]=new le(te[ee].features,B),$[ee].name=ee,$[ee].version=B.version,$[ee].extent=B.extent;return Xe({layers:$})},Le.GeoJSONWrapper=xe;const Lr=te=>te[0],On=te=>te[1];class lr{constructor(B,$=Lr,ee=On,se=64,ge=Float64Array){this.nodeSize=se,this.points=B;const Ee=B.length<65536?Uint16Array:Uint32Array,Ce=this.ids=new Ee(B.length),ye=this.coords=new ge(2*B.length);for(let Se=0;Se<B.length;Se++)Ce[Se]=Se,ye[2*Se]=$(B[Se]),ye[2*Se+1]=ee(B[Se]);nn(Ce,ye,se,0,Ce.length-1,0)}range(B,$,ee,se){return function(ge,Ee,Ce,ye,Se,it,gt){const ot=[0,ge.length-1,0],Zt=[];let un,rn;for(;ot.length;){const fn=ot.pop(),Rn=ot.pop(),cr=ot.pop();if(Rn-cr<=gt){for(let we=cr;we<=Rn;we++)un=Ee[2*we],rn=Ee[2*we+1],un>=Ce&&un<=Se&&rn>=ye&&rn<=it&&Zt.push(ge[we]);continue}const vr=Math.floor((cr+Rn)/2);un=Ee[2*vr],rn=Ee[2*vr+1],un>=Ce&&un<=Se&&rn>=ye&&rn<=it&&Zt.push(ge[vr]);const mr=(fn+1)%2;(0===fn?Ce<=un:ye<=rn)&&(ot.push(cr),ot.push(vr-1),ot.push(mr)),(0===fn?Se>=un:it>=rn)&&(ot.push(vr+1),ot.push(Rn),ot.push(mr))}return Zt}(this.ids,this.coords,B,$,ee,se,this.nodeSize)}within(B,$,ee){return function(se,ge,Ee,Ce,ye,Se){const it=[0,se.length-1,0],gt=[],ot=ye*ye;for(;it.length;){const Zt=it.pop(),un=it.pop(),rn=it.pop();if(un-rn<=Se){for(let mr=rn;mr<=un;mr++)Jt(ge[2*mr],ge[2*mr+1],Ee,Ce)<=ot&&gt.push(se[mr]);continue}const fn=Math.floor((rn+un)/2),Rn=ge[2*fn],cr=ge[2*fn+1];Jt(Rn,cr,Ee,Ce)<=ot&&gt.push(se[fn]);const vr=(Zt+1)%2;(0===Zt?Ee-ye<=Rn:Ce-ye<=cr)&&(it.push(rn),it.push(fn-1),it.push(vr)),(0===Zt?Ee+ye>=Rn:Ce+ye>=cr)&&(it.push(fn+1),it.push(un),it.push(vr))}return gt}(this.ids,this.coords,B,$,ee,this.nodeSize)}}const di={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},Wn=Math.fround||(Xi=new Float32Array(1),te=>(Xi[0]=+te,Xi[0]));var Xi;class Yi{constructor(B){this.options=Wa(Object.create(di),B),this.trees=new Array(this.options.maxZoom+1)}load(B){const{log:$,minZoom:ee,maxZoom:se,nodeSize:ge}=this.options;$&&console.time("total time");const Ee=`prepare ${B.length} points`;$&&console.time(Ee),this.points=B;let Ce=[];for(let ye=0;ye<B.length;ye++)B[ye].geometry&&Ce.push(cn(B[ye],ye));this.trees[se+1]=new lr(Ce,gc,pa,ge,Float32Array),$&&console.timeEnd(Ee);for(let ye=se;ye>=ee;ye--){const Se=+Date.now();Ce=this._cluster(Ce,ye),this.trees[ye]=new lr(Ce,gc,pa,ge,Float32Array),$&&console.log("z%d: %d clusters in %dms",ye,Ce.length,+Date.now()-Se)}return $&&console.timeEnd("total time"),this}getClusters(B,$){let ee=((B[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,B[1]));let ge=180===B[2]?180:((B[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)ee=-180,ge=180;else if(ee>ge){const it=this.getClusters([ee,se,180,Ee],$),gt=this.getClusters([-180,se,ge,Ee],$);return it.concat(gt)}const Ce=this.trees[this._limitZoom($)],ye=Ce.range(io(ee),mc(Ee),io(ge),mc(se)),Se=[];for(const it of ye){const gt=Ce.points[it];Se.push(gt.numPoints?Gr(gt):this.points[gt.index])}return Se}getChildren(B){const $=this._getOriginId(B),ee=this._getOriginZoom(B),se="No cluster with the specified id.",ge=this.trees[ee];if(!ge)throw new Error(se);const Ee=ge.points[$];if(!Ee)throw new Error(se);const Ce=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),ye=ge.within(Ee.x,Ee.y,Ce),Se=[];for(const it of ye){const gt=ge.points[it];gt.parentId===B&&Se.push(gt.numPoints?Gr(gt):this.points[gt.index])}if(0===Se.length)throw new Error(se);return Se}getLeaves(B,$,ee){const se=[];return this._appendLeaves(se,B,$=$||10,ee=ee||0,0),se}getTile(B,$,ee){const se=this.trees[this._limitZoom(B)],ge=Math.pow(2,B),{extent:Ee,radius:Ce}=this.options,ye=Ce/Ee,Se=(ee-ye)/ge,it=(ee+1+ye)/ge,gt={features:[]};return this._addTileFeatures(se.range(($-ye)/ge,Se,($+1+ye)/ge,it),se.points,$,ee,ge,gt),0===$&&this._addTileFeatures(se.range(1-ye/ge,Se,1,it),se.points,ge,ee,ge,gt),$===ge-1&&this._addTileFeatures(se.range(0,Se,ye/ge,it),se.points,-1,ee,ge,gt),gt.features.length?gt:null}getClusterExpansionZoom(B){let $=this._getOriginZoom(B)-1;for(;$<=this.options.maxZoom;){const ee=this.getChildren(B);if($++,1!==ee.length)break;B=ee[0].properties.cluster_id}return $}_appendLeaves(B,$,ee,se,ge){const Ee=this.getChildren($);for(const Ce of Ee){const ye=Ce.properties;if(ye&&ye.cluster?ge+ye.point_count<=se?ge+=ye.point_count:ge=this._appendLeaves(B,ye.cluster_id,ee,se,ge):ge<se?ge++:B.push(Ce),B.length===ee)break}return ge}_addTileFeatures(B,$,ee,se,ge,Ee){for(const Ce of B){const ye=$[Ce],Se=ye.numPoints;let it,gt,ot;if(Se)it=Mn(ye),gt=ye.x,ot=ye.y;else{const rn=this.points[ye.index];it=rn.properties,gt=io(rn.geometry.coordinates[0]),ot=mc(rn.geometry.coordinates[1])}const Zt={type:1,geometry:[[Math.round(this.options.extent*(gt*ge-ee)),Math.round(this.options.extent*(ot*ge-se))]],tags:it};let un;Se?un=ye.id:this.options.generateId?un=ye.index:this.points[ye.index].id&&(un=this.points[ye.index].id),void 0!==un&&(Zt.id=un),Ee.features.push(Zt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))}_cluster(B,$){const ee=[],{radius:se,extent:ge,reduce:Ee,minPoints:Ce}=this.options,ye=se/(ge*Math.pow(2,$));for(let Se=0;Se<B.length;Se++){const it=B[Se];if(it.zoom<=$)continue;it.zoom=$;const gt=this.trees[$+1],ot=gt.within(it.x,it.y,ye),Zt=it.numPoints||1;let un=Zt;for(const rn of ot){const fn=gt.points[rn];fn.zoom>$&&(un+=fn.numPoints||1)}if(un>Zt&&un>=Ce){let rn=it.x*Zt,fn=it.y*Zt,Rn=Ee&&Zt>1?this._map(it,!0):null;const cr=(Se<<5)+($+1)+this.points.length;for(const vr of ot){const mr=gt.points[vr];if(mr.zoom<=$)continue;mr.zoom=$;const we=mr.numPoints||1;rn+=mr.x*we,fn+=mr.y*we,mr.parentId=cr,Ee&&(Rn||(Rn=this._map(it,!0)),Ee(Rn,this._map(mr)))}it.parentId=cr,ee.push(nr(rn/un,fn/un,cr,un,Rn))}else if(ee.push(it),un>1)for(const rn of ot){const fn=gt.points[rn];fn.zoom<=$||(fn.zoom=$,ee.push(fn))}}return ee}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,$){if(B.numPoints)return $?Wa({},B.properties):B.properties;const ee=this.points[B.index].properties,se=this.options.map(ee);return $&&se===ee?Wa({},se):se}}function nr(te,B,$,ee,se){return{x:Wn(te),y:Wn(B),zoom:1/0,id:$,parentId:-1,numPoints:ee,properties:se}}function cn(te,B){const[$,ee]=te.geometry.coordinates;return{x:Wn(io($)),y:Wn(mc(ee)),zoom:1/0,index:B,parentId:-1}}function Gr(te){return{type:"Feature",id:te.id,properties:Mn(te),geometry:{type:"Point",coordinates:[(B=te.x,360*(B-.5)),rr(te.y)]}};var B}function Mn(te){const B=te.numPoints,$=B>=1e4?`${Math.round(B/1e3)}k`:B>=1e3?Math.round(B/100)/10+"k":B;return Wa(Wa({},te.properties),{cluster:!0,cluster_id:te.id,point_count:B,point_count_abbreviated:$})}function io(te){return te/360+.5}function mc(te){const B=Math.sin(te*Math.PI/180),$=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return $<0?0:$>1?1:$}function rr(te){const B=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Wa(te,B){for(const $ in B)te[$]=B[$];return te}function gc(te){return te.x}function pa(te){return te.y}function Os(te,B,$,ee){for(var se,ge=ee,Ee=$-B>>1,Ce=$-B,ye=te[B],Se=te[B+1],it=te[$],gt=te[$+1],ot=B+3;ot<$;ot+=3){var Zt=_c(te[ot],te[ot+1],ye,Se,it,gt);if(Zt>ge)se=ot,ge=Zt;else if(Zt===ge){var un=Math.abs(ot-Ee);un<Ce&&(se=ot,Ce=un)}}ge>ee&&(se-B>3&&Os(te,B,se,ee),te[se+2]=ge,$-se>3&&Os(te,se,$,ee))}function _c(te,B,$,ee,se,ge){var Ee=se-$,Ce=ge-ee;if(0!==Ee||0!==Ce){var ye=((te-$)*Ee+(B-ee)*Ce)/(Ee*Ee+Ce*Ce);ye>1?($=se,ee=ge):ye>0&&($+=Ee*ye,ee+=Ce*ye)}return(Ee=te-$)*Ee+(Ce=B-ee)*Ce}function or(te,B,$,ee){var se={id:void 0===te?null:te,type:B,geometry:$,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var Ee=ge.geometry,Ce=ge.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)ma(ge,Ee);else if("Polygon"===Ce||"MultiLineString"===Ce)for(var ye=0;ye<Ee.length;ye++)ma(ge,Ee[ye]);else if("MultiPolygon"===Ce)for(ye=0;ye<Ee.length;ye++)for(var Se=0;Se<Ee[ye].length;Se++)ma(ge,Ee[ye][Se])}(se),se}function ma(te,B){for(var $=0;$<B.length;$+=3)te.minX=Math.min(te.minX,B[$]),te.minY=Math.min(te.minY,B[$+1]),te.maxX=Math.max(te.maxX,B[$]),te.maxY=Math.max(te.maxY,B[$+1])}function Xa(te,B,$,ee){if(B.geometry){var se=B.geometry.coordinates,ge=B.geometry.type,Ee=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Ce=[],ye=B.id;if($.promoteId?ye=B.properties[$.promoteId]:$.generateId&&(ye=ee||0),"Point"===ge)Ws(se,Ce);else if("MultiPoint"===ge)for(var Se=0;Se<se.length;Se++)Ws(se[Se],Ce);else if("LineString"===ge)wl(se,Ce,Ee,!1);else if("MultiLineString"===ge){if($.lineMetrics){for(Se=0;Se<se.length;Se++)wl(se[Se],Ce=[],Ee,!1),te.push(or(ye,"LineString",Ce,B.properties));return}mu(se,Ce,Ee,!1)}else if("Polygon"===ge)mu(se,Ce,Ee,!0);else{if("MultiPolygon"!==ge){if("GeometryCollection"===ge){for(Se=0;Se<B.geometry.geometries.length;Se++)Xa(te,{id:ye,geometry:B.geometry.geometries[Se],properties:B.properties},$,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<se.length;Se++){var it=[];mu(se[Se],it,Ee,!0),Ce.push(it)}}te.push(or(ye,ge,Ce,B.properties))}}function Ws(te,B){B.push(Fh(te[0])),B.push(zh(te[1])),B.push(0)}function wl(te,B,$,ee){for(var se,ge,Ee=0,Ce=0;Ce<te.length;Ce++){var ye=Fh(te[Ce][0]),Se=zh(te[Ce][1]);B.push(ye),B.push(Se),B.push(0),Ce>0&&(Ee+=ee?(se*Se-ye*ge)/2:Math.sqrt(Math.pow(ye-se,2)+Math.pow(Se-ge,2))),se=ye,ge=Se}var it=B.length-3;B[2]=1,Os(B,0,it,$),B[it+2]=1,B.size=Math.abs(Ee),B.start=0,B.end=B.size}function mu(te,B,$,ee){for(var se=0;se<te.length;se++){var ge=[];wl(te[se],ge,$,ee),B.push(ge)}}function Fh(te){return te/360+.5}function zh(te){var B=Math.sin(te*Math.PI/180),$=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return $<0?0:$>1?1:$}function Ni(te,B,$,ee,se,ge,Ee,Ce){if(ee/=B,ge>=($/=B)&&Ee<ee)return te;if(Ee<$||ge>=ee)return null;for(var ye=[],Se=0;Se<te.length;Se++){var it=te[Se],gt=it.geometry,ot=it.type,Zt=0===se?it.minX:it.minY,un=0===se?it.maxX:it.maxY;if(Zt>=$&&un<ee)ye.push(it);else if(!(un<$||Zt>=ee)){var rn=[];if("Point"===ot||"MultiPoint"===ot)Xs(gt,rn,$,ee,se);else if("LineString"===ot)yc(gt,rn,$,ee,se,!1,Ce.lineMetrics);else if("MultiLineString"===ot)ys(gt,rn,$,ee,se,!1);else if("Polygon"===ot)ys(gt,rn,$,ee,se,!0);else if("MultiPolygon"===ot)for(var fn=0;fn<gt.length;fn++){var Rn=[];ys(gt[fn],Rn,$,ee,se,!0),Rn.length&&rn.push(Rn)}if(rn.length){if(Ce.lineMetrics&&"LineString"===ot){for(fn=0;fn<rn.length;fn++)ye.push(or(it.id,ot,rn[fn],it.tags));continue}"LineString"!==ot&&"MultiLineString"!==ot||(1===rn.length?(ot="LineString",rn=rn[0]):ot="MultiLineString"),"Point"!==ot&&"MultiPoint"!==ot||(ot=3===rn.length?"Point":"MultiPoint"),ye.push(or(it.id,ot,rn,it.tags))}}}return ye.length?ye:null}function Xs(te,B,$,ee,se){for(var ge=0;ge<te.length;ge+=3){var Ee=te[ge+se];Ee>=$&&Ee<=ee&&(B.push(te[ge]),B.push(te[ge+1]),B.push(te[ge+2]))}}function yc(te,B,$,ee,se,ge,Ee){for(var Ce,ye,Se=Nh(te),it=0===se?nf:Bh,gt=te.start,ot=0;ot<te.length-3;ot+=3){var Zt=te[ot],un=te[ot+1],rn=te[ot+2],fn=te[ot+3],Rn=te[ot+4],cr=0===se?Zt:un,vr=0===se?fn:Rn,mr=!1;Ee&&(Ce=Math.sqrt(Math.pow(Zt-fn,2)+Math.pow(un-Rn,2))),cr<$?vr>$&&(ye=it(Se,Zt,un,fn,Rn,$),Ee&&(Se.start=gt+Ce*ye)):cr>ee?vr<ee&&(ye=it(Se,Zt,un,fn,Rn,ee),Ee&&(Se.start=gt+Ce*ye)):ga(Se,Zt,un,rn),vr<$&&cr>=$&&(ye=it(Se,Zt,un,fn,Rn,$),mr=!0),vr>ee&&cr<=ee&&(ye=it(Se,Zt,un,fn,Rn,ee),mr=!0),!ge&&mr&&(Ee&&(Se.end=gt+Ce*ye),B.push(Se),Se=Nh(te)),Ee&&(gt+=Ce)}var we=te.length-3;Zt=te[we],un=te[we+1],rn=te[we+2],(cr=0===se?Zt:un)>=$&&cr<=ee&&ga(Se,Zt,un,rn),we=Se.length-3,ge&&we>=3&&(Se[we]!==Se[0]||Se[we+1]!==Se[1])&&ga(Se,Se[0],Se[1],Se[2]),Se.length&&B.push(Se)}function Nh(te){var B=[];return B.size=te.size,B.start=te.start,B.end=te.end,B}function ys(te,B,$,ee,se,ge){for(var Ee=0;Ee<te.length;Ee++)yc(te[Ee],B,$,ee,se,ge,!1)}function ga(te,B,$,ee){te.push(B),te.push($),te.push(ee)}function nf(te,B,$,ee,se,ge){var Ee=(ge-B)/(ee-B);return te.push(ge),te.push($+(se-$)*Ee),te.push(1),Ee}function Bh(te,B,$,ee,se,ge){var Ee=(ge-$)/(se-$);return te.push(B+(ee-B)*Ee),te.push(ge),te.push(1),Ee}function Vh(te,B){for(var $=[],ee=0;ee<te.length;ee++){var se,ge=te[ee],Ee=ge.type;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)se=Uh(ge.geometry,B);else if("MultiLineString"===Ee||"Polygon"===Ee){se=[];for(var Ce=0;Ce<ge.geometry.length;Ce++)se.push(Uh(ge.geometry[Ce],B))}else if("MultiPolygon"===Ee)for(se=[],Ce=0;Ce<ge.geometry.length;Ce++){for(var ye=[],Se=0;Se<ge.geometry[Ce].length;Se++)ye.push(Uh(ge.geometry[Ce][Se],B));se.push(ye)}$.push(or(ge.id,Ee,se,ge.tags))}return $}function Uh(te,B){var $=[];$.size=te.size,void 0!==te.start&&($.start=te.start,$.end=te.end);for(var ee=0;ee<te.length;ee+=3)$.push(te[ee]+B,te[ee+1],te[ee+2]);return $}function jh(te,B){if(te.transformed)return te;var $,ee,se,ge=1<<te.z,Ee=te.x,Ce=te.y;for($=0;$<te.features.length;$++){var ye=te.features[$],Se=ye.geometry,it=ye.type;if(ye.geometry=[],1===it)for(ee=0;ee<Se.length;ee+=2)ye.geometry.push(vc(Se[ee],Se[ee+1],B,ge,Ee,Ce));else for(ee=0;ee<Se.length;ee++){var gt=[];for(se=0;se<Se[ee].length;se+=2)gt.push(vc(Se[ee][se],Se[ee][se+1],B,ge,Ee,Ce));ye.geometry.push(gt)}}return te.transformed=!0,te}function vc(te,B,$,ee,se,ge){return[Math.round($*(te*ee-se)),Math.round($*(B*ee-ge))]}function gu(te,B,$,ee,se){for(var ge=B===se.maxZoom?0:se.tolerance/((1<<B)*se.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ee,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<te.length;Ce++){Ee.numFeatures++,$h(Ee,te[Ce],ge,se);var ye=te[Ce].minX,Se=te[Ce].minY,it=te[Ce].maxX,gt=te[Ce].maxY;ye<Ee.minX&&(Ee.minX=ye),Se<Ee.minY&&(Ee.minY=Se),it>Ee.maxX&&(Ee.maxX=it),gt>Ee.maxY&&(Ee.maxY=gt)}return Ee}function $h(te,B,$,ee){var se=B.geometry,ge=B.type,Ee=[];if("Point"===ge||"MultiPoint"===ge)for(var Ce=0;Ce<se.length;Ce+=3)Ee.push(se[Ce]),Ee.push(se[Ce+1]),te.numPoints++,te.numSimplified++;else if("LineString"===ge)_a(Ee,se,te,$,!1,!1);else if("MultiLineString"===ge||"Polygon"===ge)for(Ce=0;Ce<se.length;Ce++)_a(Ee,se[Ce],te,$,"Polygon"===ge,0===Ce);else if("MultiPolygon"===ge)for(var ye=0;ye<se.length;ye++){var Se=se[ye];for(Ce=0;Ce<Se.length;Ce++)_a(Ee,Se[Ce],te,$,!0,0===Ce)}if(Ee.length){var it=B.tags||null;if("LineString"===ge&&ee.lineMetrics){for(var gt in it={},B.tags)it[gt]=B.tags[gt];it.mapbox_clip_start=se.start/se.size,it.mapbox_clip_end=se.end/se.size}var ot={geometry:Ee,type:"Polygon"===ge||"MultiPolygon"===ge?3:"LineString"===ge||"MultiLineString"===ge?2:1,tags:it};null!==B.id&&(ot.id=B.id),te.features.push(ot)}}function _a(te,B,$,ee,se,ge){var Ee=ee*ee;if(ee>0&&B.size<(se?Ee:ee))$.numPoints+=B.length/3;else{for(var Ce=[],ye=0;ye<B.length;ye+=3)(0===ee||B[ye+2]>Ee)&&($.numSimplified++,Ce.push(B[ye]),Ce.push(B[ye+1])),$.numPoints++;se&&function(Se,it){for(var gt=0,ot=0,Zt=Se.length,un=Zt-2;ot<Zt;un=ot,ot+=2)gt+=(Se[ot]-Se[un])*(Se[ot+1]+Se[un+1]);if(gt>0===it)for(ot=0,Zt=Se.length;ot<Zt/2;ot+=2){var rn=Se[ot],fn=Se[ot+1];Se[ot]=Se[Zt-2-ot],Se[ot+1]=Se[Zt-1-ot],Se[Zt-2-ot]=rn,Se[Zt-1-ot]=fn}}(Ce,ge),te.push(Ce)}}function Ys(te,B){var $=(B=this.options=function(se,ge){for(var Ee in ge)se[Ee]=ge[Ee];return se}(Object.create(this.options),B)).debug;if($&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var se,ge,Ee,Ce,ye,Se,ee=function(se,ge){var Ee=[];if("FeatureCollection"===se.type)for(var Ce=0;Ce<se.features.length;Ce++)Xa(Ee,se.features[Ce],ge,Ce);else Xa(Ee,"Feature"===se.type?se:{geometry:se},ge);return Ee}(te,B);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=ee,ge=B,Ee=ge.buffer/ge.extent,Ce=se,ye=Ni(se,1,-1-Ee,Ee,0,-1,2,ge),Se=Ni(se,1,1-Ee,2+Ee,0,-1,2,ge),(ye||Se)&&(Ce=Ni(se,1,-Ee,1+Ee,0,-1,2,ge)||[],ye&&(Ce=Vh(ye,1).concat(Ce)),Se&&(Ce=Ce.concat(Vh(Se,-1)))),ee=Ce).length&&this.splitTile(ee,0,0,0),$&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xc(te,B,$){return 32*((1<<te)*$+B)+te}function _u(te,B){const $=te.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);const ee=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ee)return B(null,null);const se=new vt(ee.features);let ge=Le(se);0===ge.byteOffset&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),B(null,{vectorTile:se,rawData:ge.buffer})}Ys.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ys.prototype.splitTile=function(te,B,$,ee,se,ge,Ee){for(var Ce=[te,B,$,ee],ye=this.options,Se=ye.debug;Ce.length;){ee=Ce.pop(),$=Ce.pop(),B=Ce.pop(),te=Ce.pop();var it=1<<B,gt=xc(B,$,ee),ot=this.tiles[gt];if(!ot&&(Se>1&&console.time("creation"),ot=this.tiles[gt]=gu(te,B,$,ee,ye),this.tileCoords.push({z:B,x:$,y:ee}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,$,ee,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));var Zt="z"+B;this.stats[Zt]=(this.stats[Zt]||0)+1,this.total++}if(ot.source=te,se){if(B===ye.maxZoom||B===se)continue;var un=1<<se-B;if($!==Math.floor(ge/un)||ee!==Math.floor(Ee/un))continue}else if(B===ye.indexMaxZoom||ot.numPoints<=ye.indexMaxPoints)continue;if(ot.source=null,0!==te.length){Se>1&&console.time("clipping");var rn,fn,Rn,cr,vr,mr,we=.5*ye.buffer/ye.extent,Uo=.5-we,ei=.5+we,vs=1+we;rn=fn=Rn=cr=null,vr=Ni(te,it,$-we,$+ei,0,ot.minX,ot.maxX,ye),mr=Ni(te,it,$+Uo,$+vs,0,ot.minX,ot.maxX,ye),te=null,vr&&(rn=Ni(vr,it,ee-we,ee+ei,1,ot.minY,ot.maxY,ye),fn=Ni(vr,it,ee+Uo,ee+vs,1,ot.minY,ot.maxY,ye),vr=null),mr&&(Rn=Ni(mr,it,ee-we,ee+ei,1,ot.minY,ot.maxY,ye),cr=Ni(mr,it,ee+Uo,ee+vs,1,ot.minY,ot.maxY,ye),mr=null),Se>1&&console.timeEnd("clipping"),Ce.push(rn||[],B+1,2*$,2*ee),Ce.push(fn||[],B+1,2*$,2*ee+1),Ce.push(Rn||[],B+1,2*$+1,2*ee),Ce.push(cr||[],B+1,2*$+1,2*ee+1)}}},Ys.prototype.getTile=function(te,B,$){var ee=this.options,se=ee.extent,ge=ee.debug;if(te<0||te>24)return null;var Ee=1<<te,Ce=xc(te,B=(B%Ee+Ee)%Ee,$);if(this.tiles[Ce])return jh(this.tiles[Ce],se);ge>1&&console.log("drilling down to z%d-%d-%d",te,B,$);for(var ye,Se=te,it=B,gt=$;!ye&&Se>0;)Se--,it=Math.floor(it/2),gt=Math.floor(gt/2),ye=this.tiles[xc(Se,it,gt)];return ye&&ye.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Se,it,gt),ge>1&&console.time("drilling down"),this.splitTile(ye.source,Se,it,gt,te,B,$),ge>1&&console.timeEnd("drilling down"),this.tiles[Ce]?jh(this.tiles[Ce],se):null):null};class To extends d.VectorTileWorkerSource{constructor(B,$,ee,se,ge){super(B,$,ee,se,_u),ge&&(this.loadGeoJSON=ge)}loadData(B,$){const ee=B&&B.request,se=ee&&ee.collectResourceTiming;this.loadGeoJSON(B,(ge,Ee)=>{if(ge||!Ee)return $(ge);if("object"!=typeof Ee)return $(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{De(Ee,!0);try{if(B.filter){const ye=d.createExpression(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ye.result)throw new Error(ye.value.map(it=>`${it.key}: ${it.message}`).join(", "));const Se=Ee.features.filter(it=>ye.value.evaluate({zoom:0},it));Ee={type:"FeatureCollection",features:Se}}this._geoJSONIndex=B.cluster?new Yi(function({superclusterOptions:ye,clusterProperties:Se}){if(!Se||!ye)return ye;const it={},gt={},ot={accumulated:null,zoom:0},Zt={properties:null},un=Object.keys(Se);for(const rn of un){const[fn,Rn]=Se[rn],cr=d.createExpression(Rn),vr=d.createExpression("string"==typeof fn?[fn,["accumulated"],["get",rn]]:fn);it[rn]=cr.value,gt[rn]=vr.value}return ye.map=rn=>{Zt.properties=rn;const fn={};for(const Rn of un)fn[Rn]=it[Rn].evaluate(ot,Zt);return fn},ye.reduce=(rn,fn)=>{Zt.properties=fn;for(const Rn of un)ot.accumulated=rn[Rn],rn[Rn]=gt[Rn].evaluate(ot,Zt)},ye}(B)).load(Ee.features):new Ys(ye=Ee,B.geojsonVtOptions)}catch(ye){return $(ye)}this.loaded={};const Ce={};if(se){const ye=d.getPerformanceMeasurement(ee);ye&&(Ce.resourceTiming={},Ce.resourceTiming[B.source]=JSON.parse(JSON.stringify(ye)))}$(null,Ce)}var ye})}reloadTile(B,$){const ee=this.loaded;return ee&&ee[B.uid]?super.reloadTile(B,$):this.loadTile(B,$)}loadGeoJSON(B,$){if(B.request)d.getJSON(B.request,$);else{if("string"!=typeof B.data)return $(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(B.data))}catch{return $(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(ee){$(ee)}}getClusterChildren(B,$){try{$(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(ee){$(ee)}}getClusterLeaves(B,$){try{$(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(ee){$(ee)}}}class bc{constructor(B){this.self=B,this.actor=new d.Actor(B,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:To},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,ee)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ee},this.self.registerRTLTextPlugin=$=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=$.applyArabicShaping,d.plugin.processBidirectionalText=$.processBidirectionalText,d.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(B,$,ee){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B],ee()}checkIfReady(B,$,ee){ee()}setReferrer(B,$){this.referrer=$}spriteLoaded(B,$){this.isSpriteLoaded[B]=$;for(const ee in this.workerSources[B]){const se=this.workerSources[B][ee];for(const ge in se)se[ge]instanceof d.VectorTileWorkerSource&&(se[ge].isSpriteLoaded=$,se[ge].fire(new d.Event("isSpriteLoaded")))}}setImages(B,$,ee){this.availableImages[B]=$;for(const se in this.workerSources[B]){const ge=this.workerSources[B][se];for(const Ee in ge)ge[Ee].availableImages=$}ee()}enableTerrain(B,$,ee){this.terrain=$,ee()}setProjection(B,$){this.projections[B]=d.getProjection($)}setLayers(B,$,ee){this.getLayerIndex(B).replace($),ee()}updateLayers(B,$,ee){this.getLayerIndex(B).update($.layers,$.removedIds),ee()}loadTile(B,$,ee){const se=this.enableTerrain?d.extend({enableTerrain:this.terrain},$):$;se.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,$.type,$.source).loadTile(se,ee)}loadDEMTile(B,$,ee){const se=this.enableTerrain?d.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(B,$.source).loadTile(se,ee)}reloadTile(B,$,ee){const se=this.enableTerrain?d.extend({enableTerrain:this.terrain},$):$;se.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,$.type,$.source).reloadTile(se,ee)}abortTile(B,$,ee){this.getWorkerSource(B,$.type,$.source).abortTile($,ee)}removeTile(B,$,ee){this.getWorkerSource(B,$.type,$.source).removeTile($,ee)}removeSource(B,$,ee){if(!this.workerSources[B]||!this.workerSources[B][$.type]||!this.workerSources[B][$.type][$.source])return;const se=this.workerSources[B][$.type][$.source];delete this.workerSources[B][$.type][$.source],void 0!==se.removeSource?se.removeSource($,ee):ee()}loadWorkerSource(B,$,ee){try{this.self.importScripts($.url),ee()}catch(se){ee(se.toString())}}syncRTLPluginState(B,$,ee){try{d.plugin.setState($);const se=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=se){this.self.importScripts(se);const ge=d.plugin.isParsed();ee(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),ge)}}catch(se){ee(se.toString())}}getAvailableImages(B){let $=this.availableImages[B];return $||($=[]),$}getLayerIndex(B){let $=this.layerIndexes[B];return $||($=this.layerIndexes[B]=new Me),$}getWorkerSource(B,$,ee){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][$]||(this.workerSources[B][$]={}),this.workerSources[B][$][ee]||(this.workerSources[B][$][ee]=new this.workerSourceTypes[$]({send:(se,ge,Ee,Ce,ye,Se)=>{this.actor.send(se,ge,Ee,B,ye,Se)},scheduler:this.actor.scheduler},this.getLayerIndex(B),this.getAvailableImages(B),this.isSpriteLoaded[B])),this.workerSources[B][$][ee]}getDEMWorkerSource(B,$){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][$]||(this.demWorkerSources[B][$]=new ce),this.demWorkerSources[B][$]}enforceCacheSizeLimit(B,$){d.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(B,$,ee){ee(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bc(self)),bc}),Ue(0,function(d){function W(p,o){if(Array.isArray(p)){if(!Array.isArray(o)||p.length!==o.length)return!1;for(let h=0;h<p.length;h++)if(!W(p[h],o[h]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==o){if("object"!=typeof o||Object.keys(p).length!==Object.keys(o).length)return!1;for(const h in p)if(!W(p[h],o[h]))return!1;return!0}return p===o}var Te=Me;function Me(p){return o=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(w);try{x=new Worker(T),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(T),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()||(void 0===ce[h=o&&o.failIfMajorPerformanceCaveat]&&(ce[h]=function(_){var x,T,S,A,w=(T=_,S=document.createElement("canvas"),(A=Object.create(Me.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,S.getContext("webgl",A)||S.getContext("experimental-webgl",A));if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),!0===w.getShaderParameter(x,w.COMPILE_STATUS))}(h)),!ce[h]||document.documentMode));var o,h}var ce={};function De(p,o,h){const _=d.window.document.createElement(p);return void 0!==o&&(_.className=o),h&&h.appendChild(_),_}function lt(p,o,h){const _=d.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(o))_.setAttributeNS(null,x,o[x]);return h&&h.appendChild(_),_}Me.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $t=d.window.document&&d.window.document.documentElement.style,tt=$t&&void 0!==$t.userSelect?"userSelect":"WebkitUserSelect";let Mt;function vt(){$t&&tt&&(Mt=$t[tt],$t[tt]="none")}function _t(){$t&&tt&&($t[tt]=Mt)}function le(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",le,!0)}function Be(){d.window.addEventListener("click",le,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",le,!0)},0)}function je(p,o){const h=p.getBoundingClientRect();return Xe(p,h,o)}function Le(p,o){const h=p.getBoundingClientRect(),_=[];for(let x=0;x<o.length;x++)_.push(Xe(p,h,o[x]));return _}function xe(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Xe(p,o,h){const _=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new d.pointGeometry((h.clientX-o.left)*_,(h.clientY-o.top)*_)}function st(p,o){var h=o[0],_=o[1],x=o[2],w=o[3],T=h*w-x*_;return T?(p[0]=w*(T=1/T),p[1]=-_*T,p[2]=-x*T,p[3]=h*T,p):null}function He(p){const{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class zt extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,h){this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,h){if(!o)return!0;let _=0;for(const x of o){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(o,h){return!(o&&(4!==o.length||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let _=!0;if(!this.isLoaded())for(const x of o)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const _={};for(const x of o){this.images[x]||this.fire(new d.Event("styleimagemissing",{id:x}));const w=this.images[x];w?_[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:d.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],_=this.getImage(o);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new d.ImagePosition(x,_);this.patterns[o]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const w in this.patterns)o.push(this.patterns[w].bin);const{w:h,h:_}=d.potpack(o),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const w in this.patterns){const{bin:T}=this.patterns[w],S=T.x+1,A=T.y+1,R=this.images[w].data,L=R.width,N=R.height;d.RGBAImage.copy(R,x,{x:0,y:0},{x:S,y:A},{width:L,height:N}),d.RGBAImage.copy(R,x,{x:0,y:N-1},{x:S,y:A-1},{width:L,height:1}),d.RGBAImage.copy(R,x,{x:0,y:0},{x:S,y:A+N},{width:L,height:1}),d.RGBAImage.copy(R,x,{x:L-1,y:0},{x:S-1,y:A},{width:1,height:N}),d.RGBAImage.copy(R,x,{x:0,y:0},{x:S+L,y:A},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];He(_)&&this.updateImage(h,_)}}}const tn=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,o){return function([h,_,x]){const w=d.degToRad(_+90),T=d.degToRad(x);return{x:h*Math.cos(w)*Math.sin(T),y:h*Math.sin(w)*Math.sin(T),z:h*Math.cos(T),azimuthal:_,polar:x}}(p.expression.evaluate(o))}interpolate(p,o,h){return{x:d.number(p.x,o.x,h),y:d.number(p.y,o.y,h),z:d.number(p.z,o.z,h),azimuthal:d.number(p.azimuthal,o.azimuthal,h),polar:d.number(p.polar,o.polar,h)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Wt="-transition";class It extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(tn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(d.validateLight,o,h))for(const _ in o){const x=o[_];d.endsWith(_,Wt)?this._transitionable.setTransition(_.slice(0,-Wt.length),x):this._transitionable.setValue(_,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,_){return(!_||!1!==_.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Pt=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),nn="-transition";class Rt extends d.Evented{constructor(o,h){super(),this._transitionable=new d.Transitionable(Pt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(o){for(const h in o){const _=o[h];d.endsWith(h,nn)?this._transitionable.setTransition(h.slice(0,-nn.length),_):this._transitionable.setValue(h,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function mn(p,o,h,_){const x=d.smoothstep(45,65,h),[w,T]=yn(p,_),S=d.length(o);let A=1-Math.min(1,Math.exp((S-w)/(T-w)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*x*p.alpha}function yn(p,o){const h=.5/Math.tan(.5*o);return[p.range[0]+h,p.range[1]+h]}const Jt=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"high-color":new d.DataConstantProperty(d.spec.fog["high-color"]),"space-color":new d.DataConstantProperty(d.spec.fog["space-color"]),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"]),"star-intensity":new d.DataConstantProperty(d.spec.fog["star-intensity"])}),Lr="-transition";class On extends d.Evented{constructor(o,h){super(),this._transitionable=new d.Transitionable(Jt),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const o=this._transform,h="globe"===o.projection.name,_=d.globeToMercatorTransition(o.zoom),x=this.properties.get("range"),w=[.5,3];return{range:h?[d.number(w[0],x[0],_),d.number(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h={}){if(!this._validate(d.validateFog,o,h)){for(const _ of Object.keys(d.spec.fog))o&&void 0===o[_]&&(o[_]=d.spec.fog[_].default);for(const _ in o){const x=o[_];d.endsWith(_,Lr)?this._transitionable.setTransition(_.slice(0,-Lr.length),x):this._transitionable.setValue(_,x)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.smoothstep(45,65,o))*h.a}getOpacityAtLatLng(o,h){return this._transform.projection.supportsFog?function(_,x,w){const T=d.MercatorCoordinate.fromLngLat(x),S=w.elevation?w.elevation.getAtPointOrZero(T):0,A=[T.x,T.y,S];return d.transformMat4(A,A,w.mercatorFogMatrix),mn(_,A,w.pitch,w._fov)}(this.state,o,h):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?yn(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,_){return(!_||!1!==_.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class lr{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const w=new lr.Actor(_[x],h,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,h,_){d.asyncAll(this.actors,(x,w)=>{x.send(o,h,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function di(p,o,h){return o*(d.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}lr.Actor=d.Actor;class Wn{constructor(o,h,_,x){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(o,h){let _,x;if(o instanceof d.pointGeometry||"number"==typeof o[0]){const w=d.pointGeometry.convert(o);_=[d.pointGeometry.convert(o)],x=h.isPointAboveHorizon(w)}else{const w=d.pointGeometry.convert(o[0]),T=d.pointGeometry.convert(o[1]);_=[w,T],x=d.polygonizeBounds(w,T).every(S=>h.isPointAboveHorizon(S))}return new Wn(_,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],x=d.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),d.bufferConvexPolygon(x,o)}bufferedCameraGeometryGlobe(o){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],x=d.polygonizeBounds(h,_,o),w=this.cameraPoint.clone();switch(3*((w.y>h.y)+(w.y>_.y))+((w.x>h.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(o,h,_,x=0){const w=o.queryPadding/h._projectionScaler+1,T=_?this._bufferedCameraMercator(w,h):this._bufferedScreenMercator(w,h);let S=o.tileID.wrap+(T.unwrapped?x:0);const A=T.polygon.map(ie=>d.getTilePoint(o.tileTransform,ie,S));if(!d.polygonIntersectsBox(A,0,0,d.EXTENT,d.EXTENT))return;S=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const R=this.screenGeometryMercator.polygon.map(ie=>d.getTileVec3(o.tileTransform,ie,S)),L=R.map(ie=>new d.pointGeometry(ie[0],ie[1])),N=h.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),H=d.getTileVec3(o.tileTransform,N,S),Z=R.map(ie=>{const Y=d.sub(ie,ie,H);return d.normalize(Y,Y),new d.Ray(H,Y)}),K=di(o,1,h.zoom)*h._projectionScaler;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:Z,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(q=d.getBounds(A),q.min.x=d.clamp(q.min.x,0,d.EXTENT),q.min.y=d.clamp(q.min.y,0,d.EXTENT),q.max.x=d.clamp(q.max.x,0,d.EXTENT),q.max.y=d.clamp(q.max.y,0,d.EXTENT),q),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:K};var q}_bufferedScreenMercator(o,h){const _=nr(o);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(o),h):{polygon:this.bufferedScreenGeometry(o).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(o,h){const _=nr(o);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),h):{polygon:this.bufferedCameraGeometry(o).map(w=>h.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(o,h){const _=function(w,T){const S=d.multiply([],T.pixelMatrix,T.globeMatrix),A=[0,-d.GLOBE_RADIUS,0,1],R=[0,d.GLOBE_RADIUS,0,1],L=[0,0,0,1];d.transformMat4$1(A,A,S),d.transformMat4$1(R,R,S),d.transformMat4$1(L,L,S);const N=new d.pointGeometry(A[0]/A[3],A[1]/A[3]),H=new d.pointGeometry(R[0]/R[3],R[1]/R[3]),Z=d.polygonContainsPoint(w,N)&&A[3]<L[3],K=d.polygonContainsPoint(w,H)&&R[3]<L[3];if(!Z&&!K)return null;const q=function(fe,ke,Ve){for(let Re=1;Re<fe.length;Re++){const ft=Yi(ke.pointCoordinate3D(fe[Re-1]).x),ae=Yi(ke.pointCoordinate3D(fe[Re]).x);if(Ve<0){if(ft<ae)return{idx:Re,t:-ft/(ae-1-ft)}}else if(ae<ft)return{idx:Re,t:(1-ft)/(ae+1-ft)}}return null}(w,T,Z?-1:1);if(!q)return null;const{idx:ie,t:Y}=q;let Q=ie>1?Xi(w.slice(0,ie),T):[],X=ie<w.length?Xi(w.slice(ie),T):[];Q=Q.map(fe=>new d.pointGeometry(Yi(fe.x),fe.y)),X=X.map(fe=>new d.pointGeometry(Yi(fe.x),fe.y));const ue=[...Q];0===ue.length&&ue.push(X[X.length-1]);const ne=d.number(ue[ue.length-1].y,(0===X.length?Q[0]:X[0]).y,Y);let oe;return oe=Z?[new d.pointGeometry(0,ne),new d.pointGeometry(0,0),new d.pointGeometry(1,0),new d.pointGeometry(1,ne)]:[new d.pointGeometry(1,ne),new d.pointGeometry(1,1),new d.pointGeometry(0,1),new d.pointGeometry(0,ne)],ue.push(...oe),0===X.length?ue.push(Q[0]):ue.push(...X),{polygon:ue.map(fe=>new d.MercatorCoordinate(fe.x,fe.y)),unwrapped:!1}}(o,h);if(_)return _;const x=function(w,T){let S=!1,A=-1/0,R=0;for(let N=0;N<w.length-1;N++)w[N].x>A&&(A=w[N].x,R=N);for(let N=0;N<w.length-1;N++){const H=(R+N)%(w.length-1),Z=w[H],K=w[H+1];Math.abs(Z.x-K.x)>.5&&(Z.x<K.x?(Z.x+=1,0===H&&(w[w.length-1].x+=1)):(K.x+=1,H+1===w.length-1&&(w[0].x+=1)),S=!0)}const L=d.mercatorXfromLng(T.center.lng);return S&&L<Math.abs(L-1)&&w.forEach(N=>{N.x-=1}),{polygon:w,unwrapped:S}}(Xi(o,h).map(w=>new d.pointGeometry(Yi(w.x),w.y)),h);return{polygon:x.polygon.map(w=>new d.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function Xi(p,o){return d.resample(p,h=>{const _=o.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Yi(p){return p<0?1+p%1:p%1}function nr(p){return 100*p|0}function cn(p,o,h,_,x){const w=function(T,S){if(T)return x(T);if(S){const A=d.pick(d.extend(S,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(A.vectorLayers=S.vector_layers,A.vectorLayerIds=A.vectorLayers.map(R=>R.id)),S.language_options&&(A.languageOptions=S.language_options),S.language&&S.language[S.id]&&(A.language=S.language[S.id]),S.worldview_options&&(A.worldviewOptions=S.worldview_options),S.worldview?A.worldview=S.worldview[S.id]:S.worldview_default&&(A.worldview=S.worldview_default),A.tiles=o.canonicalizeTileset(A,p.url),x(null,A)}};return p.url?d.getJSON(o.transformRequest(o.normalizeSourceURL(p.url,null,h,_),d.ResourceType.Source),w):d.exported.frame(()=>w(null,p))}class Gr{constructor(o,h,_){this.bounds=d.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),_=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*h),w=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=_&&o.x<w&&o.y>=x&&o.y<T}}class Mn{constructor(o,h,_){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const io={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mc{constructor(o,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=o;const w=o.gl;this.buffer=w.createBuffer(),o.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];void 0!==x&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,h,_){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],T=h.attributes[w.name];void 0!==T&&o.vertexAttribPointer(T,w.components,o[io[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wa extends rr{getDefault(){return d.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class gc extends rr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class pa extends rr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Os extends rr{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _c extends rr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class or extends rr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class ma extends rr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Xa extends rr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ws extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class wl extends rr{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class mu extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Fh extends rr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class zh extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Ni extends rr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Xs extends rr{getDefault(){return d.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class yc extends rr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Nh extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class ys extends rr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class ga extends rr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class nf extends rr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Bh extends rr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Vh extends rr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Uh extends rr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class jh extends rr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class vc extends rr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class gu extends rr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class $h extends rr{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _a extends rr{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ys extends rr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class xc extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class _u extends rr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class To extends rr{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class bc extends To{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class te extends To{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class B extends te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ${constructor(o,h,_,x){this.context=o,this.width=h,this.height=_;const w=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new bc(o,w),x&&(this.depthAttachment=new te(o,w))}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class ee{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Wa(this),this.clearDepth=new gc(this),this.clearStencil=new pa(this),this.colorMask=new Os(this),this.depthMask=new _c(this),this.stencilMask=new or(this),this.stencilFunc=new ma(this),this.stencilOp=new Xa(this),this.stencilTest=new Ws(this),this.depthRange=new wl(this),this.depthTest=new mu(this),this.depthFunc=new Fh(this),this.blend=new zh(this),this.blendFunc=new Ni(this),this.blendColor=new Xs(this),this.blendEquation=new yc(this),this.cullFace=new Nh(this),this.cullFaceSide=new ys(this),this.frontFace=new ga(this),this.program=new nf(this),this.activeTexture=new Bh(this),this.viewport=new Vh(this),this.bindFramebuffer=new Uh(this),this.bindRenderbuffer=new jh(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new gu(this),this.bindElementBuffer=new $h(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _a(this),this.pixelStoreUnpack=new Ys(this),this.pixelStoreUnpackPremultiplyAlpha=new xc(this),this.pixelStoreUnpackFlipY=new _u(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Mn(this,o,h)}createVertexBuffer(o,h,_){return new mc(this,o,h,_)}createRenderbuffer(o,h,_){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,o,h,_),this.bindRenderbuffer.set(null),w}createFramebuffer(o,h,_){return new $(this,o,h,_)}clear({color:o,depth:h,stencil:_}){const x=this.gl;let w=0;o&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(w)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){W(o.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class se extends d.Evented{constructor(o,h,_,x){super(),this.id=o,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=cn(this._options,this.map._requestManager,null,null,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):h&&(d.extend(this,h),h.bounds&&(this.tileBounds=new Gr(h.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(h.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const _=d.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(x,d.ResourceType.Tile),(w,T,S,A)=>(delete o.request,o.aborted?(o.state="unloaded",h(null)):w?(o.state="errored",h(w)):T?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:S,expires:A}),o.setTexture(T,this.map.painter),o.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(o,h,_){o.setTexture(h,_)}static unloadTileData(o,h){o.texture&&h.saveTileTexture(o.texture)}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let ge;function Ee(p,o,h,_,x,w,T,S){const A=[p,h,x,o,_,w,1,1,1],R=[T,S,1],L=d.adjoint([],A),[N,H,Z]=d.transformMat3(R,R,d.transpose(L,L));return d.multiply$1(A,[N,0,0,0,H,0,0,0,Z],A)}class Ce extends d.Evented{constructor(o,h,_,x){super(),this.id=o,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(o,h){this._loaded=h||!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(_,x)=>{if(this._loaded=!0,_)this.fire(new d.ErrorEvent(_));else if(x){const{HTMLImageElement:w}=d.window;this.image=x instanceof w?d.exported.getImageData(x):x,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const h=o.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,w=1/0,T=-1/0,S=-1/0;for(const N of _)x=Math.min(x,N.x),w=Math.min(w,N.y),T=Math.max(T,N.x),S=Math.max(S,N.y);const A=Math.max(T-x,S-w),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),L=Math.pow(2,R);return new d.CanonicalTileID(R,Math.floor((x+T)/2*L),Math.floor((w+S)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const A in this.tiles){const R=this.tiles[A];"loaded"!==R.state&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const h=d.tileTransform(this.tileID,this.map.transform.projection),[_,x,w,T]=this.coordinates.map(A=>{const R=h.projection.project(A[0],A[1]);return d.getTilePoint(h,R)._round()});this.perspectiveTransform=function(A,R,L,N,H,Z,K,q,ie,Y){const Q=Ee(0,0,A,0,0,R,A,R),X=Ee(L,N,H,Z,K,q,ie,Y);return d.multiply$1(X,d.adjoint(Q,Q),X),[X[6]/X[8]*A/d.EXTENT,X[7]/X[8]*R/d.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,T.x,T.y,w.x,w.y);const S=this._boundsArray=new d.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(x.x,x.y,d.EXTENT,0),S.emplaceBack(T.x,T.y,0,d.EXTENT),S.emplaceBack(w.x,w.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(S,d.boundsAttributes.members),this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,h=o.gl;this.texture?this.texture.update(this.image):(this.texture=new d.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:class extends d.Evented{constructor(p,o,h,_){if(super(),this.id=p,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(o,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(p){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"}));const o=this.language||this.map._language,h=this.worldview||this.map._worldview;this._tileJSONRequest=cn(this._options,this.map._requestManager,o,h,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${o}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new d.ErrorEvent(_))):x&&(d.extend(this,x),x.bounds&&(this.tileBounds=new Gr(x.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(_)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const o=this.map.style._getSourceCaches(this.id);for(const h of o)h.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,o){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=o:p.request=p.actor.send("reloadTile",_,x.bind(this));else if(p.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const w=d.loadVectorTile.call({deduped:this._deduped},_,(T,S)=>{T||!S?x.call(this,T):(_.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},p.actor&&p.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);p.request={cancel:w}}function x(w,T){return delete p.request,p.aborted?o(null):w&&404!==w.status?o(w):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:se,"raster-dem":class extends se{constructor(p,o,h,_){super(p,o,h,_),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(p.state="errored",o(x)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=d.getImage(this.map._requestManager.transformRequest(h,d.ResourceType.Tile),function(x,w,T,S){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(x)p.state="errored",o(x);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:S});const A=d.window.ImageBitmap&&w instanceof d.window.ImageBitmap&&(null==ge&&(ge=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),ge),R=1-(w.width-d.prevPowerOfTwo(w.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=A?w:d.exported.getImageData(w,R),N={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const o=p.canonical,h=Math.pow(2,o.z),_=(o.x-1+h)%h,x=0===o.x?p.wrap-1:p.wrap,w=(o.x+1+h)%h,T=o.x+1===h?p.wrap+1:p.wrap,S={};return S[new d.OverscaledTileID(p.overscaledZ,x,o.z,_,o.y).key]={backfilled:!1},S[new d.OverscaledTileID(p.overscaledZ,T,o.z,w,o.y).key]={backfilled:!1},o.y>0&&(S[new d.OverscaledTileID(p.overscaledZ,x,o.z,_,o.y-1).key]={backfilled:!1},S[new d.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},S[new d.OverscaledTileID(p.overscaledZ,T,o.z,w,o.y-1).key]={backfilled:!1}),o.y+1<h&&(S[new d.OverscaledTileID(p.overscaledZ,x,o.z,_,o.y+1).key]={backfilled:!1},S[new d.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},S[new d.OverscaledTileID(p.overscaledZ,T,o.z,w,o.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,o,h,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=o.data,this._options=d.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const x=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*x,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*x,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*x,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},o),this}getClusterLeaves(p,o,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:o,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),o=this._data;"string"==typeof o?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(o),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new d.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new d.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,o){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete p.request,p.unloadVectorData(),p.aborted?o(null):_?o(_):(p.loadVectorData(x,this.map.painter,"reloadTile"===h),o(null))),void 0,"loadTile"===h)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ce{constructor(p,o,h,_){super(p,o,h,_),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,d.ResourceType.Source).url);d.getVideo(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ce,canvas:class extends Ce{constructor(p,o,h,_){super(p,o,h,_),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(w=>"number"!=typeof w))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends d.Evented{constructor(p,o,h,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=o,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Gr(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),d.extend(this,d.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:o,y:h,z:_}=p.canonical;return this._implementation.hasTile({x:o,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){const{x:h,y:_,z:x}=p.tileID.canonical,w=new d.window.AbortController,T=this._implementation.loadTile({x:h,y:_,z:x},{signal:w.signal});if(!T)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null);T.cancel=()=>w.abort(),p.request=T.then(function(S){return delete p.request,p.aborted?(p.state="unloaded",o(null)):S?(A=S)instanceof d.window.ImageData||A instanceof d.window.ImageBitmap||A instanceof d.window.HTMLCanvasElement?(this.loadTileData(p,S),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null));var A}.bind(this)).catch(S=>{20!==S.code&&(p.state="errored",o(S))})}loadTileData(p,o){se.loadTileData(p,o,this._map.painter)}unloadTileData(p){se.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:o,y:h,z:_}=p.tileID.canonical,x=this._implementation.prepareTile({x:o,y:h,z:_});return x?(this.loadTileData(p,x),p.state="loaded",x):null}unloadTile(p,o){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:h,y:_,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Se=function(p,o,h,_){const x=new ye[o.type](p,o,h,_);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],x),x};function it(p,o){const h=d.identity([]);return d.scale(h,h,[.5*p.width,.5*-p.height,1]),d.translate(h,h,[1,-1,0]),d.multiply(h,h,p.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(h)}function gt(p,o,h,_,x,w,T,S=!1){const A=p.tilesIn(_,T,S);A.sort(Zt);const R=[];for(const N of A)R.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(o,h,p._state,N,x,w,it(p.transform,N.tile.tileID),S)});const L=function(N){const H={},Z={};for(const K of N){const q=K.queryResults,ie=K.wrappedTileID,Y=Z[ie]=Z[ie]||{};for(const Q in q){const X=q[Q],ue=Y[Q]=Y[Q]||{},ne=H[Q]=H[Q]||[];for(const oe of X)ue[oe.featureIndex]||(ue[oe.featureIndex]=!0,ne.push(oe))}}return H}(R);for(const N in L)L[N].forEach(H=>{const Z=H.feature,K=Z.layer;K&&"background"!==K.type&&"sky"!==K.type&&(Z.source=K.source,K["source-layer"]&&(Z.sourceLayer=K["source-layer"]),Z.state=void 0!==Z.id?p.getFeatureState(K["source-layer"],Z.id):{})});return L}function ot(p,o){const h=p.getRenderableIds().map(w=>p.getTileByID(w)),_=[],x={};for(let w=0;w<h.length;w++){const T=h[w],S=T.tileID.canonical.key;x[S]||(x[S]=!0,T.querySourceFeatures(_,o))}return _}function Zt(p,o){const h=p.tileID,_=o.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function un(){return null!=Vl.workerClass?new Vl.workerClass:new d.window.Worker(Vl.workerUrl)}const rn="mapboxgl_preloaded_worker_pool";class fn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<fn.workerCount;)this.workers.push(new un);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rn]}numActive(){return Object.keys(this.active).length}}let Rn;function cr(){return Rn||(Rn=new fn),Rn}function vr(p,o){const h={};for(const _ in p)"ref"!==_&&(h[_]=p[_]);return d.refProperties.forEach(_=>{_ in o&&(h[_]=o[_])}),h}function mr(p){p=p.slice();const o=Object.create(null);for(let h=0;h<p.length;h++)o[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=vr(p[h],o[p[h].ref]));return p}fn.workerCount=2;const we={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Uo(p,o,h){h.push({command:we.addSource,args:[p,o[p]]})}function ei(p,o,h){o.push({command:we.removeSource,args:[p]}),h[p]=!0}function vs(p,o,h,_){ei(p,h,_),Uo(p,o,h)}function ug(p,o,h){let _;for(_ in p[h])if(p[h].hasOwnProperty(_)&&"data"!==_&&!W(p[h][_],o[h][_]))return!1;for(_ in o[h])if(o[h].hasOwnProperty(_)&&"data"!==_&&!W(p[h][_],o[h][_]))return!1;return!0}function Qo(p,o,h,_,x,w){let T;for(T in o=o||{},p=p||{})p.hasOwnProperty(T)&&(W(p[T],o[T])||h.push({command:w,args:[_,T,o[T],x]}));for(T in o)o.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(W(p[T],o[T])||h.push({command:w,args:[_,T,o[T],x]}))}function yu(p){return p.id}function Sp(p,o){return p[o.id]=o,p}class vu{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=d.clamp(o,0,1);let h=1,_=this._distances[h];const x=o*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const w=h-1,T=this._distances[w],S=_-T,A=S>0?(x-T)/S:0;return this.points[w].mult(1-A).add(this.points[h].mult(A))}}class mt{constructor(o,h,_){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(h/_);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,_,x,w){this._forEachCell(h,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(o,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(o,h,_,x,w,T){this.boxCells[w].push(T)}_insertCircleCell(o,h,_,x,w,T){this.circleCells[w].push(T)}_query(o,h,_,x,w,T){if(_<0||o>this.width||x<0||h>this.height)return!w&&[];const S=[];if(o<=0&&h<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],L=this.circles[3*A+1],N=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:R-N,y1:L-N,x2:R+N,y2:L+N})}return T?S.filter(T):S}return this._forEachCell(o,h,_,x,this._queryCell,S,{hitTest:w,seenUids:{box:{},circle:{}}},T),w?S.length>0:S}_queryCircle(o,h,_,x,w){const T=o-_,S=o+_,A=h-_,R=h+_;if(S<0||T>this.width||R<0||A>this.height)return!x&&[];const L=[];return this._forEachCell(T,A,S,R,this._queryCellCircle,L,{hitTest:x,circle:{x:o,y:h,radius:_},seenUids:{box:{},circle:{}}},w),x?L.length>0:L}query(o,h,_,x,w){return this._query(o,h,_,x,!1,w)}hitTest(o,h,_,x,w){return this._query(o,h,_,x,!0,w)}hitTestCircle(o,h,_,x){return this._queryCircle(o,h,_,!0,x)}_queryCell(o,h,_,x,w,T,S,A){const R=S.seenUids,L=this.boxCells[w];if(null!==L){const H=this.bboxes;for(const Z of L)if(!R.box[Z]){R.box[Z]=!0;const K=4*Z;if(o<=H[K+2]&&h<=H[K+3]&&_>=H[K+0]&&x>=H[K+1]&&(!A||A(this.boxKeys[Z]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:H[K],y1:H[K+1],x2:H[K+2],y2:H[K+3]})}}}const N=this.circleCells[w];if(null!==N){const H=this.circles;for(const Z of N)if(!R.circle[Z]){R.circle[Z]=!0;const K=3*Z;if(this._circleAndRectCollide(H[K],H[K+1],H[K+2],o,h,_,x)&&(!A||A(this.circleKeys[Z]))){if(S.hitTest)return T.push(!0),!0;{const q=H[K],ie=H[K+1],Y=H[K+2];T.push({key:this.circleKeys[Z],x1:q-Y,y1:ie-Y,x2:q+Y,y2:ie+Y})}}}}}_queryCellCircle(o,h,_,x,w,T,S,A){const R=S.circle,L=S.seenUids,N=this.boxCells[w];if(null!==N){const Z=this.bboxes;for(const K of N)if(!L.box[K]){L.box[K]=!0;const q=4*K;if(this._circleAndRectCollide(R.x,R.y,R.radius,Z[q+0],Z[q+1],Z[q+2],Z[q+3])&&(!A||A(this.boxKeys[K])))return T.push(!0),!0}}const H=this.circleCells[w];if(null!==H){const Z=this.circles;for(const K of H)if(!L.circle[K]){L.circle[K]=!0;const q=3*K;if(this._circlesCollide(Z[q],Z[q+1],Z[q+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(o,h,_,x,w,T,S,A){const R=this._convertToXCellCoord(o),L=this._convertToYCellCoord(h),N=this._convertToXCellCoord(_),H=this._convertToYCellCoord(x);for(let Z=R;Z<=N;Z++)for(let K=L;K<=H;K++)if(w.call(this,o,h,_,x,this.xCellCount*K+Z,T,S,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,_,x,w,T){const S=x-o,A=w-h,R=_+T;return R*R>S*S+A*A}_circleAndRectCollide(o,h,_,x,w,T,S){const A=(T-x)/2,R=Math.abs(o-(x+A));if(R>A+_)return!1;const L=(S-w)/2,N=Math.abs(h-(w+L));if(N>L+_)return!1;if(R<=A||N<=L)return!0;const H=R-A,Z=N-L;return H*H+Z*Z<=_*_}}const tr=Math.tan(85*Math.PI/180);function bn(p,o,h,_,x,w,T){const S=d.create();if(h)if("globe"===w.name){const A=d.calculateGlobeLabelMatrix(x,o);d.multiply(S,S,A)}else{const A=st([],T);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],_||d.rotateZ(S,S,x.angle)}else d.multiply(S,x.labelPlaneMatrix,p);return S}function ks(p,o,h,_,x,w,T){const S=bn(p,o,h,_,x,w,T);return"globe"===w.name&&h||(S[2]=S[6]=S[10]=S[14]=0),S}function ya(p,o,h,_,x,w,T){if(h){if("globe"===w.name){const S=bn(p,o,h,_,x,w,T);return d.invert(S,S),d.multiply(S,p,S),S}{const S=d.clone(p),A=d.identity([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],d.multiply(S,S,A),_||d.rotateZ(S,S,-x.angle),S}}return x.glCoordMatrix}function Ht(p,o,h=0){const _=[p.x,p.y,h,1];h?d.transformMat4$1(_,_,o):fi(_,_,o);const x=_[3];return{point:[_[0]/x,_[1]/x,_[2]/x],signedDistanceFromCamera:x}}function Rs(p,o){const h=[p[0],p[1],p[2],1];d.transformMat4$1(h,h,o);const _=h[3];return{point:[h[0]/_,h[1]/_,h[2]/_],signedDistanceFromCamera:_}}function Mr(p,o){return Math.min(.5+p/o*.5,1.5)}function Cl(p,o){const h=p[0]/p[3],_=p[1]/p[3];return h>=-o[0]&&h<=o[0]&&_>=-o[1]&&_<=o[1]}function xs(p,o,h,_,x,w,T,S,A,R){const L=h.transform,N=_?p.textSizeData:p.iconSizeData,H=d.evaluateSizeForZoom(N,h.transform.zoom),Z="globe"===L.projection.name,K=[256/h.width*2+1,256/h.height*2+1],q=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();let ie=null;Z&&(ie=_?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const Y=p.lineVertexArray,Q=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,X=h.transform.width/h.transform.height;let ue=!1;for(let ne=0;ne<Q.length;ne++){const oe=Q.get(ne);if(oe.writingMode!==d.WritingMode.vertical||ue||0!==ne&&Q.get(ne-1).writingMode===d.WritingMode.horizontal||(ue=!0),(oe.hidden||oe.writingMode===d.WritingMode.vertical)&&!ue){Tn(oe.numGlyphs,q);continue}ue=!1;const fe=new d.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),ke=A?A(fe):[0,0,0],Ve=L.projection.projectTilePoint(fe.x,fe.y,R.canonical),Re=[Ve.x+ke[0],Ve.y+ke[1],Ve.z+ke[2]],ft=[...Re,1];if(d.transformMat4$1(ft,ft,o),!Cl(ft,K)){Tn(oe.numGlyphs,q);continue}const ae=Mr(h.transform.cameraToCenterDistance,ft[3]),Ie=d.evaluateSizeForFeature(N,H,oe),Ke=T?Ie/ae:Ie*ae,Dt=Ht(new d.pointGeometry(Re[0],Re[1]),x,Re[2]);if(Dt.signedDistanceFromCamera<=0){Tn(oe.numGlyphs,q);continue}let Ye={};const Vt=T?null:A,xt=Ya(oe,Ke,!1,S,o,x,w,p.glyphOffsetArray,Y,q,ie,Dt.point,fe,Ye,X,Vt,L.projection,R,T);ue=xt.useVertical,Vt&&xt.needsFlipping&&(Ye={}),(xt.notEnoughRoom||ue||xt.needsFlipping&&Ya(oe,Ke,!0,S,o,x,w,p.glyphOffsetArray,Y,q,ie,Dt.point,fe,Ye,X,Vt,L.projection,R,T).notEnoughRoom)&&Tn(oe.numGlyphs,q)}_?(p.text.dynamicLayoutVertexBuffer.updateData(q),ie&&p.text.globeExtVertexBuffer.updateData(ie)):(p.icon.dynamicLayoutVertexBuffer.updateData(q),ie&&p.icon.globeExtVertexBuffer.updateData(ie))}function En(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q){const ie=S.glyphStartIndex+S.numGlyphs,Y=S.lineStartIndex,Q=S.lineStartIndex+S.lineLength,X=o.getoffsetX(S.glyphStartIndex),ue=o.getoffsetX(ie-1),ne=va(p*X,h,_,x,w,T,S.segment,Y,Q,A,R,L,N,H,!0,Z,K,q);if(!ne)return null;const oe=va(p*ue,h,_,x,w,T,S.segment,Y,Q,A,R,L,N,H,!0,Z,K,q);return oe?{first:ne,last:oe}:null}function Pn(p,o,h,_){return p.writingMode===d.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*_?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?o.y<h.y?{needsFlipping:!0}:null:0!==p.flipState&&function(x,w,T){const S=(w.x-x.x)*T;return 0===S||Math.abs((w.y-x.y)/S)>tr}(o,h,_)?1===p.flipState?{needsFlipping:!0}:null:o.x>h.x?{needsFlipping:!0}:null}function Ya(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q,ie,Y,Q){const X=o/24,ue=p.lineOffsetX*X,ne=p.lineOffsetY*X;let oe;if(p.numGlyphs>1){const fe=p.glyphStartIndex+p.numGlyphs,ke=p.lineStartIndex,Ve=p.lineStartIndex+p.lineLength,Re=En(X,S,ue,ne,h,N,H,p,A,w,Z,q,!1,ie,Y,Q);if(!Re)return{notEnoughRoom:!0};const ft=Rs(Re.first.point,T).point,ae=Rs(Re.last.point,T).point,Ie=new d.pointGeometry(ft[0],ft[1]),Ke=new d.pointGeometry(ae[0],ae[1]);if(_&&!h){const Dt=Pn(p,Ie,Ke,K);if(p.flipState=Dt&&Dt.needsFlipping?1:2,Dt)return Dt}oe=[Re.first];for(let Dt=p.glyphStartIndex+1;Dt<fe-1;Dt++)oe.push(va(X*S.getoffsetX(Dt),ue,ne,h,N,H,p.segment,ke,Ve,A,w,Z,q,!1,!1,ie,Y,Q));oe.push(Re.last)}else{if(_&&!h){const ke=Ht(H,x).point,Ve=p.lineStartIndex+p.segment+1,Re=new d.pointGeometry(A.getx(Ve),A.gety(Ve)),ft=Ht(Re,x),ae=ft.signedDistanceFromCamera>0?ft.point:Fn(H,Re,ke,1,x,void 0,ie,Y.canonical),Ie=Pn(p,new d.pointGeometry(ke[0],ke[1]),new d.pointGeometry(ae[0],ae[1]),K);if(p.flipState=Ie&&Ie.needsFlipping?1:2,Ie)return Ie}const fe=va(X*S.getoffsetX(p.glyphStartIndex),ue,ne,h,N,H,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,w,Z,q,!1,!1,ie,Y,Q);if(!fe)return{notEnoughRoom:!0};oe=[fe]}if(L)for(const fe of oe)d.updateGlobeVertexNormal(L,R.length+0,fe.up[0],fe.up[1],fe.up[2]),d.updateGlobeVertexNormal(L,R.length+1,fe.up[0],fe.up[1],fe.up[2]),d.updateGlobeVertexNormal(L,R.length+2,fe.up[0],fe.up[1],fe.up[2]),d.updateGlobeVertexNormal(L,R.length+3,fe.up[0],fe.up[1],fe.up[2]),d.addDynamicAttributes(R,fe.point[0],fe.point[1],fe.point[2],fe.angle);else for(const fe of oe)d.addDynamicAttributes(R,fe.point[0],fe.point[1],fe.point[2],fe.angle);return{}}function rf(p,o,h,_,x){const w=_.projectTilePoint(p.x,p.y,o);if(!x)return Ht(w,h,w.z);const T=x(p);return Ht(new d.pointGeometry(w.x+T[0],w.y+T[1]),h,w.z+T[2])}function Fn(p,o,h,_,x,w,T,S){const A=rf(p.add(p.sub(o)._unit()),S,x,T,w).point,R=d.sub([],h,A);return d.scaleAndAdd([],h,R,_/d.length(R))}function va(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q,ie,Y){const Q=_?p-o:p+o;let X=Q>0?1:-1,ue=0;_&&(X*=-1,ue=Math.PI),X<0&&(ue+=Math.PI);let ne=X>0?S+T:S+T+1,oe=x,fe=x,ke=0,Ve=0;const Re=Math.abs(Q),ft=[],ae=[];let Ie=w;const Ke=()=>{const qt=ne-X;return 0===ke?w:new d.pointGeometry(R.getx(qt),R.gety(qt))},Dt=()=>Fn(Ke(),Ie,fe,Re-ke+1,L,H,q,ie.canonical);for(;ke+Ve<=Re;){if(ne+=X,ne<S||ne>=A)return null;if(fe=oe,ft.push(oe),Z&&ae.push(Ie||Ke()),oe=N[ne],void 0===oe){Ie=new d.pointGeometry(R.getx(ne),R.gety(ne));const qt=rf(Ie,ie.canonical,L,q,H);oe=qt.signedDistanceFromCamera>0?N[ne]=qt.point:Dt()}else Ie=null;ke+=Ve,Ve=d.distance(fe,oe)}Ie=Ie||new d.pointGeometry(R.getx(ne),R.gety(ne));const Ye=Ke();K&&H&&(N[ne]=oe=void 0===N[ne]?oe:Dt(),Ve=d.distance(fe,oe));const Vt=(Re-ke)/Ve,xt=Ie.sub(Ye).mult(Vt)._add(Ye),Et=d.sub([],oe,fe),wt=d.scaleAndAdd([],fe,Et,Vt);let bt=[0,0,1],Lt=Et[0],sn=Et[1];if(Y&&(bt=q.upVector(ie.canonical,xt.x,xt.y),0!==bt[0]||0!==bt[1]||1!==bt[2])){const qt=[1,0,0],vn=[0,1,0];qt[0]=bt[2],qt[1]=0,qt[2]=-bt[0],d.cross(vn,bt,qt),d.normalize(qt,qt),d.normalize(vn,vn),Lt=d.dot(Et,qt),sn=d.dot(Et,vn)}if(h){const qt=d.cross([],bt,Et);d.normalize(qt,qt),d.scaleAndAdd(wt,wt,qt,h*X)}const Sn=ue+Math.atan2(sn,Lt);return ft.push(wt),Z&&ae.push(xt),{point:wt,angle:Sn,path:ft,tilePath:ae,up:bt}}const Vn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tn(p,o){for(let h=0;h<p;h++){const _=o.length;o.resize(_+4),o.float32.set(Vn,4*_)}}function fi(p,o,h){const _=o[0],x=o[1];return p[0]=h[0]*_+h[4]*x+h[12],p[1]=h[1]*_+h[5]*x+h[13],p[3]=h[3]*_+h[7]*x+h[15],p}const Ls=100;class of{constructor(o,h,_=new mt(o.width+200,o.height+200,25),x=new mt(o.width+200,o.height+200,25)){this.transform=o,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ls,this.screenBottomBoundary=o.height+Ls,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,_,x,w,T,S,A){let R=_.projectedAnchorX,L=_.projectedAnchorY,N=_.projectedAnchorZ;const H=_.elevation,Z=_.tileID;if(H&&Z){const ne=o.getProjection().upVector(Z.canonical,_.tileAnchorX,_.tileAnchorY),oe=o.getProjection().upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=ne[0]*H*oe,L+=ne[1]*H*oe,N+=ne[2]*H*oe}const K=this.projectAndGetPerspectiveRatio(S,[R,L,N],_.tileID,"globe"===o.projection.name||!!H||this.transform.pitch>0,o.getProjection()),q=T*K.perspectiveRatio,ie=(_.x1*h+x.x-_.padding)*q+K.point.x,Y=(_.y1*h+x.y-_.padding)*q+K.point.y,Q=(_.x2*h+x.x+_.padding)*q+K.point.x,X=(_.y2*h+x.y+_.padding)*q+K.point.y,ue=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(ie,Y,Q,X)||!w&&this.grid.hitTest(ie,Y,Q,X,A)||ue?{box:[],offscreen:!1,occluded:K.occluded}:{box:[ie,Y,Q,X],offscreen:this.isOffscreen(ie,Y,Q,X),occluded:!1}}placeCollisionCircles(o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q){const ie=[],Y=this.transform.elevation,Q=Y?Y.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,o.getProjection()):Ye=>[0,0,0],X=new d.pointGeometry(_.tileAnchorX,_.tileAnchorY),ue=o.getProjection().projectTilePoint(_.tileAnchorX,_.tileAnchorY,q.canonical),ne=Q(X),oe=[ue.x+ne[0],ue.y+ne[1],ue.z+ne[2]],fe="globe"===o.projection.name,ke=this.projectAndGetPerspectiveRatio(S,[oe[0],oe[1],oe[2]],q,fe||!!Y||this.transform.pitch>0,o.getProjection()),{perspectiveRatio:Ve}=ke,Re=(N?T/Ve:T*Ve)/d.ONE_EM,ft=Ht(new d.pointGeometry(oe[0],oe[1]),A,oe[2]).point,ae=ke.signedDistanceFromCamera>0?En(Re,w,_.lineOffsetX*Re,_.lineOffsetY*Re,!1,ft,X,_,x,A,{},Y&&!N?Q:null,N&&!!Y,o.getProjection(),q,N):null;let Ie=!1,Ke=!1,Dt=!0;if(ae&&!ke.occluded){const Ye=.5*Z*Ve+K,Vt=new d.pointGeometry(-100,-100),xt=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Et=new vu,wt=ae.first,bt=ae.last;let Lt=[];for(let qt=wt.path.length-1;qt>=1;qt--)Lt.push(wt.path[qt]);for(let qt=1;qt<bt.path.length;qt++)Lt.push(bt.path[qt]);const sn=2.5*Ye;if(R){const qt=Lt.map(Y&&!fe?(vn,hr)=>{const Ur=Q(hr<wt.path.length-1?wt.tilePath[wt.path.length-1-hr]:bt.tilePath[hr-wt.path.length+2]);return vn[2]=Ur[2],Rs(vn,R)}:vn=>Rs(vn,R));Lt=qt.some(vn=>vn.signedDistanceFromCamera<=0)?[]:qt.map(vn=>vn.point)}let Sn=[];if(Lt.length>0){const qt=Lt.map(Ar=>new d.pointGeometry(Ar[0],Ar[1]));let vn=1/0,hr=-1/0,Ur=1/0,qr=-1/0;for(let Ar=0;Ar<qt.length;Ar++)vn=Math.min(vn,qt[Ar].x),Ur=Math.min(Ur,qt[Ar].y),hr=Math.max(hr,qt[Ar].x),qr=Math.max(qr,qt[Ar].y);Sn=vn>=Vt.x&&hr<=xt.x&&Ur>=Vt.y&&qr<=xt.y?[qt]:hr<Vt.x||vn>xt.x||qr<Vt.y||Ur>xt.y?[]:d.clipLine([qt],Vt.x,Vt.y,xt.x,xt.y)}for(const qt of Sn){Et.reset(qt,.25*Ye);let vn=0;vn=Et.length<=.5*Ye?1:Math.ceil(Et.paddedLength/sn)+1;for(let hr=0;hr<vn;hr++){const Ur=hr/Math.max(vn-1,1),qr=Et.lerp(Ur),Ar=qr.x+Ls,jo=qr.y+Ls;ie.push(Ar,jo,Ye,0);const $i=Ar-Ye,Da=jo-Ye,Pr=Ar+Ye,Zr=jo+Ye;if(Dt=Dt&&this.isOffscreen($i,Da,Pr,Zr),Ke=Ke||this.isInsideGrid($i,Da,Pr,Zr),!h&&this.grid.hitTestCircle(Ar,jo,Ye,H)&&(Ie=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!L&&Ie||!Ke?[]:ie,offscreen:Dt,collisionDetected:Ie,occluded:ke.occluded}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,x=1/0,w=-1/0,T=-1/0;for(const L of o){const N=new d.pointGeometry(L.x+Ls,L.y+Ls);_=Math.min(_,N.x),x=Math.min(x,N.y),w=Math.max(w,N.x),T=Math.max(T,N.y),h.push(N)}const S=this.grid.query(_,x,w,T).concat(this.ignoredGrid.query(_,x,w,T)),A={},R={};for(const L of S){const N=L.key;if(void 0===A[N.bucketInstanceId]&&(A[N.bucketInstanceId]={}),A[N.bucketInstanceId][N.featureIndex])continue;const H=[new d.pointGeometry(L.x1,L.y1),new d.pointGeometry(L.x2,L.y1),new d.pointGeometry(L.x2,L.y2),new d.pointGeometry(L.x1,L.y2)];d.polygonIntersectsPolygon(h,H)&&(A[N.bucketInstanceId][N.featureIndex]=!0,void 0===R[N.bucketInstanceId]&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(o,h,_,x,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,_,x,w){const T=h?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let A=0;A<o.length;A+=4)T.insertCircle(S,o[A],o[A+1],o[A+2])}projectAndGetPerspectiveRatio(o,h,_,x,w){const T=[h[0],h[1],h[2],1];let S=!1;if(h[2]||this.transform.pitch>0){d.transformMat4$1(T,T,o);const A="globe"===w.name;this.fogState&&_&&!A&&(S=function(R,L,N,H,Z,K){const q=K.calculateFogTileMatrix(Z),ie=[L,N,H];return d.transformMat4(ie,ie,q),mn(R,ie,K.pitch,K._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)}else fi(T,T,o);return{point:new d.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+Ls,(-T[1]/T[3]+1)/2*this.transform.height+Ls),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:x&&T[2]>T[3]||S}}isOffscreen(o,h,_,x){return _<Ls||o>=this.screenRightBoundary||x<Ls||h>this.screenBottomBoundary}isInsideGrid(o,h,_,x){return _>=0&&o<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=d.identity([]);return d.translate(o,o,[-100,-100,0]),o}}function Bi(p,o,h){const _=o.createTileMatrix(p,p.worldSize,h.toUnwrapped());return d.multiply(new Float32Array(16),p.projMatrix,_)}function ai(p,o,h){if(o.projection.name===h.projection.name)return p.projMatrix;const _=h.clone();return _.setProjection(o.projection),Bi(_,o.getProjection(),p)}function sf(p,o,h){return o.name===h.projection.name?p.projMatrix:Bi(h,o,p)}class xu{constructor(o,h,_,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class pi{constructor(o,h,_,x,w,T=!1){this.text=new xu(o?o.text:null,h,_,w),this.icon=new xu(o?o.icon:null,h,x,w),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Do{constructor(o,h,_,x=!1){this.text=o,this.icon=h,this.skipFade=_,this.clipped=x}}class Ip{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class Gh{constructor(o,h,_,x,w){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class uo{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[o]}}function af(p,o,h,_,x){const{horizontalAlign:w,verticalAlign:T}=d.getAnchorAlignment(p),S=-(w-.5)*o,A=-(T-.5)*h,R=d.evaluateVariableOffset(p,_);return new d.pointGeometry(S+R[0]*x,A+R[1]*x)}function bu(p,o,h,_,x){const w=new d.pointGeometry(p,o);return h&&w._rotate(_?x:-x),w}class Ka{constructor(o,h,_,x,w){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new of(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new uo(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,_,x){const w=_.getBucket(h),T=_.latestFeatureIndex;if(!w||!T||h.id!==w.layerIds[0])return;const S=w.layers[0].layout,A=_.collisionBoxArray,R=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/d.EXTENT,N=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const H=(Z=_.tileID,K=w.getProjection(),q=this.transform,K.name===this.projection?q.calculateProjMatrix(Z.toUnwrapped()):Bi(q,K,Z));var Z,K,q;const ie="map"===S.get("text-pitch-alignment"),Y="map"===S.get("text-rotation-alignment");h.compileFilter();const Q=h.dynamicFilter(),X=h.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(_),ne=ks(H,_.tileID.canonical,ie,Y,this.transform,w.getProjection(),ue);let oe=null;if(ie){const Ve=ya(H,_.tileID.canonical,ie,Y,this.transform,w.getProjection(),ue);oe=d.multiply([],this.transform.labelPlaneMatrix,Ve)}let fe=null;Q&&_.latestFeatureIndex&&(fe={unwrappedTileID:N,dynamicFilter:Q,dynamicFilterNeedsFeature:X,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Gh(w.bucketInstanceId,T,w.sourceLayerIndex,w.index,_.tileID);const ke={bucket:w,layout:S,posMatrix:H,textLabelPlaneMatrix:ne,labelToScreenMatrix:oe,clippingData:fe,scale:R,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const Ve of w.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:ft,symbolInstanceEnd:ae}=Ve;o.push({sortKey:Re,symbolInstanceStart:ft,symbolInstanceEnd:ae,parameters:ke})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q,ie,Y,Q){const X=[H.textOffset0,H.textOffset1],ue=af(o,_,x,X,w),ne=this.collisionIndex.placeCollisionBox(K,w,h,bu(ue.x,ue.y,T,S,this.transform.angle),N,A,R,L.predicate);if((!ie||0!==this.collisionIndex.placeCollisionBox(K,K.getSymbolInstanceIconSize(Q,this.transform.zoom,Z),ie,bu(ue.x,ue.y,T,S,this.transform.angle),N,A,R,L.predicate).box.length)&&ne.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:X,width:_,height:x,anchor:o,textScale:w,prevAnchor:oe},this.markUsedJustification(K,o,H,q),K.allowVerticalPlacement&&(this.markUsedOrientation(K,q,H),this.placedOrientations[H.crossTileID]=q),{shift:ue,placedGlyphBoxes:ne}}}placeLayerBucketPart(o,h,_,x){const{bucket:w,layout:T,posMatrix:S,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:L,textPixelRatio:N,holdingForFade:H,collisionBoxArray:Z,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:q,collisionGroup:ie}=o.parameters,Y=T.get("text-optional"),Q=T.get("icon-optional"),X=T.get("text-allow-overlap"),ue=T.get("icon-allow-overlap"),ne="map"===T.get("text-rotation-alignment"),oe="map"===T.get("text-pitch-alignment"),fe="none"!==T.get("icon-text-fit"),ke="viewport-y"===T.get("symbol-z-order");this.transform.setProjection(w.projection);let Ve=X&&(ue||!w.hasIconData()||Q),Re=ue&&(X||!w.hasTextData()||Y);!w.collisionArrays&&Z&&w.deserializeCollisionBoxes(Z),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,Z);const ft=(ae,Ie,Ke)=>{if(L){const Pr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zr=null;if(L.dynamicFilterNeedsFeature){const sr=this.retainedQueryData[w.bucketInstanceId];Zr=L.featureIndex.loadFeature({featureIndex:ae.featureIndex,bucketIndex:sr.bucketIndex,sourceLayerIndex:sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Pr,Zr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new d.pointGeometry(ae.tileAnchorX,ae.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[ae.crossTileID]=new Do(!1,!1,!1,!0),void(h[ae.crossTileID]=!0)}if(h[ae.crossTileID])return;if(H)return void(this.placements[ae.crossTileID]=new Do(!1,!1,!1));let Dt=!1,Ye=!1,Vt=!0,xt=!1,Et=!1,wt=null,bt={box:null,offscreen:null,occluded:null},Lt={box:null,offscreen:null,occluded:null},sn=null,Sn=null,qt=null,vn=0,hr=0,Ur=0;Ke.textFeatureIndex?vn=Ke.textFeatureIndex:ae.useRuntimeCollisionCircles&&(vn=ae.featureIndex),Ke.verticalTextFeatureIndex&&(hr=Ke.verticalTextFeatureIndex);const qr=Pr=>{Pr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||Pr.elevation)&&(Pr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,Pr.tileAnchorX,Pr.tileAnchorY):0)},Ar=Ke.textBox;if(Ar){qr(Ar);const Pr=sr=>{let li=d.WritingMode.horizontal;if(w.allowVerticalPlacement&&!sr&&this.prevPlacement){const Gi=this.prevPlacement.placedOrientations[ae.crossTileID];Gi&&(this.placedOrientations[ae.crossTileID]=Gi,li=Gi,this.markUsedOrientation(w,li,ae))}return li},Zr=(sr,li)=>{if(w.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&Ke.verticalTextBox){for(const Gi of w.writingModes)if(Gi===d.WritingMode.vertical?(bt=li(),Lt=bt):bt=sr(),bt&&bt.box&&bt.box.length)break}else bt=sr()};if(T.get("text-variable-anchor")){let sr=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ae.crossTileID]){const zr=this.prevPlacement.variableOffsets[ae.crossTileID];sr.indexOf(zr.anchor)>0&&(sr=sr.filter(ri=>ri!==zr.anchor),sr.unshift(zr.anchor))}const li=(zr,ri,nl)=>{const zs=w.getSymbolInstanceTextSize(K,ae,this.transform.zoom,Ie),Ul=(zr.x2-zr.x1)*zs+2*zr.padding,jl=(zr.y2-zr.y1)*zs+2*zr.padding,Ns=fe&&!ue?ri:null;Ns&&qr(Ns);let ki={box:[],offscreen:!1,occluded:!1};const os=X?2*sr.length:sr.length;for(let Bs=0;Bs<os;++Bs){const rl=this.attemptAnchorPlacement(sr[Bs%sr.length],zr,Ul,jl,zs,ne,oe,N,S,ie,Bs>=sr.length,ae,Ie,w,nl,Ns,K,q);if(rl&&(ki=rl.placedGlyphBoxes,ki&&ki.box&&ki.box.length)){Dt=!0,wt=rl.shift;break}}return ki};Zr(()=>li(Ar,Ke.iconBox,d.WritingMode.horizontal),()=>{const zr=Ke.verticalTextBox;return zr&&qr(zr),w.allowVerticalPlacement&&!(bt&&bt.box&&bt.box.length)&&ae.numVerticalGlyphVertices>0&&zr?li(zr,Ke.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),bt&&(Dt=bt.box,Vt=bt.offscreen,xt=bt.occluded);const Gi=Pr(bt&&bt.box);if(!Dt&&this.prevPlacement){const zr=this.prevPlacement.variableOffsets[ae.crossTileID];zr&&(this.variableOffsets[ae.crossTileID]=zr,this.markUsedJustification(w,zr.anchor,ae,Gi))}}else{const sr=(li,Gi)=>{const zr=w.getSymbolInstanceTextSize(K,ae,this.transform.zoom,Ie),ri=this.collisionIndex.placeCollisionBox(w,zr,li,new d.pointGeometry(0,0),X,N,S,ie.predicate);return ri&&ri.box&&ri.box.length&&(this.markUsedOrientation(w,Gi,ae),this.placedOrientations[ae.crossTileID]=Gi),ri};Zr(()=>sr(Ar,d.WritingMode.horizontal),()=>{const li=Ke.verticalTextBox;return w.allowVerticalPlacement&&ae.numVerticalGlyphVertices>0&&li?(qr(li),sr(li,d.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Pr(bt&&bt.box&&bt.box.length)}}if(sn=bt,Dt=sn&&sn.box&&sn.box.length>0,Vt=sn&&sn.offscreen,xt=sn&&sn.occluded,ae.useRuntimeCollisionCircles){const Pr=w.text.placedSymbolArray.get(ae.centerJustifiedTextSymbolIndex>=0?ae.centerJustifiedTextSymbolIndex:ae.verticalPlacedTextSymbolIndex),Zr=d.evaluateSizeForFeature(w.textSizeData,K,Pr),sr=T.get("text-padding");Sn=this.collisionIndex.placeCollisionCircles(w,X,Pr,w.lineVertexArray,w.glyphOffsetArray,Zr,S,A,R,_,oe,ie.predicate,ae.collisionCircleDiameter*Zr/d.ONE_EM,sr,this.retainedQueryData[w.bucketInstanceId].tileID),Dt=X||Sn.circles.length>0&&!Sn.collisionDetected,Vt=Vt&&Sn.offscreen,xt=Sn.occluded}if(Ke.iconFeatureIndex&&(Ur=Ke.iconFeatureIndex),Ke.iconBox){const Pr=Zr=>{qr(Zr);const sr=fe&&wt?bu(wt.x,wt.y,ne,oe,this.transform.angle):new d.pointGeometry(0,0),li=w.getSymbolInstanceIconSize(q,this.transform.zoom,Ie);return this.collisionIndex.placeCollisionBox(w,li,Zr,sr,ue,N,S,ie.predicate)};Lt&&Lt.box&&Lt.box.length&&Ke.verticalIconBox?(qt=Pr(Ke.verticalIconBox),Ye=qt.box.length>0):(qt=Pr(Ke.iconBox),Ye=qt.box.length>0),Vt=Vt&&qt.offscreen,Et=qt.occluded}const jo=Y||0===ae.numHorizontalGlyphVertices&&0===ae.numVerticalGlyphVertices,$i=Q||0===ae.numIconVertices;if(jo||$i?$i?jo||(Ye=Ye&&Dt):Dt=Ye&&Dt:Ye=Dt=Ye&&Dt,Dt&&sn&&sn.box&&this.collisionIndex.insertCollisionBox(sn.box,T.get("text-ignore-placement"),w.bucketInstanceId,Lt&&Lt.box&&hr?hr:vn,ie.ID),Ye&&qt&&this.collisionIndex.insertCollisionBox(qt.box,T.get("icon-ignore-placement"),w.bucketInstanceId,Ur,ie.ID),Sn&&(Dt&&this.collisionIndex.insertCollisionCircles(Sn.circles,T.get("text-ignore-placement"),w.bucketInstanceId,vn,ie.ID),_)){const Pr=w.bucketInstanceId;let Zr=this.collisionCircleArrays[Pr];void 0===Zr&&(Zr=this.collisionCircleArrays[Pr]=new Ip);for(let sr=0;sr<Sn.circles.length;sr+=4)Zr.circles.push(Sn.circles[sr+0]),Zr.circles.push(Sn.circles[sr+1]),Zr.circles.push(Sn.circles[sr+2]),Zr.circles.push(Sn.collisionDetected?1:0)}const Da="globe"!==w.projection.name;Ve=Ve&&(Da||!xt),Re=Re&&(Da||!Et),this.placements[ae.crossTileID]=new Do(Dt||Ve,Ye||Re,Vt||w.justReloaded),h[ae.crossTileID]=!0};if(ke){const ae=w.getSortedSymbolIndexes(this.transform.angle);for(let Ie=ae.length-1;Ie>=0;--Ie){const Ke=ae[Ie];ft(w.symbolInstances.get(Ke),Ke,w.collisionArrays[Ke])}}else for(let ae=o.symbolInstanceStart;ae<o.symbolInstanceEnd;ae++)ft(w.symbolInstances.get(ae),ae,w.collisionArrays[ae]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[w.bucketInstanceId];d.invert(ae.invProjMatrix,S),ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(o,h,_,x){let w;w=x===d.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(h)];const T=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const S of T)S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=w>=0&&S!==w?0:_.crossTileID)}markUsedOrientation(o,h,_){const x=h===d.WritingMode.horizontal||h===d.WritingMode.horizontalOnly?h:0,w=h===d.WritingMode.vertical?h:0,T=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const S of T)o.text.placedSymbolArray.get(S).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(o):1,w=h?h.opacities:{},T=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],L=w[A];L?(this.opacities[A]=new pi(L,x,R.text,R.icon,null,R.clipped),_=_||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[A]=new pi(null,x,R.text,R.icon,R.skipFade,R.clipped),_=_||R.text||R.icon)}for(const A in w){const R=w[A];if(!this.opacities[A]){const L=new pi(R,x,!1,!1);L.isHidden()||(this.opacities[A]=L,_=_||R.text.placed||R.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);_?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const _={};for(const x of h){const w=x.getBucket(o);w&&x.latestFeatureIndex&&o.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,x.collisionBoxArray)}}updateBucketOpacities(o,h,_){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const x=o.layers[0].layout,w=!!o.layers[0].dynamicFilter(),T=new pi(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),R=x.get("text-variable-anchor"),L="map"===x.get("text-rotation-alignment"),N="map"===x.get("text-pitch-alignment"),H="none"!==x.get("icon-text-fit"),Z=new pi(null,0,S&&(A||!o.hasIconData()||x.get("icon-optional")),A&&(S||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&_&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(_);const K=(ie,Y,Q)=>{for(let X=0;X<Y/4;X++)ie.opacityVertexArray.emplaceBack(Q)};let q=0;for(let ie=0;ie<o.symbolInstances.length;ie++){const Y=o.symbolInstances.get(ie),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:X,crossTileID:ue}=Y;let ne=this.opacities[ue];h[ue]?ne=T:ne||(ne=Z,this.opacities[ue]=ne),h[ue]=!0;const oe=Q>0||X>0,fe=Y.numIconVertices>0,ke=this.placedOrientations[Y.crossTileID],Ve=ke===d.WritingMode.vertical,Re=ke===d.WritingMode.horizontal||ke===d.WritingMode.horizontalOnly;if(!oe&&!fe||ne.isHidden()||q++,oe){const ft=Qa(ne.text);K(o.text,Q,Ve?Vi:ft),K(o.text,X,Re?Vi:ft);const ae=ne.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(Dt=>{Dt>=0&&(o.text.placedSymbolArray.get(Dt).hidden=ae||Ve?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=ae||Re?1:0);const Ie=this.variableOffsets[Y.crossTileID];Ie&&this.markUsedJustification(o,Ie.anchor,Y,ke);const Ke=this.placedOrientations[Y.crossTileID];Ke&&(this.markUsedJustification(o,"left",Y,Ke),this.markUsedOrientation(o,Ke,Y))}if(fe){const ft=Qa(ne.icon);Y.placedIconSymbolIndex>=0&&(K(o.icon,Y.numIconVertices,Ve?Vi:ft),o.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ne.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(K(o.icon,Y.numVerticalIconVertices,Re?Vi:ft),o.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ne.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const ft=o.collisionArrays[ie];if(ft){let ae=new d.pointGeometry(0,0),Ie=!0;if(ft.textBox||ft.verticalTextBox){if(R){const Dt=this.variableOffsets[ue];Dt?(ae=af(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textScale),L&&ae._rotate(N?this.transform.angle:-this.transform.angle)):Ie=!1}w&&(Ie=!ne.clipped),ft.textBox&&Ja(o.textCollisionBox.collisionVertexArray,ne.text.placed,!Ie||Ve,ae.x,ae.y),ft.verticalTextBox&&Ja(o.textCollisionBox.collisionVertexArray,ne.text.placed,!Ie||Re,ae.x,ae.y)}const Ke=Ie&&Boolean(!Re&&ft.verticalIconBox);ft.iconBox&&Ja(o.iconCollisionBox.collisionVertexArray,ne.icon.placed,Ke,H?ae.x:0,H?ae.y:0),ft.verticalIconBox&&Ja(o.iconCollisionBox.collisionVertexArray,ne.icon.placed,!Ke,H?ae.x:0,H?ae.y:0)}}}if(o.fullyClipped=0===q,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ie.invProjMatrix,o.placementViewportMatrix=ie.viewportMatrix,o.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function Ja(p,o,h,_,x){p.emplaceBack(o?1:0,h?1:0,_||0,x||0),p.emplaceBack(o?1:0,h?1:0,_||0,x||0),p.emplaceBack(o?1:0,h?1:0,_||0,x||0),p.emplaceBack(o?1:0,h?1:0,_||0,x||0)}const lf=Math.pow(2,25),es=Math.pow(2,24),Er=Math.pow(2,17),wu=Math.pow(2,16),Oy=Math.pow(2,9),hg=Math.pow(2,8),gn=Math.pow(2,1);function Qa(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const o=p.placed?1:0,h=Math.floor(127*p.opacity);return h*lf+o*es+h*Er+o*wu+h*Oy+o*hg+h*gn+o}const Vi=0;class Ks{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,_,x,w){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(T,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,_,0===S.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class Hh{constructor(o,h,_,x,w,T,S,A){this.placement=new Ka(o,w,T,S,A),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,_){const x=d.exported.now(),w=()=>{const T=d.exported.now()-x;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=h[o[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ks(T)),this._inProgressLayer.continuePlacement(_[T.source],this.placement,this._showCollisionBoxes,T,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const qh=512/d.EXTENT/2;class dg{constructor(o,h,_){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<h.length;x++){const w=h.get(x),T=w.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,o)})}}getScaledCoordinates(o,h){const _=qh/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*d.EXTENT+o.tileAnchorX)*_),y:Math.floor((h.canonical.y*d.EXTENT+o.tileAnchorY)*_)}}findMatches(o,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<o.length;w++){const T=o.get(w);if(T.crossTileID)continue;const S=this.indexedSymbolInstances[T.key];if(!S)continue;const A=this.getScaledCoordinates(T,h);for(const R of S)if(Math.abs(R.coord.x-A.x)<=x&&Math.abs(R.coord.y-A.y)<=x&&!_[R.crossTileID]){_[R.crossTileID]=!0,T.crossTileID=R.crossTileID;break}}}}class Ap{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(0!==h)for(const _ in this.indexes){const x=this.indexes[_],w={};for(const T in x){const S=x[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),w[S.tileID.key]=S}this.indexes[_]=w}this.lng=o}addBucket(o,h,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const w in this.indexes){const T=this.indexes[w];if(Number(w)>o.overscaledZ)for(const S in T){const A=T[S];A.tileID.isChildOf(o)&&A.findMatches(h.symbolInstances,o,x)}else{const S=T[o.scaledTo(Number(w)).key];S&&S.findMatches(h.symbolInstances,o,x)}}for(let w=0;w<h.symbolInstances.length;w++){const T=h.symbolInstances.get(w);T.crossTileID||(T.crossTileID=_.generate(),x[T.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new dg(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const _ in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[o][x.crossTileID]}removeStaleBuckets(o){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const w in x)o[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],h=!0)}return h}}class Zh{constructor(){this.layerIndexes={},this.crossTileIDs=new Ap,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,_,x){let w=this.layerIndexes[o.id];void 0===w&&(w=this.layerIndexes[o.id]=new wc);let T=!1;const S={};"globe"!==x.name&&w.handleWrapJump(_);for(const A of h){const R=A.getBucket(o);R&&o.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(A.tileID,R,this.crossTileIDs)&&(T=!0),S[R.bucketInstanceId]=!0)}return w.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(o){const h={};o.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Cc=(p,o)=>d.emitValidationErrors(p,o&&o.filter(h=>"source.canvas"!==h.identifier)),fg=d.pick(we,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Dn=d.pick(we,["setCenter","setZoom","setBearing","setPitch"]),cf={version:8,layers:[],sources:{}},uf={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ai extends d.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new lr(cr(),this),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(o._requestManager,h.localFontFamily?d.LocalGlyphMode.all:h.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new Zh,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const _=this;this._rtlTextPluginCallback=Ai.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,T)=>{if(d.triggerPluginCompletionEvent(w),T&&T.every(S=>S))for(const S in _._sourceCaches){const A=_._sourceCaches[S],R=A.getSource().type;"vector"!==R&&"geojson"!==R||A.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===w.id&&this._validateLayer(S)}})}loadURL(o,h={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);const x=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(x,(w,T)=>{this._request=null,w?this.fire(new d.ErrorEvent(w)):T&&this._load(T,_)})}loadJSON(o,h={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(o,!1!==h.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(cf,!1)}_updateLayerCount(o,h){const _=h?1:-1;o.is3D()&&(this._num3DLayers+=_),"circle"===o.type&&(this._numCircleLayers+=_),"symbol"===o.type&&(this._numSymbolLayers+=_)}_load(o,h){if(h&&Cc(this,d.validateStyle(o)))return;this._loaded=!0,this.stylesheet=d.clone$1(o),this._updateMapProjection();for(const x in o.sources)this.addSource(x,o.sources[x],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const _=mr(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=d.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new It(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(h,_,x){let w,T,S;const A=d.exported.devicePixelRatio>1?"@2x":"";let R=d.getJSON(_.transformRequest(_.normalizeSpriteURL(h,A,".json"),d.ResourceType.SpriteJSON),(H,Z)=>{R=null,S||(S=H,w=Z,N())}),L=d.getImage(_.transformRequest(_.normalizeSpriteURL(h,A,".png"),d.ResourceType.SpriteImage),(H,Z)=>{L=null,S||(S=H,T=Z,N())});function N(){if(S)x(S);else if(w&&T){const H=d.exported.getImageData(T),Z={};for(const K in w){const{width:q,height:ie,x:Y,y:Q,sdf:X,pixelRatio:ue,stretchX:ne,stretchY:oe,content:fe}=w[K],ke=new d.RGBAImage({width:q,height:ie});d.RGBAImage.copy(H,ke,{x:Y,y:Q},{x:0,y:0},{width:q,height:ie}),Z[K]={data:ke,pixelRatio:ue,sdf:X,stretchX:ne,stretchY:oe,content:fe}}x(null,Z)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new d.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.getSource(o.source);if(!h)return;const _=o.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const _ of o){const x=this._layers[_];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&uf[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const T in this._updatedSources){const S=this._updatedSources[T];"reload"===S?this._reloadSource(T):"clear"===S&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];_[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(o,this._availableImages),!w.isHidden(o.zoom)){const S=this._getLayerSourceCache(w);S&&(S.used=!0)}const T=this.map.painter;if(T){const S=w.getProgramIds();if(!S)continue;const A=w.getProgramConfiguration(o.zoom);for(const R of S)T.useProgram(R,A)}}for(const x in _){const w=this._sourceCaches[x];_[x]!==w.used&&w.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Cc(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=mr(o.layers);const h=function(x,w){if(!x)return[{command:we.setStyle,args:[w]}];let T=[];try{if(!W(x.version,w.version))return[{command:we.setStyle,args:[w]}];W(x.center,w.center)||T.push({command:we.setCenter,args:[w.center]}),W(x.zoom,w.zoom)||T.push({command:we.setZoom,args:[w.zoom]}),W(x.bearing,w.bearing)||T.push({command:we.setBearing,args:[w.bearing]}),W(x.pitch,w.pitch)||T.push({command:we.setPitch,args:[w.pitch]}),W(x.sprite,w.sprite)||T.push({command:we.setSprite,args:[w.sprite]}),W(x.glyphs,w.glyphs)||T.push({command:we.setGlyphs,args:[w.glyphs]}),W(x.transition,w.transition)||T.push({command:we.setTransition,args:[w.transition]}),W(x.light,w.light)||T.push({command:we.setLight,args:[w.light]}),W(x.fog,w.fog)||T.push({command:we.setFog,args:[w.fog]}),W(x.projection,w.projection)||T.push({command:we.setProjection,args:[w.projection]});const S={},A=[];!function(N,H,Z,K){let q;for(q in H=H||{},N=N||{})N.hasOwnProperty(q)&&(H.hasOwnProperty(q)||ei(q,Z,K));for(q in H)H.hasOwnProperty(q)&&(N.hasOwnProperty(q)?W(N[q],H[q])||("geojson"===N[q].type&&"geojson"===H[q].type&&ug(N,H,q)?Z.push({command:we.setGeoJSONSourceData,args:[q,H[q].data]}):vs(q,H,Z,K)):Uo(q,H,Z))}(x.sources,w.sources,A,S);const R=[];x.layers&&x.layers.forEach(N=>{N.source&&S[N.source]?T.push({command:we.removeLayer,args:[N.id]}):R.push(N)});let L=x.terrain;L&&S[L.source]&&(T.push({command:we.setTerrain,args:[void 0]}),L=void 0),T=T.concat(A),W(L,w.terrain)||T.push({command:we.setTerrain,args:[w.terrain]}),function(N,H,Z){H=H||[];const K=(N=N||[]).map(yu),q=H.map(yu),ie=N.reduce(Sp,{}),Y=H.reduce(Sp,{}),Q=K.slice(),X=Object.create(null);let ue,ne,oe,fe,ke,Ve,Re;for(ue=0,ne=0;ue<K.length;ue++)oe=K[ue],Y.hasOwnProperty(oe)?ne++:(Z.push({command:we.removeLayer,args:[oe]}),Q.splice(Q.indexOf(oe,ne),1));for(ue=0,ne=0;ue<q.length;ue++)oe=q[q.length-1-ue],Q[Q.length-1-ue]!==oe&&(ie.hasOwnProperty(oe)?(Z.push({command:we.removeLayer,args:[oe]}),Q.splice(Q.lastIndexOf(oe,Q.length-ne),1)):ne++,Ve=Q[Q.length-ue],Z.push({command:we.addLayer,args:[Y[oe],Ve]}),Q.splice(Q.length-ue,0,oe),X[oe]=!0);for(ue=0;ue<q.length;ue++)if(oe=q[ue],fe=ie[oe],ke=Y[oe],!X[oe]&&!W(fe,ke))if(W(fe.source,ke.source)&&W(fe["source-layer"],ke["source-layer"])&&W(fe.type,ke.type)){for(Re in Qo(fe.layout,ke.layout,Z,oe,null,we.setLayoutProperty),Qo(fe.paint,ke.paint,Z,oe,null,we.setPaintProperty),W(fe.filter,ke.filter)||Z.push({command:we.setFilter,args:[oe,ke.filter]}),W(fe.minzoom,ke.minzoom)&&W(fe.maxzoom,ke.maxzoom)||Z.push({command:we.setLayerZoomRange,args:[oe,ke.minzoom,ke.maxzoom]}),fe)fe.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?Qo(fe[Re],ke[Re],Z,oe,Re.slice(6),we.setPaintProperty):W(fe[Re],ke[Re])||Z.push({command:we.setLayerProperty,args:[oe,Re,ke[Re]]}));for(Re in ke)ke.hasOwnProperty(Re)&&!fe.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?Qo(fe[Re],ke[Re],Z,oe,Re.slice(6),we.setPaintProperty):W(fe[Re],ke[Re])||Z.push({command:we.setLayerProperty,args:[oe,Re,ke[Re]]}))}else Z.push({command:we.removeLayer,args:[oe]}),Ve=Q[Q.lastIndexOf(oe)+1],Z.push({command:we.addLayer,args:[ke,Ve]})}(R,w.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:we.setStyle,args:[w]}]}return T}(this.serialize(),o).filter(x=>!(x.command in Dn));if(0===h.length)return!1;const _=h.filter(x=>!(x.command in fg));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,h){return this.getImage(o)?this.fire(new d.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,h),this._afterImageUpdated(o),this)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new d.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateSource,`sources.${o}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=Se(o,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:x.serialize(),sourceId:o}));const w=T=>{const S=(T?"symbol:":"other:")+o,A=this._sourceCaches[S]=new d.SourceCache(S,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=A,A.style=this,A.onAdd(this.map)};w(!1),"vector"!==h.type&&"geojson"!==h.type||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const h=this.getSource(o);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(o);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getSource(o).setData(h),this._changed=!0}getSource(o){const h=this._getSourceCache(o);return h&&h.getSource()}addLayer(o,h,_={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if("custom"===o.type){if(Cc(this,d.validateCustomStyleLayer(o)))return;w=d.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(x,o.source),o=d.clone$1(o),o=d.extend(o,{source:x})),this._validate(d.validateLayer,`layers.${x}`,o,{arrayIndex:-1},_))return;w=d.createStyleLayer(o),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const T=h?this._order.indexOf(h):this._order.length;if(h&&-1===T)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const S=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&S&&"custom"!==w.type){const A=this._removedLayers[x];delete this._removedLayers[x],A.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",S.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const _=this._order.indexOf(o);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,_){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===h&&x.maxzoom===_||(null!=h&&(x.minzoom=h),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,h,_={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!W(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(d.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=d.clone$1(h),this._updateLayer(x)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const h=this.getLayer(o);return h&&d.clone$1(h.filter)}setLayoutProperty(o,h,_,x={}){this._checkLoaded();const w=this.getLayer(o);w?W(w.getLayoutProperty(h),_)||(w.setLayoutProperty(h,_,x),this._updateLayer(w)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,h){const _=this.getLayer(o);if(_)return _.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,h,_,x={}){this._checkLoaded();const w=this.getLayer(o);w?W(w.getPaintProperty(h),_)||(w.setPaintProperty(h,_,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,h){const _=this.getLayer(o);return _&&_.getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const _=o.source,x=o.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new d.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const T=w.type;if("geojson"===T&&x)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!x)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const A of S)A.setFeatureState(x,o.id,h)}removeFeatureState(o,h){this._checkLoaded();const _=o.source,x=this.getSource(_);if(!x)return void this.fire(new d.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=x.type,T="vector"===w?o.sourceLayer:void 0;if("vector"===w&&!T)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const A of S)A.removeFeatureState(T,o.id,h)}getFeatureState(o){this._checkLoaded();const h=o.source,_=o.sourceLayer,x=this.getSource(h);if(x){if("vector"!==x.type||_)return void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();o[_.id]||(o[_.id]=_.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(o){this._updatedLayers[o.id]=!0;const h=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[o.source]="reload",h.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const h=T=>"fill-extrusion"===this._layers[T].type,_={},x=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(h(S)){_[S]=T;for(const A of o){const R=A[S];if(R)for(const L of R)x.push(L)}}}x.sort((T,S)=>S.intersectionZ-T.intersectionZ);const w=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(h(S))for(let A=x.length-1;A>=0;A--){const R=x[A].feature;if(_[R.layer.id]<T)break;w.push(R),x.pop()}else for(const A of o){const R=A[S];if(R)for(const L of R)w.push(L.feature)}}return w}queryRenderedFeatures(o,h,_){h&&h.filter&&this._validate(d.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of h.layers){const R=this._layers[A];if(!R)return this.fire(new d.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];x[R.source]=!0}}const w=[];h.availableImages=this._availableImages;const T=h&&h.layers?h.layers.some(A=>{const R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),S=Wn.createFromScreenPoints(o,_);for(const A in this._sourceCaches){const R=this._sourceCaches[A].getSource().id;h.layers&&!x[R]||w.push(gt(this._sourceCaches[A],this._layers,this._serializedLayers,S,h,_,T,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(A,R,L,N,H,Z,K){const q={},ie=Z.queryRenderedSymbols(N),Y=[];for(const Q of Object.keys(ie).map(Number))Y.push(K[Q]);Y.sort(Zt);for(const Q of Y){const X=Q.featureIndex.lookupSymbolFeatures(ie[Q.bucketInstanceId],R,Q.bucketIndex,Q.sourceLayerIndex,H.filter,H.layers,H.availableImages,A);for(const ue in X){const ne=q[ue]=q[ue]||[],oe=X[ue];oe.sort((fe,ke)=>{const Ve=Q.featureSortOrder;if(Ve){const Re=Ve.indexOf(fe.featureIndex);return Ve.indexOf(ke.featureIndex)-Re}return ke.featureIndex-fe.featureIndex});for(const fe of oe)ne.push(fe)}}for(const Q in q)q[Q].forEach(X=>{const ue=X.feature,ne=L(A[Q]).getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=ne});return q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(o,h){h&&h.filter&&this._validate(d.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(o);let x=[];for(const w of _)x=x.concat(ot(w,h));return x}addSourceType(o,h,_){return Ai.getSourceType(o)?_(new Error(`A source type called "${o}" already exists.`)):(Ai.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const T in o)if(!W(o[T],_[T])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,h),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,h=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof o.source){const _="terrain-dem-src";this.addSource(_,o.source),o=d.clone$1(o),o=d.extend(o,{source:_})}if(this._validate(d.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(o,h);else{const _=this.terrain,x=_.get();for(const w of Object.keys(d.spec.terrain))!o.hasOwnProperty(w)&&d.spec.terrain[w].default&&(o[w]=d.spec.terrain[w].default);for(const w in o)if(!W(o[w],x[w])){_.set(o),this.stylesheet.terrain=o;const T=this._setTransitionParameters({duration:0});_.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const h=this.fog=new On(o,this.map.transform);this.stylesheet.fog=o;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(o).length&&h.set(o);for(const x in o)if(!W(o[x],_[x])){h.set(o),this.stylesheet.fog=o;const w=this._setTransitionParameters({duration:0});h.updateTransitions(w);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:d.exported.now(),transition:d.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o,h){const _=this.terrain=new Rt(o,h);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const h=this._layers[o];"symbol"===h.type&&this._updateLayer(h)}}_validate(o,h,_,x,w={}){return(!w||!1!==w.validate)&&Cc(this,o.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:_,styleSpec:d.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const h=this._getSourceCaches(o);for(const _ of h)_.clearTiles()}_reloadSource(o){const h=this._getSourceCaches(o);for(const _ of h)_.resume(),_.reload()}_updateSources(o){for(const h in this._sourceCaches)this._sourceCaches[h].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,_,x,w=!1){let T=!1,S=!1;const A={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!A[L.source]){const H=this._getLayerSourceCache(L);if(!H)continue;A[L.source]=H.getRenderableIds(!0).map(Z=>H.getTileByID(Z)).sort((Z,K)=>K.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(K.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(L,A[L.source],o.center.lng,o.projection);T=T||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),o.zoom))&&(this.pauseablePlacement=new Hh(o,this._order,w,h,_,x,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(o,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(o,h,_){return d.makeRequest(h,_)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}_isSourceCacheLoaded(o){const h=this._getSourceCaches(o);return 0===h.length?(this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ai.getSourceType=function(p){return ye[p]},Ai.setSourceType=function(p,o){ye[p]=o},Ai.registerForPluginStateChange=d.registerForPluginStateChange;var Wh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Pp="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let bs={},Ui={};bs=gr("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Ui=gr("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const hf=gr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Cu=Wh,So="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Ir={background:gr("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:gr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:gr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:gr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:gr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:gr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:gr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:gr("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:gr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:gr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:gr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:gr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:gr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:gr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:gr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Pp),skyboxGradient:gr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Pp),skyboxCapture:gr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:gr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function gr(p,o,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,w=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(x),S=o.match(x),A=Wh.match(x);let R=S?S.concat(T):T;h||(bs.staticUniforms&&(R=bs.staticUniforms.concat(R)),Ui.staticUniforms&&(R=Ui.staticUniforms.concat(R))),R&&(R=R.concat(A));const L={};return{fragmentSource:p=p.replace(_,(N,H,Z,K,q)=>(L[q]=!0,"define"===H?`\n#ifndef HAS_UNIFORM_u_${q}\nvarying ${Z} ${K} ${q};\n#else\nuniform ${Z} ${K} u_${q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${q}\n    ${Z} ${K} ${q} = u_${q};\n#endif\n`)),vertexSource:o=o.replace(_,(N,H,Z,K,q)=>{const ie="float"===K?"vec2":"vec4",Y=q.match(/color/)?"color":ie;return L[q]?"define"===H?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${Z} ${ie} a_${q};\nvarying ${Z} ${K} ${q};\n#else\nuniform ${Z} ${K} u_${q};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = a_${q};\n#else\n    ${Z} ${K} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);\n#else\n    ${Z} ${K} ${q} = u_${q};\n#endif\n`:"define"===H?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${Z} ${ie} a_${q};\n#else\nuniform ${Z} ${K} u_${q};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${Z} ${K} ${q} = a_${q};\n#else\n    ${Z} ${K} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${Z} ${K} ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);\n#else\n    ${Z} ${K} ${q} = u_${q};\n#endif\n`}),staticAttributes:w,staticUniforms:R}}class pg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,_,x,w,T,S,A,R){this.context=o;let L=this.boundPaintVertexBuffers.length!==x.length;for(let N=0;!L&&N<x.length;N++)this.boundPaintVertexBuffers[N]!==x[N]&&(L=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!L&&this.boundIndexBuffer===w&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===A&&this.boundDynamicVertexBuffer3===R?(o.bindVertexArrayOES.set(this.vao),S&&S.bind(),w&&w.dynamicDraw&&w.bind(),A&&A.bind(),R&&R.bind()):this.freshBind(h,_,x,w,T,S,A,R)}freshBind(o,h,_,x,w,T,S,A){let R;const L=o.numAttributes,N=this.context,H=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=A;else{R=N.currentNumAttributes||0;for(let Z=L;Z<R;Z++)H.disableVertexAttribArray(Z)}h.enableAttributes(H,o);for(const Z of _)Z.enableAttributes(H,o);T&&T.enableAttributes(H,o),S&&S.enableAttributes(H,o),A&&A.enableAttributes(H,o),h.bind(),h.setVertexAttribPointers(H,o,w);for(const Z of _)Z.bind(),Z.setVertexAttribPointers(H,o,w);T&&(T.bind(),T.setVertexAttribPointers(H,o,w)),x&&x.bind(),S&&(S.bind(),S.setVertexAttribPointers(H,o,w)),A&&(A.bind(),A.setVertexAttribPointers(H,o,w)),N.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function el(p,o){const h=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new d.MercatorCoordinate(0,_/h).toLngLat().lat,new d.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function Tr(p,o,h,_,x,w,T){const S=p.context,A=S.gl,R=h.fbo;if(!R)return;p.prepareDrawTile();const L=p.useProgram("hillshade");S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const N=((q,ie,Y,Q)=>{const X=Y.paint.get("hillshade-shadow-color"),ue=Y.paint.get("hillshade-highlight-color"),ne=Y.paint.get("hillshade-accent-color");let oe=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(oe-=q.transform.angle);const fe=!q.options.moving;return{u_matrix:Q||q.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),fe),u_image:0,u_latrange:el(0,ie.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),oe],u_shadow:X,u_highlight:ue,u_accent:ne}})(p,h,_,p.terrain?o.projMatrix:null);p.prepareDrawProgram(S,L,o.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:Z,tileBoundsSegments:K}=p.getTileBoundsBuffers(h);L.draw(S,A.TRIANGLES,x,w,T,d.CullFaceMode.disabled,N,_.id,H,Z,K)}function Ml(p,o,h){if(!o.needsDEMTextureUpload)return;const _=p.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(h.stride);const w=h.getPixels();o.demTexture?o.demTexture.update(w,{premultiply:!1}):o.demTexture=new d.Texture(_,w,x.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Mc(p,o,h,_,x,w){const T=p.context,S=T.gl;if(!o.dem)return;const A=o.dem;if(T.activeTexture.set(S.TEXTURE1),Ml(p,o,A),!o.demTexture)return;o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const R=A.dim;T.activeTexture.set(S.TEXTURE0);let L=o.fbo;if(!L){const K=new d.Texture(T,{width:R,height:R,data:null},S.RGBA);K.bind(S.LINEAR,S.CLAMP_TO_EDGE),L=o.fbo=T.createFramebuffer(R,R,!0),L.colorAttachment.set(K.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,R,R]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,_,x,w,d.CullFaceMode.disabled,((K,q)=>{const ie=q.stride,Y=d.create();return d.ortho(Y,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(Y,Y,[0,-d.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[ie,ie],u_zoom:K.overscaledZ,u_unpack:q.unpackVector}})(o.tileID,A),h.id,N,H,Z),o.needsHillshadePrepare=!1}const Ec=(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image0:new d.Uniform1i(p,o.u_image0),u_skirt_height:new d.Uniform1f(p,o.u_skirt_height)}),Mu=(p,o)=>({u_matrix:p,u_image0:0,u_skirt_height:o}),Un=(p,o,h,_,x,w,T,S,A,R,L,N,H,Z)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:L,u_globe_radius:N,u_viewport:H,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9)});function xa(p,o){return null!=p&&null!=o&&!(!p.hasData()||!o.hasData())&&null!=p.demTexture&&null!=o.demTexture&&p.tileID.key!==o.tileID.key}const El=new class{constructor(){this.operations={}}newMorphing(p,o,h,_,x){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[p]={startTime:_,phase:0,duration:x,from:o,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(const o in this.operations){const h=this.operations[o];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},kr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Op(p,o){const h=1<<p.z;return!o&&(0===p.x||p.x===h-1)||0===p.y||p.y===h-1}const Tc=p=>({u_matrix:p});function Xh(p,o,h,_,x){if(x>0){const w=d.exported.now(),T=(w-p.timeAdded)/x,S=o?(w-o.timeAdded)/x:-1,A=h.getSource(),R=_.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),N=L&&p.refreshedUponExpiration?1:d.clamp(L?T:1-S,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),o?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class mg extends d.SourceCache{constructor(o){const h={type:"raster-dem",maxzoom:o.transform.maxZoom},_=new lr(cr(),null),x=Se("mock-dem",h,_,o.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,h){o.state="loaded",h(null)}}class ws extends d.SourceCache{constructor(o){const h=Se("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new lr(cr(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,_){if(o.freezeTileCoverage)return;this.transform=o;const x=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,T)=>{if(w[T.key]="",!this._tiles[T.key]){const S=new d.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);S.state="loaded",this._tiles[T.key]=S}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(o){const h=this.proxyCachedFBO[o];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Yh extends d.OverscaledTileID{constructor(o,h,_){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Kh extends d.Elevation{constructor(o,h){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,w]=function(A){const R=new d.StructArrayLayout4i8,L=new d.StructArrayLayout3ui6,N=131;R.reserve(17161),L.reserve(33800);const H=d.EXTENT/128,Z=d.EXTENT+H/2,K=Z+H;for(let ie=-H;ie<K;ie+=H)for(let Y=-H;Y<K;Y+=H){const Q=Y<0||Y>Z||ie<0||ie>Z?24575:0,X=d.clamp(Math.round(Y),0,d.EXTENT),ue=d.clamp(Math.round(ie),0,d.EXTENT);R.emplaceBack(X+Q,ue,X,ue)}const q=(ie,Y)=>{const Q=Y*N+ie;L.emplaceBack(Q+1,Q,Q+N),L.emplaceBack(Q+N,Q+N+1,Q+1)};for(let ie=1;ie<129;ie++)for(let Y=1;Y<129;Y++)q(Y,ie);return[0,129].forEach(ie=>{for(let Y=0;Y<130;Y++)q(Y,ie),q(ie,Y)}),[R,L,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(_,d.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=d.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ws(h.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const S=T.gl;this._overlapStencilMode=new d.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new mg(h.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,h,_){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const x=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(h,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(A=>{const R=h.getTileByID(A).tileID;return R.projMatrix=_.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),N=new d.pointGeometry(L.x,L.y);A.sort((H,Z)=>{if(Z.overscaledZ-H.overscaledZ)return Z.overscaledZ-H.overscaledZ;const K=new d.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),q=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ie=N.mult(1<<H.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(K)-ie.distSqr(q)})})(x,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const A in T){const R=T[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,o[A],w),R.usedForTerrain))continue;const L=o[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=x.map(A=>new Yh(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const L=R.tileID.key;L in S||(this._visibleDemTiles.push(R),S[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),Ml(this.painter,x,w))}}_prepareDemTileUniforms(o,h,_,x){if(!h||null==h.demTexture)return!1;const w=o.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-w.z),S=x||"";return _[`u_dem_tl${S}`]=[w.x*T%1,w.y*T%1],_[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,h=o.gl;if(!this._emptyDepthBufferTexture){const _=new d.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.Texture(o,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const w=x.dem.tree.minimums[0];return w>0&&o++,_+w},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new d.RGBAImage({width:1,height:1},new Uint8Array(d.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new d.Texture(o,x,h.RGBA,{premultiply:!1}),w}setupElevationDraw(o,h,_){const x=this.painter.context,w=x.gl,T=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const A=this.painter.transform,R=A.projection,L=o.tileID.canonical;T.u_tile_tl_up=R.upVector(L,0,0),T.u_tile_tr_up=R.upVector(L,d.EXTENT,0),T.u_tile_br_up=R.upVector(L,d.EXTENT,d.EXTENT),T.u_tile_bl_up=R.upVector(L,0,d.EXTENT),T.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?d.GLOBE_METERS_TO_ECEF:R.upVectorScale(L,A.center.lat,A.worldSize).metersToTile;let N=null,H=null,Z=1;if(_&&_.morphing&&this._useVertexMorphing){const K=_.morphing.srcDemTile,q=_.morphing.dstDemTile;Z=_.morphing.phase,K&&q&&(this._prepareDemTileUniforms(o,K,T,"_prev")&&(H=K),this._prepareDemTileUniforms(o,q,T)&&(N=q))}if(H&&N?(x.activeTexture.set(w.TEXTURE2),N.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),H.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),T.u_dem_lerp=Z):(N=this.terrainTileForTile[o.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(o,N,T)?N.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&N){const K=(1<<N.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=K}_&&_.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,T)}renderToBackBuffer(o){const h=this.painter,_=this.painter.context;0!==o.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,T,S,A){if("globe"===x.transform.projection.name)!function(R,L,N,H,Z){const K=R.context,q=K.gl;let ie,Y;const Q=R.options.showTerrainWireframe?2:0,X=R.transform,ue=d.globeUseCustomAntiAliasing(R,K,X),ne=(ae,Ie)=>{if(Y===ae)return;const Ke=[kr[ae],"PROJECTION_GLOBE_VIEW"];ue&&Ke.push("CUSTOM_ANTIALIASING"),Ie&&Ke.push(kr[Q]),ie=R.useProgram("globeRaster",null,Ke),Y=ae},oe=R.colorModeForRenderPass(),fe=new d.DepthMode(q.LEQUAL,d.DepthMode.ReadWrite,R.depthRangeFor3D);El.update(Z);const ke=d.calculateGlobeMercatorMatrix(X),Ve=[d.mercatorXfromLng(X.center.lng),d.mercatorYfromLat(X.center.lat)],Re=R.globeSharedBuffers,ft=[X.width*d.exported.devicePixelRatio,X.height*d.exported.devicePixelRatio];if((Q?[!1,!0]:[!1]).forEach(ae=>{Y=-1;const Ie=ae?q.LINES:q.TRIANGLES;for(const Ke of H){const Dt=N.getTile(Ke),Ye=d.StencilMode.disabled,Vt=L.prevTerrainTileForTile[Ke.key],xt=L.terrainTileForTile[Ke.key];xa(Vt,xt)&&El.newMorphing(Ke.key,Vt,xt,Z,250),K.activeTexture.set(q.TEXTURE0),Dt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const Et=El.getMorphValuesForProxy(Ke.key),wt=Et?1:0,bt={useDenormalizedUpVectorScale:!0};Et&&d.extend$1(bt,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:d.easeCubicInOut(Et.phase)}});const Lt=Float32Array.from(X.globeMatrix),sn=d.globeTileLatLngCorners(Ke.canonical),Sn=d.getLatitudinalLod((sn[0][0]+sn[1][0])/2),qt=d.getGridMatrix(Ke.canonical,sn,Sn),vn=d.globeNormalizeECEF(d.globeTileBounds(Ke.canonical)),hr=Un(X.projMatrix,Lt,ke,vn,d.globeToMercatorTransition(X.zoom),Ve,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,ft,qt);if(ne(wt,ae),L.setupElevationDraw(Dt,ie,bt),R.prepareDrawProgram(K,ie,Ke.toUnwrapped()),Re){const[Ur,qr,Ar]=ae?Re.getWirefameBuffers(R.context,Sn):Re.getGridBuffers(Sn);ie.draw(K,Ie,fe,Ye,oe,d.CullFaceMode.backCCW,hr,"globe_raster",Ur,qr,Ar)}}}),Re){const ae=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&ae.push("CUSTOM_ANTIALIASING"),ie=R.useProgram("globeRaster",null,ae);for(const Ie of H){const{x:Ke,y:Dt,z:Ye}=Ie.canonical,Vt=0===Dt,xt=Dt===(1<<Ye)-1,[Et,wt,bt,Lt]=Re.getPoleBuffers(Ye);if(Lt&&(Vt||xt)){const sn=N.getTile(Ie);K.activeTexture.set(q.TEXTURE0),sn.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Sn=d.globePoleMatrixForTile(Ye,Ke,X);const qt=d.globeNormalizeECEF(d.globeTileBounds(Ie.canonical)),vn=(hr,Ur)=>hr.draw(K,q.TRIANGLES,fe,d.StencilMode.disabled,oe,d.CullFaceMode.disabled,Un(X.projMatrix,Sn,Sn,qt,0,Ve,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,ft),"globe_pole_raster",Ur,bt,Lt);L.setupElevationDraw(sn,ie,{}),R.prepareDrawProgram(K,ie,Ie.toUnwrapped()),Vt&&vn(ie,Et),xt&&(Sn=d.scale(d.create(),Sn,[1,-1,1]),vn(ie,wt))}}}}(x,w,T,S,A);else{const R=x.context,L=R.gl;let N,H;const Z=x.options.showTerrainWireframe?2:0,K=(X,ue)=>{if(H===X)return;const ne=[kr[X]];ue&&ne.push(kr[Z]),N=x.useProgram("terrainRaster",null,ne),H=X},q=x.colorModeForRenderPass(),ie=new d.DepthMode(L.LEQUAL,d.DepthMode.ReadWrite,x.depthRangeFor3D);El.update(A);const Y=x.transform,Q=6*Math.pow(1.5,22-Y.zoom)*w.exaggeration();(Z?[!1,!0]:[!1]).forEach(X=>{H=-1;const ue=X?L.LINES:L.TRIANGLES,[ne,oe]=X?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const fe of S){const ke=T.getTile(fe),Ve=d.StencilMode.disabled,Re=w.prevTerrainTileForTile[fe.key],ft=w.terrainTileForTile[fe.key];xa(Re,ft)&&El.newMorphing(fe.key,Re,ft,A,250),R.activeTexture.set(L.TEXTURE0),ke.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const ae=El.getMorphValuesForProxy(fe.key),Ie=ae?1:0;let Ke;ae&&(Ke={morphing:{srcDemTile:ae.from,dstDemTile:ae.to,phase:d.easeCubicInOut(ae.phase)}});const Dt=Mu(fe.projMatrix,Op(fe.canonical,Y.renderWorldCopies)?Q/10:Q);K(Ie,X),w.setupElevationDraw(ke,N,Ke),x.prepareDrawProgram(R,N,fe.toUnwrapped()),N.draw(R,ue,ie,Ve,q,d.CullFaceMode.backCCW,Dt,"terrain_raster",w.gridBuffer,ne,oe)}})}}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),S=[],A=h.style.order;let R=0;for(const L of w){const N=x.getTileByID(L.proxyTileKey),H=x.proxyCachedFBO[L.key]?x.proxyCachedFBO[L.key][o]:void 0,Z=void 0!==H?x.renderCache[H]:this.pool[R++],K=void 0!==H;if(N.texture=Z.tex,K&&!Z.dirty){S.push(N.tileID);continue}let q;_.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(_.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let ie=T.start;ie<=T.end;++ie){const Y=h.style._layers[A[ie]];if(Y.isHidden(h.transform.zoom))continue;const Q=h.style._getLayerSourceCache(Y),X=Q?this.proxyToSource[L.key][Q.id]:[L];if(!X)continue;const ue=X;_.viewport.set([0,0,Z.fb.width,Z.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(Z,X,Y,Q),q=Q?Q.id:null),h.renderLayer(h,Q,Y,ue)}this.renderedToTile?(Z.dirty=!0,S.push(N.tileID)):K||--R,5===R&&(R=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const h=o.order.length;if(0===h)return{efficiency:100};let _,x=0,w=0,T=!1;for(let S=0;S<h;++S){const A=o._layers[o.order[S]];this._style.isLayerDraped(A)?(T&&++x,++w):T||(T=!0,_=A.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const T=w.tileID,S=Math.pow(2,T.overscaledZ),{x:A,y:R}=T.canonical,L=A/S,N=(A+1)/S,H=R/S,Z=(R+1)/S;return{minx:L,miny:H,maxx:N,maxy:Z,t:w.dem.tree.raycastRoot(L,H,N,Z,o,h,_),tile:w}});x.sort((w,T)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const w of x){if(null==w.t)return null;const T=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,o,h,_);if(null!=T)return T}return null}_createFBO(){const o=this.painter.context,h=o.gl,_=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const x=new d.Texture(o,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=o.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new B(o,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._layers[o],_=h.isHidden(this.painter.transform.zoom),x=h.getCrossfadeParameters(),w=!!x&&1!==x.t,T=h.hasTransition();return"custom"!==h.type&&!_&&(w||T)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof se){o=!0;break}if(o)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],x=_.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(_);if("raster"!==_.type||x||!w)continue;const T=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][w.id];if(A)for(const R of A){const L=Xh(w.getTile(R),w.findLoadedParent(R,0),w,this.painter.transform,T);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(w.id,R)}}}}_setupDrapedRenderBatches(){const o=this._style.order,h=o.length;if(0===h)return;const _=[];let x,w=0,T=this._style._layers[o[w]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++w<h;)T=this._style._layers[o[w]];for(;w<h;++w){const S=this._style._layers[o[w]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===x&&(x=w):void 0!==x&&(_.push({start:x,end:w-1}),x=void 0))}void 0!==x&&_.push({start:x,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<T.length;++S){const A=Object.values(T[S]);h.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let T=_.length-1;T>=0;T--){const S=_[T];if(h.getTileByID(S.key),void 0!==h.proxyCachedFBO[S.key]){const A=o[S.key],R=this.proxyToSource[S.key];let L=0;for(const N in R){const H=R[N],Z=A[N];if(!Z||Z.length!==H.length||H.some((K,q)=>K!==Z[q]||x[N]&&x[N].hasOwnProperty(K.key))){L=-1;break}++L}for(const N in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][N]].dirty=L<0||L!==Object.values(A).length}}const w=[...this._drapedRenderBatches];w.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of w)for(const S of _){if(h.proxyCachedFBO[S.key])continue;let A=h.renderCachePool.pop();void 0===A&&h.renderCache.length<50&&(A=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==A&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][T.start]=A,h.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,T=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(o,h){const _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const T=_.useProgram("clippingMask");for(const S of o){const A=_._tileClippingMaskIDs[S.key]=--h;T.draw(x,w.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:w.ALWAYS,mask:0},A,255,w.KEEP,w.KEEP,w.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Tc(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const _=[o.x,o.y,1,1];d.transformMat4$1(_,_,h.pixelMatrixInverse),d.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,w=d.mercatorZfromAltitude(1,h.center.lat),T=[x[0],x[1],x[2]/w,0],S=d.subtract([],_.slice(0,3),T);d.normalize(S,S);const A=this.raycast(T,S,this._exaggeration);return null!==A&&A?(d.scaleAndAdd(T,T,S,A),T[3]=T[2],T[2]*=w,T):null}drawDepth(){const o=this.painter,h=o.context,_=this.proxySourceCache,x=Math.ceil(o.width),w=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=h.gl,S=h.createFramebuffer(x,w,!0);h.activeTexture.set(T.TEXTURE0);const A=new d.Texture(h,{width:x,height:w,data:null},T.RGBA);A.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(A.texture);const R=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,w);S.depthAttachment.set(R),this._depthFBO=S,this._depthTexture=A}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,w]),function(T,S,A,R){if("globe"===T.transform.projection.name)return;const L=T.context,N=L.gl;L.clear({depth:1});const H=T.useProgram("terrainDepth"),Z=new d.DepthMode(N.LESS,d.DepthMode.ReadWrite,T.depthRangeFor3D);for(const K of R){const q=A.getTile(K),ie=Mu(K.projMatrix,0);S.setupElevationDraw(q,H),H.draw(L,N.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,ie,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(o,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,_){if(o.getSource()instanceof Ce)return this._setupProxiedCoordsForImageSource(o,h,_);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const x=this.proxiedCoords[o.id]=[],w=this.proxyCoords;for(let S=0;S<w.length;S++){const A=w[S],R=this._findTileCoveringTileID(A,o);if(R){const L=this._createProxiedId(A,R,_[A.key]&&_[A.key][o.id]);x.push(L),this.proxyToSource[A.key][o.id]=[L]}}let T=!1;for(let S=0;S<h.length;S++){const A=o.getTile(h[S]);if(!A||!A.hasData())continue;const R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][o.id],N=this._createProxiedId(R.tileID,A,_[R.tileID.key]&&_[R.tileID.key][o.id]);L?L.splice(L.length-1,0,N):this.proxyToSource[R.tileID.key][o.id]=[N],x.push(N),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,h,_){if(!o.getSource().loaded())return;const x=this.proxiedCoords[o.id]=[],w=this.proxyCoords,T=o.getSource(),S=new d.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),A=T.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((L,N)=>(L.min.x=Math.min(L.min.x,N.x-S.x),L.min.y=Math.min(L.min.y,N.y-S.y),L.max.x=Math.max(L.max.x,N.x-S.x),L.max.y=Math.max(L.max.y,N.y-S.y),L),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,N)=>{const H=L.wrap+L.canonical.x/(1<<L.canonical.z),Z=L.canonical.y/(1<<L.canonical.z),K=d.EXTENT/(1<<L.canonical.z),q=N.wrap+N.canonical.x/(1<<N.canonical.z),ie=N.canonical.y/(1<<N.canonical.z);return H+K<q+A.min.x||H>q+A.max.x||Z+K<ie+A.min.y||Z>ie+A.max.y};for(let L=0;L<w.length;L++){const N=w[L];for(let H=0;H<h.length;H++){const Z=o.getTile(h[H]);if(!Z||!Z.hasData()||R(N,Z.tileID))continue;const K=this._createProxiedId(N,Z,_[N.key]&&_[N.key][o.id]),q=this.proxyToSource[N.key][o.id];q?q.push(K):this.proxyToSource[N.key][o.id]=[K],x.push(K)}}}_createProxiedId(o,h,_){let x=this.orthoMatrix;if(_){const w=_.find(T=>T.key===h.tileID.key);if(w)return w}if(h.tileID.key!==o.key){const w=o.canonical.z-h.tileID.canonical.z;let T,S,A;x=d.create();const R=h.tileID.wrap-o.wrap<<o.overscaledZ;w>0?(T=d.EXTENT>>w,S=T*((h.tileID.canonical.x<<w)-o.canonical.x+R),A=T*((h.tileID.canonical.y<<w)-o.canonical.y)):(T=d.EXTENT<<-w,S=d.EXTENT*(h.tileID.canonical.x-(o.canonical.x+R<<-w)),A=d.EXTENT*(h.tileID.canonical.y-(o.canonical.y<<-w))),d.ortho(x,0,T,0,T,0,1),d.translate(x,x,[S,A,0])}return new Yh(h.tileID,o.key,x)}_findTileCoveringTileID(o,h){let _=h.getTile(o);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],w=x[o.key];if(_=w?h.getTileByID(w):null,_&&_.hasData()||null===w)return _;let T=_?_.tileID:o,S=T.overscaledZ;const A=h.getSource().minzoom,R=[];if(!w){const N=h.getSource().maxzoom;if(o.canonical.z>=N){const H=o.canonical.z-N;h.getSource().reparseOverscaled?(S=Math.max(o.canonical.z+2,h.transform.tileZoom),T=new d.OverscaledTileID(S,o.wrap,N,o.canonical.x>>H,o.canonical.y>>H)):0!==H&&(S=N,T=new d.OverscaledTileID(S,o.wrap,N,o.canonical.x>>H,o.canonical.y>>H))}T.key!==o.key&&(R.push(T.key),_=h.getTile(T))}const L=N=>{R.forEach(H=>{x[H]=N}),R.length=0};for(S-=1;S>=A&&(!_||!_.hasData());S--){_&&L(_.tileID.key);const N=T.calculateScaledKey(S);if(_=h.getTileByID(N),_&&_.hasData())break;const H=x[N];if(null===H)break;void 0===H?R.push(N):_=h.getTileByID(H)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let _=this._tilesDirty[o];_||(_=this._tilesDirty[o]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(h){let _=0;const x=new d.StructArrayLayout2ui4,w=131;for(let T=1;T<129;T++){for(let S=1;S<129;S++)_=T*w+S,x.emplaceBack(_,_+1),x.emplaceBack(_,_+w),x.emplaceBack(_+1,_+w),128===T&&x.emplaceBack(_+w,_+w+1);x.emplaceBack(_+1,_+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function wn(p){const o=[];for(let h=0;h<p.length;h++){if(null===p[h])continue;const _=p[h].split(" ");o.push(_.pop())}return o}class oo{static cacheKey(o,h,_){let x=`${o}${_?_.cacheKey:""}`;for(const w of h)x+=`/${w}`;return x}constructor(o,h,_,x,w,T){const S=o.gl;this.program=S.createProgram();const A=wn(_.staticAttributes),R=x?x.getBinderAttributes():[],L=A.concat(R),N=_.staticUniforms?wn(_.staticUniforms):[],H=x?x.getBinderUniforms():[],Z=N.concat(H),K=[];for(const ne of Z)K.indexOf(ne)<0&&K.push(ne);let q=x?x.defines():[];q=q.concat(T.map(ne=>`#define ${ne}`));const ie=q.concat(o.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(So):So,So,Cu,hf.fragmentSource,Ui.fragmentSource,_.fragmentSource).join("\n"),Y=q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Cu,hf.vertexSource,Ui.vertexSource,bs.vertexSource,_.vertexSource).join("\n"),Q=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(Q,ie),S.compileShader(Q),S.attachShader(this.program,Q);const X=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(X,Y),S.compileShader(X),S.attachShader(this.program,X),this.attributes={};const ue={};this.numAttributes=L.length;for(let ne=0;ne<this.numAttributes;ne++)L[ne]&&(S.bindAttribLocation(this.program,ne,L[ne]),this.attributes[L[ne]]=ne);S.linkProgram(this.program),S.deleteShader(X),S.deleteShader(Q);for(let ne=0;ne<K.length;ne++){const oe=K[ne];if(oe&&!ue[oe]){const fe=S.getUniformLocation(this.program,oe);fe&&(ue[oe]=fe)}}var ne,oe;this.fixedUniforms=w(o,ue),this.binderUniforms=x?x.getUniforms(o,ue):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(ne=o,(oe=ue).u_dem),u_dem_prev:new d.Uniform1i(ne,oe.u_dem_prev),u_dem_unpack:new d.Uniform4f(ne,oe.u_dem_unpack),u_dem_tl:new d.Uniform2f(ne,oe.u_dem_tl),u_dem_scale:new d.Uniform1f(ne,oe.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(ne,oe.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(ne,oe.u_dem_scale_prev),u_dem_size:new d.Uniform1f(ne,oe.u_dem_size),u_dem_lerp:new d.Uniform1f(ne,oe.u_dem_lerp),u_exaggeration:new d.Uniform1f(ne,oe.u_exaggeration),u_depth:new d.Uniform1i(ne,oe.u_depth),u_depth_size_inv:new d.Uniform2f(ne,oe.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(ne,oe.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(ne,oe.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(ne,oe.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(ne,oe.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(ne,oe.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(ne,oe.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(ne,oe.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((ne,oe)=>({u_fog_matrix:new d.UniformMatrix4f(ne,oe.u_fog_matrix),u_fog_range:new d.Uniform2f(ne,oe.u_fog_range),u_fog_color:new d.Uniform4f(ne,oe.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(ne,oe.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(ne,oe.u_fog_temporal_offset),u_frustum_tl:new d.Uniform3f(ne,oe.u_frustum_tl),u_frustum_tr:new d.Uniform3f(ne,oe.u_frustum_tr),u_frustum_br:new d.Uniform3f(ne,oe.u_frustum_br),u_frustum_bl:new d.Uniform3f(ne,oe.u_frustum_bl),u_globe_pos:new d.Uniform3f(ne,oe.u_globe_pos),u_globe_radius:new d.Uniform1f(ne,oe.u_globe_radius),u_globe_transition:new d.Uniform1f(ne,oe.u_globe_transition),u_is_globe:new d.Uniform1i(ne,oe.u_is_globe),u_viewport:new d.Uniform2f(ne,oe.u_viewport)}))(o,ue))}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)_[x].set(h[x])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)_[x].location&&_[x].set(h[x])}}draw(o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q,ie,Y){const Q=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(x),o.setColorMode(w),o.setCullFace(T);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(S[ue]);K&&K.setUniforms(o,this.binderUniforms,H,{zoom:Z});const X={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[h];for(const ue of N.get()){const ne=ue.vaos||(ue.vaos={});(ne[A]||(ne[A]=new pg)).bind(o,this,R,K?K.getPaintVertexBuffers():[],L,ue.vertexOffset,q,ie,Y),Q.drawElements(h,ue.primitiveLength*X,Q.UNSIGNED_SHORT,ue.primitiveOffset*X*2)}}}function Fr(p,o,h){const _=1/di(h,1,o.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,o.transform.tileZoom)/x,T=w*(h.tileID.canonical.x+h.tileID.wrap*x),S=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,S>>16],u_pixel_coord_lower:[65535&T,65535&S]}}const ho=d.create(),fo=(p,o,h,_,x,w,T,S,A)=>{const R=o.style.light,L=R.properties.get("position"),N=[L.x,L.y,L.z],H=d.create$1();"viewport"===R.properties.get("anchor")&&(d.fromRotation(H,-o.transform.angle),d.transformMat3(N,N,H));const Z=R.properties.get("color"),K=o.transform,q={u_matrix:p,u_lightpos:N,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ho,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===K.projection.name&&(q.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],q.u_zoom_transition=T,q.u_inv_rot_matrix=A,q.u_merc_center=S,q.u_up_dir=K.projection.upVector(new d.CanonicalTileID(0,0,0),S[0]*d.EXTENT,S[1]*d.EXTENT),q.u_height_lift=w),q},so=(p,o,h,_,x,w,T,S,A,R,L)=>{const N=fo(p,o,h,_,x,S,A,R,L),H={u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8};return d.extend(N,Fr(w,o,T),H)},ao=p=>({u_matrix:p}),Gt=(p,o,h,_)=>d.extend(ao(p),Fr(h,o,_)),jn=(p,o)=>({u_matrix:p,u_world:o}),Yr=(p,o,h,_,x)=>d.extend(Gt(p,o,h,_),{u_world:x}),Ci=d.create(),ba=(p,o,h,_,x,w)=>{const T=p.transform,S="globe"===T.projection.name;let A;if("map"===w.paint.get("circle-pitch-alignment"))if(S){const L=d.globePixelsToTileUnits(T.zoom,o.canonical)*T._projectionScaler;A=Float32Array.from([L,0,0,L])}else A=T.calculatePixelsToTileUnitsMatrix(h);else A=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:p.translatePosMatrix(o.projMatrix,h,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Ci,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){R.u_inv_rot_matrix=_,R.u_merc_center=x,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=d.globeToMercatorTransition(T.zoom);const L=x[0]*d.EXTENT,N=x[1]*d.EXTENT;R.u_up_dir=T.projection.upVector(new d.CanonicalTileID(0,0,0),L,N)}return R},ji=p=>{const o=[];return"map"===p.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},wa=(p,o,h,_)=>{const x=d.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:o.getCameraToCenterDistance(_),u_extrude_scale:[o.pixelsToGLUnits[0]/x,o.pixelsToGLUnits[1]/x]}},ti=(p,o,h=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:h}),Tl=d.create(),Dc=(p,o,h,_,x,w,T)=>{const S=p.transform,A="globe"===S.projection.name,R=A?d.globePixelsToTileUnits(S.zoom,o.canonical)*S._projectionScaler:di(h,1,w),L={u_matrix:o.projMatrix,u_extrude_scale:R,u_intensity:T,u_inv_rot_matrix:Tl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=_,L.u_merc_center=x,L.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],L.u_zoom_transition=d.globeToMercatorTransition(S.zoom);const N=x[0]*d.EXTENT,H=x[1]*d.EXTENT;L.u_up_dir=S.projection.upVector(new d.CanonicalTileID(0,0,0),N,H)}return L},qn=(p,o,h,_,x,w,T,S)=>{const A=p.transform,R=A.calculatePixelsToTileUnitsMatrix(o),L={u_matrix:Qh(p,o,h,x),u_pixels_to_tile_units:R,u_device_pixel_ratio:T,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:S};if(Qs(h)){const N=Js(o,p.transform);L.u_texsize=o.lineAtlasTexture.size,L.u_scale=[N,_.fromScale,_.toScale],L.u_mix=_.t}return L},Jh=(p,o,h,_,x,w)=>{const T=p.transform,S=Js(o,T);return{u_matrix:Qh(p,o,h,x),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:w,u_image:0,u_scale:[S,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Js(p,o){return 1/di(p,1,o.tileZoom)}function Qh(p,o,h,_){return p.translatePosMatrix(_||o.tileID.projMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Qs(p){const o=p.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const po=(p,o,h,_,x,w)=>{return{u_matrix:p,u_tl_parent:o,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=x.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Dl(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var T,S};function Dl(p){p*=Math.PI/180;const o=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Sl=d.create(),Io=(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q)=>{const ie=x.transform,Y={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:ie.width/ie.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+_,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Sl,u_up_vector:[0,-1,0]};return"globe"===q.name&&(Y.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],Y.u_zoom_transition=N,Y.u_inv_rot_matrix=Z,Y.u_merc_center=H,Y.u_camera_forward=ie._camera.forward(),Y.u_ecef_origin=d.globeECEFOrigin(ie.globeMatrix,L.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(ie.globeMatrix),Y.u_up_vector=K),Y},Il=(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q,ie)=>d.extend(Io(p,o,h,_,x,w,T,S,A,R,N,H,Z,K,q,ie),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+L}),df=(p,o,h,_,x,w,T,S,A,R,L,N,H,Z,K,q)=>d.extend(Il(p,o,h,_,x,w,T,S,!0,A,!0,L,N,H,Z,K,q),{u_texsize_icon:R,u_texture_icon:1}),Hr=(p,o,h)=>({u_matrix:p,u_opacity:o,u_color:h}),Sc=(p,o,h,_,x,w)=>d.extend(function(T,S,A,R){const L=A.imageManager.getPattern(T.from.toString()),N=A.imageManager.getPattern(T.to.toString()),{width:H,height:Z}=A.imageManager.getPixelSize(),K=Math.pow(2,R.tileID.overscaledZ),q=R.tileSize*Math.pow(2,A.transform.tileZoom)/K,ie=q*(R.tileID.canonical.x+R.tileID.wrap*K),Y=q*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[H,Z],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/di(R,1,A.transform.tileZoom),u_pixel_coord_upper:[ie>>16,Y>>16],u_pixel_coord_lower:[65535&ie,65535&Y]}}(_,w,h,x),{u_matrix:p,u_opacity:o}),gg={fillExtrusion:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_lightpos:new d.Uniform3f(p,o.u_lightpos),u_lightintensity:new d.Uniform1f(p,o.u_lightintensity),u_lightcolor:new d.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,o.u_vertical_gradient),u_opacity:new d.Uniform1f(p,o.u_opacity),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_up_dir:new d.Uniform3f(p,o.u_up_dir),u_height_lift:new d.Uniform1f(p,o.u_height_lift)}),fillExtrusionPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_lightpos:new d.Uniform3f(p,o.u_lightpos),u_lightintensity:new d.Uniform1f(p,o.u_lightintensity),u_lightcolor:new d.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,o.u_vertical_gradient),u_height_factor:new d.Uniform1f(p,o.u_height_factor),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_up_dir:new d.Uniform3f(p,o.u_up_dir),u_height_lift:new d.Uniform1f(p,o.u_height_lift),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade),u_opacity:new d.Uniform1f(p,o.u_opacity)}),fill:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),fillPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade)}),fillOutline:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_world:new d.Uniform2f(p,o.u_world)}),fillOutlinePattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_world:new d.Uniform2f(p,o.u_world),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade)}),circle:(p,o)=>({u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(p,o.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_up_dir:new d.Uniform3f(p,o.u_up_dir)}),collisionBox:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(p,o.u_extrude_scale)}),collisionCircle:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_inv_matrix:new d.UniformMatrix4f(p,o.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(p,o.u_viewport_size)}),debug:(p,o)=>({u_color:new d.UniformColor(p,o.u_color),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_overlay:new d.Uniform1i(p,o.u_overlay),u_overlay_scale:new d.Uniform1f(p,o.u_overlay_scale)}),clippingMask:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),heatmap:(p,o)=>({u_extrude_scale:new d.Uniform1f(p,o.u_extrude_scale),u_intensity:new d.Uniform1f(p,o.u_intensity),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_up_dir:new d.Uniform3f(p,o.u_up_dir)}),heatmapTexture:(p,o)=>({u_image:new d.Uniform1i(p,o.u_image),u_color_ramp:new d.Uniform1i(p,o.u_color_ramp),u_opacity:new d.Uniform1f(p,o.u_opacity)}),hillshade:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_latrange:new d.Uniform2f(p,o.u_latrange),u_light:new d.Uniform2f(p,o.u_light),u_shadow:new d.UniformColor(p,o.u_shadow),u_highlight:new d.UniformColor(p,o.u_highlight),u_accent:new d.UniformColor(p,o.u_accent)}),hillshadePrepare:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_dimension:new d.Uniform2f(p,o.u_dimension),u_zoom:new d.Uniform1f(p,o.u_zoom),u_unpack:new d.Uniform4f(p,o.u_unpack)}),line:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(p,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(p,o.u_units_to_pixels),u_dash_image:new d.Uniform1i(p,o.u_dash_image),u_gradient_image:new d.Uniform1i(p,o.u_gradient_image),u_image_height:new d.Uniform1f(p,o.u_image_height),u_texsize:new d.Uniform2f(p,o.u_texsize),u_scale:new d.Uniform3f(p,o.u_scale),u_mix:new d.Uniform1f(p,o.u_mix),u_alpha_discard_threshold:new d.Uniform1f(p,o.u_alpha_discard_threshold),u_trim_offset:new d.Uniform2f(p,o.u_trim_offset)}),linePattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(p,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_image:new d.Uniform1i(p,o.u_image),u_units_to_pixels:new d.Uniform2f(p,o.u_units_to_pixels),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade),u_alpha_discard_threshold:new d.Uniform1f(p,o.u_alpha_discard_threshold)}),raster:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_tl_parent:new d.Uniform2f(p,o.u_tl_parent),u_scale_parent:new d.Uniform1f(p,o.u_scale_parent),u_fade_t:new d.Uniform1f(p,o.u_fade_t),u_opacity:new d.Uniform1f(p,o.u_opacity),u_image0:new d.Uniform1i(p,o.u_image0),u_image1:new d.Uniform1i(p,o.u_image1),u_brightness_low:new d.Uniform1f(p,o.u_brightness_low),u_brightness_high:new d.Uniform1f(p,o.u_brightness_high),u_saturation_factor:new d.Uniform1f(p,o.u_saturation_factor),u_contrast_factor:new d.Uniform1f(p,o.u_contrast_factor),u_spin_weights:new d.Uniform3f(p,o.u_spin_weights),u_perspective_transform:new d.Uniform2f(p,o.u_perspective_transform)}),symbolIcon:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_camera_forward:new d.Uniform3f(p,o.u_camera_forward),u_tile_matrix:new d.UniformMatrix4f(p,o.u_tile_matrix),u_up_vector:new d.Uniform3f(p,o.u_up_vector),u_ecef_origin:new d.Uniform3f(p,o.u_ecef_origin),u_texture:new d.Uniform1i(p,o.u_texture)}),symbolSDF:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_texture:new d.Uniform1i(p,o.u_texture),u_gamma_scale:new d.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(p,o.u_tile_id),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_camera_forward:new d.Uniform3f(p,o.u_camera_forward),u_tile_matrix:new d.UniformMatrix4f(p,o.u_tile_matrix),u_up_vector:new d.Uniform3f(p,o.u_up_vector),u_ecef_origin:new d.Uniform3f(p,o.u_ecef_origin),u_is_halo:new d.Uniform1i(p,o.u_is_halo)}),symbolTextAndIcon:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_texsize_icon:new d.Uniform2f(p,o.u_texsize_icon),u_texture:new d.Uniform1i(p,o.u_texture),u_texture_icon:new d.Uniform1i(p,o.u_texture_icon),u_gamma_scale:new d.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(p,o.u_is_halo)}),background:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_opacity:new d.Uniform1f(p,o.u_opacity),u_color:new d.UniformColor(p,o.u_color)}),backgroundPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_opacity:new d.Uniform1f(p,o.u_opacity),u_image:new d.Uniform1i(p,o.u_image),u_pattern_tl_a:new d.Uniform2f(p,o.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(p,o.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(p,o.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(p,o.u_pattern_br_b),u_texsize:new d.Uniform2f(p,o.u_texsize),u_mix:new d.Uniform1f(p,o.u_mix),u_pattern_size_a:new d.Uniform2f(p,o.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(p,o.u_pattern_size_b),u_scale_a:new d.Uniform1f(p,o.u_scale_a),u_scale_b:new d.Uniform1f(p,o.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(p,o.u_tile_units_to_pixels)}),terrainRaster:Ec,terrainDepth:Ec,skybox:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_sun_direction:new d.Uniform3f(p,o.u_sun_direction),u_cubemap:new d.Uniform1i(p,o.u_cubemap),u_opacity:new d.Uniform1f(p,o.u_opacity),u_temporal_offset:new d.Uniform1f(p,o.u_temporal_offset)}),skyboxGradient:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_color_ramp:new d.Uniform1i(p,o.u_color_ramp),u_center_direction:new d.Uniform3f(p,o.u_center_direction),u_radius:new d.Uniform1f(p,o.u_radius),u_opacity:new d.Uniform1f(p,o.u_opacity),u_temporal_offset:new d.Uniform1f(p,o.u_temporal_offset)}),skyboxCapture:(p,o)=>({u_matrix_3f:new d.UniformMatrix3f(p,o.u_matrix_3f),u_sun_direction:new d.Uniform3f(p,o.u_sun_direction),u_sun_intensity:new d.Uniform1f(p,o.u_sun_intensity),u_color_tint_r:new d.Uniform4f(p,o.u_color_tint_r),u_color_tint_m:new d.Uniform4f(p,o.u_color_tint_m),u_luminance:new d.Uniform1f(p,o.u_luminance)}),globeRaster:(p,o)=>({u_proj_matrix:new d.UniformMatrix4f(p,o.u_proj_matrix),u_globe_matrix:new d.UniformMatrix4f(p,o.u_globe_matrix),u_normalize_matrix:new d.UniformMatrix4f(p,o.u_normalize_matrix),u_merc_matrix:new d.UniformMatrix4f(p,o.u_merc_matrix),u_zoom_transition:new d.Uniform1f(p,o.u_zoom_transition),u_merc_center:new d.Uniform2f(p,o.u_merc_center),u_image0:new d.Uniform1i(p,o.u_image0),u_grid_matrix:new d.UniformMatrix3f(p,o.u_grid_matrix),u_frustum_tl:new d.Uniform3f(p,o.u_frustum_tl),u_frustum_tr:new d.Uniform3f(p,o.u_frustum_tr),u_frustum_br:new d.Uniform3f(p,o.u_frustum_br),u_frustum_bl:new d.Uniform3f(p,o.u_frustum_bl),u_globe_pos:new d.Uniform3f(p,o.u_globe_pos),u_globe_radius:new d.Uniform1f(p,o.u_globe_radius),u_viewport:new d.Uniform2f(p,o.u_viewport)}),globeAtmosphere:(p,o)=>({u_frustum_tl:new d.Uniform3f(p,o.u_frustum_tl),u_frustum_tr:new d.Uniform3f(p,o.u_frustum_tr),u_frustum_br:new d.Uniform3f(p,o.u_frustum_br),u_frustum_bl:new d.Uniform3f(p,o.u_frustum_bl),u_horizon:new d.Uniform1f(p,o.u_horizon),u_transition:new d.Uniform1f(p,o.u_transition),u_fadeout_range:new d.Uniform1f(p,o.u_fadeout_range),u_color:new d.Uniform4f(p,o.u_color),u_high_color:new d.Uniform4f(p,o.u_high_color),u_space_color:new d.Uniform4f(p,o.u_space_color),u_star_intensity:new d.Uniform1f(p,o.u_star_intensity),u_star_density:new d.Uniform1f(p,o.u_star_density),u_star_size:new d.Uniform1f(p,o.u_star_size),u_temporal_offset:new d.Uniform1f(p,o.u_temporal_offset),u_horizon_angle:new d.Uniform1f(p,o.u_horizon_angle),u_rotation_matrix:new d.UniformMatrix4f(p,o.u_rotation_matrix)})};let Al;function ed(p,o,h,_,x,w,T){const S=p.context,A=S.gl,R=p.transform,L=p.useProgram("collisionBox"),N=[];let H=0,Z=0;for(let ue=0;ue<_.length;ue++){const ne=_[ue],oe=o.getTile(ne),fe=oe.getBucket(h);if(!fe)continue;const ke=ai(ne,fe,R);let Ve=ke;0===x[0]&&0===x[1]||(Ve=p.translatePosMatrix(ke,oe,x,w));const Re=T?fe.textCollisionBox:fe.iconCollisionBox,ft=fe.collisionCircleArray;if(ft.length>0){const ae=d.create(),Ie=Ve;d.mul(ae,fe.placementInvProjMatrix,R.glCoordMatrix),d.mul(ae,ae,fe.placementViewportMatrix),N.push({circleArray:ft,circleOffset:Z,transform:Ie,invTransform:ae,projection:fe.getProjection()}),H+=ft.length/4,Z=H}Re&&(p.terrain&&p.terrain.setupElevationDraw(oe,L),L.draw(S,A.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,wa(Ve,R,oe,fe.getProjection()),h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,R.zoom,null,Re.collisionVertexBuffer,Re.collisionVertexBufferExt))}if(!T||!N.length)return;const K=p.useProgram("collisionCircle"),q=new d.StructArrayLayout2f1f2i16;q.resize(4*H),q._trim();let ie=0;for(const ue of N)for(let ne=0;ne<ue.circleArray.length/4;ne++){const oe=4*ne,fe=ue.circleArray[oe+0],ke=ue.circleArray[oe+1],Ve=ue.circleArray[oe+2],Re=ue.circleArray[oe+3];q.emplace(ie++,fe,ke,Ve,Re,0),q.emplace(ie++,fe,ke,Ve,Re,1),q.emplace(ie++,fe,ke,Ve,Re,2),q.emplace(ie++,fe,ke,Ve,Re,3)}(!Al||Al.length<2*H)&&(Al=function(ue){const ne=2*ue,oe=new d.StructArrayLayout3ui6;oe.resize(ne),oe._trim();for(let fe=0;fe<ne;fe++){const ke=6*fe;oe.uint16[ke+0]=4*fe+0,oe.uint16[ke+1]=4*fe+1,oe.uint16[ke+2]=4*fe+2,oe.uint16[ke+3]=4*fe+2,oe.uint16[ke+4]=4*fe+3,oe.uint16[ke+5]=4*fe+0}return oe}(H));const Y=S.createIndexBuffer(Al,!0),Q=S.createVertexBuffer(q,d.collisionCircleLayout.members,!0);for(const ue of N){const ne={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(X=R).getCameraToCenterDistance(ue.projection),u_viewport_size:[X.width,X.height]};K.draw(S,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,ne,h.id,Q,Y,d.SegmentVector.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,R.zoom)}var X;Q.destroy(),Y.destroy()}const Ic=d.create();function td(p,o,h,_,x,w){const{horizontalAlign:T,verticalAlign:S}=d.getAnchorAlignment(p),A=-(T-.5)*o,R=-(S-.5)*h,L=d.evaluateVariableOffset(p,_);return new d.pointGeometry((A/x+L[0])*w,(R/x+L[1])*w)}function Pl(p,o,h,_,x,w,T,S,A,R,L){const N=p.text.placedSymbolArray,H=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,K={},q=sf(S,p.getProjection(),w),ie=w.elevation,Y=p.getProjection().upVectorScale(S.canonical,w.center.lat,w.worldSize);H.clear();for(let Q=0;Q<N.length;Q++){const X=N.get(Q),ue=p.allowVerticalPlacement&&!X.placedOrientation,ne=X.hidden||!X.crossTileID||ue?null:_[X.crossTileID];if(ne){const oe=new d.pointGeometry(X.tileAnchorX,X.tileAnchorY),fe=p.getProjection().upVector(S.canonical,oe.x,oe.y),ke=ie?ie.getAtTileOffset(S,oe.x,oe.y):0,Ve=Rs([X.projectedAnchorX+ke*fe[0]*Y.metersToTile,X.projectedAnchorY+ke*fe[1]*Y.metersToTile,X.projectedAnchorZ+ke*fe[2]*Y.metersToTile],h?q:T),Re=Mr(w.getCameraToCenterDistance(p.getProjection()),Ve.signedDistanceFromCamera);let ft=x.evaluateSizeForFeature(p.textSizeData,R,X)*Re/d.ONE_EM;h&&(ft*=p.tilePixelRatio/A);const{width:ae,height:Ie,anchor:Ke,textOffset:Dt,textScale:Ye}=ne,Vt=td(Ke,ae,Ie,Dt,Ye,ft);let xt;if(h){const wt=oe.add(Vt),{x:bt,y:Lt,z:sn}=p.getProjection().projectTilePoint(wt.x,wt.y,S.canonical);xt=Rs([bt+ke*fe[0]*Y.metersToTile,Lt+ke*fe[1]*Y.metersToTile,sn+ke*fe[2]*Y.metersToTile],T).point}else{const wt=o?Vt.rotate(-w.angle):Vt;xt=[Ve.point[0]+wt.x,Ve.point[1]+wt.y,0]}const Et=p.allowVerticalPlacement&&X.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<X.numGlyphs;wt++)d.addDynamicAttributes(H,xt[0],xt[1],xt[2],Et);L&&X.associatedIconIndex>=0&&(K[X.associatedIconIndex]={shiftedAnchor:xt,angle:Et})}else Tn(X.numGlyphs,H)}if(L){Z.clear();const Q=p.icon.placedSymbolArray;for(let X=0;X<Q.length;X++){const ue=Q.get(X);if(ue.hidden)Tn(ue.numGlyphs,Z);else{const ne=K[X];if(ne)for(let oe=0;oe<ue.numGlyphs;oe++)d.addDynamicAttributes(Z,ne.shiftedAnchor[0],ne.shiftedAnchor[1],ne.shiftedAnchor[2],ne.angle);else Tn(ue.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(H)}function Ki(p,o,h){return h.iconsInText&&o?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function nd(p,o,h,_,x,w,T,S,A,R,L,N){const H=p.context,Z=H.gl,K=p.transform,q="map"===S,ie="map"===A,Y=q&&"point"!==h.layout.get("symbol-placement"),Q=q&&!ie&&!Y,X=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let ue=!1;const ne=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),oe=[d.mercatorXfromLng(K.center.lng),d.mercatorYfromLat(K.center.lat)],fe=h.layout.get("text-variable-anchor"),ke="globe"===K.projection.name,Ve=[],Re=[0,-1,0];let ft=Re;!ke&&!K.mercatorFromTransition||q||(ft=function(ae){const Ie=ae._camera.getWorldToCamera(ae.worldSize,1),Ke=d.multiply([],Ie,ae.globeMatrix);d.invert(Ke,Ke);const Dt=[0,0,0],Ye=[0,1,0,0];return d.transformMat4$1(Ye,Ye,Ke),Dt[0]=Ye[0],Dt[1]=Ye[1],Dt[2]=Ye[2],d.normalize(Dt,Dt),Dt}(K));for(const ae of _){const Ie=o.getTile(ae),Ke=Ie.getBucket(h);if(!Ke||"mercator"===Ke.projection.name&&ke)continue;const Dt=x?Ke.text:Ke.icon;if(!Dt||Ke.fullyClipped||!Dt.segments.get().length)continue;const Ye=Dt.programConfigurations.get(h.id),Vt=x||Ke.sdfIcons,xt=x?Ke.textSizeData:Ke.iconSizeData,Et=ie||0!==K.pitch,wt=d.evaluateSizeForZoom(xt,K.zoom);let bt,Lt,sn,Sn,qt=[0,0],vn=null;if(x){if(Lt=Ie.glyphAtlasTexture,sn=Z.LINEAR,bt=Ie.glyphAtlasTexture.size,Ke.iconsInText){qt=Ie.imageAtlasTexture.size,vn=Ie.imageAtlasTexture;const ki="composite"===xt.kind||"camera"===xt.kind;Sn=Et||p.options.rotating||p.options.zooming||ki?Z.LINEAR:Z.NEAREST}}else{const ki=1!==h.layout.get("icon-size").constantOr(0)||Ke.iconsNeedLinear;Lt=Ie.imageAtlasTexture,sn=Vt||p.options.rotating||p.options.zooming||ki||Et?Z.LINEAR:Z.NEAREST,bt=Ie.imageAtlasTexture.size}const hr="globe"===Ke.projection.name,Ur=hr?ft:Re,qr=hr?d.globeToMercatorTransition(K.zoom):0,Ar=sf(ae,Ke.getProjection(),K),jo=K.calculatePixelsToTileUnitsMatrix(Ie),$i=bn(Ar,Ie.tileID.canonical,ie,q,K,Ke.getProjection(),jo),Da=p.terrain&&ie&&Y?d.invert(d.create(),$i):Ic,Pr=ya(Ar,Ie.tileID.canonical,ie,q,K,Ke.getProjection(),jo),Zr=fe&&Ke.hasTextData(),sr="none"!==h.layout.get("icon-text-fit")&&Zr&&Ke.hasIconData();if(Y){const ki=K.elevation,os=ki?ki.getAtTileOffsetFunc(ae,K.center.lat,K.worldSize,Ke.getProjection()):rl=>[0,0,0],Bs=ks(Ar,Ie.tileID.canonical,ie,q,K,Ke.getProjection(),jo);xs(Ke,Ar,p,x,Bs,Pr,ie,R,os,ae)}const li=Y||x&&fe||sr,Gi=p.translatePosMatrix(Ar,Ie,w,T),zr=li?Ic:$i,ri=p.translatePosMatrix(Pr,Ie,w,T,!0),nl=Ke.getProjection().createInversionMatrix(K,ae.canonical),zs=[];p.terrain&&ie&&zs.push("PITCH_WITH_MAP_TERRAIN"),hr&&zs.push("PROJECTION_GLOBE_VIEW"),li&&zs.push("PROJECTED_POS_ON_VIEWPORT");const Ul=Vt&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let jl;jl=Vt?Ke.iconsInText?df(xt.kind,wt,Q,ie,p,Gi,zr,ri,bt,qt,ae,qr,oe,nl,Ur,Ke.getProjection()):Il(xt.kind,wt,Q,ie,p,Gi,zr,ri,x,bt,!0,ae,qr,oe,nl,Ur,Ke.getProjection()):Io(xt.kind,wt,Q,ie,p,Gi,zr,ri,x,bt,ae,qr,oe,nl,Ur,Ke.getProjection());const Ns={program:p.useProgram(Ki(Vt,x,Ke),Ye,zs),buffers:Dt,uniformValues:jl,atlasTexture:Lt,atlasTextureIcon:vn,atlasInterpolation:sn,atlasInterpolationIcon:Sn,isSDF:Vt,hasHalo:Ul,tile:Ie,labelPlaneMatrixInv:Da};if(X&&Ke.canOverlap){ue=!0;const ki=Dt.segments.get();for(const os of ki)Ve.push({segments:new d.SegmentVector([os]),sortKey:os.sortKey,state:Ns})}else Ve.push({segments:Dt.segments,sortKey:0,state:Ns})}ue&&Ve.sort((ae,Ie)=>ae.sortKey-Ie.sortKey);for(const ae of Ve){const Ie=ae.state;if(p.terrain&&p.terrain.setupElevationDraw(Ie.tile,Ie.program,{useDepthForOcclusion:!ke,labelPlaneMatrixInv:Ie.labelPlaneMatrixInv}),H.activeTexture.set(Z.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,Z.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(H.activeTexture.set(Z.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ie.isSDF){const Ke=Ie.uniformValues;Ie.hasHalo&&(Ke.u_is_halo=1,mo(Ie.buffers,ae.segments,h,p,Ie.program,ne,L,N,Ke)),Ke.u_is_halo=0}mo(Ie.buffers,ae.segments,h,p,Ie.program,ne,L,N,Ie.uniformValues)}}function mo(p,o,h,_,x,w,T,S,A){const R=_.context;x.draw(R,R.gl.TRIANGLES,w,T,S,d.CullFaceMode.disabled,A,h.id,p.layoutVertexBuffer,p.indexBuffer,o,h.paint,_.transform.zoom,p.programConfigurations.get(h.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer)}function ts(p,o,h,_,x,w,T){const S=p.context.gl,A=h.paint.get("fill-pattern"),R=A&&A.constantOr(1),L=h.getCrossfadeParameters();let N,H,Z,K,q;T?(H=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(H=R?"fillPattern":"fill",N=S.TRIANGLES);for(const ie of _){const Y=o.getTile(ie);if(R&&!Y.patternsLoaded())continue;const Q=Y.getBucket(h);if(!Q)continue;p.prepareDrawTile();const X=Q.programConfigurations.get(h.id),ue=p.useProgram(H,X);R&&(p.context.activeTexture.set(S.TEXTURE0),Y.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),X.updatePaintBuffers(L));const ne=A.constantOr(null);if(ne&&Y.imageAtlas){const fe=Y.imageAtlas,ke=fe.patternPositions[ne.to.toString()],Ve=fe.patternPositions[ne.from.toString()];ke&&Ve&&X.setConstantPatternPositions(ke,Ve)}const oe=p.translatePosMatrix(ie.projMatrix,Y,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){K=Q.indexBuffer2,q=Q.segments2;const fe=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Z="fillOutlinePattern"===H&&R?Yr(oe,p,L,Y,fe):jn(oe,fe)}else K=Q.indexBuffer,q=Q.segments,Z=R?Gt(oe,p,L,Y):ao(oe);p.prepareDrawProgram(p.context,ue,ie.toUnwrapped()),ue.draw(p.context,N,x,p.stencilModeForClipping(ie),w,d.CullFaceMode.disabled,Z,h.id,Q.layoutVertexBuffer,K,q,h.paint,p.transform.zoom,X)}}function Ac(p,o,h,_,x,w,T){const S=p.context,A=S.gl,R=p.transform,L=h.paint.get("fill-extrusion-pattern"),N=L.constantOr(1),H=h.getCrossfadeParameters(),Z=h.paint.get("fill-extrusion-opacity"),K="globe"===R.projection.name?d.fillExtrusionHeightLift():0,q="globe"===R.projection.name,ie=q?d.globeToMercatorTransition(R.zoom):0,Y=[d.mercatorXfromLng(R.center.lng),d.mercatorYfromLat(R.center.lat)],Q=[];q&&Q.push("PROJECTION_GLOBE_VIEW");for(const X of _){const ue=o.getTile(X),ne=ue.getBucket(h);if(!ne||ne.projection.name!==R.projection.name)continue;const oe=ne.programConfigurations.get(h.id),fe=p.useProgram(N?"fillExtrusionPattern":"fillExtrusion",oe,Q);if(p.terrain){const Ie=p.terrain;if(p.style.terrainSetForDrapingOnly())Ie.setupElevationDraw(ue,fe,{useMeterToDem:!0});else{if(!ne.enableTerrain)continue;if(Ie.setupElevationDraw(ue,fe,{useMeterToDem:!0}),Pc(S,o,X,ne,h,Ie),!ne.centroidVertexBuffer){const Ke=fe.attributes.a_centroid_pos;void 0!==Ke&&A.vertexAttrib2f(Ke,0,0)}}}N&&(p.context.activeTexture.set(A.TEXTURE0),ue.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),oe.updatePaintBuffers(H));const ke=L.constantOr(null);if(ke&&ue.imageAtlas){const Ie=ue.imageAtlas,Ke=Ie.patternPositions[ke.to.toString()],Dt=Ie.patternPositions[ke.from.toString()];Ke&&Dt&&oe.setConstantPatternPositions(Ke,Dt)}const Ve=p.translatePosMatrix(X.projMatrix,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Re=R.projection.createInversionMatrix(R,X.canonical),ft=h.paint.get("fill-extrusion-vertical-gradient"),ae=N?so(Ve,p,ft,Z,X,H,ue,K,ie,Y,Re):fo(Ve,p,ft,Z,X,K,ie,Y,Re);p.prepareDrawProgram(S,fe,X.toUnwrapped()),fe.draw(S,S.gl.TRIANGLES,x,w,T,d.CullFaceMode.backCCW,ae,h.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,h.paint,p.transform.zoom,oe,p.terrain?ne.centroidVertexBuffer:null,q?ne.layoutVertexExtBuffer:null)}}function Pc(p,o,h,_,x,w){const T=[Y=>{let Q=Y.canonical.x-1,X=Y.wrap;return Q<0&&(Q=(1<<Y.canonical.z)-1,X--),new d.OverscaledTileID(Y.overscaledZ,X,Y.canonical.z,Q,Y.canonical.y)},Y=>{let Q=Y.canonical.x+1,X=Y.wrap;return Q===1<<Y.canonical.z&&(Q=0,X++),new d.OverscaledTileID(Y.overscaledZ,X,Y.canonical.z,Q,Y.canonical.y)},Y=>new d.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new d.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],S=Y=>{const Q=o.getSource().minzoom,X=ne=>{const oe=o.getTileByID(ne);if(oe&&oe.hasData())return oe.getBucket(x)},ue=[0,-1,1];for(const ne of ue){if(Y.overscaledZ+ne<Q)continue;const oe=X(Y.calculateScaledKey(Y.overscaledZ+ne));if(oe)return oe}},A=[0,0,0],R=(Y,Q)=>(A[0]=Math.min(Y.min.y,Q.min.y),A[1]=Math.max(Y.max.y,Q.max.y),A[2]=d.EXTENT-Q.min.x>Y.max.x?Q.min.x-d.EXTENT:Y.max.x,A),L=(Y,Q)=>(A[0]=Math.min(Y.min.x,Q.min.x),A[1]=Math.max(Y.max.x,Q.max.x),A[2]=d.EXTENT-Q.min.y>Y.max.y?Q.min.y-d.EXTENT:Y.max.y,A),N=[(Y,Q)=>R(Y,Q),(Y,Q)=>R(Q,Y),(Y,Q)=>L(Y,Q),(Y,Q)=>L(Q,Y)],H=new d.pointGeometry(0,0);let Z,K,q;const ie=(Y,Q,X,ue,ne)=>{const oe=[[ue?X:Y,ue?Y:X,0],[ue?X:Q,ue?Q:X,0]],fe=ne<0?d.EXTENT+ne:ne,ke=[ue?fe:(Y+Q)/2,ue?(Y+Q)/2:fe,0];return 0===X&&ne<0||0!==X&&ne>0?w.getForTilePoints(q,[ke],!0,K):oe.push(ke),w.getForTilePoints(h,oe,!0,Z),Math.max(oe[0][2],oe[1][2],ke[2])/w.exaggeration()};for(let Y=0;Y<4;Y++){const Q=(Y<2?1:5)-Y,X=_.borders[Y];if(0===X.length)continue;const ue=q=T[Y](h),ne=S(ue);if(!(ne&&ne instanceof d.FillExtrusionBucket&&ne.enableTerrain)||_.borderDoneWithNeighborZ[Y]===ne.canonical.z&&ne.borderDoneWithNeighborZ[Q]===_.canonical.z||(K=w.findDEMTileFor(ue),!K||!K.dem))continue;if(!Z){const Ve=w.findDEMTileFor(h);if(!Ve||!Ve.dem)return;Z=Ve}const oe=ne.borders[Q];let fe=0;const ke=ne.borderDoneWithNeighborZ[Q]!==_.canonical.z;if(_.canonical.z===ne.canonical.z){for(let Ve=0;Ve<X.length;Ve++){const Re=_.featuresOnBorder[X[Ve]],ft=Re.borders[Y];let ae;for(;fe<oe.length&&(ae=ne.featuresOnBorder[oe[fe]],!(ae.borders[Q][1]>ft[0]+3));)ke&&ne.encodeCentroid(void 0,ae,!1),fe++;if(ae&&fe<oe.length){const Ie=fe;let Ke=0;for(;!(ae.borders[Q][0]>ft[1]-3)&&(Ke++,++fe!==oe.length);)ae=ne.featuresOnBorder[oe[fe]];if(ae=ne.featuresOnBorder[oe[Ie]],Re.intersectsCount()>1||ae.intersectsCount()>1||1!==Ke){1!==Ke&&(fe=Ie),_.encodeCentroid(void 0,Re,!1),ke&&ne.encodeCentroid(void 0,ae,!1);continue}const Dt=N[Y](Re,ae),Ye=Y%2?d.EXTENT-1:0;H.x=ie(Dt[0],Math.min(d.EXTENT-1,Dt[1]),Ye,Y<2,Dt[2]),H.y=0,_.encodeCentroid(H,Re,!1),ke&&ne.encodeCentroid(H,ae,!1)}else _.encodeCentroid(void 0,Re,!1)}_.borderDoneWithNeighborZ[Y]=ne.canonical.z,_.needsCentroidUpdate=!0,ke&&(ne.borderDoneWithNeighborZ[Q]=_.canonical.z,ne.needsCentroidUpdate=!0)}else{for(const Ve of X)_.encodeCentroid(void 0,_.featuresOnBorder[Ve],!1);if(ke){for(const Ve of oe)ne.encodeCentroid(void 0,ne.featuresOnBorder[Ve],!1);ne.borderDoneWithNeighborZ[Q]=_.canonical.z,ne.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Y]=ne.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(p)}const ea=new d.Color(1,0,0,1),Ao=new d.Color(0,1,0,1),kp=new d.Color(0,0,1,1),Eu=new d.Color(1,0,1,1),Oc=new d.Color(0,1,1,1);function ff(p,o,h,_){ur(p,0,o+h/2,p.transform.width,h,_)}function pf(p,o,h,_){ur(p,o-h/2,0,h,p.transform.height,_)}function ur(p,o,h,_,x,w){const T=p.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(o*d.exported.devicePixelRatio,h*d.exported.devicePixelRatio,_*d.exported.devicePixelRatio,x*d.exported.devicePixelRatio),T.clear({color:w}),S.disable(S.SCISSOR_TEST)}function mf(p,o,h){const _=p.context,x=_.gl,w="globe"===p.transform.projection.name,T=h.projMatrix,S=p.useProgram("debug",null,w?["PROJECTION_GLOBE_VIEW"]:null),A=o.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(A,S);const R=d.DepthMode.disabled,L=d.StencilMode.disabled,N=p.colorModeForRenderPass(),H="$debug";_.activeTexture.set(x.TEXTURE0),p.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),w?A._makeGlobeTileDebugBuffers(p.context,p.transform.projection):A._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const Z=A._tileDebugBuffer||p.debugBuffer,K=A._tileDebugIndexBuffer||p.debugIndexBuffer,q=A._tileDebugSegments||p.debugSegments;S.draw(_,x.LINE_STRIP,R,L,N,d.CullFaceMode.disabled,ti(T,d.Color.red),H,Z,K,q,null,null,null,A._globeTileDebugBorderBuffer);const ie=A.latestRawTileData,Y=Math.floor((ie&&ie.byteLength||0)/1024),Q=o.getTile(h).tileSize,X=512/Math.min(Q,512)*(h.overscaledZ/p.transform.zoom)*.5;let ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ue+=` => ${h.overscaledZ}`),function(ke,Ve){ke.initDebugOverlayCanvas();const Re=ke.debugOverlayCanvas,ft=ke.context.gl,ae=ke.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,Re.width,Re.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(Ve,5,5),ae.strokeText(Ve,5,5),ke.debugOverlayTexture.update(Re),ke.debugOverlayTexture.bind(ft.LINEAR,ft.CLAMP_TO_EDGE)}(p,`${ue} ${Y}kb`);const ne=A._tileDebugTextBuffer||p.debugBuffer,oe=A._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,fe=A._tileDebugTextSegments||p.debugSegments;S.draw(_,x.TRIANGLES,R,L,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,ti(T,d.Color.transparent,X),H,ne,oe,fe,null,null,null,A._globeTileDebugTextBuffer)}const ky=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_g}=ky;function Fs(p,o,h,_){p.emplaceBack(o,h,_)}class yg{constructor(o){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,Fs(this.vertexArray,-1,-1,1),Fs(this.vertexArray,1,-1,1),Fs(this.vertexArray,-1,1,1),Fs(this.vertexArray,1,1,1),Fs(this.vertexArray,-1,-1,-1),Fs(this.vertexArray,1,-1,-1),Fs(this.vertexArray,-1,1,-1),Fs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,_g),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function Tu(p,o,h,_,x,w){const T=p.gl,S=o.paint.get("sky-atmosphere-color"),A=o.paint.get("sky-atmosphere-halo-color"),R=o.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:d.fromMat4(d.create$1(),_),u_sun_direction:x,u_sun_intensity:R,u_color_tint_r:[(K=S).r,K.g,K.b,K.a],u_color_tint_m:[(q=A).r,q.g,q.b,q.a],u_luminance:5e-5};var K,q;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+w,o.skyboxTexture,0),h.draw(p,T.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const vg=d.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ry{constructor(o){const h=new d.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new d.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(h,vg.members),this.indexBuffer=o.createIndexBuffer(_),this.segments=d.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const gf={symbol:function(p,o,h,_,x){if("translucent"!==p.renderPass)return;const w=d.StencilMode.disabled,T=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(S,A,R,L,N,H,Z){const K=A.transform,q="map"===N,ie="map"===H;for(const Y of S){const Q=L.getTile(Y),X=Q.getBucket(R);if(!X||!X.text||!X.text.segments.get().length)continue;const ue=d.evaluateSizeForZoom(X.textSizeData,K.zoom),ne=sf(Y,X.getProjection(),K),oe=K.calculatePixelsToTileUnitsMatrix(Q),fe=bn(ne,Q.tileID.canonical,ie,q,K,X.getProjection(),oe),ke="none"!==R.layout.get("icon-text-fit")&&X.hasIconData();if(ue){const Ve=Math.pow(2,K.zoom-Q.tileID.overscaledZ);Pl(X,q,ie,Z,d.symbolSize,K,fe,Y,Ve,ue,ke)}}}(_,p,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&nd(p,o,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),w,T),0!==h.paint.get("text-opacity").constantOr(1)&&nd(p,o,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),w,T),o.map.showCollisionBoxes&&(ed(p,o,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ed(p,o,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,h,_){if("translucent"!==p.renderPass)return;const x=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),S=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===w.constantOr(1)||0===T.constantOr(1)))return;const A=p.context,R=A.gl,L=p.transform,N=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),H=d.StencilMode.disabled,Z=p.colorModeForRenderPass(),K="globe"===L.projection.name,q=[d.mercatorXfromLng(L.center.lng),d.mercatorYfromLat(L.center.lat)],ie=[];for(let Q=0;Q<_.length;Q++){const X=_[Q],ue=o.getTile(X),ne=ue.getBucket(h);if(!ne||ne.projection.name!==L.projection.name)continue;const oe=ne.programConfigurations.get(h.id),fe=ji(h);K&&fe.push("PROJECTION_GLOBE_VIEW");const ke=p.useProgram("circle",oe,fe),Ve=ne.layoutVertexBuffer,Re=ne.globeExtVertexBuffer,ft=ne.indexBuffer,ae=L.projection.createInversionMatrix(L,X.canonical),Ie={programConfiguration:oe,program:ke,layoutVertexBuffer:Ve,globeExtVertexBuffer:Re,indexBuffer:ft,uniformValues:ba(p,X,ue,ae,q,h),tile:ue};if(S){const Ke=ne.segments.get();for(const Dt of Ke)ie.push({segments:new d.SegmentVector([Dt]),sortKey:Dt.sortKey,state:Ie})}else ie.push({segments:ne.segments,sortKey:0,state:Ie})}S&&ie.sort((Q,X)=>Q.sortKey-X.sortKey);const Y={useDepthForOcclusion:!K};for(const Q of ie){const{programConfiguration:X,program:ue,layoutVertexBuffer:ne,globeExtVertexBuffer:oe,indexBuffer:fe,uniformValues:ke,tile:Ve}=Q.state,Re=Q.segments;p.terrain&&p.terrain.setupElevationDraw(Ve,ue,Y),p.prepareDrawProgram(A,ue,Ve.tileID.toUnwrapped()),ue.draw(A,R.TRIANGLES,N,H,Z,d.CullFaceMode.disabled,ke,h.id,ne,fe,Re,h.paint,L.zoom,X,K?oe:null)}},heatmap:function(p,o,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const x=p.context,w=x.gl,T=d.StencilMode.disabled,S=new d.ColorMode([w.ONE,w.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(Z,K,q,ie){const Y=Z.gl,Q=K.width*ie,X=K.height*ie;Z.activeTexture.set(Y.TEXTURE1),Z.viewport.set([0,0,Q,X]);let ue=q.heatmapFbo;if(!ue||ue&&(ue.width!==Q||ue.height!==X)){ue&&ue.destroy();const ne=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ne),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ue=q.heatmapFbo=Z.createFramebuffer(Q,X,!1),function(oe,fe,ke,Ve,Re,ft){const ae=oe.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,Re,ft,0,ae.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),Ve.colorAttachment.set(ke)}(Z,0,ne,ue,Q,X)}else Y.bindTexture(Y.TEXTURE_2D,ue.colorAttachment.get()),Z.bindFramebuffer.set(ue.framebuffer)})(x,p,h,"globe"===p.transform.projection.name?.5:.25),x.clear({color:d.Color.transparent});const A=p.transform,R="globe"===A.projection.name,L=R?["PROJECTION_GLOBE_VIEW"]:null,N=R?d.CullFaceMode.frontCCW:d.CullFaceMode.disabled,H=[d.mercatorXfromLng(A.center.lng),d.mercatorYfromLat(A.center.lat)];for(let Z=0;Z<_.length;Z++){const K=_[Z];if(o.hasRenderableParent(K))continue;const q=o.getTile(K),ie=q.getBucket(h);if(!ie||ie.projection.name!==A.projection.name)continue;const Y=ie.programConfigurations.get(h.id),Q=p.useProgram("heatmap",Y,L),{zoom:X}=p.transform;p.terrain&&p.terrain.setupElevationDraw(q,Q),p.prepareDrawProgram(x,Q,K.toUnwrapped());const ue=A.projection.createInversionMatrix(A,K.canonical);Q.draw(x,w.TRIANGLES,d.DepthMode.disabled,T,S,N,Dc(p,K,q,ue,H,X,h.paint.get("heatmap-intensity")),h.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,h.paint,p.transform.zoom,Y,R?ie.globeExtVertexBuffer:null)}x.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,w){const T=x.context,S=T.gl,A=w.heatmapFbo;if(!A)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new d.Texture(T,w.colorRamp,S.RGBA)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(T,S.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,x.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(p,h))},line:function(p,o,h,_){if("translucent"!==p.renderPass)return;const x=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===x.constantOr(1)||0===w.constantOr(1))return;const T=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture?1:d.exported.devicePixelRatio,R=h.paint.get("line-dasharray"),L=R.constantOr(1),N=h.layout.get("line-cap"),H=h.paint.get("line-pattern"),Z=H.constantOr(1),K=h.paint.get("line-gradient"),q=h.getCrossfadeParameters(),ie=Z?"linePattern":"line",Y=p.context,Q=Y.gl,X=(ne=>{const oe=[];Qs(ne)&&oe.push("RENDER_LINE_DASH"),ne.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const fe=ne.paint.get("line-trim-offset");0===fe[0]&&0===fe[1]||oe.push("RENDER_LINE_TRIM_OFFSET");const ke=ne.paint.get("line-pattern").constantOr(1),Ve=1!==ne.paint.get("line-opacity").constantOr(1);return!ke&&Ve&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(h);let ue=X.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ue=!1);for(const ne of _){const oe=o.getTile(ne);if(Z&&!oe.patternsLoaded())continue;const fe=oe.getBucket(h);if(!fe)continue;p.prepareDrawTile();const ke=fe.programConfigurations.get(h.id),Ve=p.useProgram(ie,ke,X),Re=H.constantOr(null);if(Re&&oe.imageAtlas){const xt=oe.imageAtlas,Et=xt.patternPositions[Re.to.toString()],wt=xt.patternPositions[Re.from.toString()];Et&&wt&&ke.setConstantPatternPositions(Et,wt)}const ft=R.constantOr(null),ae=N.constantOr(null);if(!Z&&ft&&ae&&oe.lineAtlas){const xt=oe.lineAtlas,Et=xt.getDash(ft.to,ae),wt=xt.getDash(ft.from,ae);Et&&wt&&ke.setConstantPatternPositions(Et,wt)}let[Ie,Ke]=h.paint.get("line-trim-offset");("round"===ae||"square"===ae)&&Ie!==Ke&&(0===Ie&&(Ie-=1),1===Ke&&(Ke+=1));const Dt=p.terrain?ne.projMatrix:null,Ye=Z?Jh(p,oe,h,q,Dt,A):qn(p,oe,h,q,Dt,fe.lineClipsArray.length,A,[Ie,Ke]);if(K){const xt=fe.gradients[h.id];let Et=xt.texture;if(h.gradientVersion!==xt.version){let wt=256;if(h.stepInterpolant){const bt=o.getSource().maxzoom,Lt=ne.canonical.z===bt?Math.ceil(1<<p.transform.maxZoom-ne.canonical.z):1;wt=d.clamp(d.nextPowerOfTwo(fe.maxLineLength/d.EXTENT*1024*Lt),256,Y.maxTextureSize)}xt.gradient=d.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:xt.gradient||void 0,clips:fe.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new d.Texture(Y,xt.gradient,Q.RGBA),xt.version=h.gradientVersion,Et=xt.texture}Y.activeTexture.set(Q.TEXTURE1),Et.bind(h.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}L&&(Y.activeTexture.set(Q.TEXTURE0),oe.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),ke.updatePaintBuffers(q)),Z&&(Y.activeTexture.set(Q.TEXTURE0),oe.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),ke.updatePaintBuffers(q)),p.prepareDrawProgram(Y,Ve,ne.toUnwrapped());const Vt=xt=>{Ve.draw(Y,Q.TRIANGLES,T,xt,S,d.CullFaceMode.disabled,Ye,h.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,h.paint,p.transform.zoom,ke,fe.layoutVertexBuffer2)};if(ue){const xt=p.stencilModeForClipping(ne).ref;0===xt&&p.terrain&&Y.clear({stencil:0});const Et={func:Q.EQUAL,mask:255};Ye.u_alpha_discard_threshold=.8,Vt(new d.StencilMode(Et,xt,255,Q.KEEP,Q.KEEP,Q.INVERT)),Ye.u_alpha_discard_threshold=0,Vt(new d.StencilMode(Et,xt,255,Q.KEEP,Q.KEEP,Q.KEEP))}else Vt(p.stencilModeForClipping(ne))}ue&&(p.resetStencilClippingMasks(),p.terrain&&Y.clear({stencil:0}))},fill:function(p,o,h,_){const x=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const T=p.colorModeForRenderPass(),S=h.paint.get("fill-pattern"),A=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===x.constantOr(d.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(p.renderPass===A){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);ts(p,o,h,_,R,T,!1)}if("translucent"===p.renderPass&&h.paint.get("fill-antialias")){const R=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);ts(p,o,h,_,R,T,!0)}},"fill-extrusion":function(p,o,h,_){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===p.renderPass){const w=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))Ac(p,o,h,_,w,d.StencilMode.disabled,d.ColorMode.disabled),Ac(p,o,h,_,w,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const T=p.colorModeForRenderPass();Ac(p,o,h,_,w,d.StencilMode.disabled,T)}}},hillshade:function(p,o,h,_){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const x=p.context,w=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[A,R]="translucent"!==p.renderPass||S?[{},_]:p.stencilConfigForOverlap(_);for(const L of R){const N=o.getTile(L);if(N.needsHillshadePrepare&&"offscreen"===p.renderPass)Mc(p,N,h,w,d.StencilMode.disabled,T);else if("translucent"===p.renderPass){const H=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):A[L.overscaledZ];Tr(p,L,N,h,w,H,T)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,h,_,x,w){if("translucent"!==p.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const T=p.context,S=T.gl,A=o.getSource(),R=p.useProgram("raster"),L=p.colorModeForRenderPass(),N=p.terrain&&p.terrain.renderingToTexture,[H,Z]=A instanceof Ce||N?[{},_]:p.stencilConfigForOverlap(_),K=Z[Z.length-1].overscaledZ,q=!p.options.moving;for(const ie of Z){const Y=N?d.DepthMode.disabled:p.depthModeForSublayer(ie.overscaledZ-K,1===h.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,S.LESS),Q=ie.toUnwrapped(),X=o.getTile(ie);if(N&&(!X||!X.hasData()))continue;const ue=N?ie.projMatrix:p.transform.calculateProjMatrix(Q,q),ne=p.terrain&&N?p.terrain.stencilModeForRTTOverlap(ie):H[ie.overscaledZ],oe=w?0:h.paint.get("raster-fade-duration");X.registerFadeDuration(oe);const fe=o.findLoadedParent(ie,0),ke=Xh(X,fe,o,p.transform,oe);let Ve,Re;p.terrain&&p.terrain.prepareDrawTile();const ft="nearest"===h.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),X.texture.bind(ft,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),fe?(fe.texture.bind(ft,S.CLAMP_TO_EDGE),Ve=Math.pow(2,fe.tileID.overscaledZ-X.tileID.overscaledZ),Re=[X.tileID.canonical.x*Ve%1,X.tileID.canonical.y*Ve%1]):X.texture.bind(ft,S.CLAMP_TO_EDGE);const ae=po(ue,Re||[0,0],Ve||1,ke,h,A instanceof Ce?A.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(T,R,Q),A instanceof Ce)A.boundsBuffer&&A.boundsSegments&&R.draw(T,S.TRIANGLES,Y,d.StencilMode.disabled,L,d.CullFaceMode.disabled,ae,h.id,A.boundsBuffer,p.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:Ke,tileBoundsSegments:Dt}=p.getTileBoundsBuffers(X);R.draw(T,S.TRIANGLES,Y,ne,L,d.CullFaceMode.disabled,ae,h.id,Ie,Ke,Dt)}}p.resetStencilClippingMasks()},background:function(p,o,h,_){const x=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(0===w)return;const T=p.context,S=T.gl,A=p.transform,R=A.tileSize,L=h.paint.get("background-pattern");if(p.isPatternMissing(L))return;const N=!L&&1===x.a&&1===w&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const H=d.StencilMode.disabled,Z=p.depthModeForSublayer(0,"opaque"===N?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),K=p.colorModeForRenderPass(),q=p.useProgram(L?"backgroundPattern":"background");let ie,Y=_;Y||(ie=p.getBackgroundTiles(),Y=Object.values(ie).map(X=>X.tileID)),L&&(T.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));const Q=h.getCrossfadeParameters();for(const X of Y){const ue=X.toUnwrapped(),ne=_?X.projMatrix:p.transform.calculateProjMatrix(ue);p.prepareDrawTile();const oe=o?o.getTile(X):ie?ie[X.key]:new d.Tile(X,R,A.zoom,p),fe=L?Sc(ne,w,p,L,{tileID:X,tileSize:R},Q):Hr(ne,w,x);p.prepareDrawProgram(T,q,ue);const{tileBoundsBuffer:ke,tileBoundsIndexBuffer:Ve,tileBoundsSegments:Re}=p.getTileBoundsBuffers(oe);q.draw(T,S.TRIANGLES,Z,H,K,d.CullFaceMode.disabled,fe,h.id,ke,Ve,Re)}},sky:function(p,o,h){const _=p.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:d.smoothstep(7,8,_.zoom),w=h.paint.get("sky-opacity")*x;if(0===w)return;const T=p.context,S=h.paint.get("sky-type"),A=new d.DepthMode(T.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===p.renderPass?h.needsSkyboxCapture(p)&&(function(L,N,H,Z){const K=L.context,q=K.gl;let ie=N.skyboxFbo;if(!ie){ie=N.skyboxFbo=K.createFramebuffer(32,32,!1),N.skyboxGeometry=new yg(K),N.skyboxTexture=K.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,N.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let ue=0;ue<6;++ue)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(ie.framebuffer),K.viewport.set([0,0,32,32]);const Y=N.getCenter(L,!0),Q=L.useProgram("skyboxCapture"),X=new Float64Array(16);d.identity(X),d.rotateY(X,X,.5*-Math.PI),Tu(K,N,Q,X,Y,0),d.identity(X),d.rotateY(X,X,.5*Math.PI),Tu(K,N,Q,X,Y,1),d.identity(X),d.rotateX(X,X,.5*-Math.PI),Tu(K,N,Q,X,Y,2),d.identity(X),d.rotateX(X,X,.5*Math.PI),Tu(K,N,Q,X,Y,3),d.identity(X),Tu(K,N,Q,X,Y,4),d.identity(X),d.rotateY(X,X,Math.PI),Tu(K,N,Q,X,Y,5),K.viewport.set([0,0,L.width,L.height])}(p,h),h.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,N,H,Z,K){const q=L.context,ie=q.gl,Y=L.transform,Q=L.useProgram("skybox");q.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,N.skyboxTexture);const X={u_matrix:Y.skyboxMatrix,u_sun_direction:N.getCenter(L,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:K};L.prepareDrawProgram(q,Q),Q.draw(q,ie.TRIANGLES,H,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,X,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,h,A,w,R):"gradient"===S&&"sky"===p.renderPass&&function(L,N,H,Z,K){const q=L.context,ie=q.gl,Y=L.transform,Q=L.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new yg(q)),q.activeTexture.set(ie.TEXTURE0);let X=N.colorRampTexture;X||(X=N.colorRampTexture=new d.Texture(q,N.colorRamp,ie.RGBA)),X.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ue=(ne=Y.skyboxMatrix,oe=N.getCenter(L,!1),fe=N.paint.get("sky-gradient-radius"),ke=Z,Ve=K,{u_matrix:ne,u_color_ramp:0,u_center_direction:oe,u_radius:d.degToRad(fe),u_opacity:ke,u_temporal_offset:Ve});var ne,oe,fe,ke,Ve;L.prepareDrawProgram(q,Q),Q.draw(q,ie.TRIANGLES,H,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,ue,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,h,A,w,R)},debug:function(p,o,h){for(let _=0;_<h.length;_++)mf(p,o,h[_])},custom:function(p,o,h){const _=p.context,x=h.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const w=x.prerender;w&&(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),w.call(x,_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(d.StencilMode.disabled);const w="3d"===x.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);_.setDepthMode(w),x.render(_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}};class _f{constructor(o,h){this.context=new ee(o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zh,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,h){const _=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Kh(this,o));const x=this._terrain;this.transform.elevation=_?x:null,x.update(o,this.transform,h)}_updateFog(o){const h=o.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,h){if(this.width=o*d.exported.devicePixelRatio,this.height=h*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const o=this.context,h=new d.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(d.EXTENT,0),h.emplaceBack(0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const _=new d.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(d.EXTENT,0),_.emplaceBack(0,d.EXTENT),_.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=o.createVertexBuffer(_,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const x=new d.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(x,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const w=new d.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(d.EXTENT,0,d.EXTENT,0),w.emplaceBack(0,d.EXTENT,0,d.EXTENT),w.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(w,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const T=new d.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const S=new d.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=o.createIndexBuffer(S),this.emptyTexture=new d.Texture(o,new d.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=d.create();const A=this.context.gl;this.stencilClearMode=new d.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(d.window.performance.now()),this.atmosphereBuffer=new Ry(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,h.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,Tc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,h,_){if(!h||this.currentStencilSource===h.id||!o.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of _)if(void 0===this._tileClippingMaskIDs[A.key]){S=!0;break}if(!S)return}this.currentStencilSource=h.id;const x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of _){const A=h.getTile(S),R=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:H}=this.getTileBoundsBuffers(A);T.draw(x,w.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:w.ALWAYS,mask:0},R,255,w.KEEP,w.KEEP,w.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Tc(S.projMatrix),"$clipping",L,N,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new d.StencilMode({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new d.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,_=o.sort((T,S)=>S.overscaledZ-T.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const T={};for(let S=0;S<w;S++)T[S+x]=new d.StencilMode({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[T,_]}return[{[x]:d.StencilMode.disabled},_]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([o.CONSTANT_COLOR,o.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(o,h,_){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new d.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const A in x){const R=x[A];R.used&&R.prepare(this.context)}const w={},T={},S={};for(const A in x){const R=x[A];w[A]=R.getVisibleCoordinates(),T[A]=w[A].slice().reverse(),S[A]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<_.length;A++)if(this.style._layers[_[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),d.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of _){const R=this.style._layers[A],L=o._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const N=L?T[L.id]:void 0;("custom"===R.type||R.isSky()||N&&N.length)&&this.renderLayer(this,L,R,N)}if(this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[_[this.currentLayer]],R=o._getLayerSourceCache(A);if(A.isSky())continue;const L=R?T[R.id]:void 0;this._renderTileClippingMasks(A,R,L),this.renderLayer(this,R,A,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,R){const L=A.context,N=L.gl,H=A.transform,Z=new d.DepthMode(N.LEQUAL,d.DepthMode.ReadOnly,[0,1]),K=A.useProgram("globeAtmosphere",null,"globe"===H.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),q=d.globeToMercatorTransition(H.zoom),ie=R.properties.get("color").toArray01(),Y=R.properties.get("high-color").toArray01(),Q=R.properties.get("space-color").toArray01PremultipliedAlpha(),X=d.identity$1([]);d.rotateY$1(X,X,-d.degToRad(H._center.lng)),d.rotateX$1(X,X,d.degToRad(H._center.lat)),d.rotateZ$1(X,X,H.angle),d.rotateX$1(X,X,-H._pitch);const ue=d.fromQuat(new Float32Array(16),X),ne=d.mapValue(R.properties.get("star-intensity"),0,1,0,.25),fe=d.mapValue(R.properties.get("horizon-blend"),0,1,5e-4,.25),ke=d.globeUseCustomAntiAliasing(A,L,H)&&5e-4===fe?H.worldSize/(2*Math.PI*1.025)-1:H.globeRadius,Ve=A.frameCounter/1e3%1,Re=d.length(H.globeCenterInViewSpace),ft=Math.sqrt(Math.pow(Re,2)-Math.pow(ke,2)),ae=Math.acos(ft/Re),Ie={u_frustum_tl:H.frustumCorners.TL,u_frustum_tr:H.frustumCorners.TR,u_frustum_br:H.frustumCorners.BR,u_frustum_bl:H.frustumCorners.BL,u_horizon:H.frustumCorners.horizon,u_transition:q,u_fadeout_range:fe,u_color:ie,u_high_color:Y,u_space_color:Q,u_star_intensity:ne,u_star_size:5*d.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ve,u_horizon_angle:ae,u_rotation_matrix:ue};A.prepareDrawProgram(L,K);const Ke=A.atmosphereBuffer;Ke&&K.draw(L,N.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,Ie,"skybox",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}(this,this.style.fog),this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const A=this.style._layers[_[this.currentLayer]],R=o._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,R,A,R?T[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const A=this.style._layers[_[this.currentLayer]],R=o._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=R?("symbol"===A.type?S:T)[R.id]:void 0;this._renderTileClippingMasks(A,R,R?w[R.id]:void 0),this.renderLayer(this,R,A,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;d.values(this.style._layers).forEach(R=>{const L=o._getLayerSourceCache(R);L&&!R.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<L.getSource().maxzoom)&&(A=L)}),A&&this.options.showTileBoundaries&&gf.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const R=A.transform.padding;ff(A,A.transform.height-(R.top||0),3,ea),ff(A,R.bottom||0,3,Ao),pf(A,R.left||0,3,kp),pf(A,A.transform.width-(R.right||0),3,Eu);const L=A.transform.centerPoint;var N,H,Z,K;ur(N=A,(H=L.x)-1,(Z=A.transform.height-L.y)-10,2,20,K=Oc),ur(N,H-10,Z-1,20,2,K)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}}renderLayer(o,h,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(_.type)||gf[_.type](o,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,h=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),o.beginQueryEXT(o.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const h={};for(const _ in o){const x=o[_],w=this.context.extTimerQuery,T=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),h[_]=T}return h}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const x of o)_+=h.getQueryObjectEXT(x,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(x);return _}translatePosMatrix(o,h,_,x,w){if(!_[0]&&!_[1])return o;const T=w?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(T){const R=Math.sin(T),L=Math.cos(T);_=[_[0]*L-_[1]*R,_[0]*R+_[1]*L]}const S=[w?_[0]:di(h,_[0],this.transform.zoom),w?_[1]:di(h,_[1],this.transform.zoom),0],A=new Float32Array(16);return d.translate(A,o,S),A}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!h||!_}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!o&&0!==h.getOpacity(this.transform.pitch)&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,h,_){this.cache=this.cache||{};const x=_||[],w=this.currentGlobalDefines().concat(x),T=oo.cacheKey(o,w,h);return this.cache[T]||(this.cache[T]=new oo(this.context,o,Ir[o],h,gg[o],w)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),T=((S,A,R,L,N,H,Z,K,q,ie,Y)=>{const Q=S.transform,X=A.properties.get("color").toArray01();X[3]=L;const ue=S.frameCounter/1e3%1;return{u_fog_matrix:R?Q.calculateFogTileMatrix(R):S.identityMat,u_fog_range:A.getFovAdjustedRange(Q._fov),u_fog_color:X,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:ue,u_frustum_tl:N,u_frustum_tr:H,u_frustum_br:Z,u_frustum_bl:K,u_globe_pos:q,u_globe_radius:ie,u_viewport:Y,u_globe_transition:d.globeToMercatorTransition(Q.zoom),u_is_globe:+("globe"===Q.projection.name)}})(this,x,_,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.exported.devicePixelRatio,this.transform.height*d.exported.devicePixelRatio]);h.setFogUniformValues(o,T)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=o[x.key]||new d.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class kc{constructor(o=0,h=0,_=0,x=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=_,this.right=x}interpolate(o,h,_){return null!=h.top&&null!=o.top&&(this.top=d.number(o.top,h.top,_)),null!=h.bottom&&null!=o.bottom&&(this.bottom=d.number(o.bottom,h.bottom,_)),null!=h.left&&null!=o.left&&(this.left=d.number(o.left,h.left,_)),null!=h.right&&null!=o.right&&(this.right=d.number(o.right,h.right,_)),this}getCenter(o,h){const _=d.clamp((this.left+o-this.right)/2,0,o),x=d.clamp((this.top+h-this.bottom)/2,0,h);return new d.pointGeometry(_,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new kc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yf(p,o){const h=d.getColumn(p,3);d.fromQuat(p,o),d.setColumn(p,3,h)}function Rc(p,o){const h=d.identity$1([]);return d.rotateZ$1(h,h,-o),d.rotateX$1(h,h,-p),h}function Lc(p,o){const h=[p[0],p[1],0],_=[o[0],o[1],0];if(d.length(h)>=1e-15){const T=d.normalize([],h);d.scale$2(_,T,d.dot(_,T)),o[0]=_[0],o[1]=_[1]}const x=d.cross([],o,p);if(d.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Rc(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}class rd{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){if(o){const h=o instanceof d.MercatorCoordinate?o:new d.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(h.x=d.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(o)):0,x=this.position,w=d.MercatorCoordinate.fromLngLat(o,_),T=[w.x-x.x,w.y-x.y,w.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Lc(T,h)}setPitchBearing(o,h){this.orientation=Rc(d.degToRad(o),d.degToRad(-h))}}class Du{constructor(o,h){this._transform=d.identity([]),this.orientation=h,this.position=o}get mercatorPosition(){const o=this.position;return new d.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=d.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var h;o&&d.setColumn(this._transform,3,[(h=o)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||d.identity$1([]),o&&yf(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=Rc(o,h),yf(this._transform,this._orientation)}forward(){const o=d.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=d.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=d.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const _=new Float64Array(16);return d.invert(_,this.getWorldToCamera(o,h)),_}getWorldToCameraPosition(o,h,_){const x=this.position;d.scale$2(x,x,-o);const w=new Float64Array(16);return d.fromScaling(w,[_,_,_]),d.translate(w,w,x),w[10]*=h,w}getWorldToCamera(o,h){const _=new Float64Array(16),x=new Float64Array(4),w=this.position;return d.conjugate(x,this._orientation),d.scale$2(w,w,-o),d.fromQuat(_,x),d.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(o,h,_,x){const w=new Float64Array(16);return d.perspective(w,o,h,_,x),w}getDistanceToElevation(o){const h=0===o?0:d.mercatorZfromAltitude(o,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new Du([...this.position],[...this.orientation])}}function Nt(p,o){const h=Su(p.projection,p.zoom,p.width,p.height),_=function(w,T,S,A,R){const L=new d.LngLat(S.lng-180*mi,S.lat),N=new d.LngLat(S.lng+180*mi,S.lat),H=w.project(L.lng,L.lat),Z=w.project(N.lng,N.lat),K=-Math.atan2(Z.y-H.y,Z.x-H.x),q=d.MercatorCoordinate.fromLngLat(S);q.y=d.clamp(q.y,-.999975,.999975);const ie=q.toLngLat(),Y=w.project(ie.lng,ie.lat),Q=d.MercatorCoordinate.fromLngLat(ie);Q.x+=mi;const X=Q.toLngLat(),ue=w.project(X.lng,X.lat),ne=Ol(ue.x-Y.x,ue.y-Y.y,K),oe=d.MercatorCoordinate.fromLngLat(ie);oe.y+=mi;const fe=oe.toLngLat(),ke=w.project(fe.lng,fe.lat),Ve=Ol(ke.x-Y.x,ke.y-Y.y,K),Re=Math.abs(ne.x)/Math.abs(Ve.y),ft=d.identity([]);d.rotateZ(ft,ft,-K*(1-(R?0:A)));const ae=d.identity([]);return d.scale(ae,ae,[1,1-(1-Re)*A,1]),ae[4]=-Ve.x/Ve.y*A,d.rotateZ(ae,ae,K),d.multiply(ae,ft,ae),ae}(p.projection,0,p.center,h,o),x=Ji(p);return d.scale(_,_,[x,x,1]),_}function Ji(p){const o=p.projection,h=Su(p.projection,p.zoom,p.width,p.height),_=id(o,p.center),x=id(o,d.LngLat.convert(o.center));return Math.pow(2,_*h+(1-h)*x)}function Su(p,o,h,_,x=1/0){const w=p.range;if(!w)return 0;const T=Math.min(x,Math.max(h,_)),S=Math.log(T/1024)/Math.LN2;return d.smoothstep(w[0]+S,w[1]+S,o)}const mi=1/4e4;function id(p,o){const h=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),_=new d.LngLat(o.lng-180*mi,h),x=new d.LngLat(o.lng+180*mi,h),w=p.project(_.lng,h),T=p.project(x.lng,h),S=d.MercatorCoordinate.fromLngLat(_),A=d.MercatorCoordinate.fromLngLat(x),R=T.x-w.x,L=T.y-w.y,N=A.x-S.x,H=A.y-S.y,Z=Math.sqrt((N*N+H*H)/(R*R+L*L));return Math.log(Z)/Math.LN2}function Ol(p,o,h){const _=Math.cos(h),x=Math.sin(h);return{x:p*_-o*x,y:p*x+o*_}}class od{constructor(o,h,_,x,w,T,S){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Du,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new od(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(o||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=d.getProjection(this.projectionOptions);const _=!W(h,this.getProjection());return _&&this._calcMatrices(),_}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const h=-o*Math.PI/180;var _,x,w,T,S,A,R,L,N,H;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,T=this.angle,S=(w=this.rotationMatrix)[0],A=w[1],R=w[2],L=w[3],N=Math.sin(T),H=Math.cos(T),x[0]=S*H+R*N,x[1]=A*H+L*N,x[2]=S*-N+R*H,x[3]=A*-N+L*H)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=d.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,w=0;for(let T=0;T<h.length;T++){const S=new d.pointGeometry(h[T][0]*this.width,_+h[T][1]*(this.height-_)),A=o.pointCoordinate(S);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);x+=A[3]*R,w+=R}return 0===w?NaN:x/w}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const o=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(o),w=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let _;_=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const x=d.length(d.sub([],this._camera.position,_));return d.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!d.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const _=[o.position.x,o.position.y,o.position.z];d.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new rd;return h.position=new d.MercatorCoordinate(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(o){if(!d.length$1(o))return!1;d.normalize$1(o,o);const h=d.transformQuat([],[0,0,-1],o),_=d.transformQuat([],[0,-1,0],o);if(_[2]<0)return!1;const x=Lc(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;o[2]=d.clamp(o[2],x/_,x/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,_){this._unmodified=!1,this._edgeInsets.interpolate(o,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new d.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const _=this.pointCoordinate(new d.pointGeometry(0,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,0)),w=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new d.pointGeometry(0,this.height)),S=Math.floor(Math.min(_.x,x.x,w.x,T.x)),A=Math.floor(Math.max(_.x,x.x,w.x,T.x)),R=1;for(let L=S-R;L<=A+R;L++)0!==L&&h.push(new d.UnwrappedTileID(L,o))}return h}coveringTiles(o){let h=this.coveringZoomLevel(o);const _=h,x=this.elevation&&!o.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==o.minzoom&&h<o.minzoom)return[];void 0!==o.maxzoom&&h>o.maxzoom&&(h=o.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,A=1<<h,R=[A*T.x,A*T.y,0],L="globe"===this.projection.name,N=!L,H=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,N),Z=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=A*d.mercatorZfromAltitude(1,this.center.lat),q=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),ie=[A*Z.x,A*Z.y,q*(N?1:K)],Y=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,X=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ue=o.isTerrainDEM?-X:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?Ji(this):1,oe=Ye=>{const xt=new d.MercatorCoordinate(Ye.x+25e-6,Ye.y,Ye.z),Et=new d.MercatorCoordinate(Ye.x,Ye.y+25e-6,Ye.z),wt=Ye.toLngLat(),bt=xt.toLngLat(),Lt=Et.toLngLat(),sn=this.locationCoordinate(wt),Sn=this.locationCoordinate(bt),qt=this.locationCoordinate(Lt),vn=Math.hypot(Sn.x-sn.x,Sn.y-sn.y),hr=Math.hypot(qt.x-sn.x,qt.y-sn.y);return Math.sqrt(vn*hr)*ne/25e-6},fe=Ye=>{const Vt=X,xt=ue;return{aabb:d.tileAABB(this,A,0,0,0,Ye,xt,Vt,this.projection),zoom:0,x:0,y:0,minZ:xt,maxZ:Vt,wrap:Ye,fullyVisible:!1}},ke=[];let Ve=[];const Re=h,ft=o.reparseOverscaled?_:h,ae=Ye=>Ye*Ye,Ie=ae((q-this._centerAltitude)*K),Ke=Ye=>{if(!this._elevation||!Ye.tileID||!w)return;const Vt=this._elevation.getMinMaxForTile(Ye.tileID),xt=Ye.aabb;Vt?(xt.min[2]=Vt.min,xt.max[2]=Vt.max,xt.center[2]=(xt.min[2]+xt.max[2])/2):(Ye.shouldSplit=Dt(Ye),Ye.shouldSplit||(xt.min[2]=xt.max[2]=xt.center[2]=this._centerAltitude))},Dt=Ye=>{if(Ye.zoom<Q)return!0;if(Ye.zoom===Re)return!1;if(null!=Ye.shouldSplit)return Ye.shouldSplit;const Vt=Ye.aabb.distanceX(ie),xt=Ye.aabb.distanceY(ie);let Et=Ie,wt=1;if(L){Et=ae(Ye.aabb.distanceZ(ie));const Lt=Math.pow(2,Ye.zoom),sn=d.latFromMercatorY((Ye.y+1)/Lt),Sn=d.latFromMercatorY(Ye.y/Lt),qt=Math.min(Math.max(S,sn),Sn),vn=d.circumferenceAtLatitude(qt)/d.circumferenceAtLatitude(S);if(wt=qt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vn/this._mercatorScaleRatio),this.zoom<=d.GLOBE_ZOOM_THRESHOLD_MIN&&Ye.zoom===Re-1&&vn>=.9)return!0}else if(x&&(Et=ae(Ye.aabb.distanceZ(ie)*K)),this.projection.isReprojectedInTileSpace&&_<=5){const Lt=Math.pow(2,Ye.zoom),sn=oe(new d.MercatorCoordinate((Ye.x+.5)/Lt,(Ye.y+.5)/Lt));wt=sn>.85?1:sn}const bt=Vt*Vt+xt*xt+Et;return bt<ae((1<<Re-Ye.zoom)*Y*wt*((Lt,sn)=>{if(sn*ae(.707)<Lt)return 1;const Sn=Math.sqrt(sn/Lt);return Sn/(1.4144271570014144+(Math.pow(1.1,Sn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Et,Ie),bt))};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)ke.push(fe(-Ye)),ke.push(fe(Ye));for(ke.push(fe(0));ke.length>0;){const Ye=ke.pop(),Vt=Ye.x,xt=Ye.y;let Et=Ye.fullyVisible;if(!Et){const wt=Ye.aabb.intersects(H);if(0===wt)continue;Et=2===wt}if(Ye.zoom!==Re&&Dt(Ye))for(let wt=0;wt<4;wt++){const bt=(Vt<<1)+wt%2,Lt=(xt<<1)+(wt>>1),sn={aabb:w?Ye.aabb.quadrant(wt):d.tileAABB(this,A,Ye.zoom+1,bt,Lt,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:bt,y:Lt,wrap:Ye.wrap,fullyVisible:Et,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};x&&!L&&(sn.tileID=new d.OverscaledTileID(Ye.zoom+1===Re?ft:Ye.zoom+1,Ye.wrap,Ye.zoom+1,bt,Lt),Ke(sn)),ke.push(sn)}else{const wt=Ye.zoom===Re?ft:Ye.zoom;if(o.minzoom&&o.minzoom>wt)continue;const bt=R[0]-(.5+Vt+(Ye.wrap<<Ye.zoom))*(1<<h-Ye.zoom),Lt=R[1]-.5-xt,sn=Ye.tileID?Ye.tileID:new d.OverscaledTileID(wt,Ye.wrap,Ye.zoom,Vt,xt);Ve.push({tileID:sn,distanceSq:bt*bt+Lt*Lt})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,Vt=this.horizonLineFromTop();Ve=Ve.filter(xt=>{const Et=[0,0,0,1],wt=[d.EXTENT,d.EXTENT,0,1],bt=this.calculateFogTileMatrix(xt.tileID.toUnwrapped());d.transformMat4$1(Et,Et,bt),d.transformMat4$1(wt,wt,bt);const Lt=d.getAABBPointSquareDist(Et,wt);if(0===Lt)return!0;let sn=!1;const Sn=this._elevation;if(Sn&&Lt>Ye&&0!==Vt){const qt=this.calculateProjMatrix(xt.tileID.toUnwrapped());let vn;o.isTerrainDEM||(vn=Sn.getMinMaxForTile(xt.tileID)),vn||(vn={min:ue,max:X});const hr=d.furthestTileCorner(this.rotation),Ur=[hr[0]*d.EXTENT,hr[1]*d.EXTENT,vn.max];d.transformMat4(Ur,Ur,qt),sn=(1-Ur[1])*this.height*.5<Vt}return Lt<Ye||sn})}return Ve.sort((Ye,Vt)=>Ye.distanceSq-Vt.distanceSq).map(Ye=>Ye.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),_=this.projection.project(o.lng,h);return new d.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,h){let _,x;const w=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;_=(h.x-w.x)/S,x=(h.y-w.y)/S}else{const S=this.pointCoordinate(h),A=this.pointCoordinate(w);_=S.x-A.x,x=S.y-A.y}const T=this.locationCoordinate(o);this.setLocation(new d.MercatorCoordinate(T.x-_,T.y-x))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,h){const _=h?d.mercatorZfromAltitude(h,o.lat):void 0,x=this.projection.project(o.lng,o.lat);return new d.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,h){const _=h??this._centerAltitude,x=[o.x,o.y,0,1],w=[o.x,o.y,1,1];d.transformMat4$1(x,x,this.pixelMatrixInverse),d.transformMat4$1(w,w,this.pixelMatrixInverse);const T=w[3];d.scale$1(x,x,1/x[3]),d.scale$1(w,w,1/T);const S=x[2],A=w[2];return{p0:x,p1:w,t:S===A?0:(_-S)/(A-S)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],_=[o.x,o.y,1,1];return d.transformMat4$1(h,h,this.pixelMatrixInverse),d.transformMat4$1(_,_,this.pixelMatrixInverse),d.scale$1(h,h,1/h[3]),d.scale$1(_,_,1/_[3]),h[2]=d.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=d.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,d.scale$1(h,h,1/this.worldSize),d.scale$1(_,_,1/this.worldSize),new d.Ray([h[0],h[1],h[2]],d.normalize([],d.sub([],_,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:_,t:x}=o,w=d.mercatorZfromAltitude(h[2],this._center.lat),T=d.mercatorZfromAltitude(_[2],this._center.lat);return new d.MercatorCoordinate(d.number(h[0],_[0],x)/this.worldSize,d.number(h[1],_[1],x)/this.worldSize,d.number(w,T,x))}pointCoordinate(o,h=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,h)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let h=this.projection.pointCoordinate3D(this,o.x,o.y);if(h)return new d.MercatorCoordinate(h[0],h[1],h[2]);let _=0,x=this.horizonLineFromTop();if(o.y>x)return this.pointCoordinate(o);const w=.02*x,T=o.clone();for(let S=0;S<10&&x-_>w;S++){T.y=d.number(_,x,.66);const A=this.projection.pointCoordinate3D(this,T.x,T.y);A?(x=T.y,h=A):_=T.y}return h?new d.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}_coordinatePoint(o,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,x=[o.x*this.worldSize,o.y*this.worldSize,_+o.toAltitude(),1];return d.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new d.pointGeometry(x[0]/x[3],x[1]/x[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,h){const _=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(_,o),A=this.pointCoordinate(x,o);const R=this.pointCoordinate(w,h),L=this.pointCoordinate(T,h),N=(H,Z)=>(Z.y-H.y)/(Z.x-H.x);return S.y>1&&A.y>=0?S=new d.MercatorCoordinate((1-L.y)/N(L,S)+L.x,1):S.y<0&&A.y<=1&&(S=new d.MercatorCoordinate(-L.y/N(L,S)+L.x,0)),A.y>1&&S.y>=0?A=new d.MercatorCoordinate((1-R.y)/N(R,A)+R.x,1):A.y<0&&S.y<=1&&(A=new d.MercatorCoordinate(-R.y/N(R,A)+R.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const h=o.visibleDemTiles.reduce((_,x)=>{if(x.dem){const w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,h){return this.projection.createTileMatrix(this,h,o)}calculateDistanceTileData(o){const h=o.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=o.canonical,w=1/this.height,T=this.cameraWorldSize/this.zoomScale(x.z),S=(x.x+Math.pow(2,x.z)*o.wrap)*T,A=x.y*T,R=this.point,L=this.angle,N=Math.sin(-L),H=-Math.cos(-L);return _[h]={bearing:[N,H],center:[(R.x-S)*w,(R.y-A)*w],scale:T/d.EXTENT*w},_[h]}calculateFogTileMatrix(o){const h=o.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSize,o);return d.multiply(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(o,h=!1){const _=o.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const w=this.calculatePosMatrix(o,this.worldSize);return d.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(o){const h=o.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(w,T){const{scale:S}=w.tileTransform,A=S*d.EXTENT/(w.tileSize*Math.pow(2,T.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return R=new Float32Array(4),H=(L=T.inverseAdjustmentMatrix)[1],Z=L[2],K=L[3],ie=(N=[A,A])[1],R[0]=L[0]*(q=N[0]),R[1]=H*q,R[2]=Z*ie,R[3]=K*ie,R;var R,L,N,H,Z,K,q,ie}(o,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const o=this._elevation;this._updateCameraState();const h=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),w=d.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,x[2]/=w,d.normalize(x,x);const T=o.raycast(_,x,o.exaggeration());if(T){const S=d.scaleAndAdd([],_,x,T),A=new d.MercatorCoordinate(S[0],S[1],d.mercatorZfromAltitude(S[2],d.latFromMercatorY(S[1]))),R=(A.z+d.length([A.x-_[0],A.y-_[1],A.z-_[2]*w]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=o.getAtPointOrZero(new d.MercatorCoordinate(..._)),w=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(T<w){const S=this.locationCoordinate(this._center,this._centerAltitude),A=[S.x-_[0],S.y-_[1],S.z-_[2]],R=d.length(A);A[2]-=(w-T)/this._projectionScaler;const L=d.length(A);if(0===L)return;d.scale$2(A,A,R/L*this._projectionScaler),this._camera.position=[S.x-A[0],S.y-A[1],S.z*this._projectionScaler-A[2]],this._camera.orientation=Lc(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const N=this.center;return N.lat=d.clamp(N.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(N.lng=d.clamp(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}const o=this._unmodified,{x:h,y:_}=this.point;let x=0,w=h,T=_;const S=this.width/2,A=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-A<R&&(T=R+A),_+A>L&&(T=L-A),L-R<this.height&&(x=Math.max(x,this.height/(L-R)),T=(L+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const N=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,Z=this.worldSize/2-(N+H)/2;w=(h+Z+this.worldSize)%this.worldSize-Z,w-S<N&&(w=N+S),w+S>H&&(w=H-S),H-N<this.width&&(x=Math.max(x,this.width/(H-N)),w=(H+N)/2)}w===h&&T===_||(this.center=this.unproject(new d.pointGeometry(w,T))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.pixelsPerMeter;if("globe"===this.projection.name){const ne=d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,oe=d.mercatorZfromAltitude(1,d.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=ne/oe}const _=Su(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?h:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-o.x/this.width,w[9]=2*o.y/this.height;let T=d.mul([],w,x);if(this.projection.isReprojectedInTileSpace){const ne=this.locationCoordinate(this.center),oe=d.identity([]);d.translate(oe,oe,[ne.x*this.worldSize,ne.y*this.worldSize,0]),d.multiply(oe,oe,Nt(this)),d.translate(oe,oe,[-ne.x*this.worldSize,-ne.y*this.worldSize,0]),d.multiply(T,T,oe),this.inverseAdjustmentMatrix=function(fe){const ke=Nt(fe,!0);return st([],[ke[0],ke[1],ke[4],ke[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],T,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=T,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const S=d.invert([],w);this.frustumCorners=d.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);d.identity(A),d.scale(A,A,[1,-1,1]),d.rotateX(A,A,this._pitch),d.rotateZ(A,A,this.angle);const R=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-o.x/this.width,R[9]=2*(o.y+L)/this.height,this.skyboxMatrix=d.multiply(A,R,A);const N=this.point,H=N.x,Z=N.y,K=this.width%2/2,q=this.height%2/2,ie=Math.cos(this.angle),Y=Math.sin(this.angle),Q=H-Math.round(H)+ie*K+Y*q,X=Z-Math.round(Z)+ie*q+Y*K,ue=new Float64Array(T);if(d.translate(ue,ue,[Q>.5?Q-1:Q,X>.5?X-1:X,0]),this.alignedProjMatrix=ue,T=d.create(),d.scale(T,T,[this.width/2,-this.height/2,1]),d.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=d.create(),d.scale(T,T,[1,-1,1]),d.translate(T,T,[-1,-1,0]),d.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=d.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.calculateGlobeMatrix(this);const ne=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.transformMat4(ne,ne,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._projectionScaler,w=[o,o,h];d.scale$2(w,w,x),d.scale$2(_,_,-1),d.multiply$2(_,_,w);const T=d.create();d.translate(T,T,_),d.scale(T,T,w),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,x)}_computeCameraPosition(o){const h=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-o/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,o/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=o[2];let x=1;_>0&&(x=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),S=Math.max((o[2]-w)/Math.cos(_),T),A=this._zoomFromMercatorZ(S);d.scaleAndAdd(o,o,h,S),this._pitch=d.clamp(_,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(x,-Math.PI,Math.PI),this._setZoom(d.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,h){const _=Math.min(o.x,h.x),x=Math.max(o.x,h.x),w=Math.min(o.y,h.y),T=Math.max(o.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new d.pointGeometry(_,w),new d.pointGeometry(x,T),new d.pointGeometry(_,T),new d.pointGeometry(x,w)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of S){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const H=this.rayIntersectionCoordinate(N);if(H.x<A||H.y<0||H.x>R||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,h){const _=d.length(d.sub([],this._camera.position,o)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const o=function(h,_){const x=[h[0],h[1],h[2],1];d.transformMat4$1(x,x,_);const w=Math.max(x[3],1e-6);return[x[0]/w,x[1]/w,x[2]/w,w]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.pointGeometry(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,o))}}getCameraToCenterDistance(o){const h=Su(o,this.zoom,this.width,this.height,1024),_=o.pixelSpaceConversion(this.center.lat,this.worldSize,h);return.5/Math.tan(.5*this._fov)*this.height*_}}function Fc(p,o){let h=!1,_=null;const x=()=>{_=null,h&&(p(),_=setTimeout(x,o),h=!1)};return()=>(h=!0,_||x(),_)}class sd{constructor(o){this._hashName=o&&encodeURIComponent(o),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Fc(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,d.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),d.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const h=this._map;if(!h)return"";const _=h.getCenter(),x=Math.round(100*h.getZoom())/100,w=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,w),S=Math.round(_.lng*T)/T,A=Math.round(_.lat*T)/T,R=h.getBearing(),L=h.getPitch();let N="";if(N+=o?`/${S}/${A}/${x}`:`${x}/${A}/${S}`,(R||L)&&(N+="/"+Math.round(10*R)/10),L&&(N+=`/${Math.round(L)}`),this._hashName){const H=this._hashName;let Z=!1;const K=d.window.location.hash.slice(1).split("&").map(q=>{const ie=q.split("=")[0];return ie===H?(Z=!0,`${ie}=${N}`):q}).filter(q=>q);return Z||K.push(`${H}=${N}`),`#${K.join("&")}`}return`#${N}`}_getCurrentHash(){const o=d.window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(h[3]||0):o.getBearing();return o.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,o)}}const kl={linearity:.3,easing:d.bezier(0,0,.3,1)},ad=d.extend({deceleration:2500,maxSpeed:1400},kl),Rp=d.extend({deceleration:20,maxSpeed:1400},kl),lo=d.extend({deceleration:1e3,maxSpeed:360},kl),vf=d.extend({deceleration:1e3,maxSpeed:90},kl);class xg{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=d.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const w=Ll(h.pan.mag(),_,d.extend({},ad,o||{}));x.offset=h.pan.mult(w.amount/h.pan.mag()),x.center=this._map.transform.center,Rl(x,w)}if(h.zoom){const w=Ll(h.zoom,_,Rp);x.zoom=this._map.transform.zoom+w.amount,Rl(x,w)}if(h.bearing){const w=Ll(h.bearing,_,lo);x.bearing=this._map.transform.bearing+d.clamp(w.amount,-179,179),Rl(x,w)}if(h.pitch){const w=Ll(h.pitch,_,vf);x.pitch=this._map.transform.pitch+w.amount,Rl(x,w)}if(x.zoom||x.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Rl(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function Ll(p,o,h){const{maxSpeed:_,linearity:x,deceleration:w}=h,T=d.clamp(p*x/(o/1e3),-_,_),S=Math.abs(T)/(w*x);return{easing:h.easing,duration:1e3*S,amount:T*(S/2)}}class Po extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,_,x={}){const w=je(h.getCanvasContainer(),_),T=h.unproject(w);super(o,d.extend({point:w,lngLat:T,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class Fl extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,_){const x="touchend"===o?_.changedTouches:_.touches,w=Le(h.getCanvasContainer(),x),T=w.map(A=>h.unproject(A)),S=w.reduce((A,R,L,N)=>A.add(R.div(N.length)),new d.pointGeometry(0,0));super(o,{points:w,point:S,lngLats:T,lngLat:h.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class Lp extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class zc{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Lp(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Po(o.type,this._map,o))}mouseup(o){this._map.fire(new Po(o.type,this._map,o))}preclick(o){const h=d.extend({},o);h.type="preclick",this._map.fire(new Po(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Po(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Po(o.type,this._map,o))}mouseover(o){this._map.fire(new Po(o.type,this._map,o))}mouseout(o){this._map.fire(new Po(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Fl(o.type,this._map,o))}touchmove(o){this._map.fire(new Fl(o.type,this._map,o))}touchend(o){this._map.fire(new Fl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Fl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fp{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Po(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Po("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Po(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gi{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&0===o.button&&(vt(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=De("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const w=Math.min(x.x,_.x),T=Math.max(x.x,_.x),S=Math.min(x.y,_.y),A=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${S}px)`,this._box.style.width=T-w+"px",this._box.style.height=A-S+"px")})}mouseupWindow(o,h){if(!this._active||0!==o.button)return;const _=this._startPos,x=h;if(this.reset(),Be(),_.x!==x.x||_.y!==x.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_t(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new d.Event(o,{originalEvent:h}))}}function Iu(p,o){const h={};for(let _=0;_<p.length;_++)h[p[_].identifier]=o[_];return h}class zp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const w=new d.pointGeometry(0,0);for(const T of x)w._add(T);return w.div(x.length)}(h),this.touches=Iu(_,h)))}touchmove(o,h,_){if(this.aborted||!this.centroid)return;const x=Iu(_,h);for(const w in this.touches){const T=this.touches[w],S=x[w];(!S||S.dist(T)>30)&&(this.aborted=!0)}}touchend(o,h,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class _i{constructor(o){this.singleTap=new zp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,h,_){this.singleTap.touchstart(o,h,_)}touchmove(o,h,_){this.singleTap.touchmove(o,h,_)}touchend(o,h,_){const x=this.singleTap.touchend(o,h,_);if(x){const w=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(w&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Np{constructor(){this._zoomIn=new _i({numTouches:1,numTaps:2}),this._zoomOut=new _i({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,_){this._zoomIn.touchstart(o,h,_),this._zoomOut.touchstart(o,h,_)}touchmove(o,h,_){this._zoomIn.touchmove(o,h,_),this._zoomOut.touchmove(o,h,_)}touchend(o,h,_){const x=this._zoomIn.touchend(o,h,_),w=this._zoomOut.touchend(o,h,_);return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:o})}):w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(w)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Au={0:1,2:2};class zl{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const _=xe(o);this._correctButton(o,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(o,h){const _=this._lastPoint;if(_)if(o.preventDefault(),null!=this._eventButton&&function(x,w){const T=Au[w];return void 0===x.buttons||(x.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(o){this._lastPoint&&xe(o)===this._eventButton&&(this._moved&&Be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ns extends zl{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return 0===h&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class xf extends zl{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const _=.8*(h.x-o.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(o){o.preventDefault()}}class Pu extends zl{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const _=-.5*(h.y-o.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(o){o.preventDefault()}}class Nl{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(o,h,_){return this._calculateTransform(o,h,_)}touchmove(o,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,h,_)}}touchend(o,h,_){this._calculateTransform(o,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,_){_.length>0&&(this._active=!0);const x=Iu(_,h),w=new d.pointGeometry(0,0),T=new d.pointGeometry(0,0);let S=0;for(const R in x){const L=x[R],N=this._touches[R];N&&(w._add(L),T._add(L.sub(N)),S++,x[R]=L)}if(this._touches=x,S<this._minTouches||!T.mag())return;const A=T.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class go{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,h,_){return{}}touchstart(o,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,_){const x=this._firstTwoTouches;if(!x)return;o.preventDefault();const[w,T]=x,S=Pi(_,h,w),A=Pi(_,h,T);if(!S||!A)return;const R=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],R,o)}touchend(o,h,_){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,T=Pi(_,h,x),S=Pi(_,h,w);T&&S||(this._active&&Be(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pi(p,o,h){for(let _=0;_<p.length;_++)if(p[_].identifier===h)return o[_]}function ld(p,o){return Math.log(p/o)/Math.LN2}class Bp extends go{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ld(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ld(this._distance,_),pinchAround:h}}}function Ca(p,o){return 180*p.angleWith(o)/Math.PI}class Vp extends go{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const _=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ca(this._vector,_),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Ca(o,this._startVector);return Math.abs(_)<h}}function rs(p){return Math.abs(p.y)>Math.abs(p.x)}class zn extends go{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,rs(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,_){const x=this._lastPoints;if(!x)return;const w=o[0].sub(x[0]),T=o[1].sub(x[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,T,_.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(w.y+T.y)/2*-.5})}gestureBeginsVertically(o,h,_){if(void 0!==this._valid)return this._valid;const x=o.mag()>=2,w=h.mag()>=2;if(!x&&!w)return;if(!x||!w)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const T=o.y>0==h.y>0;return rs(o)&&rs(h)&&T}}const Bl={panStep:100,bearingStep:15,pitchStep:10};class Ma{constructor(){const o=Bl;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,_=0,x=0,w=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),w=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),w=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:cd,zoom:h?Math.round(A)+h*(o.shiftKey?2:1):A,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cd(p){return p*(2-p)}const Bt=4.000244140625;class Up{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=o.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const _=d.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%Bt==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=je(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,h=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>Bt?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==R&&(R=1/R);const L=h(),N=Math.pow(2,L),H="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(H*R))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,w=this._easing;let T,S=!1;if("wheel"===this._type&&x&&w){const A=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),R=w(A);T=d.number(x,_,R),A<1?this._frameId||(this._frameId=!0):S=!0}else T=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:T-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=d.ease;if(this._prevEase){const _=this._prevEase,x=(d.exported.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),T=.27/Math.sqrt(w*w+1e-4)*.01,S=Math.sqrt(.0729-T*T);h=d.bezier(T,S,.25,1)}return this._prevEase={start:d.exported.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement||!!d.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class bf{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ou{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(o.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(){this._tap=new _i({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,h,_){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(o,h,_))}touchmove(o,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(o,h,_)}touchend(o,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(o,h,_)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pt{constructor(o,h,_){this._el=o,this._mousePan=h,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dr{constructor(o,h,_){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ni{constructor(o,h,_,x){this._el=o,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vr=p=>p.zoom||p.drag||p.pitch||p.rotate;class Oi extends d.Event{}class wf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const _=d.sub([],h,o);this.radius=d.length(_[2]<0?d.div([],_,this.constants):[_[0],_[1],0])}projectRay(o){d.div(o,o,this.constants),d.normalize(o,o),d.mul$1(o,o,this.constants);const h=d.scale$2([],o,this.radius);if(h[2]>0){const _=d.scale$2([],[0,0,1],d.dot(h,[0,0,1])),x=d.scale$2([],d.normalize([],[h[0],h[1],0]),this.radius),w=d.add([],h,d.scale$2([],d.sub([],d.add([],x,_),h),2));h[0]=w[0],h[1]=w[1]}return h}}function Ea(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class is{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xg(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new wf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),d.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[x,w,T]of this._listeners)x.addEventListener(w,x===d.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,h,_]of this._listeners)o.removeEventListener(h,o===d.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new zc(h,o));const x=h.boxZoom=new gi(h,o);this._add("boxZoom",x);const w=new Np,T=new Ou;h.doubleClickZoom=new bf(T,w),this._add("tapZoom",w),this._add("clickZoom",T);const S=new ku;this._add("tapDragZoom",S);const A=h.touchPitch=new zn(h);this._add("touchPitch",A);const R=new xf(o),L=new Pu(o);h.dragRotate=new dr(o,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new ns(o),H=new Nl(h,o);h.dragPan=new pt(_,N,H),this._add("mousePan",N),this._add("touchPan",H,["touchZoom","touchRotate"]);const Z=new Vp,K=new Bp;h.touchZoomRotate=new ni(_,K,Z,S),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fp(h));const q=h.scrollZoom=new Up(h,this);this._add("scrollZoom",q,["mousePan"]);const ie=h.keyboard=new Ma;this._add("keyboard",ie);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Y]&&h[Y].enable(o[Y])}_add(o,h,_){this._handlers.push({handlerName:o,handler:h,allowed:_}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vr(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,_){for(const x in o)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const _ of o)this._el.contains(_.target)&&h.push(_);return h}handleEvent(o,h){this._updatingCamera=!0;const _="renderFrame"===o.type,x=_?void 0:o,w={needsRenderFrame:!1},T={},S={},A=o.touches?this._getMapTouches(o.touches):void 0,R=A?Le(this._el,A):_?void 0:je(this._el,o);for(const{handlerName:H,handler:Z,allowed:K}of this._handlers){if(!Z.isEnabled())continue;let q;this._blockedByActive(S,K,H)?Z.reset():Z[h||o.type]&&(q=Z[h||o.type](o,R,A),this.mergeHandlerResult(w,T,q,H,x),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||Z.isActive())&&(S[H]=Z)}const L={};for(const H in this._previousActiveHandlers)S[H]||(L[H]=x);this._previousActiveHandlers=S,(Object.keys(L).length||Ea(w))&&(this._changes.push([w,T,L]),this._triggerRenderFrame()),(Object.keys(S).length||Ea(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=w;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(o,h,_,x,w){if(!_)return;d.extend(o,_);const T={handlerName:x,originalEvent:_.originalEvent||w};void 0!==_.zoomDelta&&(h.zoom=T),void 0!==_.panDelta&&(h.drag=T),void 0!==_.pitchDelta&&(h.pitch=T),void 0!==_.bearingDelta&&(h.rotate=T)}_applyChanges(){const o={},h={},_={};for(const[x,w,T]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new d.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(o.around=x.around),void 0!==x.aroundCoord&&(o.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),d.extend(h,w),d.extend(_,T);this._updateMapTransform(o,h,_),this._changes=[]}_updateMapTransform(o,h,_){const x=this._map,w=x.transform,T=Q=>[Q.x,Q.y,Q.z];if((Q=>{const X=this._eventsInProgress.drag;return X&&!this._handlersById[X.handlerName].isActive()})()&&!Ea(o)){const Q=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",Q!==w.zoom&&this._map._update(!0)}if(!Ea(o))return void this._fireEvents(h,_,!0);let{panDelta:S,zoomDelta:A,bearingDelta:R,pitchDelta:L,around:N,aroundCoord:H,pinchAround:Z}=o;void 0!==Z&&(N=Z),(Q=>h.drag&&!this._eventsInProgress.drag)()&&N&&(this._dragOrigin=T(w.pointCoordinate3D(N)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),N=N||x.transform.centerPoint,R&&(w.bearing+=R),L&&(w.pitch+=L),w._updateCameraState();const K=[0,0,0];if(S){const Q=w.pointCoordinate(N);if("globe"===w.projection.name){const X=d.latFromMercatorY(Q.y),ue=w.center.lat,ne=Math.min(d.mercatorZfromAltitude(1,X)/d.mercatorZfromAltitude(1,ue),2);S=S.rotate(-w.angle),K[0]=-S.x/w.worldSize*ne,K[1]=-S.y/w.worldSize*ne}else{const X=w.pointCoordinate(N.sub(S));Q&&X&&(K[0]=X.x-Q.x,K[1]=X.y-Q.y)}}const q=w.zoom,ie=[0,0,0];if(A){const Q=T(H||w.pointCoordinate3D(N)),X={dir:d.normalize([],d.sub([],Q,w._camera.position))};if(X.dir[2]<0){const ue=w.zoomDeltaToMovement(Q,A);d.scale$2(ie,X.dir,ue)}}const Y=d.add(K,K,ie);w._translateCameraConstrained(Y),A&&Math.abs(w.zoom-q)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,_,!0)}_fireEvents(o,h,_){const x=Vr(this._eventsInProgress),w=Vr(o),T={};for(const L in o){const{originalEvent:N}=o[L];this._eventsInProgress[L]||(T[`${L}start`]=N),this._eventsInProgress[L]=o[L]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const L in T)this._fireEvent(L,T[L]);w&&this._fireEvent("move",w.originalEvent);for(const L in o){const{originalEvent:N}=o[L];this._fireEvent(L,N)}const S={};let A;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],A=h[N]||H,S[`${L}end`]=A)}for(const L in S)this._fireEvent(L,S[L]);const R=Vr(this._eventsInProgress);if(_&&(x||w)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new d.Event("moveend",{originalEvent:A})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new d.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Oi("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Nc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bc extends d.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,_){return o=d.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},h),_)}panTo(o,h,_){return this.easeTo(d.extend({center:o},h),_)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,_){return this.easeTo(d.extend({zoom:o},h),_)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,_){return this.easeTo(d.extend({bearing:o},h),_)}resetNorth(o,h){return this.rotateTo(0,d.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),o=d.LngLatBounds.convert(o);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,h)}_extendCameraOptions(o){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=d.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const _=o.padding;o.padding={top:_,bottom:_,right:_,left:_}}return o.padding=d.extend(h,o.padding),o}_cameraForBoxAndBearing(o,h,_,x){const w=this._extendCameraOptions(x),T=this.transform,S=T.padding,A=T.project(d.LngLat.convert(o)),R=T.project(d.LngLat.convert(h)),L=new d.pointGeometry(A.x,R.y),N=new d.pointGeometry(R.x,A.y),H=-d.degToRad(_),Z=A.rotate(H),K=R.rotate(H),q=L.rotate(H),ie=N.rotate(H),Y=new d.pointGeometry(Math.max(Z.x,K.x,q.x,ie.x),Math.max(Z.y,K.y,q.y,ie.y)),Q=new d.pointGeometry(Math.min(Z.x,K.x,q.x,ie.x),Math.min(Z.y,K.y,q.y,ie.y)),X=Y.sub(Q),ue=(T.width-((S.left||0)+(S.right||0)+w.padding.left+w.padding.right))/X.x,ne=(T.height-((S.top||0)+(S.bottom||0)+w.padding.top+w.padding.bottom))/X.y;if(ne<0||ue<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const oe=Math.min(T.scaleZoom(T.scale*Math.min(ue,ne)),w.maxZoom),fe="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new d.pointGeometry(w.offset.x,w.offset.y):d.pointGeometry.convert(w.offset),ke=new d.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(_*Math.PI/180),Ve=fe.add(ke).mult(T.scale/T.zoomScale(oe));return{center:T.unproject(A.add(R).div(2).sub(Ve)),zoom:oe,bearing:_}}_cameraForBox(o,h,_,x,w){const T=this._extendCameraOptions(w);_=_||0,x=x||0,o=d.LngLat.convert(o),h=d.LngLat.convert(h);const S=this.transform.clone();S.padding=T.padding;const A=this.getFreeCameraOptions(),R=new d.LngLat(.5*(o.lng+h.lng),.5*(o.lat+h.lat)),L=.5*(_+x);if(S._camera.position[2]<d.mercatorZfromAltitude(L,R.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(R),S.setFreeCameraOptions(A);const N=d.MercatorCoordinate.fromLngLat(o),H=d.MercatorCoordinate.fromLngLat(h),Z=S.pointRayIntersection(S.centerPoint,L),K=[(q=S.rayIntersectionCoordinate(Z)).x,q.y,q.z];var q;const ie=S.screenPointToMercatorRay(S.centerPoint),Y="globe"!==S.projection.name;let Q,X=0;do{const ue=Math.floor(S.zoom),ne=1<<ue,oe=Math.min(ne*N.x,ne*H.x),fe=Math.min(ne*N.y,ne*H.y),ke=Math.max(ne*N.x,ne*H.x),Ve=Math.max(ne*N.y,ne*H.y),Re=new d.Aabb([oe,fe,_],[ke,Ve,x]),ft=d.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,ue,Y);if(2!==Re.intersects(ft)){Q&&(S._camera.position=d.scaleAndAdd([],S._camera.position,ie.dir,-Q),S._updateStateFromCamera());break}const ae=d.sub([],S._camera.position,K);Q=.5*d.length(ae),S._camera.position=d.scaleAndAdd([],S._camera.position,ie.dir,Q);try{S._updateStateFromCamera()}catch{return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++X<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(o,h,_){return"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(o,h),h,_)}_raycastElevationBox(o,h){const _=this.transform.elevation;if(!_)return;const x=new d.pointGeometry(o.x,h.y),w=new d.pointGeometry(h.x,o.y),T=_.pointCoordinate(o);if(!T)return;const S=_.pointCoordinate(h);if(!S)return;const A=_.pointCoordinate(x);if(!A)return;const R=_.pointCoordinate(w);if(!R)return;const L=new d.MercatorCoordinate(T[0],T[1]).toLngLat(),N=new d.MercatorCoordinate(S[0],S[1]).toLngLat(),H=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),Z=new d.MercatorCoordinate(R[0],R[1]).toLngLat(),K=Math.min(L.lng,Math.min(N.lng,Math.min(H.lng,Z.lng))),q=Math.min(L.lat,Math.min(N.lat,Math.min(H.lat,Z.lat))),ie=Math.max(L.lng,Math.max(N.lng,Math.max(H.lng,Z.lng))),Y=Math.max(L.lat,Math.max(N.lat,Math.max(H.lat,Z.lat))),Q=Math.min(T[3],Math.min(S[3],Math.min(A[3],R[3]))),X=Math.max(T[3],Math.max(S[3],Math.max(A[3],R[3])));return{minLngLat:new d.LngLat(K,q),maxLngLat:new d.LngLat(ie,Y),minAltitude:Q,maxAltitude:X}}fitScreenCoordinates(o,h,_,x,w){let T,S,A,R;"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const L=d.pointGeometry.convert(o),N=d.pointGeometry.convert(h),H=this._raycastElevationBox(L,N);if(H)T=H.minLngLat,S=H.maxLngLat,A=H.minAltitude,R=H.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,N))return this;T=this.transform.pointLocation(L),S=this.transform.pointLocation(N)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(o)),this.transform.pointLocation(d.pointGeometry.convert(h)),_,x):this._cameraForBox(T,S,A,R,x),x,w)}_fitInternal(o,h,_){return o?(delete(h=d.extend(o,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(o,h){this.stop();const _=o.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,T=!1;return"zoom"in o&&_.zoom!==+o.zoom&&(x=!0,_.zoom=+o.zoom),void 0!==o.center&&(_.center=d.LngLat.convert(o.center)),"bearing"in o&&_.bearing!==+o.bearing&&(w=!0,_.bearing=+o.bearing),"pitch"in o&&_.pitch!==+o.pitch&&(T=!0,_.pitch=+o.pitch),null==o.padding||_.isPaddingEqual(o.padding)||(_.padding=o.padding),o.preloadOnly?(this._preloadTiles(_),this):(this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),x&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),w&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),T&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(Nc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return d.warnOnce(Nc),this;this.stop();const x=_.zoom,w=_.pitch,T=_.bearing;_.setFreeCameraOptions(o);const S=x!==_.zoom,A=w!==_.pitch,R=T!==_.bearing;return this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),S&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),R&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),A&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),(!1===(o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate||!o.essential&&d.exported.prefersReducedMotion)&&(o.duration=0);const _=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in o?+o.zoom:x,R="bearing"in o?this._normalizeBearing(o.bearing,w):w,L="pitch"in o?+o.pitch:T,N="padding"in o?o.padding:_.padding,H=d.pointGeometry.convert(o.offset);let Z,K,q;if("globe"===_.projection.name){const Ve=d.MercatorCoordinate.fromLngLat(_.center),Re=H.rotate(-_.angle);Ve.x+=Re.x/_.worldSize,Ve.y+=Re.y/_.worldSize;const ft=Ve.toLngLat(),ae=d.LngLat.convert(o.center||ft);this._normalizeCenter(ae),Z=_.centerPoint.add(Re),K=new d.pointGeometry(Ve.x,Ve.y).mult(_.worldSize),q=new d.pointGeometry(d.mercatorXfromLng(ae.lng),d.mercatorYfromLat(ae.lat)).mult(_.worldSize).sub(K)}else{Z=_.centerPoint.add(H);const Ve=_.pointLocation(Z),Re=d.LngLat.convert(o.center||Ve);this._normalizeCenter(Re),K=_.project(Ve),q=_.project(Re).sub(K)}const ie=_.zoomScale(A-x);let Y,Q;o.around&&(Y=d.LngLat.convert(o.around),Q=_.locationPoint(Y));const X=this._zooming||A!==x,ue=this._rotating||w!==R,ne=this._pitching||L!==T,oe=!_.isPaddingEqual(N),fe=Ve=>Re=>{if(X&&(Ve.zoom=d.number(x,A,Re)),ue&&(Ve.bearing=d.number(w,R,Re)),ne&&(Ve.pitch=d.number(T,L,Re)),oe&&(Ve.interpolatePadding(S,N,Re),Z=Ve.centerPoint.add(H)),Y)Ve.setLocationAtPoint(Y,Q);else{const ft=Ve.zoomScale(Ve.zoom-x),ae=A>x?Math.min(2,ie):Math.max(.5,ie),Ie=Math.pow(ae,1-Re),Ke=Ve.unproject(K.add(q.mult(Re*Ie)).mult(ft));Ve.setLocationAtPoint(Ve.renderWorldCopies?Ke.wrap():Ke,Z)}return o.preloadOnly||this._fireMoveEvents(h),Ve};if(o.preloadOnly){const Ve=this._emulate(fe,o.duration,_);return this._preloadTiles(Ve),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=X,this._rotating=ue,this._pitching=ne,this._padding=oe,this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,ke),this._ease(fe(_),Ve=>{_.recenterOnTerrain(),this._afterEase(h,Ve)},o),this}_prepareEase(o,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!_.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new d.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new d.Event("zoomend",o)),x&&this.fire(new d.Event("rotateend",o)),w&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}flyTo(o,h){if(!o.essential&&d.exported.prefersReducedMotion){const Et=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Et,h)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);const _=this.transform,x=this.getZoom(),w=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in o?d.clamp(+o.zoom,_.minZoom,_.maxZoom):x,R="bearing"in o?this._normalizeBearing(o.bearing,w):w,L="pitch"in o?+o.pitch:T,N="padding"in o?o.padding:_.padding,H=_.zoomScale(A-x),Z=d.pointGeometry.convert(o.offset);let K=_.centerPoint.add(Z);const q=_.pointLocation(K),ie=d.LngLat.convert(o.center||q);this._normalizeCenter(ie);const Y=_.project(q),Q=_.project(ie).sub(Y);let X=o.curve;const ue=Math.max(_.width,_.height),ne=ue/H,oe=Q.mag();if("minZoom"in o){const Et=d.clamp(Math.min(o.minZoom,x,A),_.minZoom,_.maxZoom),wt=ue/_.zoomScale(Et-x);X=Math.sqrt(wt/oe*2)}const fe=X*X;function ke(Et){const wt=(ne*ne-ue*ue+(Et?-1:1)*fe*fe*oe*oe)/(2*(Et?ne:ue)*fe*oe);return Math.log(Math.sqrt(wt*wt+1)-wt)}function Ve(Et){return(Math.exp(Et)-Math.exp(-Et))/2}function Re(Et){return(Math.exp(Et)+Math.exp(-Et))/2}const ft=ke(0);let ae=function(Et){return Re(ft)/Re(ft+X*Et)},Ie=function(Et){return ue*((Re(ft)*(Ve(wt=ft+X*Et)/Re(wt))-Ve(ft))/fe)/oe;var wt},Ke=(ke(1)-ft)/X;if(Math.abs(oe)<1e-6||!isFinite(Ke)){if(Math.abs(ue-ne)<1e-6)return this.easeTo(o,h);const Et=ne<ue?-1:1;Ke=Math.abs(Math.log(ne/ue))/X,Ie=function(){return 0},ae=function(wt){return Math.exp(Et*X*wt)}}o.duration="duration"in o?+o.duration:1e3*Ke/("screenSpeed"in o?+o.screenSpeed/X:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Dt=w!==R,Ye=L!==T,Vt=!_.isPaddingEqual(N),xt=Et=>wt=>{const bt=wt*Ke,Lt=1/ae(bt);Et.zoom=1===wt?A:x+Et.scaleZoom(Lt),Dt&&(Et.bearing=d.number(w,R,wt)),Ye&&(Et.pitch=d.number(T,L,wt)),Vt&&(Et.interpolatePadding(S,N,wt),K=Et.centerPoint.add(Z));const sn=1===wt?ie:Et.unproject(Y.add(Q.mult(Ie(bt))).mult(Lt));return Et.setLocationAtPoint(Et.renderWorldCopies?sn.wrap():sn,K),Et._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(h),Et};if(o.preloadOnly){const Et=this._emulate(xt,o.duration,_);return this._preloadTiles(Et),this}return this._zooming=!0,this._rotating=Dt,this._pitching=Ye,this._padding=Vt,this._prepareEase(h,!1),this._ease(xt(_),()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!o){const _=this.handlers;_&&_.stop(!1)}return this}_ease(o,h,_){!1===_.animate||0===_.duration?(o(1),h()):(this._easeStart=d.exported.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=d.wrap(o,-180,180);const _=Math.abs(o-h);return Math.abs(o-360-h)<_&&(o-=360),Math.abs(o+360-h)<_&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=o.lng-h.center.lng;o.lng+=_>180?-360:_<-180?360:0}_emulate(o,h,_){const x=Math.ceil(15*h/1e3),w=[],T=o(_.clone());for(let S=0;S<=x;S++){const A=T(S/x);w.push(A.clone())}return w}}class jp{constructor(o={}){this.options=o,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact;return this._map=o,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=De("button","mapboxgl-ctrl-attrib-button",this._container),De("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=De("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const _=this._map._getUIString(`AttributionControl.${h}`);o.setAttribute("aria-label",_),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(o){const _=h.reduce((x,w,T)=>(w.value&&(x+=`${w.key}=${w.value}${T<h.length-1?"&":""}`),x),"?");o.href=`${d.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const w=h[x];if(w.used){const T=w.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((x,w)=>x.length-w.length),o=o.filter((x,w)=>{for(let T=w+1;T<o.length;T++)if(o[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Cf{constructor(){d.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=De("div","mapboxgl-ctrl");const h=De("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const h in o){const _=o[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class $p{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===o)return void(x.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vc(p,o,h){if(p=new d.LngLat(p.lng,p.lat),o){const _=new d.LngLat(p.lng-360,p.lat),x=new d.LngLat(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),T=h.locationPoint(p).distSqr(o),S=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(_).distSqr(o)<T&&(S||Math.abs(_.lng-h.center.lng)<w)?p=_:h.locationPoint(x).distSqr(o)<T&&(S||Math.abs(x.lng-h.center.lng)<w)&&(p=x)}for(;Math.abs(p.lng-h.center.lng)>180;){const _=h.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const Qi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Cs extends d.Evented{constructor(o,h){if(super(),(o instanceof d.window.HTMLElement||h)&&(o=d.extend({element:o},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=d.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=De("div");const x=41,w=27,T=lt("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),S=lt("radialGradient",{id:"shadowGradient"},lt("defs",{},T));lt("stop",{offset:"10%","stop-opacity":.4},S),lt("stop",{offset:"100%","stop-opacity":.05},S),lt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),lt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),lt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),lt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=d.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Qi)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const h=o.code,_=o.charCode||o.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map;if(!o)return!1;const h=o.unproject(this._pos),_=o.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(h)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const h=this._pos;if(!h||h.x<0||h.x>o.transform.width||h.y<0||h.y>o.transform.height)return void this._clearFadeTimer();const _=o.unproject(h);let x;o._usingGlobe()&&d.isLngLatBehindGlobe(o.transform,this._lngLat)?x=0:(x=1-o._queryFogOpacity(_),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(x*=.2)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const h=this._calculateXYTransform()+this._calculateZTransform(),_=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${o.x}px,${o.y}px) ${Qi[this._anchor]}\n            ${h}\n            translate(${_.x}px,${_.y}px)\n        `}_calculateXYTransform(){const o=this._pos,h=this._map;if("map"!==this.getPitchAlignment()||!h||!o)return"";if(!h._usingGlobe()){const A=h.getPitch();return A?`rotateX(${A}deg)`:""}const _=d.radToDeg(d.globeTiltAtLngLat(h.transform,this._lngLat)),x=o.sub(d.globeCenterToScreenPoint(h.transform)),w=_/(Math.abs(x.x)+Math.abs(x.y)),T=x.x*w,S=-x.y*w;return S||T?`rotateX(${S}deg) rotateY(${T}deg)`:""}_calculateZTransform(){const o=this._calculateRotation();return o?`rotateZ(${o}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const o=this._map;if(this._pos&&o&&o._usingGlobe()){const h=o.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),_=o.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(h);return this._rotation+d.radToDeg(Math.atan2(_.y,_.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(o){d.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Vc(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===o?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._usingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=d.pointGeometry.convert(o),this._update(),this}_onMove(o){const h=this._map;if(h){if(!this._isDragging){const _=this._clickTolerance||h._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(o){const h=this._map;h&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const h=this._map;return h&&(o?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Mf{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=d.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,_){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+_}}const tl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ta={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ud(p){p.parentNode&&p.parentNode.removeChild(p)}const Ef={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gp{constructor(o,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new xf({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,_&&(this.mousePitch=new Pu({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),vt()}move(o,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(o,h),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,h),S=T&&T.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_t(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(d.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),je(this.element,o)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,je(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Le(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Le(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Tf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hd={maxWidth:100,unit:"metric"};function Ta(p,o,h,_,x,w){const T=function(A){const R=Math.pow(10,`${Math.floor(A)}`.length-1);let L=A/R;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(N){const H=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*H)/H}(L),R*L}(h),S=T/h;w._requestDomTask(()=>{p.style.width=o*S+"px",p.innerHTML="nautical-mile"!==x?new Intl.NumberFormat(_,{style:"unit",unitDisplay:"narrow",unit:x}).format(T):`${T}&nbsp;nm`})}const Df={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ru=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dd(p=new d.pointGeometry(0,0),o="bottom"){if("number"==typeof p){const h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new d.pointGeometry(0,p);case"top-left":return new d.pointGeometry(h,h);case"top-right":return new d.pointGeometry(-h,h);case"bottom":return new d.pointGeometry(0,-p);case"bottom-left":return new d.pointGeometry(h,-h);case"bottom-right":return new d.pointGeometry(-h,-h);case"left":return new d.pointGeometry(p,0);case"right":return new d.pointGeometry(-p,0)}return new d.pointGeometry(0,0)}return p instanceof d.pointGeometry||Array.isArray(p)?d.pointGeometry.convert(p):d.pointGeometry.convert(p[o]||[0,0])}const Vl={version:d.version,supported:Te,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Bc{constructor(p){if(null!=(p=d.extend({},ta,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&d.isSafariWithAntialiasingBug(d.window)&&(p.antialias=!1,d.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new od(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language="auto"===p.language?d.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new $p,this._domRenderTaskQueue=new $p,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},tl,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Mf(0),this._explicitProjection=null,this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof d.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new is(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new sd("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new jp({customAttribution:p.customAttribution})),this._logoControl=new Cf,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new d.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(p,o){if(void 0===o&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[o];return-1!==o.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),o&&this.fire(new d.Event("moveend",p)),this}getBounds(){return"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language="auto"===p?d.window.navigator.language:p,this.style)for(const o in this.style._sourceCaches){const h=this.style._sourceCaches[o]._source;h._setLanguage&&h._setLanguage(this._language)}for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const o in this.style._sourceCaches){const h=this.style._sourceCaches[o]._source;h._setWorldview&&h._setWorldview(p)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){const o=this.getProjection();null===p&&(this._explicitProjection=null);const h=p||this.getProjection();let _;if(h&&"globe"===h.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?(_=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(_=this.transform.setProjection(h),this.transform.mercatorFromTransition=!1),p&&(this._explicitProjection="globe"===p.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),_){if("globe"===o.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const x in this.style._sourceCaches)this.style._sourceCaches[x].clearTiles()}this._update(!0)}return this}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,o,h){if("mouseenter"===p||"mouseover"===p){let _=!1;const x=T=>{const S=o.filter(R=>this.getLayer(R)),A=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];A.length?_||(_=!0,h.call(this,new Po(p,this,T.originalEvent,{features:A}))):_=!1},w=()=>{_=!1};return{layers:new Set(o),listener:h,delegates:{mousemove:x,mouseout:w}}}if("mouseleave"===p||"mouseout"===p){let _=!1;const x=T=>{const S=o.filter(A=>this.getLayer(A));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?_=!0:_&&(_=!1,h.call(this,new Po(p,this,T.originalEvent)))},w=T=>{_&&(_=!1,h.call(this,new Po(p,this,T.originalEvent)))};return{layers:new Set(o),listener:h,delegates:{mousemove:x,mouseout:w}}}{const _=x=>{const w=o.filter(S=>this.getLayer(S)),T=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];T.length&&(x.features=T,h.call(this,x),delete x.features)};return{layers:new Set(o),listener:h,delegates:{[p]:_}}}}on(p,o,h){if(void 0===h)return super.on(p,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(p,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(p,o,h){if(void 0===h)return super.once(p,o);Array.isArray(o)||(o=[o]);const _=this._createDelegatedListener(p,o,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(p,o,h){if(void 0===h)return super.off(p,o);o=new Set(Array.isArray(o)?o:[o]);const _=(w,T)=>{if(w.size!==T.size)return!1;for(const S of w)if(!T.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(w=>{for(let T=0;T<w.length;T++){const S=w[T];if(S.listener===h&&_(S.layers,o)){for(const A in S.delegates)this.off(A,S.delegates[A]);return w.splice(T,1),this}}})(x),this}queryRenderedFeatures(p,o){return this.style?(void 0!==o||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(o=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(p,o){return this.style.querySourceFeatures(p,o)}queryTerrainElevation(p,o){const h=this.transform.elevation;return h?(o=d.extend({},{exaggerated:!0},o),h.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,o.exaggerated)):null}setStyle(p,o){return!1!==(o=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){const o=this._locale[p];if(null==o)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Ai(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,o){if("string"==typeof p){const h=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(h,d.ResourceType.Style);d.getJSON(_,(x,w)=>{x?this.fire(new d.ErrorEvent(x)):w&&this._updateDiff(w,o)})}else"object"==typeof p&&this._updateDiff(p,o)}_updateDiff(p,o){try{this.style.setState(p)&&this._update(!0)}catch(h){d.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.warnOnce("There is no style added to the map."),!1)}addSource(p,o){return this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const o in p){const h=p[o]._tiles;for(const _ in h){const x=h[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(p,o,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,o,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:w,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&o instanceof d.window.ImageBitmap){const{width:S,height:A,data:R}=d.exported.getImageData(o);this.style.addImage(p,{data:new d.RGBAImage({width:S,height:A},R),pixelRatio:h,stretchX:x,stretchY:w,content:T,sdf:_,version:0})}else if(void 0===o.width||void 0===o.height)this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:A}=o,R=o;this.style.addImage(p,{data:new d.RGBAImage({width:S,height:A},new Uint8Array(R.data)),pixelRatio:h,stretchX:x,stretchY:w,content:T,sdf:_,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,o){const h=this.style.getImage(p);if(!h)return void this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=o instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&o instanceof d.window.ImageBitmap?d.exported.getImageData(o):o,{width:x,height:w}=_;void 0!==x&&void 0!==w?x===h.data.width&&w===h.data.height?(h.data.replace(_.data,!(o instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&o instanceof d.window.ImageBitmap)),this.style.updateImage(p,h)):this.fire(new d.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,o){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(h,_)=>{o(h,_ instanceof d.window.HTMLImageElement?d.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,o){return this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)}moveLayer(p,o){return this.style.moveLayer(p,o),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,o,h){return this.style.setLayerZoomRange(p,o,h),this._update(!0)}setFilter(p,o,h={}){return this.style.setFilter(p,o,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,o,h,_={}){return this.style.setPaintProperty(p,o,h,_),this._update(!0)}getPaintProperty(p,o){return this.style.getPaintProperty(p,o)}setLayoutProperty(p,o,h,_={}){return this.style.setLayoutProperty(p,o,h,_),this._update(!0)}getLayoutProperty(p,o){return this.style.getLayoutProperty(p,o)}setLight(p,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,o){return this.style.setFeatureState(p,o),this._update()}removeFeatureState(p,o){return this.style.removeFeatureState(p,o),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let h,_,x,w=this._container;for(;w&&(!_||!x);){const T=d.window.getComputedStyle(w).transform;T&&"none"!==T&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(x=h[3])),w=w.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=x?Math.abs(o/x):o}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=De("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=De("div","mapboxgl-canvas-container",p);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=De("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=De("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=De("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){const h=d.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const o=this._markers.indexOf(p);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const p=d.extend({},Te.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);o?(d.storeAuthState(o,!0),this.painter=new _f(o,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(o)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;const h=this.painter.context.extTimerQuery,_=d.exported.now();if(this.listens("gpu-timing-frame")&&(o=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let x=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,L=d.exported.now();this.style.zoomHistory.update(A,L);const N=new d.EvaluationParameters(A,{now:L,fadeDuration:w,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=N.crossFadingFactor();1===H&&H===this._crossFadingFactor||(x=!0,this._crossFadingFactor=H),this.style.update(N)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const A=d.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,o),setTimeout(()=>{const R=h.getQueryObjectEXT(o,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(o),this.fire(new d.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R})),d.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:R}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new d.Event("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const R=this.painter.queryGpuTimeDeferredRender(A);this.fire(new d.Event("gpu-timing-deferred-render",{gpuTime:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(S||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(T=this._updateAverageElevation(_,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,o=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const T=Math.abs(_-x);if(T>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,p,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const o=this.painter.context.gl;d.storeAuthState(o,!1),this._logoControl instanceof Cf&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(p),o.canvasCopies.map(x),o.timeStamps)}_canvasPixelComparison(p,o,h){let _=h[1]-h[0];const x=p.length/4;for(let w=0;w<o.length;w++){const T=o[w];let S=0;for(let A=0;A<T.length;A+=4)T[A]===p[A]&&T[A+1]===p[A+1]&&T[A+2]===p[A+2]&&T[A+3]===p[A+3]&&(S+=1);_+=(h[w+2]-h[w+1])*(1-S/x)}return _}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),ud(this._canvasContainer),ud(this._controlContainer),ud(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_preloadTiles(p){const o=this.style?Object.values(this.style._sourceCaches):[];return d.asyncAll(o,(h,_)=>h._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,o){d.setCacheLimits(p,o)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},Ef,p),this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),De("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),De("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:o}):h.resetNorth({},{originalEvent:o}))}),this._compassIcon=De("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const o=p.getZoom(),h=o===p.getMaxZoom(),_=o===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gp(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){const h=De("button",p,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(p,o){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({geolocation:d.window.navigator.geolocation},Tf,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Fc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(o=>{this._supportsGeolocation="denied"!==o.state,p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const o=this._map.getMaxBounds(),h=p.coords;return!!o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const o=new d.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,_=this._map.getBearing(),x=d.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),x,{geolocateSource:!0})}_updateMarker(p){if(p){const o=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,o=d.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,h=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=De("button","mapboxgl-ctrl-geolocate",this._container),De("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=De("div","mapboxgl-user-location"),this._dotElement.appendChild(De("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(De("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Cs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=De("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientation),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jp,ScaleControl:class{constructor(p){this.options=d.extend({},hd,p),d.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(p,o,h,_){const x=_&&_.maxWidth||100,w=p._containerHeight/2,T=p._containerWidth/2-x/2,S=p.unproject([T,w]),A=p.unproject([T+x,w]),R=S.distanceTo(A);if(_&&"imperial"===_.unit){const L=3.2808*R;L>5280?Ta(o,x,L/5280,h,"mile",p):Ta(o,x,L,h,"foot",p)}else _&&"nautical"===_.unit?Ta(o,x,R/1852,h,"nautical-mile",p):R>=1e3?Ta(o,x,R/1e3,h,"kilometer",p):Ta(o,x,R,h,"meter",p)}(this._map,this._container,this._language,this.options)}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=De("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=De("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=De("button","mapboxgl-ctrl-fullscreen",this._controlContainer);De("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(Df),p),d.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const o=d.window.document.createDocumentFragment(),h=d.window.document.createElement("body");let _;for(h.innerHTML=p;_=h.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=De("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){const h=this._closeButton=De("button","mapboxgl-popup-close-button",o);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const o=this._map,h=this._container,_=this._pos;if(!o||!h||!_)return"bottom";const x=h.offsetWidth,w=h.offsetHeight,T=_.x<x/2,S=_.x>o.transform.width-x/2;if(_.y+p<w)return T?"top-left":S?"top-right":"top";if(_.y>o.transform.height-w){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){const o=this._map,h=this._content;if(!o||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=De("div","mapboxgl-popup",o.getContainer()),this._tip=De("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vc(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:o.project(this._lngLat),w=dd(this.options.offset),T=this._anchor=this._getAnchor(w.y),S=dd(this.options.offset,T),A=x.add(S).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Qi[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&o._usingGlobe()){const x=d.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ru);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Cs,Style:Ai,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:rd,Evented:d.Evented,config:d.config,prewarm:function(){cr().acquire(rn)},clearPrewarmedResources:function(){const p=Rn;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(rn),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return fn.workerCount},set workerCount(p){fn.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return Vl}),$e}()},775:function(Ft){var $e;$e=function(){var Ne=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function $e(Te){return Te.match(Ne)||[]}function be(Te){return{language:(Te=$e(Te))[1]||"",extlang:Te[2]||"",script:Te[3]||"",region:Te[4]||""}}function d(Te,Me,ce){Object.defineProperty(Te,Me,{value:ce,enumerable:!0})}function W(Te,Me,ce){function De(lt){return $e(lt)[Te]||""}d(De,"pattern",Me),d(be,ce,De)}return W(1,/^[a-zA-Z]{2,3}$/,"language"),W(2,/^[a-zA-Z]{3}$/,"extlang"),W(3,/^[a-zA-Z]{4}$/,"script"),W(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),d(be,"split",function Ue(Te){return $e(Te).filter(function(Me,ce){return Me&&ce})}),be},Ft.exports?Ft.exports=$e():this.subtag=$e()},562:(Ft,At,Ne)=>{"use strict";var $e=Ne(576);Ft.exports=$e,typeof window<"u"&&(window.Suggestions=$e)},554:Ft=>{"use strict";var At=function(Ne){return this.component=Ne,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,Ne.el.parentNode.insertBefore(this.wrapper,Ne.el.nextSibling),this};At.prototype.show=function(){this.element.style.display="block"},At.prototype.hide=function(){this.element.style.display="none"},At.prototype.add=function(Ne){this.items.push(Ne)},At.prototype.clear=function(){this.items=[],this.active=0},At.prototype.isEmpty=function(){return!this.items.length},At.prototype.isVisible=function(){return"block"===this.element.style.display},At.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Ne=0;Ne<this.items.length;Ne++)this.drawItem(this.items[Ne],this.active===Ne);this.show()}else this.hide()},At.prototype.drawItem=function(Ne,$e){var Ue=document.createElement("li"),be=document.createElement("a");$e&&(Ue.className+=" active"),be.innerHTML=Ne.string,Ue.appendChild(be),this.element.appendChild(Ue),Ue.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Ue.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Ne)}.bind(this))},At.prototype.handleMouseUp=function(Ne){this.selectingListItem=!1,this.component.value(Ne.original),this.clear(),this.draw()},At.prototype.move=function(Ne){this.active=Ne,this.draw()},At.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},At.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},At.prototype.drawError=function(Ne){var $e=document.createElement("li");$e.innerHTML=Ne,this.element.appendChild($e),this.show()},Ft.exports=At},576:(Ft,At,Ne)=>{"use strict";var $e=Ne(703),Ue=Ne(780),be=Ne(554),d=function(W,Te,Me){return this.options=$e({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Me=Me||{}),this.el=W,this.data=Te||[],this.list=new be(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ce){this.handleKeyUp(ce.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ce){this.handleKeyDown(ce)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ce){this.handlePaste(ce)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};d.prototype.handleKeyUp=function(W){40===W||38===W||27===W||13===W||9===W||this.handleInputChange(this.el.value)},d.prototype.handleKeyDown=function(W){switch(W.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&W.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},d.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},d.prototype.handlePaste=function(W){if(W.clipboardData)this.handleInputChange(W.clipboardData.getData("Text"));else{var Te=this;setTimeout(function(){Te.handleInputChange(W.target.value)},100)}},d.prototype.handleInputChange=function(W){this.query=this.normalize(W),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Te){for(var Me=0;Me<Te.length&&(this.list.add(Te[Me]),Me!==this.options.limit-1);Me++);this.list.draw()}.bind(this))},d.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},d.prototype.update=function(W){this.data=W,this.handleKeyUp()},d.prototype.clear=function(){this.data=[],this.list.clear()},d.prototype.normalize=function(W){return W.toLowerCase()},d.prototype.match=function(W,Te){return W.indexOf(Te)>-1},d.prototype.value=function(W){if(this.selected=W,this.el.value=this.getItemValue(W),document.createEvent){var Te=document.createEvent("HTMLEvents");Te.initEvent("change",!0,!1),this.el.dispatchEvent(Te)}else this.el.fireEvent("onchange")},d.prototype.getCandidates=function(W){var Te={pre:"<strong>",post:"</strong>",extract:function(ce){return this.getItemValue(ce)}.bind(this)};W(this.options.filter?Ue.filter(this.query,this.data,Te).map(function(ce){return{original:ce.original,string:this.render(ce.original,ce.string)}}.bind(this)):this.data.map(function(ce){return{original:ce,string:this.render(ce)}}.bind(this)))},d.prototype.getItemValue=function(W){return W},d.prototype.render=function(W,Te){if(Te)return Te;for(var Me=this.getItemValue(W.original?W.original:W),ce=this.normalize(Me),De=ce.lastIndexOf(this.query);De>-1;){var lt=De+this.query.length;Me=Me.slice(0,De)+"<strong>"+Me.slice(De,lt)+"</strong>"+Me.slice(lt),De=ce.slice(0,De).lastIndexOf(this.query)}return Me},d.prototype.renderError=function(W){this.list.drawError(W)},Ft.exports=d},703:Ft=>{Ft.exports=function Ne(){for(var $e={},Ue=0;Ue<arguments.length;Ue++){var be=arguments[Ue];for(var d in be)At.call(be,d)&&($e[d]=be[d])}return $e};var At=Object.prototype.hasOwnProperty},652:(Ft,At,Ne)=>{"use strict";Ne.d(At,{x0:()=>d});let d=(W=21)=>crypto.getRandomValues(new Uint8Array(W)).reduce((Te,Me)=>Te+((Me&=63)<36?Me.toString(36):Me<62?(Me-26).toString(36).toUpperCase():Me>62?"-":"_"),"")}},Ft=>{Ft(Ft.s=787)}]);